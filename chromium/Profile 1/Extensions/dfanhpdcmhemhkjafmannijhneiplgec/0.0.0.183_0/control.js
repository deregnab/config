!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=15)}([function(e,t,n){e.exports=n(1)(6)},function(e,t){e.exports=shared},function(e,t,n){e.exports=n(1)(19)},function(e,t,n){e.exports=n(1)(13)},function(e,t,n){e.exports=n(1)(14)},function(e,t,n){e.exports=n(1)(2)},function(e,t,n){e.exports=n(1)(24)},function(e,t,n){e.exports=n(1)(41)},function(e,t,n){e.exports=n(1)(42)},function(e,t,n){e.exports=n(1)(9)},function(e,t,n){e.exports=n(1)(43)},function(e,t,n){e.exports=n(1)(29)},function(e,t,n){e.exports=n(1)(23)},function(e,t,n){e.exports=n(1)(47)},function(e,t,n){e.exports=n(1)(15)},function(e,t,n){n(16),n(0),n(17),n(18),n(19),n(2),n(3),n(4),n(5),n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(20),n(21),n(22),n(13),n(23),n(14),n(24),n(25),function(e,t){"use strict";function n(){d.addClass(b)}function r(){d.removeClass(b),d.removeClass(y)}function o(){r(),d.addClass(y)}function i(e){return p(e)&&h(e.then)}function a(e){if(!p(e))throw new Error("Bootstrap configuration must be an object.");if(!f(e.module))throw new Error("'config.module' must be a string.");if(e.resolve&&e.moduleResolves)throw new Error("Bootstrap configuration can contain either 'resolve' or 'moduleResolves' but not both");if(e.resolve&&!p(e.resolve))throw new Error("'config.resolve' must be an object.");if(e.bootstrapConfig&&!p(e.bootstrapConfig))throw new Error("'config.bootstrapConfig' must be an object.");if(e.moduleResolves&&!g(e.moduleResolves))throw new Error("'config.moduleResolves' must be an array.");if(v(e.moduleResolves,function(e){if(!e.module)throw new Error("A 'moduleResolve' configuration item must contain a 'module' name.");if(!p(e.resolve))throw new Error("'moduleResolve.resolve' must be an object.")}),angular.isDefined(e.onError)&&!h(e.onError))throw new Error("'config.onError' must be a function.")}function s(e,t){t=angular.element(t),e.unshift(["$provide",function(e){e.value("$rootElement",t)}])}function c(e,t){var n=["ng"];return f(e)?n.push(e):g(e)&&(n=n.concat(e)),s(n,t),angular.injector(n,t)}function l(e,n,o){var i=m.defer();return angular.element(t).ready(function(){angular.bootstrap(e,[n],o),r(),i.resolve(!0)}),i.promise}function u(e){function r(e,t,n){var r;if(C.push({name:t,moduleName:n||y}),!h(e)&&!g(e))throw new Error("Resolve for '"+t+"' is not a valid dependency injection format.");if(r=p.instantiate(e),!i(r))throw new Error("Resolve function for '"+t+"' must return a promise.");w.push(r)}function s(e){return v(e,function(e,t){var n=e&&e.data?e.data:e,r=C[t].moduleName,o=C[t].name;angular.module(r).constant(o,n)}),l(b,y,_)}function u(e){o(),h(f.onError)&&f.onError(e)}var p,f=e||{},b=f.element,y=f.module,k=f.injectorModules||[],w=[],C=[],_=f.bootstrapConfig;return d=angular.element(t.body),n(),a(f),p=c(k,b),m=p.get("$q"),f.moduleResolves?v(f.moduleResolves,function(e,t){v(e.resolve,function(e,n){r(e,n,f.moduleResolves[t].module)})}):v(f.resolve,function(e,t){r(e,t)}),m.all(w).then(s,u)}var d,m,p=angular.isObject,h=angular.isFunction,g=angular.isArray,f=angular.isString,v=angular.forEach,b="deferred-bootstrap-loading",y="deferred-bootstrap-error";e.deferredBootstrapper={bootstrap:u}}(window,document),function(e){var t=function(){function e(e,t){this.treesConfig=e,this.treeProperty=t,this.storage=localStorage,this._zoom=parseFloat(this.storage.getItem("defaultZoom"))||1,this._treeLayout="true"==this.storage.getItem("defaultTreeLayout"),this._treeSort=this.storage.getItem("defaultTreeSort")||"timestamp",this._treesSort=this.storage.getItem("defaultTreesSort")||this.treeProperty[this.treeProperty.modified],this._maxTreeDepth=parseInt(this.storage.getItem("defaultMaxTreeDepth"))||6,this._maxTreeBreadth=parseInt(this.storage.getItem("defaultMaxTreeBreadth"))||4,this._session_disabled="true"==this.storage.getItem("sessionDisabled"),this._hide_pinned="true"==this.storage.getItem("hidePinned"),this._hide_bookmarks="true"==this.storage.getItem("hideBookmarks"),this._hideLastTree="true"==this.storage.getItem("hideLastTree"),this._shareUrlWarningDisabled="true"==this.storage.getItem("shareUrlWarningDisabled"),this._reportGoogleDisabled="true"==this.storage.getItem("reportGoogleDisabled"),this._contentLanguage=this.storage.getItem("contentLanguage"),this._autoplayOff="true"==this.storage.getItem("autoplayOff"),this._announcement1="true"==this.storage.getItem("announcement1")}return Object.defineProperty(e.prototype,"zoom",{get:function(){return this._zoom},set:function(e){this.storage.setItem("defaultZoom",e.toString()),this._zoom=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeLayout",{get:function(){return this._treeLayout},set:function(e){this.storage.setItem("defaultTreeLayout",e.toString()),this._treeLayout=e,this.treesConfig.treeCtrl.vertical=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeSort",{get:function(){return this._treeSort},set:function(e){this.storage.setItem("defaultTreeSort",e),this._treeSort=e,this.treesConfig.treeCtrl.sortBy=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treesSort",{get:function(){return this._treesSort},set:function(e){this.storage.setItem("defaultTreesSort",e),this._treesSort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTreeDepth",{get:function(){return this._maxTreeDepth},set:function(e){this.storage.setItem("defaultMaxTreeDepth",e.toString()),this._maxTreeDepth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTreeBreadth",{get:function(){return this._maxTreeBreadth},set:function(e){this.storage.setItem("defaultMaxTreeBreadth",e.toString()),this._maxTreeBreadth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sessionDisabled",{get:function(){return this._session_disabled},set:function(e){this.storage.setItem("sessionDisabled",e.toString()),this._session_disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidePinned",{get:function(){return this._hide_pinned},set:function(e){this.storage.setItem("hidePinned",e.toString()),this._hide_pinned=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hideBookmarks",{get:function(){return this._hide_bookmarks},set:function(e){this.storage.setItem("hideBookmarks",e.toString()),this._hide_bookmarks=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hideLastTree",{get:function(){return this._hideLastTree},set:function(e){this.storage.setItem("hideLastTree",e.toString()),this._hideLastTree=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shareUrlWarningDisabled",{get:function(){return this._shareUrlWarningDisabled},set:function(e){this.storage.setItem("shareUrlWarningDisabled",e.toString()),this._shareUrlWarningDisabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reportGoogleDisabled",{get:function(){return this._reportGoogleDisabled},set:function(e){this.storage.setItem("reportGoogleDisabled",e.toString()),this._reportGoogleDisabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentLanguage",{get:function(){return this._contentLanguage},set:function(e){this.storage.setItem("contentLanguage",e),this._contentLanguage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoplayOff",{get:function(){return this._autoplayOff},set:function(e){this.storage.setItem("autoplayOff",e.toString()),this._autoplayOff=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"announcement1",{get:function(){return this._announcement1},set:function(e){this.storage.setItem("announcement1",e.toString()),this._announcement1=e},enumerable:!0,configurable:!0}),e}();e.value("UserSettingsStatic",t),e.value("animationEase","cubic-in-out").value("animationDuration",850),e.value("debug_data",!1).value("debug_mode",!1);var n;!function(e){e[e.str=0]="str",e[e.date=1]="date",e[e.rating=2]="rating",e[e.count=3]="count"}(n||(n={})),e.value("propertyType",n),angular.module("tnConfig").factory("placeholderImage",["$rootScope","trustAsResourceUrlFilter",function(e,t){return e.placeholderImage=t("img/default-placeholder.png"),e.placeholderImage}]),angular.module("tnConfig").value("placeholderUserImage","https://thebenclark.files.wordpress.com/2014/03/facebook-default-no-profile-pic.jpg").value("analyticsDialog",{hasBackdrop:!1,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/shared/analytics-dialog.html",controller:"AnalyticsDialog",controllerAs:"analyticsDialog",onComplete:function(e){e.analyticsDialog.onload()}}),e.factory("nodesConfig",["propertyType",function(e){var t={},n=t.index={};return t.store="nodes",t.type={title:e.str,image:e.str,type:e.str,locked_image:e.str,visited:e.date,favicon:e.str,views:e.count,description:e.str,address:e.str},n[r[r.title]]={key:o[r.title],options:{unique:!1,multiEntry:!1}},n[r[r.visited]]={key:o[r.visited],options:{unique:!1,multiEntry:!1}},t.listCtrl={sortBy:r[r.visited],sortOrder:!1,searchText:"",selectedText:null,disableSort:!1,getSelectedText:function(){return this.selectedText},getSearchText:function(){var e=this.searchText;if(e&&e.length>=3)return e},getText:function(){var e=this.getSelectedText();return e?e.text:this.getSearchText()},isSearch:function(){return!(!this.getSelectedText()&&!this.getSearchText())},type:{visited:t.type.visited,title:t.type.title},clearSearch:function(){this.searchText="",this.selectedText=null}},t}]);var r;!function(e){e[e.title=0]="title",e[e.image=1]="image",e[e.type=2]="type",e[e.locked_image=3]="locked_image",e[e.visited=4]="visited",e[e.favicon=5]="favicon",e[e.description=6]="description",e[e.tags=7]="tags",e[e.rss=8]="rss",e[e.geo=9]="geo",e[e.address=10]="address",e[e.isArticle=11]="isArticle",e[e.url=12]="url",e[e.facebook_id=13]="facebook_id",e[e.color=14]="color",e[e.og_image=15]="og_image",e[e.lang=16]="lang"}(r||(r={}));var o;!function(e){e[e.n=0]="n",e[e.i=1]="i",e[e.t=2]="t",e[e.l=3]="l",e[e.v=4]="v",e[e.f=5]="f",e[e.d=6]="d",e[e.k=7]="k",e[e.r=8]="r",e[e.g=9]="g",e[e.a=10]="a",e[e.c=11]="c",e[e.u=12]="u",e[e.b=13]="b",e[e.o=14]="o",e[e.m=15]="m",e[e.e=16]="e"}(o||(o={})),angular.module("tnConfig").value("nodeDialogConfig",{hasBackdrop:!1,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/shared/node-dialog.html",controller:"NodeDialogCtrl",controllerAs:"vm",onComplete:function(e,t){t.find("#dialogContent_node-dialog").mCustomScrollbar({theme:"minimal-dark"})},onRemoving:function(e){e.find("#dialogContent_node-dialog").mCustomScrollbar("destroy")}}).value("relatedDialogConfig",{hasBackdrop:!1,disableParentScroll:!0,clickOutsideToClose:!0,controller:function(){this.loading=!0},controllerAs:"relatedDialogCtrl",bindToController:!0,templateUrl:"partials/shared/related-dialog.html",onComplete:function(e,t){t.find("md-content").mCustomScrollbar({theme:"minimal-dark"})},onRemoving:function(e){e.find("md-content").mCustomScrollbar("destroy")}}).value("nodeUrlDialogConfig",{hasBackdrop:!1,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/shared/node-url-dialog.html",controllerAs:"vm"}).value("nodesProperties",r).value("nodesShortProperties",o),e.value("SCOPES",["https://www.googleapis.com/auth/plus.me","https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/userinfo.email"]).value("API_KEY","AIzaSyCHbESTG-Tt_cir4j6swhSe73MmNxOMdAI").value("SECONDARY_API_KEY","AIzaSyAVFXhdstGRYa40dbjNhJmzKx4ASVrBpuA").value("DISQUS_FORUM","brancher").value("DISQUS_API_KEY","VGVs0rDj4Weg7I5d42NNgIukCqMhFv3PQQkh4WACRZJvvXEWzBXV0zUyTOfb7uMt").value("FB_ID","1099461436740953").value("FB_SCOPES",["user_friends"]).value("EBAY_CAMPID","5338007501").value("AMAZON_ID","brancher0b-20").value("ALIBABA_ID","928268164").value("ITUNES_TOKEN","").value("GOOGLE_OPTIMIZE_CODE","GTM-M56ZPVZ").factory("BUFFER_ID",["debug_mode",function(e){return e?"59c86e67aa7cc01b6bf6a1bc":"59c859ee285dcfbc478fcdee"}]).factory("BUFFER_REDIRECT_URI",["BASE_URL",function(e){return e+"/buffer"}]).constant("ANALYTICS_TRACKING_ID","UA-87007310-1").constant("GOOGLE_AD_CLIENT","ca-pub-4049546790962842").value("EXTENSION_ID","undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.id||"dfanhpdcmhemhkjafmannijhneiplgec").value("CLIENT_ID","988709185566-o0jm430od2s08urqnsujfnli5a6572is.apps.googleusercontent.com").factory("BASE_URL",["debug_mode",function(e){return e?"http://localhost:8080":"https://brancher.io"}]).factory("BASE_API_URL",["debug_mode",function(e){return e?"http://localhost:8080":"https://getbrancher.appspot.com"}]).factory("BASE",["BASE_API_URL",function(e){return e+"/_ah/api"}]).factory("EXTENSION_URL",["EXTENSION_ID",function(e){return"https://chrome.google.com/webstore/detail/"+e}]).factory("STORAGE_URL",["BASE_API_URL",function(e){return e+".storage.googleapis.com/"}]),e.factory("treesConfig",["$rootScope","UserSettingsStatic","propertyType",function(e,t,n){var r={},o=e.userSettings=new t(r,i),s=r.index={},c=localStorage;return r.store="trees",r.MAX_CHILDREN=100,r.checkOverQuota=function(){var e=c.getItem("overQuotaNotification");return!e||+new Date-+new Date(e)>864e5},r.setOverQuota=function(){c.setItem("overQuotaNotification",(new Date).toISOString())},s[i[i.children]]={key:a[i.children],options:{unique:!1,multiEntry:!0}},s[i[i.created]]={key:a[i.created],options:{unique:!0,multiEntry:!1}},s[i[i.modified]]={key:a[i.modified],options:{unique:!0,multiEntry:!1}},s[i[i.title]]={key:a[i.title],options:{unique:!1,multiEntry:!1}},e.groupCtrl=r.groupCtrl={sortBy:o.treesSort,sortOrder:!1,disableSort:!1,treesSearch:{selectedNode:null,searchText:"",getSelectedNode:function(){return this.selectedNode},getSearchText:function(){var e=this.searchText;if(e&&e.length>=3)return e},isSearch:function(){return!(!this.getSelectedNode()&&!this.getSearchText())},clear:function(){this.selectedNode=null,this.searchText=""},getText:function(){var e=this.getSelectedNode();return e?e.text:this.getSearchText()}},type:{created:n.date,modified:n.date,title:n.str,rating:n.rating,description:n.str,count:n.str,addedCount:n.count,views:n.count},updateSort:function(){var e=this,t=e.sortBy,r=e.sortOrder;switch(this.type[t]){case n.date:this.reverse=!r;break;case n.str:this.reverse=r;break;case n.rating:this.reverse=!0}}},r.treeCtrl={sortBy:o.treeSort,sortOrder:!1,vertical:o.treeLayout,isListed:!1,isExpanded:!1,type:{visited:n.date,timestamp:n.date,title:n.str},data:{visited:!0,timestamp:!1,title:!0}},e.groupCtrl.updateSort(),r}]);var i;!function(e){e[e.created=0]="created",e[e.modified=1]="modified",e[e.title=2]="title",e[e.description=3]="description",e[e.children=4]="children",e[e.parents=5]="parents",e[e.timestamps=6]="timestamps",e[e.original=7]="original",e[e.image=8]="image",e[e.favorite=9]="favorite",e[e.tags=10]="tags",e[e.seen=11]="seen",e[e.domains=12]="domains",e[e.lang=13]="lang"}(i||(i={}));var a;!function(e){e[e.t=0]="t",e[e.m=1]="m",e[e.n=2]="n",e[e.d=3]="d",e[e.c=4]="c",e[e.p=5]="p",e[e.s=6]="s",e[e.o=7]="o",e[e.i=8]="i",e[e.f=9]="f",e[e.g=10]="g",e[e.e=11]="e",e[e.a=12]="a",e[e.l=13]="l"}(a||(a={}));var s;!function(e){e[e.tree=0]="tree",e[e.link=1]="link",e[e.image=2]="image"}(s||(s={})),angular.module("tnConfig").value("treeProperty",i).value("treeShortProperty",a).value("linkEvent",s).value("dialogConfig",{hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/shared/tree-dialog.html",controller:"TreeDialogCtrl",controllerAs:"vm"}).value("userImagesDialogConfig",{controller:"UserImagesDialogCtrl",controllerAs:"userImagesDialog",templateUrl:"partials/shared/user-images-dialog.html",hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,onComplete:function(e,t){t.find("#dialog-container").mCustomScrollbar(e.scrollConfig)},onRemoving:function(e){e.find("#dialog-container").mCustomScrollbar("destroy")}}).value("mapDialogConfig",{hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/shared/map-dialog.html",controllerAs:"mapDialogCtrl",controller:["$scope","$timeout","$controller","maps","geolocation","geoNodes","title",function(e,t,n,r,o,i,a){e.mapDialogCtrl.title=a,t(function(){return n("MapDialogCtrl",{$scope:e,maps:r,geolocation:o,geoNodes:i})},850)}]}).value("reportDialogConfig",{hasBackdrop:!1,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/shared/report-dialog.html",controller:"ReportDialogCtrl",controllerAs:"vm"}).value("subscriptionsDialogConfig",{hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/components/subscriptions-dialog.html",controller:"SubscriptionsDialogCtrl",controllerAs:"vm",onComplete:function(e,t){e.vm.$element=t,e.vm.onload()},onRemoving:function(e){e.find("md-dialog-content").mCustomScrollbar("destroy")}}).value("treeEditorsDialogConfig",{hasBackdrop:!1,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/shared/tree-editors-dialog.html",controller:"TreeEditorsDialogCtrl",controllerAs:"vm",onComplete:function(e,t){e.vm.$element=t,e.vm.onload()},onRemoving:function(e){e.find("md-dialog-content").mCustomScrollbar("destroy")}}).value("overQuotaNotification",{type:"basic",iconUrl:"img/icon128-disabled.png",title:"Storage quota exceeded!",message:"You have reached the maximum number of trees for a free user",contextMessage:"Please, upgrade to pro-account for the unlimited storage",requireInteraction:!0}).factory("deleteTreeConfirmDialog",["$mdDialog",function(e){return function(t){return e.confirm().title("Are you sure?").textContent("This tree will be deleted.").ariaLabel("Delete tree").targetEvent(t).ok("OK").cancel("Cancel")}}])}(angular.module("tnConfig",[])),function(e){e.factory("IDB",["$q","treesConfig","nodesConfig",function(e,t,n){var r=e.defer(),o={};indexedDB||r.reject({error:"IndexedDB not found"});var i=indexedDB.open("Trees",1);return o.IDBRange=IDBKeyRange,i.onupgradeneeded=function(e){var r=e.target,o=r.result,i=o.createObjectStore(t.store,{autoIncrement:!0}),a=o.createObjectStore(n.store);angular.forEach(t.index,function(e,t){return i.createIndex(t,e.key,e.options)}),angular.forEach(n.index,function(e,t){return a.createIndex(t,e.key,e.options)})},i.onsuccess=function(e){var t=e.target;o.IndexedDB=t.result,r.resolve(o)},i.onerror=function(){r.reject({error:"IndexedDB error"})},i.onblocked=function(){r.reject({error:"IndexedDB blocked"})},r.promise}])}(angular.module("tnIndexedDB",["tnConfig"])),function(e){e.factory("BaseEditOneCommand",["Class","BaseCommand","Link","Nodes","util",function(e,t,n,r,o){var i={};return i.initialize=function(e,t,n){var r=this;r.subtree=t,n.stack=e,r.callSuper(n)},i.getCount=function(){return 1},i.merge=function(){var e=this,t=e.getTree(),r=e.subtree,o=r.child;t&&(t.put(o,new n(r.parent,r.timestamp)),r.children.forEach(function(e){var n=t.get(e);n&&(n.parent=o)}))},i.remove=function(){var e=this,t=e.getTree(),n=e.subtree,r=n.parent;t&&t.remove(n.child)&&n.children.forEach(function(e){var n=t.get(e);n&&(n.parent=r)})},i.toJSON=function(e){var t=this,n=angular.copy(t.subtree);return angular.merge(n,e),n.timestamp=o.parseDate(n.timestamp).toISOString(),t.isMerge&&(n.nodes=r.getByKeys([n.child])),n},new e(t,i)}]),e.factory("BaseEditRootCommand",["Class","BaseCommand","Nodes","Link","util",function(e,t,n,r,o){var i={};return i.initialize=function(e,t,n){var r=this;r.subtree=t,n.stack=e,r.callSuper(n)},i.getCount=function(){return 1},i.merge=function(){var e=this,t=e.getTree(),n=e.subtree,o=n.child;if(t&&!t.hasKey(o)){var i=t.get(t.root);i.isRoot=!1,i.parent=o,t.put(o,new r("ROOT",n.timestamp)),t.root=o}},i.remove=function(){var e=this,t=e.getTree(),n=e.subtree,o=n.child;if(t&&t.remove(o)){var i=t.rassoc(new r(o));i.value.isRoot=!0,i.value.parent=null,t.root=i.key}},i.toJSON=function(e){var t=this,r=angular.copy(t.subtree);return angular.merge(r,e),r.timestamp=o.parseDate(r.timestamp).toISOString(),t.isMerge&&(r.nodes=n.getByKeys([r.child])),r},new e(t,i)}]),e.factory("BaseCommand",["Class","Command",function(e,t){var n={};return n.getTree=function(){return this._stack.tree},new e(t,n)}]),angular.module("tnCommands").factory("BaseEditCommand",["Class","BaseCommand","Nodes",function(e,t,n){var r={};return r.initialize=function(e,t,n){var r=this;r.subtree=t,n.stack=e,r.callSuper(n)},r.getCount=function(){return this.subtree.size},r.merge=function(){var e=this,t=e.getTree();t&&t.update(e.subtree.getTreeCopy(),function(e,t){return t})},r.remove=function(){var e=this,t=e.getTree();if(t){var n=e.subtree;t.removeIf(function(e){return n.hasKey(e.key)})}},r.toJSON=function(e){var t=this,r=t.subtree.toJSON(!0),o=r.children,i=r.parents,a=r.timestamps,s=r.modified,c={children:o,parents:i,timestamps:a,modified:s};return t.isMerge&&(c.nodes=n.getByKeys(o)),angular.merge(c,e),c},new e(t,r)}]),e.factory("MergeOne",["Class","BaseEditOneCommand",function(e,t){var n={};return n.initialize=function(e,t){var n=this;n.isMerge=!0,n.callSuper(e,t,{execute:function(){this.merge()},undo:function(){this.remove()}})},n.getAPIMethod=function(e){return e?"remove.link":"store.link"},new e(t,n)}]),e.factory("MergeRoot",["Class","BaseEditRootCommand",function(e,t){var n={};return n.initialize=function(e,t){var n=this;n.isMerge=!0,n.callSuper(e,t,{execute:function(){this.merge()},undo:function(){this.remove()}})},n.getAPIMethod=function(e){return e?"remove.root":"store.root"},new e(t,n)}]),e.factory("Merge",["Class","BaseEditCommand",function(e,t){var n={};return n.initialize=function(e,t){var n=this;n.isMerge=!0,n.callSuper(e,t,{execute:function(){this.merge()},undo:function(){this.remove()}})},n.getAPIMethod=function(e){return e?"remove.links":"store.links"},new e(t,n)}]),e.factory("RemoveOne",["Class","BaseEditOneCommand",function(e,t){var n={};return n.initialize=function(e,t){var n=this;n.isRemove=!0,n.callSuper(e,t,{execute:function(){this.remove()},undo:function(){this.merge()}})},n.getAPIMethod=function(e){return e?"store.link":"remove.link"},new e(t,n)}]),e.factory("RemoveRoot",["Class","BaseEditRootCommand",function(e,t){var n={};return n.initialize=function(e,t){var n=this;n.isRemove=!0,n.callSuper(e,t,{execute:function(){this.remove()},undo:function(){this.merge()}})},n.getAPIMethod=function(e){return e?"store.root":"remove.root"},new e(t,n)}]),e.factory("Remove",["Class","BaseEditCommand",function(e,t){var n={};return n.initialize=function(e,t){var n=this;n.isRemove=!0,n.callSuper(e,t,{execute:function(){this.remove()},undo:function(){this.merge()}})},n.getAPIMethod=function(e){return e?"store.links":"remove.links"},new e(t,n)}])}(angular.module("tnCommands",["tnConfig"])),function(e){e.service("util",["$rootScope",function(e){var t=this,n={sameDay:"[Today,] DD/MM/YYYY",nextDay:"[Tomorrow]",nextWeek:"dddd",lastDay:"[Yesterday,] DD/MM/YYYY",lastWeek:"[Last] dddd, DD/MM/YYYY",sameElse:"DD/MM/YYYY"};t.parseDate=function(e){if(angular.isDate(e))return e;if(angular.isString(e)){var t=new Date(e.replace("Z",""));return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}return new Date},t.formatDateCalendar=function(e){return moment(e).calendar(null,n)},t.translate=function(e,t){return"translate("+e+"px, "+t+"px) "},t.scale=function(e,t){return angular.isUndefined(t)?"scale("+e+") ":"scale("+e+", "+t+") "},t.replaceProperties=function(e,t,n){angular.forEach(n,function(n){var r=t[n];r?e[n]=r:delete e[n]})},t.renameProperties=function(e,t,n){return angular.forEach(Object.keys(n),function(r){var o=n[r];if(delete n[r],o){var i=e[r];angular.isNumber(i)&&(n[t[i]]=o)}}),n},t.isPdf=function(e){return".pdf"==e.slice(e.length-4)},t.getUserLanguage=function(){return e.userSettings.contentLanguage?e.userSettings.contentLanguage:"undefined"==typeof navigator?"en":(navigator.language||"").split("-")[0]||"en"}}])}(angular.module("tnUtil",[])),function(e){var t=n(5),r=n(6),o=n(7),i=n(8),a=n(9),s=n(10),c=n(11),l=n(12);e.config(["$provide",function(e){var n=new t.Class({include:a.Enumerable,extend:s.Forwardable,initialize:function(e){this.list=e},forEach:function(e,t){if(!e)return this.enumFor("forEach");for(var n=0,r=this.list.length;n<r;n++)e.call(t,this.list[n]);return this}});n.defineDelegators("list","push","splice"),e.value("Container",n),e.value("Command",i.Command),e.value("Stack",i.Command.Stack),e.value("Module",t.Module),e.value("Class",t.Class),e.value("Hash",r.Hash),e.value("OrderedHash",r.OrderedHash),e.value("Set",o.Set),e.value("OrderedSet",o.OrderedSet),e.value("Comparable",c.Comparable),e.value("Observable",l.Observable)}]),e.factory("buffer",["toastObserver",function(e){var t,n={};return n.get=function(){return t.getTreeCopy()},n.set=function(n){t=n,e.notifyObservers("Copied "+n.size+" node(s)")},n.isEmpty=function(){return!t},n}]),e.factory("Nodes",["Observable","Hash",function(e,t){var n=new t;return n.setDefault(function(e,t){return{title:"Not Found",url:"https://goo.gl/"+t}}),n.extend(e),n.extend({getByKeys:function(e){var t=this;return t.valuesAt.apply(t,e)},addNode:function(e,t){var n=this;n.hasKey(e)?angular.merge(n.get(e),t):t.title&&n.put(e,t),t.value||(t.value=e)}}),n}]),e.factory("OrderedContainer",["Module","Observable","propertyType",function(e,t,n){var r={};return r.include=t,r.addNew=function(e,t,r){var o=this,i=!0;if(!o.isEmpty())switch(t){case n.date:i=!r;break;case n.str:var a=this.forEachValue();i=r?e.gte(a.min()):e.lte(a.max())}return i},r.updateContainer=function(e,t,n,r,o,i){var a=this;if(a.size>1&&a.hasKey(e))for(var s=0;s<t.length;s+=1)if(n==t[s]){var c=a.remove(e);a.addNew(c,r,o)&&(a.put(e,c),a.resort(i)),a.notifyObservers();break}},r.resort=function(e){var t=this,n=t.sortBy(function(e){return e.value});t.clear(),e&&n.reverse(),n.forEach(function(e){return t.put(e.key,e.value)})},new e(r)}]),e.factory("Stacks",["Class","Hash","TreeStack",function(e,t,n){var r={};return r.registerTree=function(e,t){var r=this,o=r.get(e);o?o.tree=t:(o=new n,o.tree=t,r.put(e,o)),t.stack=o},r.unregisterTree=function(e){var t=this,n=t.get(e);n&&(n.tree=null)},new e(t,r)}]),e.factory("TreesMeta",["Class","OrderedHash","OrderedContainer","TreesMetaContainer",function(e,t,n,r){var o={};return o.include=[n],o.toTreesMetaArray=function(){return this.map(function(e){return r.assoc(e.key)})},o.groupTrees=function(e){var t=this,n=t.toTreesMetaArray(),r=[];return angular.isString(e)?[{key:e,value:n}]:(n.forEach(function(t){var n=e(t.value),o=r[r.length-1];o&&o.key==n?o.value.push(t):r.push({key:n,value:[t]})}),r)},o.deleteMeta=function(e){var t=this;r.remove(e),t.remove(e)&&t.notifyObservers()},new e(t,o)}]),angular.module("tnClasses").factory("TreesMetaContainer",["Hash",function(e){return new e}]),e.factory("Trees",["Class","Observable","OrderedHash","Tree","Stacks","Link","buffer",function(e,t,n,r,o,i,a){var s,c={},l=new o,u=new i;return c.include=t,c.put=function(e,t){var n=this;return l.registerTree(e,t),n.callSuper(e,t)},c.remove=function(e){var t=this;return l.unregisterTree(e),t.callSuper(e)},c.clear=function(){var e=this;return e.forEachKey(function(t){return e.remove(t)}),e.callSuper()},c.deleteTree=function(e){var t=this;t.hasKey(e)&&(t.remove(e),l.remove(e))},c.add=function(e,t){var n=this,o=t.id;if(o&&!n.hasKey(o)){var i=new r(e,t);n.put(o,i)}},c.getTree=function(e){var t=this;if(t.hasKey(e))return t.get(e)},c.hasNode=function(e,t){return e&&e.hasKey(t)},c.bufferTree=function(e){var t=this,n=t.getTree(e);angular.isDefined(n)&&a.set(n.getTreeCopy())},c.buffer=function(e,t){var n=this,r=n.getTree(e);n.hasNode(r,t)&&a.set(r.getBranchCopy(t))},c.paste=function(e,t,n){var r=this;if(!a.isEmpty()||n){var o=r.getTree(e);if(r.hasNode(o,t)){n=n||a.get();var s=n.rassoc(u);if(s){var c=s.key;return c!=t&&n.put(c,new i(t,s.value.timestamp)),o.getMerge(n)}}}},c.pasteBranch=function(e,t,n){return this.paste(e,t,n)},c.deleteBranch=function(e,t){var n=this,r=n.getTree(e);if(n.hasNode(r,t))return r.getRemove(t)},c.deleteOne=function(e,t){var n=this,r=n.getTree(e);if(n.hasNode(r,t))return r.getRemoveOne(t)},c.deleteRoot=function(e){var t=this,n=t.getTree(e);if(angular.isDefined(n))return n.getRemoveRoot()},c.storeLinks=function(e){var t=this,n=e.id,o=t.getTree(n),i=new r(e),a=o.stack,c=r.mergeCommand(a,i);s.execute(a,c,o)},c.removeLinks=function(e){var t=this,n=e.id,o=t.getTree(n),i=new r(e),a=o.stack,c=r.removeCommand(a,i);s.execute(a,c,o)},c.storeLink=function(e){var t=this,n=e.id,o=t.getTree(n),i=o.stack,a=r.mergeOneCommand(i,e);s.execute(i,a,o)},c.removeLink=function(e){var t=this,n=e.id,o=t.getTree(n),i=o.stack,a=r.removeOneCommand(i,e);s.execute(i,a,o)},c.storeRoot=function(e){var t=this,n=e.id,o=t.getTree(n),i=o.stack,a=r.mergeRootCommand(i,e);s.execute(i,a,o)},c.removeRoot=function(e){var t=this,n=e.id,o=t.getTree(n),i=o.stack,a=r.removeRootCommand(i,e);s.execute(i,a,o)},s=new e(n,c),s.extend({bufferNode:function(e){var t=new r([e,new i]);a.set(t)},newLink:function(e,t,n){return new r([t,new i(e,n)])},getStack:function(e){return l.get(e)},execute:function(e,t,n){e.clear(),t.execute(),n.meta.domains=n.getDomains()}}),s}]),e.factory("Users",["Class","Observable","OrderedHash",function(e,t,n){var r={};return r.include=t,r.initialize=function(){var e=this;e.more=!0,e.pageToken="",e.loading=!1,e.callSuper()},r.clear=function(){var e=this;return e.pageToken="",e.more=!0,e.callSuper()},new e(n,r)}]),e.factory("Link",["Class","util",function(e,t){var n={};return n.isRoot=!1,n.initialize=function(e,n,r){void 0===r&&(r=!1);var o=this;o.page=0,o.timestamp=t.parseDate(n),o.related=r,o.collapsed=!1,o.expanded=!1,"ROOT"!=e&&e?o.parent=e:o.isRoot=!0},n.hash=function(){var e=this;return e.isRoot?"ROOT":e.parent},n.equals=function(e){var t=this;return t.isRoot&&e.isRoot||!t.isRoot&&t.parent==e.parent},new e(n)}]),e.factory("NodeMeta",["Class","Comparable","Nodes","nodesConfig",function(e,t,n,r){var o=r.listCtrl,i={};return i.include=t,i.initialize=function(e,t,n){void 0===t&&(t=!1),this.data={key:e,value:{related:t,timestamp:n}}},i.compareTo=function(e){var t=this,n=t.getCurrentSortValue(),r=e.getCurrentSortValue();return n<r?-1:n>r?1:0},i.getCurrentSortValue=function(){var e=this,t=n.get(e.data.key)[o.sortBy];return t||""},new e(i)}]),e.factory("TreeStack",["Class","Stack","Merge",function(e,t,n){var r={};return r.getCurrent=function(){var e=this;return e.getCommand(e.pointer-1)},r.getCommand=function(e){return this._stack[e]},r.getCount=function(){var e=this,t=e.getCurrent();if(t)return t.getCount()},r.newLink=function(e){return new n(this,e)},new e(t,r)}]),e.factory("TreeMeta",["Class","Comparable","ObservableClass","treesConfig","util",function(e,t,n,r,o){var i={},a=r.groupCtrl;return i.include=t,i.initialize=function(e,t){var r=this;r.id=e,r.editable=t.editable,r.created=o.parseDate(t.created),r.observer=n(),r.update(t),r.published=t.published,r.favorite=t.favorite,r.sync=parseInt(t.sync||"0"),r.loading=!1,r.userId=t.userId,r.plusId=t.plusId,r.newLinks=0,r.shortUrl=t.shortUrl,r.original=t.original,r.selectedPage=t.selectedPage,r.lang=t.lang},i.toJSON=function(){var e=this;return{id:e.id,title:e.title,description:e.description,image:e.image,created:e.created.toISOString(),modified:e.modified.toISOString(),published:e.published,favorite:e.favorite,tags:e.tags,domains:e.domains,editable:e.editable,limitedEdit:e.limitedEdit,seen:e.seen,userId:e.userId,plusId:e.plusId,shortUrl:e.shortUrl,original:e.original,count:e.count,views:e.views,addedCount:e.addedCount,lang:e.lang}},i.update=function(e){var t=this;t.modified=o.parseDate(e.modified),t.title=e.title||t.title||"Untitled",t.description=e.description,t.tags=e.tags||[],t.addedCount=parseInt(e.addedCount),t.count=e.count||t.count,t.views=parseInt(e.views),t.image=e.image,t.seen=e.seen,t.domains=e.domains,t.datePublished=o.parseDate(e.datePublished),t.dateFavorite=o.parseDate(e.dateFavorite),t.observer.notifyObservers()},i.compareTo=function(e){var t=this,n=t.getCurrentSortValue(),r=e.getCurrentSortValue();return n<r?-1:n>r?1:0},i.getCurrentSortValue=function(){var e=this,t=e[a.sortBy];return t||""},i.getKeywords=function(){var e=this,t=e.title.split(" ").slice(0,4).join(" ");return e.tags.length&&(t=e.tags.slice(0,3).join(" ")),t},i.getEbayKeywords=function(){return"("+this.getKeywords().split(" ").join(",")+")"},new e(i)}]),angular.module("tnClasses").factory("TreeMetaProxy",["Class","Comparable","TreesMetaContainer",function(e,t,n){var r={};return r.include=t,r.initialize=function(e){this.key=e},r.compareTo=function(e){var t=this;return n.get(t.key).compareTo(n.get(e.key))},new e(r)}]),e.factory("Tree",["Class","Comparable","URI","Nodes","Hash","Set","Link","Container","Merge","Remove","MergeOne","RemoveOne","MergeRoot","RemoveRoot","treesConfig","propertyType",function(e,t,n,r,o,i,a,s,c,l,u,d,m,p,h,g){function f(e){return!(!e.locked_image&&!e.image)}function v(e){return!!e.geo}function b(e){var t=n(e.url||"");if("www.youtube.com"==t.host())return!!t.query(!0).v}var y,k={},w=h.MAX_CHILDREN,C=new a;return k.include=t,k.initialize=function(e,t){var n=this;if(angular.isArray(e))return void n.callSuper(e,null);if(!angular.isObject(e))throw new Error;var o=e.children,i=e.parents,c=e.timestamps,l=e.nodes,u=[];if(!(o&&i&&c))throw new Error;if(o.length!=i.length||i.length!=c.length)throw new Error;n.meta=t,new s(o).zip(i,c,function(e){u.push(e[0]),u.push(new a(e[1],e[2]))}),n.callSuper(u,null),n.root=n.key(C),angular.isArray(l)&&angular.forEach(l,function(e){var t=e&&e.value;t&&(r.addNode(t,e),angular.isArray(e.related)&&n.hasKey(t)&&e.related.forEach(function(e){if(!n.hasKey(e)){var r=new a(t,null,!0);n.put(e,r)}}))})},k.forEachPairWithObject=function(e,t){return this.forEachPair().forEachWithObject(e,t)},k.compareTo=function(e){return this.meta.compareTo(e.meta)},k.getCurrentSortValue=function(){return this.meta.getCurrentSortValue()},k.toJSON=function(e){var t=this,n={},r=t.meta,o=n.children=[],i=n.parents=[],a=n.timestamps=[],s=function(e){return e};return r&&angular.extend(n,r.toJSON()),e?(s=function(e){return e.toISOString()},r&&(n.created=r.created.toISOString(),n.modified=r.modified.toISOString())):(n.created=r.created,n.modified=r.modified),t.forEachPair(function(e){return function(t,n){n.related||(o.push(t),i.push(n.hash()),a.push(e(n.timestamp)))}}(s)),n},k.getTreeCopy=function(){var e=this,t=new e.klass([]);return e.forEachPairWithObject(t,function(e,t,n){n.related||e.put(t,new a(n.parent,n.timestamp))})},k.getBranchCopy=function(e){var t=this;return t.root==e?t.getTreeCopy():t.getBranch(e)},k.groupByParent=function(){return this.groupBy(function(e){return e.value})},k.getBranch=function(e){var t=this,n=t.get(e);if(n){var r=t.groupByParent(),o=[e,new a(null,n.timestamp)];return function e(t){r.fetch(new a(t),[]).forEach(function(t){var n=t.value,r=t.key;n.related||(o.push(r),o.push(new a(n.parent,n.timestamp)),e(r))})}(e),new t.klass(o)}},k.getCompareFunction=function(e){var t,n,o=e.sortBy,i=e.reverse;switch(t=e.data[o]?function(e){return r.get(e.key)[o]||""}:function(e){return e.value[o]||""},e.type[o]){case g.date:n=function(e,t){return e>t?1:e<t?-1:0};break;case g.str:n=function(e,t){return e.localeCompare(t)}}return i?function(e,r){return-n(t(e),t(r))}:function(e,r){return n(t(e),t(r))}},k.getMerge=function(e){var t=this,n=new i(t.keys()),r=new i(e.keys());if(!r.isSubset(n)){var o=r.difference(n);if(o.size>0&&o.size+t.size<=w)return e.keepIf(function(e){return o.contains(e.key)}),new c(t.stack,e)}},k.getRemove=function(e){var t=this,n=t.getBranch(e);return n.put(e,t.get(e)),new l(t.stack,n)},k.getRemoveOne=function(e){var t=this,n={},r=n.children=[],o=t.get(e);return n.parent=o.parent,n.child=e,n.timestamp=o.timestamp,t.forEach(function(t){t.value.parent!=e||t.value.related||r.push(t.key)}),new d(t.stack,n)},k.getRemoveRoot=function(){var e=this,t={},n=e.root,r=e.get(n);if(r&&1==e.count(function(e){return e.value.parent==n}))return t.child=n,t.timestamp=r.timestamp,new p(e.stack,t)},k.getImages=function(){var e=this;return r.getByKeys(e.keys()).filter(f)},k.getGeo=function(){var e=this;return r.getByKeys(e.keys()).filter(v)},k.getYoutubeVideos=function(){var e=this;return r.getByKeys(e.keys()).filter(b)},k.getDomains=function(){var e=this,t=e.keys(),o=r.getByKeys(t).filter(function(e,n){return r.hasKey(t[n])}).map(function(e){return n(e.url).host()});return new i(o).toArray()},y=new e(o,k),y.extend({mergeCommand:function(e,t){return new c(e,t)},removeCommand:function(e,t){return new l(e,t)},mergeOneCommand:function(e,t){return new u(e,t)},removeOneCommand:function(e,t){return new d(e,t)},mergeRootCommand:function(e,t){return new m(e,t)},removeRootCommand:function(e,t){return new p(e,t)}}),y}])}(angular.module("tnClasses",["tnCommands","tnUtil"])),function(e){var t=function(){function e(e,t,n,r,o){this.$q=e,this.$http=n,this.GApi=r,this.GData=o,this.status=!1,this.storage=localStorage,this.logoutURL="https://www.facebook.com/logout.php",this.serviceURL="https://graph.facebook.com/v2.8/",t.facebook=this}return e.prototype.getAccessToken=function(){return this.access_token},e.prototype.removeAccessToken=function(){this.access_token=null,this.updateStatus()},e.prototype.setAccessToken=function(e){var t=e&&(e.access_token||e.accessToken);t?(this.access_token=t,this.updateStatus()):this.removeAccessToken()},e.prototype.fetchAccessToken=function(){return this.$q.when()},e.prototype.facebookLogin=function(e){return this.$q.when()},e.prototype.facebookLogout=function(){return this.$q.when()},e.prototype.publisherLogin=function(e){return this.$q.when([])},e.prototype.updateStatus=function(){this.status=!!this.getAccessToken()},e.prototype.getUser=function(t,n){return void 0===n&&(n="id,name,picture"),this.GApi.execute("user","get.node.facebook",{value:t}).then(function(t){return e.makeNodeUserObject(t)})},e.prototype.listUserPhotos=function(t,n,r){var o=this;return void 0===r&&(r="images,name"),this.execute(function(n,i){var a=e.fbCallback(i);o.$http.get(o.serviceURL+t+"/photos",{params:{access_token:n,fields:r}}).then(a,a)},n)},e.prototype.publish=function(e,t){var n=this.serviceURL+e.id+"/feed?access_token="+e.access_token;return this.$http.post(n,"link="+t).then(angular.noop)},e.fbCallback=function(e){return function(t){return e(t.data)}},e.makeNodeUserObject=function(e){var t=e.image;return{name:e.title,picture:{data:{url:t}},id:e.facebook_id}},e.prototype.listFriends=function(e){return this.$q.when({})},e.prototype.userSetup=function(){return this.$q.reject()},e.prototype.login=function(){var e=this;return this.simple_login().then(function(t){return e.facebookLogin(t)},function(){return e.removeAccessToken()})},e.prototype.simple_login=function(e){return this.$q.when("")},e.prototype.logout=function(){return this.$q.when()},e.prototype.getToken=function(e){return this.$q.when("")},e.prototype.getUsers=function(e,t){return this.$q.when([])},e.prototype.executeAPIMethod=function(e){var t=this,n=function(){return e().then(function(e){return e},function(n){return n&&401==n.code?t.getToken().then(e):t.$q.reject(n)})};return this.status?n():this.login().then(n)},e.prototype.execute=function(e,t,n,r){var o=this;void 0===t&&(t=""),void 0===n&&(n=this.$q.defer()),void 0===r&&(r=0);var i=this.getAccessToken(),a=function(e){var t=e.error;if(t)if(r<2)switch(t.type){case"OAuthException":o.GData.isLogin()?r<1?o.fetchAccessToken().then(function(){var e=o.getAccessToken();e&&e!=i?l():c()}):c():r<1?c():s(t);break;default:n.reject()}else s(t);else n.resolve(e)},s=function(e){o.removeAccessToken(),n.reject(),!e||"connected"==e.status&&"OAuthException"!=e.type||o.login()},c=function(){return o.getToken(!0).then(l,s)},l=function(){return o.execute(e,t,n,r+1)};return i?t?this.$http.get(t,{params:{access_token:i}}).then(function(e){return a(e.data)}):e(i,a):this.login().then(function(){o.status?l():n.reject()}),n.promise},e}();e.value("facebookSharedStatic",t);var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("facebookAPIStatic",["$q","$rootScope","$window","$http","GApi","GData","GApiApp","firebaseService","URI","toastObserver","FB_SCOPES","BASE_URL","facebookSharedStatic",function(e,t,r,o,i,a,s,c,l,u,d,m,p){function h(e){return function(t){"connected"===t.status?e.resolve(t.authResponse.accessToken):e.reject(t)}}return function(p){function g(){return p.call(this,e,t,o,i,a)||this}return n(g,p),g.prototype.fetchAccessToken=function(){var t=this;return a.isLogin()?s.execute(function(){return i.executeAuth("user","facebook.token")}).then(function(e){return t.setAccessToken(e)},function(){return t.removeAccessToken()}):e.reject()},g.prototype.facebookLogin=function(e){var t=this;if(!e)return this.removeAccessToken(),this.$q.reject();var n,r={access_token:e};return a.isLogin()?n=s.execute(function(){return i.executeAuth("user","facebook.login",r)}).then(function(e){return t.setAccessToken(e)},function(){return t.setAccessToken(r)}).then(function(){return c.loginFacebook(t.getAccessToken())}):(this.setAccessToken(r),n=c.loginFacebook(e).then(function(n){return t.GApi.execute("user","facebook.user",{firebase_token:n,access_token:e})})),n},g.prototype.publisherLogin=function(e){var t=this;return s.execute(function(){return i.executeAuth("user","facebook.publisher",{access_token:e})}).then(function(e){return t.groups=e.groups,e.groups})},g.prototype.publish=function(e,t){return p.prototype.publish.call(this,e,t).then(function(){return u.notifyObservers("Successfully posted to "+e.name)})},g.prototype.facebookLogout=function(){var e=this.$q.when();return this.removeAccessToken(),a.isLogin()&&(e=s.execute(function(){return i.executeAuth("user","facebook.logout")})),e.then(function(){return c.logoutFacebook()})},g.prototype.getToken=function(){var e=this,t=this.$q.defer();return FB.getLoginStatus(h(t)),t.promise.then(function(t){return e.setAccessToken({access_token:t}),t})},g.prototype.simple_login=function(e){void 0===e&&(e=d);var t=this.$q.defer();return FB.login(h(t),{scope:e.join(",")}),t.promise},g.prototype.userSetup=function(){var t=e.when(this.getAccessToken());return this.status||(t=this.getToken()),t.then(function(e){return c.loginFacebook(e)}).then(angular.noop)},g.prototype.logout=function(){var e=this.logoutURL,t=this.getAccessToken();return this.facebookLogout().then(function(){var n=l(e).query({next:m+"/",access_token:t});r.location.href=n.toString()})},g.prototype.getUsers=function(e){if(e.length)return this.GApi.execute("user","get.nodes.facebook",{nodes:e}).then(function(e){return e.nodes&&e.nodes.map(g.makeNodeUserObject)})},g.prototype.listFriends=function(e,t){var n=this;return void 0===t&&(t="id,name,picture"),this.execute(function(e,r){var o=g.fbCallback(r);n.$http.get(n.serviceURL+"me/friends",{params:{access_token:e,fields:t}}).then(o,o)},e)},g}(p)}])}(angular.module("tnDataFacebook",["tnConfig"])),function(e){e.config(["$provide",function(e){e.factory("ObservableClass",["Class","Observable",function(e,t){return function(){var n=new e;return n.extend(t),n}}]),e.factory("timestampObserver",["$interval","ObservableClass",function(e,t){var n=t();return e(function(){return n.notifyObservers()},6e4,0,!1),n}])}]);var t=function(){function e(e,t,n,r,o,i,a){this.$httpParamSerializerJQLike=e,this.GApi=t,this.GApiApp=n,this.users=r,this.URI=o,this.BUFFER_ID=i,this.BUFFER_REDIRECT_URI=a}return e.prototype.login=function(){location.href=this.URI("https://bufferapp.com/oauth2/authorize").query({client_id:this.BUFFER_ID,redirect_uri:this.BUFFER_REDIRECT_URI,response_type:"code"}).toString()},e.prototype.isLogin=function(){return this.users.isBufferLogin},e.prototype.getProfiles=function(){var e=this;return this.GApiApp.execute(function(){return e.GApi.execute("user","buffer.profiles")}).then(function(e){return e.profiles})},e.prototype.createUpdate=function(e){var t=this;return this.GApiApp.execute(function(){return t.GApi.execute("user","buffer.create",{update:t.$httpParamSerializerJQLike(e)})})},e}();e.value("bufferSharedStatic",t);var n=function(){function e(e,t,n,r,o,i,a,s,c,l,u,d,m,p){this.$q=e,this.$cacheFactory=t,this.GApi=n,this.GApiApp=r,this.URI=o,this.uriParser=i,this.OrderedHash=a,this.NodeMeta=s,this.Nodes=c,this.ObservableClass=l,this.util=d,this.listCtrl=m,this.BASE_URL=p,this.openedTabsObserver=this.ObservableClass(),this.windowCloseObserver=this.ObservableClass(),this.articleLinkClickObserver=this.ObservableClass(),this.state={more:!0,moreLocal:!0,pageToken:"",loading:!1,loadingLocal:!1,offset:0},(this.container=new this.OrderedHash).extend(u),this.$cacheFactory.get("relatedNodes")||(this.relatedCache=this.$cacheFactory("relatedNodes",{capacity:8}))}return e.prototype.upadteLoadState=function(){var e=this.state;if(!e.more||e.loading)return!0;e.loading=!0},e.prototype.cleanLoadState=function(){this.state.loading=!1},e.prototype.addNodes=function(e,t){var n=this;void 0===t&&(t=!1);var r=this.state,o=this.container;r.pageToken=e.pageToken,r.more=e.more,this.addNodesShared(e.nodes),angular.forEach(e.nodes,function(e){var r=e.value;o.hasKey(r)||o.put(r,new n.NodeMeta(r,t))})},e.prototype.clearNodes=function(e){void 0===e&&(e=!1);var t=this.state;this.container.clear(),t.more=!0,t.moreLocal=e,t.pageToken="",t.loading=!1,t.offset=0},e.prototype.newNode=function(e){var t=new this.NodeMeta(e),n=this.listCtrl,r=n.sortBy,o=n.reverse,i=n.sortOrder,a=this.listCtrl.type[r],s=this.container;s.remove(e),s.addNew(t,a,i)&&(s.put(e,t),s.resort(o),s.notifyObservers())},e.prototype.getNode=function(e){return this.Nodes.get(e)},e.prototype.getYoutubeVideoId=function(e){if(e.url){var t=this.URI(e.url);if("www.youtube.com"==t.host())return t.query(!0).v}},e.prototype.getNodePreview=function(e,t){void 0===t&&(t=!1);var n=this.getNode(e);return{title:n.title,image:n.image,url:t?this.BASE_URL:n.url,description:n.description,targetUrl:this.getShortUrl(e,t),tags:n.tags,type:"node"}},e.prototype.getShortUrl=function(e,t){return void 0===t&&(t=!1),t?this.BASE_URL+"/article/?key="+e:"https://goo.gl/"+e},e.prototype.getNodesPreview=function(e,t){var n=this;return void 0===t&&(t=!1),e.filter(function(e){return"web search"!=n.getNode(e).type}).map(function(e){return n.getNodePreview(e)},t)},e.prototype.getNodesShared=function(e){return this.Nodes.getByKeys(e)},e.prototype.addNodesShared=function(e){var t=this,n=this.Nodes;e&&e.forEach(function(e){e.visited&&angular.isString(e.visited)&&(e.visited=t.util.parseDate(e.visited)),n.addNode(e.value,e)})},e.prototype.getNodeArticle=function(e){return this.GApi.execute("user","get.article",{value:e})},e.prototype.report=function(e,t){var n=this;return this.GApi.execute("user","report",{url:e,reason:t}).then(function(t){return t.isBlocked&&n.Nodes.remove(e),t})},e.prototype.search=function(e,t,n,r){var o=this;void 0===n&&(n=10),void 0===r&&(r=!1);var i=this.state;if(!this.upadteLoadState()){var a={query:e,pageToken:i.pageToken,geo:t?t.latitude+","+t.longitude:""};return this.GApi.execute("user","search.nodes",a).then(function(e){return o.addNodes(e,r)}).finally(function(){return o.cleanLoadState()})}},e.prototype.getNodeRequest=function(e,t){var n=this;void 0===t&&(t=!1);var r,o=this,i=o.$q,a=o.GApi,s=o.URI,c=o.Nodes,l=o.uriParser;e?(r=s(e),r.protocol()||r.protocol("http")):r=s("");var u=l.parse(r),d=u.toString();if(d){if(!t)for(var m=0,p=c.toArray();m<p.length;m++){var h=p[m];if(h.value.url==d)return i.when(c.get(h.key))}if("www.facebook.com"==u.host()){var g=l.getFacebookId(u);return a.execute("user","get.node.facebook",{value:g})}return a.execute("user","get.node",{url:d,isArticle:t}).then(function(e){return n.addNodesShared([e]),e})}return i.reject()},e.prototype.searchGlobal=function(e){var t=this;return this.search(e).then(function(){return t.container.notifyObservers()})},e.prototype.load=function(){return this.loadFunction("list.nodes")},e.prototype.loadRecommended=function(){var e=this;if(this.upadteLoadState())return this.$q.reject();var t=this.container.keys();return this.execute("list.nodes.recommended",{nodes:t}).then(function(t){e.addNodes(t),e.container.notifyObservers()}).finally(function(){return e.cleanLoadState()})},e.prototype.loadGlobal=function(){return this.loadFunction("list.nodes.rating")},e.prototype.loadFavorites=function(){return this.loadFunction("list.nodes.favorites")},e.prototype.loadDomain=function(e){return this.loadFunction("list.nodes.domain",e)},e.prototype.loadTag=function(e){return this.loadFunction("list.nodes.tag",e)},e.prototype.remove=function(e){return this.execute("remove.node",{value:e})},e.prototype.addFavorite=function(e){return this.execute("add.node.favorites",{value:e})},e.prototype.hasFavorite=function(e){return this.execute("has.node.favorites",{value:e}).then(function(e){return e.more})},e.prototype.removeFavorite=function(e){return this.execute("remove.node.favorites",{value:e})},e.prototype.addNodeVisit=function(e){return this.execute("add.nodes.visits",{nodes:[{visited:(new Date).toISOString(),value:e}]})},e.prototype.related=function(e,t){var n=this;void 0===t&&(t=!1);var r=this.relatedCache.get(e);return r?this.$q.when(r):this.GApi.execute("user","nodes.related",{query:e,limit:20,isArticle:t}).then(function(t){if(t&&t.nodes)return n.addNodesShared(t.nodes),r=n.mapNodesShared(t.nodes,!1),n.relatedCache.put(e,r),r})},e.prototype.googleSearch=function(e){var t=this;return this.GApi.execute("user","google.search",{query:e}).then(function(e){return t.nodesResponseShared(e)})},e.prototype.linkedNodes=function(e){var t=this;return this.GApi.execute("user","nodes.linked",{value:e}).then(function(e){return t.nodesResponseShared(e)})},e.prototype.mapNodesShared=function(e,t){var n=this;return void 0===t&&(t=!0),e.map(function(e){return new n.NodeMeta(e.value,t)})},e.prototype.nodesResponseShared=function(e){if(e&&e.nodes)return this.addNodesShared(e.nodes),this.mapNodesShared(e.nodes,!1)},e.prototype.getNodes=function(e){return this.$q.when()},e.prototype.execute=function(e,t){var n=this,r=n.GApi;return n.GApiApp.execute(function(){return r.executeAuth("user",e,t)})},e.prototype.loadFunction=function(e,t){var n=this,r=this,o=r.$q,i=r.GApi;r.util;if(this.upadteLoadState())return o.reject();var a=this.state.pageToken,s=this.util.getUserLanguage();return i.execute("user",e,{pageToken:a,query:t,lang:s}).then(function(e){return n.addNodes(e),n.container.notifyObservers(),e.modified}).finally(function(){return n.cleanLoadState()})},e}();e.value("nodesSharedStatic",n);var r=function(){function e(e,t,n,r,o,i){this.$rootScope=e,this.GApi=t,this.GData=n,this.GApiApp=r,this.toastObserver=o,this.BASE_URL=i}return e.prototype.login=function(){var e=this;return this.GApiApp.execute(function(){return e.GApi.executeAuth("user","pocket.login")}).then(function(t){location.href="https://getpocket.com/auth/authorize?request_token="+t.access_token+"&redirect_uri="+encodeURIComponent(e.BASE_URL)})},e.prototype.add=function(e){var t=this,n=function(){return t.GApiApp.execute(function(){return t.GApi.executeAuth("user","pocket.add",{value:e})}).then(function(){return t.toastObserver.notifyObservers("Added to Pocket")},function(e){if(e&&403==e.code)return t.login()})};return this.GData.isLogin()?n():this.$rootScope.login().then(n)},e}();e.value("pocketSharedStatic",r);var o=function(){function e(e,t,n,r,o,i,a,s,c,l,u,d){this.$q=e,this.GApi=t,this.$queueFactory=n,this.TreesMetaContainer=r,this.OrderedHash=o,this.Trees=i,this.TreeMeta=a,this.TreeMetaProxy=s,this.TreesMeta=c,this.ObservableClass=l,this.groupCtrl=u,this.util=d,this.treesContainer=new this.Trees,this.treesMetaContainer=new this.TreesMeta,this.pinnedTreesContainer=new this.OrderedHash,this.quotaObserver=this.ObservableClass(),this.pinnedTreesObserver=this.ObservableClass(),this.commandQueue=this.$queueFactory(),this.MAX_PINNED=100,this.isOverQuota=!1,this.state={more:!0,pageToken:"",loading:!1,offset:0,treeLoading:!1,nodes:[],noNodesFound:!1,treesPageToken:"",treesMore:!1,viewState:{session:0,favorites:0,published:0,feed:0}}}return e.prototype.updateContainer=function(e,t){if(!this.groupCtrl.treesSearch.isSearch()&&!this.groupCtrl.disableSort){var n=this.groupCtrl,r=n.sortBy,o=n.sortOrder,i=n.reverse,a=this.groupCtrl.type[r];this.treesMetaContainer.updateContainer(e,t,r,a,o,i)}},e.prototype.getTreeMeta=function(e){return this.TreesMetaContainer.get(e)},e.prototype.addToContainer=function(e,t){var n=this;t.forEach(function(t){var r=t.id,o=new n.TreeMeta(r,t);o.pinned=!0,n.TreesMetaContainer.put(r,o),e.put(r,new n.TreeMetaProxy(r))})},e.prototype.addPinned=function(e){var t=e&&e.trees;t&&this.addToContainer(this.pinnedTreesContainer,t),this.pinnedTreesObserver.notifyObservers()},e.prototype.addTree=function(e,t){void 0===t&&(t=e.id);var n=this,r=n.TreesMetaContainer,o=n.treesMetaContainer;if(t){var i=new this.TreeMeta(t,e);o.hasKey(t)||o.put(t,new this.TreeMetaProxy(t)),r.hasKey(t)?this.getTreeMeta(t).update(i):r.put(t,i)}},e.prototype.addTrees=function(e){var t=this;if(e){var n=this.state;n.pageToken=e.pageToken,n.treesPageToken=e.treesPageToken,n.more=e.more,n.treesMore=e.treesMore,n.nodes=e.nodes,n.noNodesFound=e.noNodesFound,angular.forEach(e.trees,function(e){return t.addTree(e)})}},e.prototype.addTreeObject=function(e,t){var n=this.treesContainer;n.hasKey(e.id)||(e.sync=parseInt(t.sync||"0"),e.userId=t.userId,e.plusId=t.plusId,e.isReposted=t.isReposted,e.editors=t.editors||[],e.limitedEdit=t.limitedEdit,e.editable=t.editable,n.add(t,e))},e.prototype.newTree=function(e){var t=this,n=t.TreesMetaContainer,r=t.treesMetaContainer,o=this.groupCtrl,i=o.sortBy,a=o.sortOrder,s=o.reverse,c=this.groupCtrl.type[i],l=e.id,u=new this.TreeMeta(l,e),d=r.addNew(u,c,a);d&&!r.hasKey(l)&&(n.put(l,u),r.put(l,new this.TreeMetaProxy(l)),r.resort(s),r.notifyObservers()),d||(this.state.more=!0)},e.prototype.newLink=function(e,t,n){void 0===n&&(n=!0);var r=e.link,o=e.tree,i=e.timestamp,a=o.id,s=new Date(i),c=this.treesContainer.getTree(a);if(!(c&&c.isOpened)){t&&this.addTree(o,a);var l=this.getTreeMeta(a);if(l&&(l.newLinks+=1,l.modified=s),n){var u=this.Trees.getStack(a);if(u){var d=this.Trees.newLink(r.parent,r.child,s);u.newLink(d).execute()}}this.updateContainer(a,["modified"])}},e.prototype.clearTrees=function(){var e=this,t=this,n=t.state,r=t.pinnedTreesContainer;n.more=!0,n.pageToken="",n.treesPageToken="",n.treesMore=!1,n.nodes=[],n.noNodesFound=!1,n.loading=!1,n.offset=0,this.treesMetaContainer.clear(),this.TreesMetaContainer.keepIf(function(t){var n=t.key;return r.hasKey(n)||n==e.linkedTreeKey})},e.prototype.updateViewState=function(e,t){void 0===t&&(t=!0);var n=t?1:-1;this.state.viewState[e]+=n},e.prototype.requestTrees=function(e,t,n){var r=this.state;return{userId:e.userId,plusId:e.plusId,query:n,reverse:t.reverse,sortBy:t.sortBy,pageToken:r.pageToken,favorite:e.favorite,published:e.published,treesPageToken:r.treesPageToken,more:r.more,treesMore:r.treesMore,nodes:r.nodes,noNodesFound:r.noNodesFound,lang:this.util.getUserLanguage()}},e.prototype.addTreeCallback=function(e){var t=this;return function(){e.loading=!1,e.seen=!0,t.state.treeLoading=!1}},e.prototype.addTreePrecall=function(e){e.loading=!0,this.state.treeLoading=!0},e.prototype.loadCallback=function(e){this.addTrees(e),this.treesMetaContainer.notifyObservers()},e.prototype.report=function(e,t){return this.GApi.execute("user","report",{tree:e,reason:t})},e.prototype.isPinDisabled=function(){return this.pinnedTreesContainer.size>=this.MAX_PINNED},e.prototype.pinTree=function(e){var t=this.pinnedTreesContainer,n=t.values(),r=this.getTreeMeta(e);r.pinned=!0,r.loading=!1,t.clear(),t.put(e,new this.TreeMetaProxy(e)),n.forEach(function(e){return t.put(e.key,e)}),this.pinnedTreesObserver.notifyObservers()},e.prototype.unpinTree=function(e){var t=this.getTreeMeta(e);t.pinned=!1,t.loading=!1,this.pinnedTreesContainer.remove(e),this.pinnedTreesObserver.notifyObservers()},e.prototype.moveTree=function(e,t){var n=this.pinnedTreesContainer,r=n.values(),o=n.findIndex(function(t){return t.key==e});n.clear(),r.splice(t,0,r.splice(o,1)[0]),r.forEach(function(e){return n.put(e.key,e)}),this.pinnedTreesObserver.notifyObservers()},e.prototype.pin=function(e){return this.$q.when()},e.prototype.unpin=function(e){return this.$q.when()},e.prototype.move=function(e,t){return this.$q.when()},e.prototype.getTree=function(e,t){return this.$q.when()},e.prototype.searchTreesByMeta=function(e,t,n){return this.$q.when()},e.prototype.load=function(e,t){return this.$q.when()},e.prototype.loadDomain=function(e){return this.$q.when()},e.prototype.loadTag=function(e){return this.$q.when()},e.prototype.add=function(e,t){return this.$q.when()},e.prototype.updateTree=function(e,t,n,r){return this.$q.when()},e.prototype.removeTree=function(e){return this.$q.when()},e.prototype.editTree=function(e){return this.$q.when()},e.prototype.editImage=function(e){return this.$q.when()},e.prototype.sync=function(e){return this.$q.when()},e.prototype.togglePublished=function(e){return this.$q.when()},e.prototype.toggleFavorite=function(e){return this.$q.when()},e.prototype.addTag=function(e,t){return this.$q.when()},e.prototype.removeTag=function(e,t){return this.$q.when()},e.prototype.addEditor=function(e,t){return this.$q.when()},e.prototype.removeEditor=function(e,t){return this.$q.when()},e.prototype.loadFeed=function(){return this.$q.when([])},e.prototype.loadShared=function(){return this.$q.when()},e.prototype.loadRecommended=function(){return this.$q.when()},e.prototype.upadteLoadState=function(){var e=this.state;if(e.loading)return!0;e.loading=!0},e.prototype.cleanLoadState=function(){this.state.loading=!1},e.prototype.createUpdateCommandObject=function(e,t,n,r,o,i){return void 0===r&&(r=!1),void 0===o&&(o=!0),void 0===i&&(i=""),{type:t.getAPIMethod(r),value:t.toJSON({id:e,modified:n.toISOString(),updateCount:o,token:i,domains:this.treesContainer.getTree(e).getDomains()})}},e.createEditCommandObject=function(e,t,n){return void 0===n&&(n=""),{type:"edit.tree",value:{id:e,title:t.title,description:t.description,modified:(new Date).toISOString(),token:n}}},e.createPublishCommandObject=function(e,t){return{type:"publish.tree",value:{id:e,published:t.published,modified:(new Date).toISOString()}}},e.createFavoriteCommandObject=function(e,t){return{type:"favorite.tree",value:{id:e,favorite:t.favorite,modified:(new Date).toISOString()}}},e}();e.value("treesSharedStatic",o);var i=function(){function e(e,t,n,r,o,i,a,s,c,l,u,d,m,p,h,g,f){this.$rootScope=e,this.$cacheFactory=t,this.$q=n,this.$window=r,this.$interval=o,this.GApi=i,this.GApiApp=a,this.facebook=s,this.pocket=c,this.itunes=l,this.Users=u,this.OrderedSet=d,this.ObservableClass=m,this.util=p,this.FB_ID=h,this.API_KEY=g,this.placeholderImage=f,this.usersContainer=new this.Users,this.usersCache=this.$cacheFactory("users",{capacity:100}),this.recentUserIds=new this.OrderedSet,this.recentUsers={},this.userLoginObserver=this.ObservableClass(),this.bookmarksObserver=this.ObservableClass(),this.maxRecentUsers=5,this.hasRatedApp=!1,this.userSubscriptions={subscribers:0,subscriptions:0},this.userCollections={},this.userPublishedDomains={pageToken:"",more:!0,loading:!1},this.plus_share="https://plus.google.com/share?url=",this.facebook_share="https://www.facebook.com/dialog/share?",this.twitter_share="https://twitter.com/intent/tweet?"}return e.prototype.login=function(e){var t=this;return this.simple_login().then(function(e){return t.loginUser(e),t.userInfo()})},e.prototype.load=function(){var e=this,t=this.usersContainer;return t.loading?this.$q.when():(t.loading=!0,this.facebook.listFriends(t.pageToken).then(function(t){return e.store(t)}).finally(function(){return t.loading=!1}))},e.prototype.storeSubscriptions=function(e){var t=this.usersContainer;if(t.pageToken=e.pageToken,t.more=e.more,e.users)return this.getUsers(e.users).then(function(e){e.forEach(function(e){return t.put(e.id||e.plusId,e)}),t.notifyObservers()})},e.prototype.store=function(e){var t=this.usersContainer,n=e.paging&&e.paging.next;t.pageToken=n,t.more=!!n,e.data.forEach(function(e){t.put(e.id,e)}),t.notifyObservers()},e.prototype.loginUser=function(e){this.$rootScope.user=e,this.userLoginObserver.notifyObservers()},e.prototype.logoutUser=function(){this.$rootScope.user=null,this.userLoginObserver.notifyObservers()},e.prototype.addRecent=function(e){var t=e&&(e.id||e.plusId),n=this.recentUserIds,r=this.recentUsers;if(t&&!n.contains(t)){if(n.add(t),r[t]=e,n.size>this.maxRecentUsers){var o=n.toArray()[0];n.remove(o),r[o]=null}return n.map(function(e){return r[e]}).reverse()}},e.prototype.getTrending=function(){var e=this;return this.GApi.execute("user","get.trending",{lang:this.util.getUserLanguage()}).then(function(t){return e.$rootScope.trending=t})},e.prototype.getPlusUser=function(t){return this.GApi.execute("plus","people.get",{userId:t,key:this.API_KEY}).then(e.makePlusUserObject)},e.prototype.getPlusUsers=function(t){var n=this;if(t.length){var r=gapi.client.newBatch(),o=this.$q.defer();return t.forEach(function(e){r.add(gapi.client.request({path:"plus/v1/people/get",params:{userId:e,key:n.API_KEY}}))}),r.execute(function(t){var n=Object.values(t).map(function(t){return e.makePlusUserObject(t.result)});o.resolve(n)}),o.promise}},e.prototype.getUsers=function(e){var t=this,n={},r={},o=[],i=[],a=[];return e.forEach(function(e,s){var c=e.userId,l=e.plusId;if(l){var u=t.usersCache.get(l);return void(u?a[s]=u:(r[l]=s,-1==i.indexOf(l)&&i.push(l)))}if(c){var u=t.usersCache.get(c);u?a[s]=u:(n[c]=s,-1==o.indexOf(c)&&o.push(c))}}),this.$q.all({fb:this.facebook.getUsers(o),plus:this.getPlusUsers(i)}).then(function(e){return e.fb&&e.fb.forEach(function(e){if(e){var r=n[e.id];a[r]=e,t.usersCache.put(e.id,e)}}),e.plus&&e.plus.forEach(function(e){if(e){var n=r[e.plusId];a[n]=e,t.usersCache.put(e.plusId,e)}}),a})},e.prototype.getUser=function(e){var t=this,n=e.userId,r=e.plusId,o=e.user;if(o)return this.$q.when(o);var i,a={id:n,plusId:r,name:"Error",picture:{data:{url:this.placeholderImage}}};return n&&(o=this.usersCache.get(n)),!o&&r&&(o=this.usersCache.get(r)),o?this.$q.when(o):(n?i=this.facebook.getUser(n).then(function(e){return e},function(){return r?t.getPlusUser(r):t.$q.reject()}):r&&(i=this.getPlusUser(r)),i?i.then(function(e){return e},function(){return a}).then(function(e){return t.usersCache.put(e.id||e.plusId,e),e}):this.$q.reject())},e.prototype.getAmazonProducts=function(e){return this.GApi.execute("user","amazon.search",{query:e.getKeywords()}).then(function(e){return e.products})},e.prototype.getEbayProducts=function(e){return this.GApi.execute("user","ebay.search",{query:e.getEbayKeywords()}).then(function(e){return e.products})},e.prototype.getITunesProducts=function(e){return this.itunes.search(e.getKeywords())},e.prototype.sharePocket=function(e){this.pocket.add(e)},e.prototype.shareGoogle=function(e){this.$window.open(this.plus_share+encodeURI(e),"_blank","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")},e.prototype.shareFacebook=function(e){this.$window.open(this.facebook_share+"app_id="+this.FB_ID+"&display=popup&href="+encodeURI(e),"_blank","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")},e.prototype.shareTwitter=function(e){this.$window.open(this.twitter_share+"via=getbrancher&url="+encodeURI(e),"_blank","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")},e.prototype.subscribeUser=function(e){var t=this;return this.GApiApp.execute(function(){return t.GApi.executeAuth("user","subscribe.user",{plusId:e.plusId,userId:e.id})})},e.prototype.unsubscribeUser=function(e){var t=this;return this.GApiApp.execute(function(){return t.GApi.executeAuth("user","unsubscribe.user",{plusId:e.plusId,userId:e.id})})},e.prototype.isSubscribed=function(e){var t=this;return this.GApiApp.execute(function(){return t.GApi.executeAuth("user","subscribe.info",{plusId:e.plusId,userId:e.id})})},e.prototype.loadSubscribers=function(e){var t=this,n=this.usersContainer;return n.loading?this.$q.when():(n.loading=!0,this.GApiApp.execute(function(){return t.GApi.executeAuth("user","list.subscribers",{pageToken:n.pageToken,user:e})}).then(function(e){return t.storeSubscriptions(e)}).finally(function(){return n.loading=!1}))},e.prototype.loadSubscriptions=function(e){var t=this,n=this.usersContainer;return n.loading?this.$q.when():(n.loading=!0,this.GApiApp.execute(function(){return t.GApi.executeAuth("user","list.subscriptions",{pageToken:n.pageToken,user:e})}).then(function(e){return t.storeSubscriptions(e)}).finally(function(){return n.loading=!1}))},e.prototype.publishDomain=function(e){var t=this;return this.GApiApp.execute(function(){return t.GApi.executeAuth("user","add.publish.domain",{url:e})})},e.prototype.unpublishDomain=function(e){var t=this;return this.GApiApp.execute(function(){return t.GApi.executeAuth("user","remove.publish.domain",{url:e})})},e.prototype.listPublishDomains=function(){var e=this,t=this.userPublishedDomains;return t.loading?this.$q.when([]):(t.loading=!0,this.GApiApp.execute(function(){return e.GApi.executeAuth("user","list.publish.domain",{pageToken:t.pageToken})}).then(function(e){return t.more=e.more,t.pageToken=e.pageToken,e.nodes}).finally(function(){return t.loading=!1}))},e.prototype.clearPublishDomains=function(){var e=this.userPublishedDomains;e.loading=!1,e.pageToken="",e.more=!0},e.prototype.complain=function(e,t){var n=this;return this.GApiApp.execute(function(){return n.GApi.executeAuth("user","complain",{rating:e,complaint:t})})},e.prototype.addTag=function(e){var t=this;return this.GApiApp.execute(function(){return t.GApi.executeAuth("user","add.tag",{name:e.name})})},e.prototype.addDomian=function(e){var t=this;return this.GApiApp.execute(function(){return t.GApi.executeAuth("user","add.domain",{name:e.name})})},e.prototype.showInvite=function(){return this.usersContainer.isEmpty()&&!this.usersContainer.more&&this.facebook.status},e.prototype.logout=function(){return this.$q.when()},e.prototype.logoutShared=function(e){return this.$q.when()},e.prototype.simple_login=function(){return this.$q.when({})},e.prototype.userInfo=function(e){return this.$q.when()},e.prototype.userSetup=function(){return this.$q.when()},e.prototype.loginFirebase=function(e){return this.$q.when()},e.prototype.loginYoutube=function(){return this.$q.when("")},e.prototype.onLinks=function(e){return angular.noop},e.prototype.onFeed=function(e){return angular.noop},e.makePlusUserObject=function(e){if(e&&e.id)return e.name=e.displayName,e.picture={data:{url:e.image&&e.image.url}},e.plusId=e.id,e.id=null,e},e}();e.value("usersSharedStatic",i);var a=function(){function e(e){this.BASE_URL=e}return e.prototype.createPlayer=function(e,t,n){this.player=new YT.Player(e,{events:{onError:n,onStateChange:function(e){return t(e.data)}}})},e.prototype.getFrameUrl=function(e){return"https://www.youtube.com/embed/"+e+"?enablejsapi=1&autoplay=1&origin="+this.BASE_URL},e.prototype.destroy=function(){this.player&&this.player.destroy(),this.player=null},e.prototype.loadVideoById=function(e){this.player.loadVideoById({videoId:e})},e}();e.value("youtubeIFrameSharedStatic",a)}(angular.module("tnDataShared",["tnClasses","tnConfig","tnDataFacebook"])),function(e){"use strict";e.factory("GApi",["$q","GClient","GData","$window",function(e,t,n,r){function o(e,t,n,r,o){var i={};i.api=e,i.apiLoad=!1,i.method=t,i.params=n,i.auth=r,i.deferred=o,m.push(i)}function i(n,o,i){var s=e.defer();return t.get().then(function(){r.gapi.client.load(n,o,void 0,i).then(function(e){var t={api:n,version:o,url:i};e&&e.hasOwnProperty("error")?(console.log(o),s.reject(t)):(s.resolve(t),d.push(n),a(n))})}),s.promise}function a(e){for(var t=e,r=0;r<m.length;r++){var o=m[r];o.api!=t&&!o.apiLoad||0!=o.auth&&1!=n.isLogin()?o.api==t&&(m[r].apiLoad=!0):(c(o.api,o.method,o.params,o.deferred),r>-1&&m.splice(r--,1))}}function s(e,t,n){for(var o=t.split("."),e=r.gapi.client[e],i=0;i<o.length;i++)e=e[o[i]];return e(n)}function c(e,t,n,r){s(e,t,n).execute(function(e){e.error?r.reject(e):r.resolve(e)})}function l(t,n,r,i){var a=e.defer();return d.indexOf(t)>-1?c(t,n,r,a):o(t,n,r,i,a),a.promise}function u(t,n){function r(e,t){e.apply(this,n).then(function(e){o.resolve(e)}).catch(function(n){if(403==n.code&&n.message.toLowerCase().indexOf("limit exceeded")>-1||503==n.code){var i=Math.floor(1e3*Math.random()+1);t<5?setTimeout(function(){r(e,++t)},1e3*Math.pow(2,t)+i):o.reject(n)}else o.reject(n)})}var o=e.defer();return r(t,0),o.promise}var d=[],m=[];return{executeCallbacks:function(){a()},load:i,createRequest:s,execute:function(e,t,n){return 3==arguments.length?l(e,t,n,!1):2==arguments.length?l(e,t,null,!1):void 0},executeAuth:function(e,t,n){return 3==arguments.length?u(l,arguments):2==arguments.length?u(l,arguments):void 0}}}]),e.factory("GAuth",["$rootScope","$q","GClient","GApi","GData","$interval","$window","$location",function(e,t,n,r,o,i,a,s){function c(){var e=t.defer();return 0==p?n.get().then(function(){a.gapi.client.load("oauth2","v2",function(){p=!0,e.resolve()})}):e.resolve(),e.promise}function l(e,t){function n(e,t){var n={client_id:m,scope:g,immediate:!1,response_type:f};e&&(n.user_id=o.getUserId(),n.immediate=!0),void 0!=h&&(n.hd=h),a.gapi.auth.authorize(n,t)}e||!0!==p?c().then(function(){n(e,t)}):n(e,t)}function u(){function e(t){if("https://accounts.google.com"===t.origin){var o=JSON.parse(t.data);a.removeEventListener("message",e),o=n(o.a[0],"code"),void 0==o?r.reject():r.resolve(o)}}function n(e,t){t=t.replace(/[[]/,"[").replace(/[]]/,"]");var n=t+"=([^&#]*)",r=new RegExp(n),o=r.exec(e);return null==o?void 0:o[1]}var r=t.defer(),o=s.protocol()+"//"+s.hostname();(""!=s.port()||443!=s.port()&&"https"==s.protocol())&&(o=o+":"+s.port());a.open("https://accounts.google.com/o/oauth2/auth?scope="+encodeURI(g)+"&redirect_uri=postmessage&response_type=code&client_id="+m+"&access_type=offline&approval_prompt=force&origin="+o,null,"width=800, height=600");return a.addEventListener("message",e),r.promise}function d(){var e=t.defer();return a.gapi.client.oauth2.userinfo.get().execute(function(t){t.code?e.reject():(o.isLogin(!0),r.executeCallbacks(),t.name&&0!==t.name.length||(t.name=t.email),o.getUser(t),e.resolve(t))}),e.promise}var m,p=!1,h=void 0,g="https://www.googleapis.com/auth/userinfo.email",f="token id_token";return{setClient:function(e){m=e},setDomain:function(e){h=e},setScope:function(e){g=e},load:c,checkAuth:function(){var e=t.defer();return l(!0,function(){d().then(function(t){e.resolve(t)},function(){e.reject()})}),e.promise},login:function(){var e=t.defer();return l(!1,function(){d().then(function(t){e.resolve(t)},function(){e.reject()})}),e.promise},setToken:function(e){var n=t.defer();return c().then(function(){a.gapi.auth.setToken(e),d().then(function(){n.resolve()},function(){n.reject()})}),n.promise},getToken:function(){var e=t.defer();return c().then(function(){e.resolve(a.gapi.auth.getToken())}),e.promise},logout:function(){var e=t.defer();return c().then(function(){a.gapi.auth.setToken(null),o.isLogin(!1),o.getUser(null),e.resolve()}),e.promise},offline:function(){var e=t.defer();return u().then(function(t){e.resolve(t)},function(){e.reject()}),e.promise}}}]),e.factory("GClient",["$document","$q","$window","$timeout",function(e,t,n,r){function o(o){var i=t.defer();n._gapiOnLoad=function(){i.resolve()};var a=e[0].createElement("script");return a.onerror=function(e){r(function(){i.reject(e)})},a.src=o,e[0].body.appendChild(a),i.promise}var i=!1,a=!1,s=null,c=[];return{get:function(){var e=t.defer();return i?e.resolve():a?c.push(e):(a=!0,o("https://apis.google.com/js/client.js?onload=_gapiOnLoad").then(function(){n.gapi.client.setApiKey(s),i=!0,a=!1,e.resolve();for(var t=0;t<c.length;t++)c[t].resolve()})),e.promise},setApiKey:function(e){s=e,i&&n.gapi.client.setApiKey(s)},getApiKey:function(){return s}}}]),e.factory("GData",["$rootScope",function(e){e.gapi={};var t=!1,n=null,r=null;return{getUserId:function(){return r},setUserId:function(e){r=e},isLogin:function(n){if(0==arguments.length)return t;t=n,e.gapi.login=n},getUser:function(e){if(0==arguments.length)return n;n=e,null!==e&&(r=e.id)}}}])}(angular.module("angular-google-gapi",[])),function(e){e.value("URI",n(14)),e.factory("uriParser",["URI","AMAZON_ID","EBAY_CAMPID","ITUNES_TOKEN",function(e,t,n,r){function o(e){return"amazon"==e}function i(e){return"ebay"==e}function a(e){return"itunes.apple.com"==e||"geo.itunes.apple.com"==e}var s={},c=e("http://rover.ebay.com/rover/1/711-53200-19255-0/1"),l={google:"q",yahoo:"p",bing:"q",yandex:"text",duckduckgo:"q"},u={google:"/search",yahoo:"/search",bing:"/search",yandex:"/search/",duckduckgo:""},d={google:"www.google.com",yahoo:"www.yahoo.com",bing:"www.bing.com",yandex:"www.yandex.com",duckduckgo:"www.duckduckgo.com"},m={google:"https://www.google.com.ua/images/branding/product/ico/googleg_lodp.ico",yahoo:"https://www.google.com/s2/favicons?domain=www.yahoo.com",bing:"https://www.google.com/s2/favicons?domain=www.bing.com",yandex:"https://www.google.com/s2/favicons?domain=www.yandex.com",duckduckgo:"https://www.google.com/s2/favicons?domain=www.duckduckgo.com"},p=["/","/feed/subscriptions","/feed/trending","/feed/history","/dashboard","/my_videos","/view_all_playlists","/live_dashboard_splash","/my_live_events","/analytics","/timedtext_cs_queue","/upload"];return s.parseSERP=function(t){var n,r=t.domain(),o=t.host(),i={};if(i.isSERP=!1,-1!=r.indexOf("google")&&-1!=o.indexOf("www.google")?i.SE="google":-1!=r.indexOf("yahoo.com")?"www.yahoo.com"!=o&&-1==o.indexOf("search")||(i.SE="yahoo"):-1!=r.indexOf("bing.com")?i.SE="bing":-1!=o.indexOf("www.yandex")?i.SE="yandex":-1!=r.indexOf("duckduckgo")&&(i.SE="duckduckgo"),n=i.SE){var a=t.query(!0),s=t.fragment(),c=l[n];i.isSERP=!0,i.favicon=m[n],angular.merge(a,e.parseQuery(s));var p=a[c];if(p){i.title=e.decodeQuery(p);(i.query={})[c]=p,i.path=u[n],i.hostname=d[n]}}return i},s.parseImg=function(t,n){if(t){if("data:image"==t.slice(0,10))return t;var r=e(t.trim());return r.protocol()?t:(r.is("absolute")?r.protocol(n.protocol()):r.is("relative")&&(r=n.clone().path(t)),r.toString())}},s.applySERP=function(t,n,r){var o=r&&r.value;if(n.isSERP){if(!n.query)return e("");r&&(r.value={type:"web search",title:n.title.charAt(0).toUpperCase()+n.title.substring(1),image:o&&o.image,favicon:n.favicon,description:o&&o.description}),t.fragment("").hostname(n.hostname).search(n.query).path(n.path)}return t},s.sortQuery=function(e){var t=e.search(!0);e.search(""),angular.forEach(Object.keys(t).sort(),function(n){e.addSearch(n,t[n])})},s.isAffiliate=function(e){var t=e.domain().split(".")[0];return o(t)||i(t)||a(e.host())},s.makeAffiliateLink=function(e){var s=e.domain().split(".")[0],l=e;if(o(s)){var u=e.path().split("/"),d=e.query(!0);"s"==u[1]?e.path("/s").fragment("").query({url:"search-alias=aps","field-keywords":d["field-keywords"]}):(e.query("").fragment(""),"ref"==u[u.length-1].slice(0,3)&&e.path(u.slice(0,u.length-1).join("/"))),l=e.removeSearch("tag").addSearch("tag",t)}else if(i(s)){var m=e.host().split(".");l="rover"==m[0]?e.setSearch("campid",n).setSearch("toolid","10001"):c.clone().query({mpre:e.toString(),campid:n,toolid:"10001"})}else if(a(e.host())){var d=e.query(!0),p=d.i,h=d.mt,g={at:r};p&&(g.i=p),h&&(g.mt=h),l=e.host("geo.itunes.apple.com").query(g).fragment("")}return l},s.parseFacebook=function(t){if("www.facebook.com"==t.host()){var n=t.path(),r=n.split("/").filter(function(e){return!!e});if(!n||"/"==n||"/dialog/share"==n||"/photo.php"==n||"feed"==r[0]||"photos"==r[1])return e("");var o=t.query(!0),i=o.id,a=o.q;if(t.query(""),i&&t.addSearch("id",i),a&&t.addSearch("q",a),!i&&!a){var s="pg"==r[0];if("groups"==r[0]||"events"==r[0]||s)if(s)t.path("/"+r[1]);else{if(!r[1])return e("");t.path("/"+r[0]+"/"+r[1])}else t.path("/"+r[0])}}return t},s.parseYoutube=function(t){if("www.youtube.com"==t.host()){var n=t.path(),r=n.split("/").filter(function(e){return!!e});if(!n||p.indexOf(n)>-1)return e("");var o=t.query(!0),i=o.v,a=o.list,s=o.search_query||o.q;t.query(""),i&&t.addSearch("v",i),!i&&a&&t.addSearch("list",a),s&&t.addSearch("search_query",s),("user"==r[0]||"channel"==r[0])&&r.length>2&&t.path("/"+r[0]+"/"+r[1])}return t},s.parse=function(t,n){if("http"!=t.protocol().slice(0,4)||"jpg"==t.suffix()||"plus.google.com"==t.host()&&"/share"==t.path())return e("");var r=s.parseSERP(t);return t.removeSearch("brancher.io").normalize(),t=s.parseFacebook(t),t=s.parseYoutube(t),t=s.applySERP(t,r,n),s.sortQuery(t),t},s.getFacebookId=function(e){var t=e.path().split("/").filter(function(e){return!!e}),n="search"!=t[0]&&t[t.length-1];return e.query(!0).id||n},s}])}(angular.module("URIjs",[])),function(e){e.service("urlShortener",["$q","$http","$cacheFactory","$timeout","URI","API_KEY","SECONDARY_API_KEY",function(e,t,n,r,o,i,a){var s=this,c=s.cache=n("shortURL"),l="https://www.googleapis.com/urlshortener/v1/url",u=["AIzaSyDZ55puWPWIO2zobjnTKOCqBGgPaAy4Z84","AIzaSyCjEGKTgmYGTXI3NpLlo3Mf1dBqoryXdLI","AIzaSyBcHHVlKWr86BZKMoV4jkkn5n8FmKVWvYM","AIzaSyAJmJFAc0MrjNHK0Nolqwc0gxYX68gAUkk","AIzaSyDFSHG8nWrzCpW5U1dzj54WrfUPk9nfIZY","AIzaSyCkAIvQSBjLy_7Bm1tzbMGyXg_5mSeM1Zc","AIzaSyC24Zk19799bLRiiroB0_gy09uETSa2ADo","AIzaSyCGPK41uA6eb0LG0ahnV0qO98dcZlMTTMk","AIzaSyCyFGi0QfAMj4gNu9T4-1n5SOVSVfnRmEk","AIzaSyD_Po1pyDxSooiBMDuxCX9G68M1bOaXaaQ","AIzaSyCtExBA-lGdpKX1CeklHeHOprk4SrOdi-g","AIzaSyDlN44efeKER1U0DB0QCssiQacfrga6xy4"];s.shortenUrl=function(n,a,d){void 0===a&&(a=i),void 0===d&&(d=[]);var m=c.get(n);return m?e.when(m):t.post(l+"?key="+a,{longUrl:n}).then(function(t){return t.data&&t.data.id?(m=o(t.data.id).path().slice(1),c.put(n,m),m):e.reject()},function(t){if(403==t.status){var o=u.filter(function(e){return-1===d.indexOf(e)});if(o.length){var i=Math.floor(Math.random()*o.length),a=o[i];return d.push(a),r(1e3).then(function(){return s.shortenUrl(n,a,d)})}}return e.reject()})},s.analytics=function(e){return t.get(l,{params:{key:a,shortUrl:"http://goo.gl/"+e,projection:"FULL"}}).then(function(e){return e.data})}}])}(angular.module("tnUrlShortener",["tnConfig","angular-google-gapi","URIjs"])),function(e){e.config(["$provide",function(e){e.factory("GApiApp",["$q","GAuth",function(e,t){var n={};return n.execute=function(n){return n().then(function(e){return e},function(r){return 401==r.code?t.checkAuth().then(n):e.reject()})},n}]),e.factory("trees",["treesAPIStatic",function(e){return new e}]),e.factory("nodes",["nodesAPIStatic",function(e){return new e}]),e.factory("users",["usersAPIStatic",function(e){return new e}]),e.factory("facebook",["facebookAPIStatic",function(e){return new e}]),e.factory("pocket",["pocketAPIStatic",function(e){return new e}]),e.factory("bufferService",["bufferAPIStatic",function(e){return new e}]),e.factory("youtubeIFrame",["youtubeIFrameAPIStatic",function(e){return new e}])}]).run(["GApi",function(e){e.load("kgsearch","v1"),e.load("plus","v1")}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("bufferAPIStatic",["$httpParamSerializerJQLike","GApi","GApiApp","users","URI","BUFFER_ID","BUFFER_REDIRECT_URI","bufferSharedStatic",function(e,n,r,o,i,a,s,c){return function(c){function l(){return c.call(this,e,n,r,o,i,a,s)||this}return t(l,c),l}(c)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("nodesAPIStatic",["$q","$cacheFactory","GApi","GApiApp","URI","OrderedHash","NodeMeta","ObservableClass","Nodes","OrderedContainer","uriParser","util","nodesConfig","BASE_URL","nodesSharedStatic",function(e,n,r,o,i,a,s,c,l,u,d,m,p,h,g){return function(g){function f(){return g.call(this,e,n,r,o,i,d,a,s,l,c,u,m,p.listCtrl,h)||this}return t(f,g),f}(g)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("pocketAPIStatic",["$rootScope","GApi","GData","GApiApp","toastObserver","BASE_URL","pocketSharedStatic",function(e,n,r,o,i,a,s){return function(s){function c(){return s.call(this,e,n,r,o,i,a)||this}return t(c,s),c}(s)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("treesAPIStatic",["$q","$rootScope","$queueFactory","GApi","GData","GApiApp","firebaseService","nodes","facebook","OrderedHash","TreesMetaContainer","TreeMetaProxy","Trees","TreesMeta","Tree","TreeMeta","ObservableClass","util","linkEvent","treesSharedStatic",function(e,n,r,o,i,a,s,c,l,u,d,m,p,h,g,f,v,b,y,k){function w(e){var t=e.type,n=e.value;return i.isLogin()?a.execute(function(){return o.executeAuth("user",t,n)}):o.execute("user",t,n)}function C(e){var t=e.type,n=e.value;return i.isLogin()?a.execute(function(){return o.executeAuth("tree",t,n)}):o.execute("tree",t,n)}var _=n.groupCtrl;return function(n){function c(){return n.call(this,e,o,r,d,u,p,f,m,h,v,_,b)||this}return t(c,n),c.prototype.getTree=function(t,n){var r=this,o=n.id,i=this.state;if(n.loading||this.treesContainer.hasKey(o)||i.treeLoading)return e.reject();var a=function(){return C({type:"get.tree",value:{id:o,token:t.shared?l.getAccessToken():"",pinned:t.pinned}}).then(function(e){return r.addTreeObject(n,e)}).finally(r.addTreeCallback(n))};return this.addTreePrecall(n),t.shared?l.executeAPIMethod(a):a()},c.prototype.searchTreesByMeta=function(t,n){var r=this;return this.upadteLoadState()?e.reject():w({type:"search.meta",value:this.requestTrees(t,_,n)}).then(function(e){return r.loadCallback(e)}).finally(function(){return r.cleanLoadState()})},c.prototype.load=function(t){var n=this;return this.upadteLoadState()?e.reject():w({type:"list.trees",value:this.requestTrees(t,_)}).then(function(e){return n.loadCallback(e)}).finally(function(){return n.cleanLoadState()})},c.prototype.loadFunction=function(t,n){var r=this;if(this.upadteLoadState())return e.reject();var i=this.state.pageToken;return o.execute("user",t,{pageToken:i,query:n}).then(function(e){return r.loadCallback(e)}).finally(function(){return r.cleanLoadState()})},c.prototype.loadDomain=function(e){return this.loadFunction("list.trees.domain",e)},c.prototype.loadTag=function(e){return this.loadFunction("list.trees.tag",e)},c.prototype.loadFeed=function(){var t=this,n=this.state;if(this.upadteLoadState())return e.reject();var r=n.pageToken;return a.execute(function(){return o.executeAuth("user","list.feed",{pageToken:r})}).then(function(e){return t.addTrees(e),e.trees&&e.trees.map(function(e){return e.id})}).finally(function(){return t.cleanLoadState()})},c.prototype.loadShared=function(){var t=this,n=this.state;return this.upadteLoadState()?e.reject():l.executeAPIMethod(function(){return o.execute("user","list.shared",{pageToken:n.pageToken,accessToken:l.getAccessToken()})}).then(function(e){return t.loadCallback(e)}).finally(function(){return t.cleanLoadState()})},c.prototype.loadRecommended=function(){var t=this;this.state;if(this.upadteLoadState())return e.reject();var n=this.treesMetaContainer.toTreesMetaArray().map(function(e){return e.value.shortUrl});return a.execute(function(){return o.executeAuth("user","list.trees.recommended",{nodes:n})}).then(function(e){return t.loadCallback(e)}).finally(function(){return t.cleanLoadState()})},c.prototype.add=function(t,n){var r=this,c=new Date;if(!t)return e.reject();var l=t.toJSON(!0);return l.modified=l.created=c.toISOString(),l.original=l.original||t.meta.id,l.token=n,this.isOverQuota&&this.quotaObserver.notifyObservers(),a.execute(function(){return o.executeAuth("tree","store.tree",l)}).then(function(e){l.id=e.tree.id,l.shortUrl=e.tree.shortUrl,l.editable=!0,r.isOverQuota=e.overQuota,r.isOverQuota&&r.quotaObserver.notifyObservers(),delete l.token,s.push("users/"+i.getUser().id+"/links",{type:"link",value:{linkType:y.tree,timestamp:c.toISOString(),tree:l}})})},c.prototype.updateTree=function(t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=!0);var i=this.treesContainer.getTree(t);if(!i)return e.reject();var a=i.meta.limitedEdit;i.meta.modified=new Date;var c=this.createUpdateCommandObject(t,n,i.meta.modified,r,o,a?l.getAccessToken():""),u=c.value.nodes,d=function(){return C(c).then(function(){return c.value.nodes=u,delete c.value.token,s.push("trees/"+i.meta.shortUrl+"/commands",c)})};return delete c.value.nodes,a?l.executeAPIMethod(d):d()},c.prototype.removeTree=function(e){return a.execute(function(){return o.executeAuth("tree","remove.tree",{id:e})}).then(function(){return s.push("users/"+i.getUser().id+"/links",{type:"remove",value:{timestamp:(new Date).toISOString(),tree:e}})})},c.prototype.editTree=function(t){var n=this.getTreeMeta(t);this.treesContainer.getTree(t);if(!n)return e.reject();var r=c.createEditCommandObject(t,n);return a.execute(function(){return o.executeAuth("tree","edit.tree",r.value)}).then(function(){return s.push("trees/"+n.shortUrl+"/commands",r).catch(angular.noop)})},c.prototype.editImage=function(t){var n=this.getTreeMeta(t);return n?a.execute(function(){return o.executeAuth("tree","edit.image",{id:t,image:n.image})}):e.reject()},c.prototype.togglePublished=function(t){var n=this,r=this.treesContainer.get(t);if(!r)return e.reject();var i=c.createPublishCommandObject(t,r.meta);return a.execute(function(){return o.executeAuth("tree",i.type,i.value)}).then(function(){return n.updateViewState("published",i.value.published),s.push("trees/"+r.meta.shortUrl+"/commands",i)})},c.prototype.toggleFavorite=function(t){var n=this,r=this.treesContainer.get(t);if(!r)return e.reject();var i=c.createFavoriteCommandObject(t,r.meta);return a.execute(function(){return o.executeAuth("tree",i.type,i.value)}).then(function(){return n.updateViewState("favorites",i.value.favorite),s.push("trees/"+r.meta.shortUrl+"/commands",i)})},c.prototype.addTag=function(t,n){return this.getTreeMeta(t)?a.execute(function(){return o.executeAuth("tree","add.tag",{id:t,tags:[n]})}):e.reject()},c.prototype.removeTag=function(t,n){return this.getTreeMeta(t)?a.execute(function(){return o.executeAuth("tree","remove.tag",{id:t,tags:[n]})}):e.reject()},c.prototype.sync=function(t){var n=this,r=this.treesContainer.getTree(t);return r?C({type:"get.tree",value:{id:r.meta.original}}).then(function(e){var o=new g(e),i=r.getMerge(o);if(i)return i.execute(),n.updateTree(t,i)}):e.reject()},c.prototype.pin=function(t){var n=this.getTreeMeta(t);return n?a.execute(function(){return o.executeAuth("tree","pin.tree",{id:n.id})}).then(function(){return s.push("users/"+i.getUser().id+"/links",{type:"pin",value:{timestamp:(new Date).toISOString(),tree:n.toJSON()}})}):e.reject()},c.prototype.unpin=function(e){return a.execute(function(){return o.executeAuth("tree","unpin.tree",{id:e})}).then(function(){return s.push("users/"+i.getUser().id+"/links",{type:"unpin",value:{timestamp:(new Date).toISOString(),tree:e}})})},c.prototype.move=function(t,n){return this.pinnedTreesContainer.hasKey(t)?a.execute(function(){return o.executeAuth("tree","move.tree",{id:t,count:n})}).then(function(){return s.push("users/"+i.getUser().id+"/links",{type:"move",value:{timestamp:(new Date).toISOString(),tree:t,index:n}})}):e.reject()},c.prototype.addEditor=function(e,t){return a.execute(function(){return o.executeAuth("tree","add.editor",{userId:e,id:t})})},c.prototype.removeEditor=function(e,t){return a.execute(function(){return o.executeAuth("tree","remove.editor",{userId:e,id:t})})},c}(k)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("usersAPIStatic",["$q","$rootScope","$cacheFactory","$window","$interval","$http","$sce","GAuth","GApi","GData","GApiApp","GApiShared","firebaseService","facebook","pocket","itunes","nodes","trees","OrderedSet","Users","ObservableClass","util","FB_ID","API_KEY","SCOPES","placeholderUserImage","usersSharedStatic",function(e,n,r,o,i,a,s,c,l,u,d,m,p,h,g,f,v,b,y,k,w,C,_,S,x,T,A){return function(v){function x(){return v.call(this,n,r,e,o,i,l,d,h,g,f,k,y,w,C,_,S,T)||this}return t(x,v),x.prototype.simple_login=function(){var e=this;return c.login().then(function(){return e.$rootScope.isLoggingIn=!0,m.loginUser()})},x.prototype.logout=function(){var e=this;return c.getToken().then(function(t){return e.logoutShared(t.access_token)}).then(angular.noop)},x.prototype.logoutShared=function(e){var t=this,n={jsonpCallbackParam:"callback",params:{token:e}};return b.pinnedTreesContainer.clear(),b.pinnedTreesObserver.notifyObservers(),this.userCollections.tags=[],this.userCollections.domains=[],h.groups=[],a.jsonp(s.trustAsResourceUrl("https://accounts.google.com/o/oauth2/revoke"),n).then(function(){return p.logoutGoogle()}).then(function(){return c.logout()}).then(function(){return t.logoutUser()}).then(angular.noop)},x.prototype.loginFirebase=function(e){var t=this;return e?c.getToken().then(function(e){return p.loginGoogle(e.access_token)}).then(function(){return t.loginUser(e)}):(this.logoutUser(),this.$q.when())},x.prototype.loginYoutube=function(){function e(){return c.getToken().then(function(e){return e.access_token})}return c.setScope(m.getYoutubeScope().join(" ")),c.checkAuth().then(e,function(){return c.login().then(e)})},x.prototype.userSetup=function(){var e=this;return c.checkAuth().then(function(t){return e.loginFirebase(t)},angular.noop).finally(function(){return angular.element("#init-load").remove()})},x.prototype.userInfo=function(t){var r=this;return void 0===t&&(t=!1),u.isLogin()?l.executeAuth("user","user.info",{small:t}).then(function(e){var t=e.subscription,o=e.pinned,i=b.linkedTreeKey;r.hasRatedApp=e.has_rated_app,r.isBufferLogin=e.is_buffer_login,t&&(r.userSubscriptions.subscribers=parseInt(t.subscribers),r.userSubscriptions.subscriptions=parseInt(t.subscriptions)),r.userCollections.tags=e.tags||[],r.userCollections.domains=e.domains||[],r.lastVisit=e.last_visit?new Date(e.last_visit):new Date,h.setAccessToken(e.facebook),h.groups=e.facebook_groups&&e.facebook_groups.groups,b.addPinned(o),n.pinning.disabled=b.isPinDisabled(),i&&(b.getTreeMeta(i).pinned=b.pinnedTreesContainer.hasKey(i))}):e.when()},x.prototype.onLinks=function(e){var t="users/"+u.getUser().id+"/links";return p.on(t,"child_added",function(t,r){var o=new Date(t.value.timestamp);p.onDataWithRemove(o,e,function(){return n.$emit(t.type,t)},r)}),function(){return p.off(t,"child_added")}},x.prototype.onFeed=function(e){var t="users/"+u.getUser().id+"/feed";return p.on(t,"child_added",function(t,r){var o=new Date(t.timestamp);p.onDataWithRemove(o,e,function(){return n.$emit("feed",t)},r)}),function(){return p.off(t,"child_added")}},x}(A)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("youtubeIFrameAPIStatic",["BASE_URL","youtubeIFrameSharedStatic",function(e,n){return function(n){function r(){var t=document.createElement("script");return t.src="https://www.youtube.com/iframe_api",document.body.appendChild(t),n.call(this,e)||this}return t(r,n),r}(n)}])}(angular.module("tnDataApp",["tnDataShared","tnUrlShortener","tnUtil","tnClasses"])),function(e){e.config(["$provide","IndexedDBConfig",function(e,t){e.value("IndexedDB",t.IndexedDB),e.value("IDBRange",t.IDBRange)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("bufferControlStatic",["GApiExtension","bufferAPIStatic",function(e,n){return function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return t(r,n),r.prototype.getProfiles=function(){var t=this;return e.execute(function(){return n.prototype.getProfiles.call(t)})},r.prototype.createUpdate=function(t){var r=this;return e.execute(function(){return n.prototype.createUpdate.call(r,t)})},r}(n)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("nodesControlStatic",["$q","GData","GApiExtension","filterFilter","IndexedDB","IDBRange","NodeMeta","Nodes","nodesConfig","dataUtil","nodesAPIStatic",function(e,n,r,o,i,a,s,c,l,u,d){var m=l.store;return function(l){function d(){return null!==l&&l.apply(this,arguments)||this}return t(d,l),d.prototype.getNodes=function(t){var n=e.defer(),r=i.transaction([m],"readonly"),o=r.objectStore(m);return r.oncomplete=function(){return n.resolve()},r.onerror=function(e){return n.reject(e)},angular.forEach(t,function(e){o.get(a.only(e)).onsuccess=function(){var t=event.target,n=t.result;n&&(u.renameNodeFromShort(n),n.value=e,c.addNode(e,n))}}),n.promise},d.prototype.getNodesRequest=function(e){var t=this;return this.GApi.execute("user","get.nodes",{nodes:e}).then(function(e){t.addNodesShared(e.nodes)})},d.prototype.loadLocal=function(t,n){void 0===n&&(n=10);var r,o=e.defer(),l=this.state,d=this.container,p=i.transaction([m],"readonly"),h=p.objectStore(m),g=t.sortBy,f=t.reverse,v=h.index(g),b=d.forEachValue(),y=f?b.min():b.max();l.loading=!0,l.more=!1,n+=d.size,y&&(r=y.getCurrentSortValue());var k,w=null;return f?(k="prev",r&&(w=a.upperBound(r,v.unique))):(k="next",r&&(w=a.lowerBound(r,v.unique))),p.oncomplete=function(){return o.resolve()},p.onerror=function(e){return o.reject(e)},v.openCursor(w,k).onsuccess=function(e){var t=e.target,r=t.result;if(r){if(d.size<n){var o=r.value,i=r.primaryKey;d.hasKey(i)||(u.renameNodeFromShort(o),c.addNode(i,o),d.put(i,new s(i))),r.continue()}}else l.moreLocal=!1},o.promise.finally(function(){return l.loading=!1})},d.prototype.searchLocal=function(t,n,r){function a(e){if(o([e],t).length){if(p){var n=e.geo;if(n){var r=n.split(",");return p(parseFloat(r[0]),parseFloat(r[1]))<5e3}return!1}return!0}}void 0===r&&(r=10);var l=e.defer(),d=this.state;if(d.moreLocal&&!d.loadingLocal){var p,h=this.container,g=i.transaction([m],"readonly"),f=g.objectStore(m),v=d.offset,b=v>0;return n&&(p=angular.bind(u,u.distance,n.latitude,n.longitude)),r+=h.size,g.oncomplete=function(){return l.resolve()},g.onerror=function(e){return l.reject(e)},d.loadingLocal=!0,f.openCursor().onsuccess=function(e){var t=e.target,n=t.result;if(n){if(h.size<r)if(b)b=!1,n.advance(v);else{var o=n.primaryKey,i=u.renameNodeFromShort(n.value);v++,!h.hasKey(o)&&a(i)&&(c.addNode(o,i),h.put(o,new s(o))),n.continue()}}else d.moreLocal=!1},l.promise.then(function(){d.offset=v}).finally(function(){return d.loadingLocal=!1})}},d.prototype.search=function(e,t,n){var r=this;void 0===n&&(n=10);var o=this.state,i=function(){return l.prototype.search.call(r,e,t,n,!0)};return o.moreLocal?this.searchLocal(e,t,n).then(function(){if(r.container.length<n)return i()}):o.more?i():void 0},d.prototype.searchGlobal=function(e){var t=this;return l.prototype.search.call(this,e).then(function(){return t.container.notifyObservers()})},d.prototype.load=function(){var e=this;return r.execute(function(){return l.prototype.load.call(e)})},d.prototype.loadRecommended=function(){var e=this;return r.execute(function(){return l.prototype.loadRecommended.call(e)})},d.prototype.remove=function(t){var o=this,a=e.defer(),s=i.transaction([m],"readwrite"),c=s.objectStore(m);return s.oncomplete=function(){return a.resolve()},s.onerror=function(e){return a.reject(e)},c.delete(t),a.promise.then(function(){if(n.isLogin())return r.execute(function(){return l.prototype.remove.call(o,t)})})},d.prototype.loadFavorites=function(){var e=this;return r.execute(function(){return l.prototype.loadFavorites.call(e)})},d.prototype.addFavorite=function(e){var t=this;return r.execute(function(){return l.prototype.addFavorite.call(t,e)})},d.prototype.hasFavorite=function(e){var t=this;return r.execute(function(){return l.prototype.hasFavorite.call(t,e)})},d.prototype.removeFavorite=function(e){var t=this;return r.execute(function(){return l.prototype.removeFavorite.call(t,e)})},d.prototype.clearNodes=function(){l.prototype.clearNodes.call(this,!0)},d}(d)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("pocketControlStatic",["GApiExtension","pocketAPIStatic",function(e,n){return function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return t(r,n),r.prototype.add=function(t){var r=this;return e.execute(function(){return n.prototype.add.call(r,t)})},r}(n)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("treesControlStatic",["$q","$rootScope","$timeout","GApi","GData","GAuth","GApiExtension","filterFilter","chromeRuntime","Tree","TreeMeta","IndexedDB","IDBRange","treesConfig","dataUtil","linkEvent","treesAPIStatic","nodesControlStatic",function(e,n,r,o,i,a,s,c,l,u,d,m,p,h,g,f,v,b){var y=h.store,k=h.groupCtrl,w=new b;return function(h){function v(){return null!==h&&h.apply(this,arguments)||this}return t(v,h),v.prototype.count=function(t){void 0===t&&(t="created");var n=e.defer(),r=m.transaction([y],"readonly"),o=r.objectStore(y).index(t);return r.onerror=function(e){return n.reject(e)},o.count().onsuccess=function(e){var t=e.target,r=t.result;n.resolve(r)},n.promise},v.prototype.getTree=function(t,n){var r=this,o=this.state,a=n.id;if(n.loading||this.treesContainer.hasKey(a)||o.treeLoading)return e.reject();var c;if(t.local){var l=e.defer(),u=p.only(a),d=m.transaction([y],"readwrite"),f=d.objectStore(y);this.addTreePrecall(n),d.onerror=function(e){return l.reject(e)},f.openCursor(u).onsuccess=function(e){var t=e.target,o=t.result;if(o){var i=o.value;g.renameTreeFromShort(i),i.seen=!0,i.editable=!0,r.addTreeObject(n,i),g.renameTreeToShort(i),o.update(i).onsuccess=function(){return l.resolve()}}else l.reject()},c=l.promise.finally(this.addTreeCallback(n))}else c=s.execute(function(){if(i.isLogin())return h.prototype.getTree.call(r,t,n);var o=m.transaction([y],"readonly"),s=o.objectStore(y),c=e.defer();return o.onerror=function(e){return c.reject(e)},s.openCursor().onsuccess=function(e){var t=e.target,n=t.result;if(n){var r=n.value;g.renameTreeFromShort(r),r.original==a?c.resolve(!0):n.continue()}else c.resolve(!1)},c.promise.then(function(e){return h.prototype.getTree.call(r,t,n).then(function(){return n.isReposted=e})}).then(angular.noop)});return c},v.prototype.searchTreesByMeta=function(t,n,r){var o=this;void 0===r&&(r=10);var i,a=this.treesMetaContainer,l=this.state;if(t.local){if(l.loading)return e.reject();var u=k.sortBy,d=k.reverse,p=e.defer(),f=m.transaction([y],"readonly"),v=f.objectStore(y).index(u),b=l.offset,C=b>0,_=d?"prev":"next",S=t.favorite?function(e){return e.favorite}:function(e){return!0};l.loading=!0,i=p.promise.then(function(){l.offset=b,a.notifyObservers()}).finally(function(){return l.loading=!1}),r+=a.size,f.oncomplete=function(){return p.resolve()},f.onerror=function(e){return p.reject(e)},v.openCursor(null,_).onsuccess=function(e){var t=e.target,i=t.result;if(i){if(a.size<r)if(C)C=!1,i.advance(b);else{var s=i.primaryKey,u=i.value;b++,g.renameTreeFromShort(u),S(u)&&c([u],n).length&&(u.count=u.children.length,u.editable=!0,o.addTree(u,s)),i.continue()}}else l.more=!1}}else{var x=function(){return s.execute(function(){return h.prototype.searchTreesByMeta.call(o,t,n)})};i=this.state.noNodesFound?x():w.searchLocal(n).then(function(){return o.state.nodes=w.container.keys(),o.state.noNodesFound=!o.state.nodes.length,o.state.treesMore=!o.state.noNodesFound,w.clearNodes(),x()})}return i},v.prototype.load=function(t,n){var r=this;void 0===n&&(n=10);var o,i=this.treesMetaContainer,a=this.state,c=k.sortBy,l=k.reverse;if(t.local){if(a.loading)return e.reject();a.loading=!0,o=this.count(c).then(function(o){var s=i.size;if(s>=o)return a.more=!1,e.when();var u,d,h=m.transaction([y],"readonly"),f=h.objectStore(y).index(c),v=i.forEachValue(),b=e.defer(),k=t.favorite?function(e){return e.favorite}:function(e){return!0},w=null;return l?(u="prev",(d=v.min())&&(w=p.upperBound(d.getCurrentSortValue(),f.unique))):(u="next",(d=v.max())&&(w=p.lowerBound(d.getCurrentSortValue(),f.unique))),h.oncomplete=function(){return b.resolve()},h.onerror=function(e){return b.reject(e)},n+=s,f.openCursor(w,u).onsuccess=function(e){var t=e.target,o=t.result;if(o){if(i.size<n){var s=o.primaryKey,c=o.value;g.renameTreeFromShort(c),k(c)&&(c.count=c.children.length,c.editable=!0,r.addTree(c,s)),o.continue()}}else a.more=!1},b.promise.then(function(){return i.notifyObservers()})}).finally(function(){return a.loading=!1})}else o=s.execute(function(){return h.prototype.load.call(r,t)});return o},v.prototype.loadFeed=function(){var e=this;return s.execute(function(){return h.prototype.loadFeed.call(e)})},v.prototype.loadRecommended=function(){var e=this;return s.execute(function(){return h.prototype.loadRecommended.call(e)})},v.prototype.add=function(t){var r,o,c=this,l=new Date;if(!t)return e.reject();if(i.isLogin())r=s.execute(function(){return a.getToken().then(function(e){return h.prototype.add.call(c,t,e.access_token)})});else{var u=e.defer(),d=m.transaction([y],"readwrite"),p=d.objectStore(y),v=function(){g.renameTreeToShort(o),p.add(o).onsuccess=function(e){g.renameTreeFromShort(o),o.id=e.target.result,o.count=o.children.length}};o=t.toJSON(),o.created=o.modified=l,o.original=o.original||t.meta.id,d.oncomplete=function(){return u.resolve()},d.onerror=function(e){return u.reject(e)},d.onabort=function(e){return u.reject(e)},r=u.promise.then(function(){n.$emit("link",{value:{linkType:f.tree,timestamp:l,tree:o}})}),o.original?p.openCursor().onsuccess=function(e){var t=e.target,n=t.result;if(n){var r=n.value;g.renameTreeFromShort(r),r.original!=o.original?n.continue():d.abort()}else v()}:v()}return r},v.prototype.updateTree=function(t,n,r,o){var a=this;void 0===r&&(r=!1),void 0===o&&(o=!0);var c,l=this.treesContainer.getTree(t);if(!l)return e.reject();if(l.meta.modified=new Date,i.isLogin()||l.meta.limitedEdit)c=s.execute(function(){return h.prototype.updateTree.call(a,t,n,r,o)});else{var u=e.defer(),d=m.transaction([y],"readwrite"),p=d.objectStore(y),f=l.toJSON();c=u.promise.then(function(){var e=a.createUpdateCommandObject(t,n,l.meta.modified,r,o);return a.sendMessage(t,e)}),d.oncomplete=function(){return u.resolve()},d.onerror=function(e){return u.reject(e)},g.renameTreeToShort(f),p.put(f,t)}return c},v.prototype.removeTree=function(t){var n,r=this,o=this.treesContainer,a=this.treesMetaContainer;if(i.isLogin())n=s.execute(function(){return h.prototype.removeTree.call(r,t)});else{var c=e.defer(),l=p.only(t),u=m.transaction([y],"readwrite"),d=u.objectStore(y);n=c.promise.then(function(){a.deleteMeta(t),o.deleteTree(t)}),u.oncomplete=function(){return c.resolve()},u.onerror=function(e){return c.reject(e)},d.delete(l)}return n},v.prototype.editTree=function(t){var n,r=this,o=this.getTreeMeta(t);this.treesContainer.getTree(t);if(!o)return e.reject();if(i.isLogin())n=s.execute(function(){return h.prototype.editTree.call(r,t)});else{var a=e.defer(),c=m.transaction([y],"readwrite"),l=c.objectStore(y);n=a.promise.then(function(){var e=v.createEditCommandObject(t,o);return r.sendMessage(t,e)}),c.oncomplete=function(){return a.resolve()},c.onerror=function(e){return a.reject(e)},l.openCursor(p.only(t)).onsuccess=function(e){var t=e.target,n=t.result;if(n){var r=n.value;g.renameTreeFromShort(r),r.title=o.title,r.description=o.description,g.renameTreeToShort(r),n.update(r)}else a.reject()}}return n},v.prototype.editImage=function(t){var n,r=this,o=this.getTreeMeta(t);if(!o)return e.reject();if(i.isLogin())n=s.execute(function(){return h.prototype.editImage.call(r,t)});else{var a=e.defer(),c=m.transaction([y],"readwrite"),l=c.objectStore(y);n=a.promise,c.oncomplete=function(){return a.resolve()},c.onerror=function(e){return a.reject(e)},l.openCursor(p.only(t)).onsuccess=function(e){var t=e.target,n=t.result;if(n){var r=n.value;g.renameTreeFromShort(r),r.image=o.image,g.renameTreeToShort(r),n.update(r)}else a.reject()}}return n},v.prototype.togglePublished=function(e){var t=this;return s.execute(function(){return h.prototype.togglePublished.call(t,e)})},v.prototype.toggleFavorite=function(t){var n,r=this,o=this.treesContainer.get(t);if(!o)return e.reject();if(i.isLogin())n=s.execute(function(){return h.prototype.toggleFavorite.call(r,t)});else{var a=e.defer(),c=m.transaction([y],"readwrite"),l=c.objectStore(y),u=v.createFavoriteCommandObject(t,o.meta);n=a.promise.then(function(){return r.updateViewState("favorites",u.value.favorite),r.sendMessage(t,u)}),c.oncomplete=function(){return a.resolve()},c.onerror=function(e){return a.reject(e)},l.openCursor(p.only(t)).onsuccess=function(e){var t=e.target,n=t.result;if(n){var r=n.value;g.renameTreeFromShort(r),r.favorite=u.value.favorite,g.renameTreeToShort(r),n.update(r)}else a.reject()}}return n},v.prototype.addTag=function(t,n){var r,o=this,a=this.getTreeMeta(t);if(!a)return e.reject();if(i.isLogin())r=s.execute(function(){return h.prototype.addTag.call(o,t,n)});else{var c=e.defer(),l=m.transaction([y],"readwrite"),u=l.objectStore(y);r=c.promise,l.oncomplete=function(){return c.resolve()},l.onerror=function(e){c.reject(e)},u.openCursor(p.only(t)).onsuccess=function(e){var t=e.target,r=t.result;if(r){var o=r.value;g.renameTreeFromShort(o),o.tags=o.tags||[],-1===o.tags.indexOf(n)&&(o.tags.push(n),g.renameTreeToShort(o),r.update(o))}else c.reject()}}return r},v.prototype.removeTag=function(t,n){var r,o=this,a=this.getTreeMeta(t);if(!a)return e.reject();if(i.isLogin())r=s.execute(function(){return h.prototype.removeTag.call(o,t,n)});else{var c=e.defer(),l=m.transaction([y],"readwrite"),u=l.objectStore(y);r=c.promise,l.oncomplete=function(){return c.resolve()},l.onerror=function(e){return c.reject(e)},u.openCursor(p.only(t)).onsuccess=function(e){var t=e.target,r=t.result;if(r){var o=r.value;g.renameTreeFromShort(o),o.tags=o.tags||[];var i=o.tags.indexOf(n);-1!==i&&(o.tags.splice(i,1),g.renameTreeToShort(o),r.update(o))}else c.reject()}}return r},v.prototype.sync=function(e){var t=this;return s.execute(function(){return h.prototype.sync.call(t,e)})},v.prototype.pin=function(e){var t=this;return s.execute(function(){return h.prototype.pin.call(t,e)})},v.prototype.unpin=function(e){var t=this;return s.execute(function(){return h.prototype.unpin.call(t,e)})},v.prototype.move=function(e,t){var n=this;return s.execute(function(){return h.prototype.move.call(n,e,t)})},v.prototype.addEditor=function(e,t){var n=this;return s.execute(function(){return h.prototype.addEditor.call(n,e,t)})},v.prototype.removeEditor=function(e,t){var n=this;return s.execute(function(){return h.prototype.removeEditor.call(n,e,t)})},v.prototype.getLast=function(){var t;if(i.isLogin())t=s.execute(function(){return o.executeAuth("user","get.last.tree")});else{var n=m.transaction([y],"readwrite"),r=n.objectStore(y).index("modified"),a=e.defer();n.onerror=function(){return a.reject()},t=a.promise,r.openCursor(null,"prev").onsuccess=function(e){var t=e.target,n=t.result;if(n){var r=n.value;g.renameTreeFromShort(r),r.id=n.primaryKey,r.count=r.children.length,r.editable=!0,r.seen=!0;var o=angular.copy(r);g.renameTreeToShort(o),n.update(o).onsuccess=function(){return a.resolve(r)}}else a.reject()}}return t},v.prototype.syncLocal=function(){var t=this;return i.isLogin()?this.count().then(function(t){if(t){var n=e.defer(),r=m.transaction([y],"readonly"),o=r.objectStore(y).index("modified"),i=[];return r.oncomplete=function(){return n.resolve(i)},r.onerror=function(e){return n.reject(e)},o.openCursor(null,"prev").onsuccess=function(e){var t=e.target,n=t.result;if(n&&i.length<100){var r=n.value;g.renameTreeFromShort(r),i.push(new u(r,new d("",r)).toJSON(!0)),n.continue()}},n.promise}}).then(function(e){if(e)return s.execute(function(){return a.getToken().then(function(t){return o.executeAuth("tree","store.trees",{token:t.access_token,trees:e})})}).then(function(e){e.overQuota&&t.quotaObserver.notifyObservers()},angular.noop).then(function(){return r(function(){return l.sendMessage({type:"clear:trees"})},3e3)}).then(angular.noop)}):e.when()},v.prototype.sendMessage=function(e,t){return l.sendMessage({type:"command",value:t}).then(function(){l.sendMessage({type:"command:"+e,value:t})})},v}(v)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("usersControlStatic",["$timeout","trees","GApiShared","GApiExtension","chromeRuntime","chromeIdentity","usersAPIStatic",function(e,n,r,o,i,a,s){return function(s){function c(){return null!==s&&s.apply(this,arguments)||this}return t(c,s),c.prototype.simple_login=function(){var t=this;return o.login(!0).then(function(){return t.$rootScope.isLoggingIn=!0,i.sendMessage({type:"GAuth:token"})}).then(function(){return o.execute(function(){return r.loginUser(!0)})}).then(function(t){return e(1e3).then(function(){return n.syncLocal()}).then(function(){return e(1e3)}).then(function(){return t})})},c.prototype.loginYoutube=function(){var e=r.getYoutubeScope();return a.getAuthToken(!1,e).then(function(e){return e},function(){return a.getAuthToken(!0,e)})},c.prototype.logout=function(){var e=this;return a.getAuthToken().then(function(t){return e.logoutShared(t).then(function(){return a.removeCachedAuthToken(t)})}).then(function(){return i.sendMessage({type:"GAuth:logout"})})},c.prototype.userSetup=function(){var e=this;return o.login().then(function(t){return e.loginFirebase(t).then(function(){if(t)return n.syncLocal()})}).finally(function(){return angular.element("#init-load").remove()})},c.prototype.subscribeUser=function(e){var t=this;return o.execute(function(){return s.prototype.subscribeUser.call(t,e)})},c.prototype.unsubscribeUser=function(e){var t=this;return o.execute(function(){return s.prototype.unsubscribeUser.call(t,e)})},c.prototype.isSubscribed=function(e){var t=this;return o.execute(function(){return s.prototype.isSubscribed.call(t,e)})},c.prototype.loadSubscribers=function(e){var t=this;return o.execute(function(){return s.prototype.loadSubscribers.call(t,e)})},c.prototype.loadSubscriptions=function(e){var t=this;return o.execute(function(){return s.prototype.loadSubscriptions.call(t,e)})},c.prototype.publishDomain=function(e){var t=this;return o.execute(function(){return s.prototype.publishDomain.call(t,e)})},c.prototype.unpublishDomain=function(e){var t=this;return o.execute(function(){return s.prototype.unpublishDomain.call(t,e)})},c.prototype.listPublishDomains=function(){var e=this;return o.execute(function(){return s.prototype.listPublishDomains.call(e)})},c.prototype.complain=function(e,t){var n=this;return o.execute(function(){return s.prototype.complain.call(n,e,t)})},c}(s)}]);var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("youtubeIFrameControlStatic",["BASE_URL","youtubeIFrameSharedStatic",function(e,n){return function(n){function r(){return n.call(this,e)||this}return t(r,n),r.prototype.getFrameUrl=function(e){return this.BASE_URL+"/youtube_iframe?videoId="+e},r.prototype.createPlayer=function(e,t,n){var r=this;this.element=e,this.onMessage=function(e){if(e.origin==r.BASE_URL)return e.data.error?n():void t(e.data.data)},window.addEventListener("message",this.onMessage,!1)},r.prototype.destroy=function(){this.onMessage&&window.removeEventListener("message",this.onMessage),this.element=this.onMessage=null},r.prototype.loadVideoById=function(e){this.element.contentWindow.postMessage(e,this.BASE_URL)},r}(n)}])}(angular.module("tnDataControl",["tnIndexedDB","tnDataApp"])),function(e){e.config(["$provide",function(e){e.value("GApiApp",{execute:function(e){return e()}})}])}(angular.module("tnDataControlExtension",["tnDataControl"])),function(e){e.service("ignoreListService",["URI",function(e){function t(e){r.setItem("ignoreList",e.join(" "))}var n=this,r=localStorage;n.getList=function(){var e=r.getItem("ignoreList");return e?e.split(" "):[]},n.addItem=function(r){var o=n.getList();if(r){-1===r.indexOf("//")&&(r="//"+r);var i=e(r).host();-1===o.indexOf(i)&&(o.push(i),t(o))}},n.removeItem=function(e){var r=n.getList(),o=r.indexOf(e);o>-1&&(r.splice(o,1),t(r))},n.hasItem=function(t){return-1!==n.getList().indexOf(e(t).host())},n.removeUrl=function(t){n.removeItem(e(t).host())}}])}(angular.module("tnIgnoreList",["URIjs"])),function(e){var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();e.factory("facebookControlStatic",["GApiExtension","chromeIdentity","URI","facebookExtensionRedirectURL","facebookAPIStatic",function(e,n,r,o,i){return function(i){function a(){return null!==i&&i.apply(this,arguments)||this}return t(a,i),a.prototype.getToken=function(){var e=this;return n.launchWebAuthFlow(o()).then(function(t){return e.setAccessToken(t),t.access_token})},a.prototype.simple_login=function(e){return n.launchWebAuthFlow(o(e),!0).then(function(e){return e.access_token})},a.prototype.logout=function(){var e=this,t=r(this.logoutURL).query({next:"https://www.facebook.com",access_token:this.getAccessToken()});return n.logout(t.toString()).then(function(){return e.facebookLogout()})},a.prototype.fetchAccessToken=function(){var t=this;return e.execute(function(){return i.prototype.fetchAccessToken.call(t)})},a.prototype.facebookLogin=function(t){var n=this;return e.execute(function(){return i.prototype.facebookLogin.call(n,t)})},a.prototype.facebookLogout=function(){var t=this;return e.execute(function(){return i.prototype.facebookLogout.call(t)})},a}(i)}])}(angular.module("tnDataFacebookExtension",["tnDataFacebook"])),function(e){e.service("chromeRuntime",["$rootScope","$q","EXTENSION_ID",function(e,t,n){var r=this,o=chrome.runtime;o.onMessage.addListener(function(t,n,r){return e.$emit(t.type,t,n,r),!0}),r.sendMessage=function(e){var r=t.defer();return o.sendMessage(n,e,function(e){var t=o.lastError||e&&e.error;t?r.reject(t):r.resolve(e)}),r.promise}}])}(angular.module("tnChromeShared",["tnConfig"])),function(e){e.service("chromeIdentity",["$q","URI",function(e,t){var n=this,r=chrome.identity,o=chrome.runtime;n.launchWebAuthFlow=function(n,i){void 0===i&&(i=!1);var a=e.defer(),s={interactive:i,url:n};return r.launchWebAuthFlow(s,function(e){if(o.lastError)a.reject();else{var n=t(e).fragment(),r=t.parseQuery(n);r.access_token?a.resolve(r):a.reject()}}),a.promise},n.getAuthToken=function(t,n){if(void 0===t&&(t=!1),!r)return e.when("");var i=e.defer(),a={interactive:t};return n&&(a.scopes=n),r.getAuthToken(a,function(e){o.lastError?i.reject():i.resolve(e)}),i.promise},n.removeCachedAuthToken=function(t){var n=e.defer();return r.removeCachedAuthToken({token:t},function(){return n.resolve()}),n.promise},n.logout=function(t){var n=e.defer(),o={interactive:!0,url:t};return r.launchWebAuthFlow(o,function(){return n.resolve()}),n.promise},n.getRedirectURL=function(e){return r.getRedirectURL(e)}}]),e.service("chromeNotifications",["$q","$rootScope",function(e,t){var n=this,r=chrome.notifications;r.onClicked.addListener(function(e){t.$emit("notification:click",e)}),n.create=function(t,n){var o=e.defer();return r.getPermissionLevel(function(e){"granted"==e?r.create(t,n,function(){return o.resolve()}):o.reject()}),o.promise}}]),e.service("chromeTabs",["$q","URI","uriParser",function(e,t,n){function r(e){return e.id}function o(r){var o=[],i=[];if(r)return r.forEach(function(e){if(e.url&&"http"==e.url.slice(0,4)&&!l.test(e.url)){var r=c.executeScript(e.id,"content_scripts/canonical.js").then(function(t){return e.url=t||e.url},angular.noop).finally(function(){return e.url=n.parse(t(e.url).normalize()).toString()});i.push(e),o.push(r)}}),e.all(o).then(function(){return i})}var i=chrome.tabs,a=chrome.windows,s=chrome.runtime,c=this,l=new RegExp("://chrome.google.com/webstore");c.getCurrent=function(){var t=e.defer();return i.getCurrent(function(e){return t.resolve(e)}),t.promise},c.create=function(e,t,n){void 0===t&&(t=e),c.query(t).then(function(t){if(t)c.highlightWindow(t.windowId),i.highlight({tabs:t.index,windowId:t.windowId},angular.noop);else{var r={url:e};angular.isNumber(n)&&(r.windowId=n,c.highlightWindow(n)),i.create(r)}})},c.query=function(n){var r=e.defer();return i.query({},function(e){return r.resolve(e)}),r.promise.then(o).then(function(e){if(n){for(var r=t(n),o=void 0,i=0;i<e.length;i+=1)if(r.equals(e[i].url)){o=e[i];break}return o}return e})},c.remove=function(t){var n=e.defer();return i.remove(t,function(){return n.resolve()}),n.promise},c.highlight=function(t){var n=e.defer();return i.highlight({tabs:t.index,windowId:t.windowId},function(){return n.resolve(t.windowId)}),n.promise},c.highlightWindow=function(t){var n=e.defer();return a.update(t,{focused:!0},function(){return n.resolve()}),n.promise},c.reload=function(t){var n=e.defer();return i.reload(t,null,function(){return n.resolve()}),n.promise},c.getWindow=function(t){var n=e.defer();return a.get(t,function(e){return n.resolve(e)}),n.promise},c.createWindow=function(t){var n=e.defer();return a.create(t,function(e){return n.resolve(e)}),n.promise},c.getTabs=function(n){var r=e.defer(),o=n.map(function(e){return t(e)});return c.query().then(function(e){r.resolve(e&&e.filter(function(e){return o.some(function(t){return t.equals(e.url)})}))}),r.promise},c.getWindowURIs=function(n){var r=e.defer();return a.get(n,{populate:!0},function(e){return r.resolve(e.tabs)}),r.promise.then(o).then(function(e){return e.map(function(e){return t(e.url)})})},c.openTabs=function(t,n){function r(n){var r=[];return t.forEach(function(t){var o=e.defer();r.push(o.promise),i.create({windowId:n,url:t},function(){return o.resolve()})}),e.all(r).then(function(){return n})}return angular.isNumber(n)?c.highlightWindow(n).then(function(){return r(n)}):c.createWindow({focused:!0}).then(function(t){var n=t.tabs[0].id;return r(t.id).then(function(t){var r=e.defer();return i.remove(n,function(){return r.resolve()}),r.promise.then(function(){return t})})})},c.closeTabs=function(t){var n=e.defer();return c.getTabs(t).then(function(e){i.remove(e.map(r),function(){return n.resolve()})}),n.promise},c.moveTabs=function(t,n){function o(e,t){if(!e||!e.length)return a.resolve(t);i.move(e.map(r),{windowId:t,index:-1},function(){return a.resolve(t)})}var a=e.defer();return c.getTabs(t).then(function(e){if(!e||!e.length)return a.resolve(n);angular.isNumber(n)?(c.highlightWindow(n),o(e.filter(function(e){return e.windowId!=n}),n)):c.createWindow({focused:!0,tabId:e[0].id}).then(function(t){return o(e.slice(1),t.id)})}),a.promise},c.executeScript=function(t,n,r,o){void 0===r&&(r=0);var a=e.defer(),c={runAt:"document_idle",frameId:r};return n?c.file=n:c.code=o,i.executeScript(t,c,function(e){s.lastError?a.reject(s.lastError):(e=e||[],a.resolve(e[0]))}),a.promise},c.insertCSS=function(t,n,r){void 0===r&&(r=0);var o=e.defer(),a={file:n,runAt:"document_idle",frameId:r};return i.insertCSS(t,a,function(){return o.resolve()}),o.promise},c.executeScripts=function(t,n,r){void 0===r&&(r=0);var o=e.when();return n.forEach(function(e){o=o.then(function(){return c.executeScript(t,e,r)})}),o},c.getTab=function(t){var n=e.defer();return i.get(t,function(e){return n.resolve(e)}),n.promise},c.openApp=function(){i.create({url:"control.html"})},c.reloadApp=function(e){i.update(e,{url:"control.html"})}}])}(angular.module("tnChrome",["tnChromeShared","URIjs"])),function(e){e.service("dataUtil",["util","treeProperty","treeShortProperty","nodesProperties","nodesShortProperties",function(e,t,n,r,o){void 0===Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),this.renameTreeFromShort=angular.bind(e,e.renameProperties,n,t),this.renameTreeToShort=angular.bind(e,e.renameProperties,t,n),this.renameNodeFromShort=angular.bind(e,e.renameProperties,o,r),this.renameNodeToShort=angular.bind(e,e.renameProperties,r,o),this.distance=function(e,t,n,r){var o=(r-t).toRad(),i=(n-e).toRad(),a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t.toRad())*Math.cos(r.toRad())*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371}}])}(angular.module("tnDataUtil",["tnConfig","tnUtil"])),function(e){e.factory("facebookExtensionRedirectURL",["chromeIdentity","URI","FB_ID","FB_SCOPES",function(e,t,n,r){var o=e.getRedirectURL("provider_cb");return function(e){return void 0===e&&(e=r),t("https://www.facebook.com/dialog/oauth").query({client_id:n,redirect_uri:o,scope:e.join(","),response_type:"token",access_type:"online"}).toString()}}]).factory("GApiExtension",["$q","$timeout","GAuth","GData","chromeIdentity",function(e,t,n,r,o){var i={};return i.login=function(e){return void 0===e&&(e=!1),o.getAuthToken(e).then(angular.noop,angular.noop).then(function(){return o.getAuthToken()}).then(function(e){if(navigator.onLine)return n.setToken({access_token:e})}).then(angular.noop,angular.noop).then(function(){return r.getUser()})},i.execute=function(t,n){return void 0===n&&(n=2),n?o.getAuthToken().then(function(r){return gapi.auth.setToken({access_token:r}),t().then(function(e){return e},function(a){return 401==a.code?o.removeCachedAuthToken(r).then(function(){return i.execute(t,n-1)}):e.reject(a)})},t):e.reject()},i.isLogin=function(){var t=r.isLogin(),i=function(){return!1};return t?e.when(!0):o.getAuthToken().then(function(e){return n.setToken({access_token:e}).then(function(){return!0},function(){return o.removeCachedAuthToken(e).then(i,i)})},i)},i}]).factory("createOverQuotaNotification",["chromeNotifications","overQuotaNotification","treesConfig",function(e,t,n){return function(){n.checkOverQuota()&&e.create("overQuota",t).then(n.setOverQuota)}}])}(angular.module("tnDataExtension",["tnIgnoreList","tnDataFacebookExtension","tnChrome","tnDataUtil"])),function(e){e.config(["$provide","TabConfig",function(e,t){e.factory("Tab",["$window","layoutObservers",function(e,n){var r=chrome.tabs;return e.addEventListener("resize",function(){t.width=e.innerWidth,t.height=e.innerHeight,n.widthObserver.notifyObservers()}),t.active=!0,r.onMoved.addListener(function(e,n){t.id==e&&t.windowId==n.windowId&&(t.index=n.toIndex)}),r.onAttached.addListener(function(e,n){t.id==e&&(t.windowId=n.newWindowId)}),t}])}]).run(["$rootScope","$window","$q","chromeRuntime","chromeTabs","Tab",function(e,t,n,r,o,i){r.sendMessage({type:"tab:selected"}).then(function(e){return e?o.highlight(e):n.reject()}).then(function(e){return o.highlightWindow(e)}).then(function(){return o.remove(i.id)})}])}(angular.module("tnChromeControl",["tnChromeShared"])),function(e){e.run(["chromeTabs","Set","nodes",function(e,t,n){function r(){e.query().then(o)}function o(e){n.openedTabs=new t(e.map(function(e){return e.url})),n.openedTabsObserver.notifyObservers()}var i=chrome.tabs;i.onUpdated.addListener(function(e,t){t.url&&r()}),i.onRemoved.addListener(r),chrome.windows.onRemoved.addListener(function(e){n.windowCloseObserver.notifyObservers(e)}),r()}])}(angular.module("tnChromeTabs",["tnChrome"])),function(e){e.value("nodeSize",{width:180,height:200,margin:{left:40,top:80},listed:72}),e.factory("layoutObservers",["ObservableClass",function(e){var t=e(),n=e(),r=e();return{widthObserver:t,scrollObserver:n,nodeDragObserver:e(),scrollEndObserver:r}}]),e.value("treeMargin",50).value("treeMetaHeight",50).value("treesContainerSidesPadding",60).value("treesToolbarHeight",44).value("treeBodyHorizontalPadding",50).value("treeBodyVerticalPadding",16).value("treeLegendHeight",76)}(angular.module("tnLayout",["tnConfig"])),function(e){e.controller("AnalyticsDialog",["$element","urlShortener","dialogConfig",function(e,t,n){function r(e){return e.append("div").attr("class","toolTip"),e.append("svg").append("g").attr("transform","translate("+m/2+","+p/2+")").call(i)}function o(e){s.call(a,e.countries),u.call(a,e.referrers),c.call(a,e.browsers),l.call(a,e.platforms)}function i(e){e.append("g").attr("class","slices"),e.append("g").attr("class","labelName"),e.append("g").attr("class","labelValue"),e.append("g").attr("class","lines")}function a(e,t){function n(e){return e.startAngle+(e.endAngle-e.startAngle)/2}var r=d3.select(e.node().parentNode.parentNode);if(!t)return void r.style("display","none");var o=t.map(function(e){return parseInt(e.count)}).reduce(function(e,t){return e+t}),i=r.select(".toolTip"),a=d3.scale.category20(),s=d3.scale.ordinal().range(a.range());t.forEach(function(e){return e.value=Math.round(parseInt(e.count)/o*1e4)/100});var c=0,l=0;t=t.filter(function(e){var t=e.value>=2;return t||(c+=e.value,l+=parseInt(e.count)),t}),c&&t.unshift({value:Math.round(100*c)/100,id:"Others",count:l.toString()});var u=e.select(".slices").selectAll("path.slice").data(g(t),function(e){return e.data.id});u.enter().insert("path").style("fill",function(e){return s(e.data.id)}).attr("class","slice"),u.transition().duration(1e3).attrTween("d",function(e){this._current=this._current||e;var t=d3.interpolate(this._current,e);return this._current=t(0),function(e){return f(t(e))}}),u.on("mousemove",function(e){i.style("left",d3.event.pageX+10+"px"),i.style("top",d3.event.pageY-25+"px"),i.style("display","inline-block"),i.html(e.data.id+"<br>"+e.data.value+"%")}),u.on("mouseout",function(e){i.style("display","none")}),u.exit().remove();var d=s.domain();"Others"==d[0]&&(d.push(d[0]),d.shift());var m=e.selectAll(".legend").data(d).enter().append("g").attr("class","legend").attr("transform",function(e,t){var n=b+y,r=n*d.length/2;return"translate("+-3*b+","+(t*n-r)+")"});m.append("rect").attr("width",b).attr("height",b).style("fill",function(e){return s(e)}).style("stroke",function(e){return s(e)}),m.append("text").attr("x",b+y).attr("y",b-y+2.25).text(function(e){return e});var p=e.select(".labelName").selectAll("text").data(g(t),function(e){return e.data.id});p.enter().append("text").attr("dy",".35em").text(function(e){return e.data.id+": "+e.value+"%"}),p.transition().duration(1e3).attrTween("transform",function(e){this._current=this._current||e;var t=d3.interpolate(this._current,e);return this._current=t(0),function(e){var r=t(e),o=v.centroid(r);return o[0]=h*(n(r)<Math.PI?1:-1),"translate("+o+")"}}).styleTween("text-anchor",function(e){this._current=this._current||e;var t=d3.interpolate(this._current,e);return this._current=t(0),function(e){return n(t(e))<Math.PI?"start":"end"}}).text(function(e){return e.data.id+": "+e.value+"%"}),p.exit().remove();var k=e.select(".lines").selectAll("polyline").data(g(t),function(e){return e.data.id});k.enter().append("polyline"),k.transition().duration(1e3).attrTween("points",function(e){this._current=this._current||e;var t=d3.interpolate(this._current,e);return this._current=t(0),function(e){var r=t(e),o=v.centroid(r);return o[0]=.95*h*(n(r)<Math.PI?1:-1),[f.centroid(r),v.centroid(r),o]}}),k.exit().remove()}var s,c,l,u,d=this,m=960,p=450,h=Math.min(m,p)/2,g=d3.layout.pie().sort(null).value(function(e){return e.value}),f=d3.svg.arc().outerRadius(.8*h).innerRadius(.4*h),v=d3.svg.arc().innerRadius(.9*h).outerRadius(.9*h),b=.05*h,y=.02*h;d.url="https://goo.gl/"+n.key,d.title=n.title,d.onload=function(){s=r(d3.select("#countries")),c=r(d3.select("#browsers")),l=r(d3.select("#platforms")),u=r(d3.select("#referrers")),t.analytics(n.key).then(function(e){o(e.analytics.allTime),d.clicks=e.analytics.allTime.longUrlClicks,d.created=e.created})}}]),e.controller("ArticleDialogCtrl",["$scope","$element","$rootScope","$mdDialog","URI","BASE_URL","nodeKey","treeKey",function(e,t,n,r,o,i,a,s){function c(e){var t=e.data;e.origin==i&&t.isArticle&&!t.len&&(n.openUrl(a,"articleError"),r.hide())}var l={key:a,is_frame:!0},u=t.find("iframe")[0];s&&!parseInt(s)&&(l.tree=s),u.src=o(i).path("/article/").query(l).toString(),u.onload=function(){t.find("#article-dialog-progress").remove()},window.addEventListener("message",c,!1),e.$on("$destroy",function(){return window.removeEventListener("message",c)})}]),e.controller("MapDialogCtrl",["$scope","maps","geolocation","geoNodes",function(e,t,n,o){function i(e){return o.forEach(function(e){var n=t.createNodeMarker(d,e,a);d.getCenter()||d.setCenter(n.marker.getPosition()),l.push(n)}),e}function a(){l.forEach(function(e){return e.infoWindow.value.setZIndex(1)})}function s(e){var t=e.infoWindow.value;t.close(),t.setContent("")}function c(){l.forEach(s)}var l=[],u=r.element("#map-container")[0],d=t.createMap(u,c);n.getCurrentPosition().then(function(e){return t.createUserMarker(d,e)}).then(i,i).then(function(e){e&&t.setUserDistances(e,l)}),e.$on("$destroy",function(){return l.forEach(function(e){t.clearInstanceListeners(e.marker),e.infoWindow.scope.$destroy()})}),r.element("#map-progress").remove()}]),e.controller("MenuCtrl",["$scope","$templateCache","$timeout","$animate","$mdPanel",function(e,t,n,o,i){var a,s=this;s.open=function(n){var c=e.$new(),l=r.element(n.currentTarget),u=i.newPanelPosition().relativeTo(l).addPanelPosition(i.xPosition.ALIGN_START,i.yPosition.ALIGN_TOPS).addPanelPosition(i.xPosition.ALIGN_START,i.yPosition.CENTER).addPanelPosition(i.xPosition.ALIGN_START,i.yPosition.ALIGN_BOTTOMS).addPanelPosition(i.xPosition.ALIGN_END,i.yPosition.ALIGN_TOPS).addPanelPosition(i.xPosition.ALIGN_END,i.yPosition.CENTER).addPanelPosition(i.xPosition.ALIGN_END,i.yPosition.ALIGN_BOTTOMS),d=i.newPanelAnimation().openFrom(l[0]).closeTo(l[0]).withAnimation(i.animation.SCALE),m={scope:c,template:t.get(s.template),position:u,animation:d,targetEvent:n,clickOutsideToClose:!0,escapeToClose:!0,trapFocus:!0,panelClass:"_md md-clickable md-whiteframe-4dp md-open-menu-container",origin:l,onDomAdded:function(){o.addClass(a.panelEl,"md-active").then(function(){a.panelEl.find("md-menu-content").mCustomScrollbar({theme:"minimal-dark"})})},onRemoving:function(){a.panelEl.removeClass("md-active"),o.addClass(a.panelEl,"md-leave"),a.panelEl.find("md-menu-content").mCustomScrollbar("destroy")},onDomRemoved:function(){c.$destroy(),s.destroy&&s.destroy(),a=null}};a=i.create(m),a.open()},s.close=function(){return a&&a.close()}}]),e.controller("NodeDialogCtrl",["URI","nodes","dialogConfig","BASE_URL",function(e,t,n,r){var o=this;o.node=t.getNode(n.key),o.transformTag=function(e){return e},o.domain=e(o.node.url).host(),o.domainUrl=r+"/domain/"+o.domain,o.openUrl=n.openUrl,o.loading=!0,t.linkedNodes(n.key).then(function(e){return o.container=e}).finally(function(){return o.loading=!1})}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.controller("NodeMenuCtrl",["$scope","$controller","GData","nodes",function(e,t,n,r){var o=t("MenuCtrl as nodeMenuCtrl",{$scope:e}),i=o.open;o.open=function(e){if(n.isLogin()){var t=o.nodeCtrl;r.hasFavorite(t.node.data.key).then(function(e){t.favorite=e,t.favoriteDisabled=!1})}i.call(o,e)},o.destroy=function(){return o.nodeCtrl.favoriteDisabled=!0}}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.controller("NodeCtrl",["$scope","$rootScope","$mdDialog","$q","GData","Analytics","URI","nodes","users","rss","uriParser","Trees","toastObserver","nodeColorExpression","nodeRelatedColorExpression","nodeDialogConfig","mapDialogConfig","reportDialogConfig","userImagesDialogConfig","relatedDialogConfig","analyticsDialog","ObservableClass","BASE_URL",function(e,t,n,o,i,a,s,c,l,u,d,m,p,h,g,f,v,b,y,k,w,C,_){function S(){I.isOpened=I.isSelectedPage||c.openedTabs&&c.openedTabs.any(function(e){return P.equals(e)})}function x(){var e=h,t=c.getNode(A);if(I.node){I.node.data.value.related&&(e=g),I.nodeColors&&(e=I.nodeColors),P=s(t.url||A);var n=P.host();I.node.domain=n,I.node.color=t.color,I.node.favicon=t.favicon,I.colors=e,I.hasGeolocation=!!t.geo,I.isPDF="PDF"==t.type,I.isWebSearch="web search"==t.type,I.hasRSS=!!t.rss,I.isArticle=t.isArticle&&"www.youtube.com"!=n&&"www.netflix.com"!=n&&"twitter.com"!=n,S()}}function T(o,i,a,s,c,l){void 0===c&&(c="related"),void 0===l&&(l=!0);var u=r.copy(k),d=u.scope=e.$new();u.targetEvent=o,u.onShowing=function(){i.then(function(e){var n=d.relatedDialogCtrl;n.container=e,n.loading=!1,n.title=s,n.node=a,n.openUrl=function(e){if(l)return t.openUrl(e,c);t.openLongUrl(e,c)}})},n.show(u)}var A,P,D,$,I=this,M=c.openedTabsObserver,E=I.dataObserver=C();I.favoriteDisabled=!0,I.$onInit=function(){A=I.node.data.key;var t=c.getNode(A);switch(I.nodeShortURL=c.getShortUrl(A),P=s(t.url||A),t.url?I.nodeURL=c.getShortUrl(A,t.isArticle):I.nodeURL=A,D=c.getYoutubeVideoId(t),I.isYoutubeVideo=!!D,P.host()){case"www.facebook.com":$=t.facebook_id||d.getFacebookId(P),I.hasPhotos=!!$}S(),e.$on("update:"+A,function(){E.notifyObservers(),x()}),I.node.title=t.title.slice(0,10)+(t.title.length>10?"...":""),I.favoriteDisabled=!1,I.domainUrl=_+"/domain/"+P.host()},I.showPhotosDialog=function(e){var t=r.copy(y);t.targetEvent=e,t.locals={facebook_id:$,title:c.getNode(A).title},n.show(t)},I.openYoutubeVideo=function(e){var t=o.defer(),r=o.defer();n.show({targetEvent:e,controller:"YoutubeIFrameDialogCtrl",controllerAs:"youtubeIFrameDialogCtrl",templateUrl:"partials/shared/youtube-dialog.html",hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,locals:{youtubeDialogData:{videoId:D,onLoad:t.promise,onClose:r.promise,nodeCtrl:I}},onRemoving:function(){return r.resolve()},onShowing:function(){return t.resolve()}}).catch(console.log)},I.showMapDialog=function(e){var t=r.copy(v);t.targetEvent=e,t.locals={geoNodes:[c.getNode(A)],title:c.getNode(A).title},n.show(t)},I.openArticle=function(e){n.show({targetEvent:e,controller:"ArticleDialogCtrl",templateUrl:"partials/shared/article-dialog.html",hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,locals:{nodeKey:A,treeKey:I.treeKey}})},I.showReportDialog=function(e){if(!i.isLogin())return t.login();var o=r.copy(b);o.targetEvent=e,o.locals={reportTarget:{node:A}},n.show(o).then(function(e){I.reportDisabled=!0,e?E.notifyObservers():t.userSettings.reportGoogleDisabled||n.show({hasBackdrop:!1,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/shared/report-google-dialog.html",controller:function(){var e=this;e.reportUrl="https://goo.gl/"+A,e.showDialogChange=function(){a.trackEvent("reportGoogleDialog","show","")}},controllerAs:"reportGoogleDialog"})})},I.showNodeDialog=function(e){var o=r.copy(f);o.targetEvent=e,o.locals={dialogConfig:{key:A,openUrl:function(){return t.openUrl(A,"linked")}}},n.show(o)},I.showAnalyticsDialog=function(e){var t=c.getNode(A).title,o=r.copy(w);o.targetEvent=e,o.locals={dialogConfig:{key:A,title:t}},n.show(o)},I.related=function(e){T(e,c.related(A),c.getNode(A),"Related")},I.rss=function(e){T(e,u.query(A),c.getNode(A),"RSS","rss",!1)},I.googleSearch=function(e){var t=c.getNode(A);T(e,c.googleSearch(t.title),t,"Search","google",!1)},I.toggleFavorite=function(){var e,n="Added to favorites";if(!i.isLogin())return t.login();I.favorite?(n="Removed from favorites",e=c.removeFavorite(A)):e=c.addFavorite(A),e.then(function(){p.notifyObservers(n),I.favorite=!I.favorite})},I.copyNode=function(e){return m.bufferNode(e)},I.getPreview=function(){return c.getNodePreview(A)},M.subscribe(S),e.$watch("nodeCtrl.nodeColors",x),e.$on("$destroy",function(){E.removeObservers(),M.unsubscribe(S)})}]),e.controller("ReportDialogCtrl",["$mdDialog","nodes","trees","toastObserver","reportTarget",function(e,t,n,r,o){var i=this;i.report=function(){var a;o.node?a=t.report(o.node,i.reason).then(function(e){return e.isBlocked}):o.tree&&(a=n.report(o.tree,i.reason).then(function(){return!1})),a&&a.then(function(t){r.notifyObservers("Content reported"),e.hide(t)})},i.cancel=function(){return e.hide()}}]),e.controller("ShareMenuCtrl",["$rootScope","$mdDialog","GData","users","facebook","bufferService","Analytics","URI","debounce",function(e,t,n,o,i,a,s,c,l){function u(e){var t;g.publish&&(t=g.publish()),t?t.then(e):e()}function d(e){t.show({targetEvent:e,disableParentScroll:!0,clickOutsideToClose:!1,hasBackdrop:!0,controllerAs:"vm",controller:p,templateUrl:"partials/shared/buffer-dialog.html"})}function m(e){t.show({targetEvent:e,disableParentScroll:!0,clickOutsideToClose:!0,hasBackdrop:!0,controllerAs:"vm",controller:h,templateUrl:"partials/shared/facebook-pages-dialog.html",onComplete:function(e,t){t.find("md-dialog-content").mCustomScrollbar({theme:"minimal-dark"})},onRemoving:function(e){e.find("md-dialog-content").mCustomScrollbar("destroy")}})}function p(){var e,t=this;e="node"==g.preview().type?g.containerPreview&&g.containerPreview():g.preview(),t.container=g.container(),e&&t.container.unshift(e),t.container.length||(t.container=[g.preview()]),t.current=t.container.filter(function(e){return e.targetUrl==g.url})[0],t.container.forEach(function(e,n){e.domain=c(e.url).domain(),e.targetUrl==g.url&&(t.current=e,n>0&&(t.container.splice(n,1),t.container.unshift(e)))}),t.publishEvent=[g.category,"share","buffer"],t.publish=function(){if(!t.loading){var e=t.profiles.filter(function(e){return e.selected}).map(function(e){return e.id}),n={photo:t.current.photo||"",link:t.current.targetUrl};t.loading=!0,a.createUpdate({profile_ids:e,media:n,now:t.current.now||!1,top:t.current.top||!1,text:t.current.text||"",shorten:!0}).then(function(e){t.current.isPublished=e.success,t.error=!e.success,t.messeage=e.message},function(){return t.error=!0}).finally(function(){return t.loading=!1})}},t.selectTag=function(e){var n=e.split(" "),e="#"+e[0].toUpperCase()+e.slice(1);n.length>1&&(e="#"+n.map(function(e){return e[0].toUpperCase()+e.slice(1)}).join("")),t.current.text=t.current.text||"",-1===t.current.text.indexOf(e)&&(t.current.text+=" "+e,s.trackEvent("bufferDialog","tag",""))},t.onProfileSelect=function(){t.publishDisabled=!t.profiles.some(function(e){return e.selected}),s.trackEvent("bufferDialog","profile","")},t.trackEvent=function(e){s.trackEvent("bufferDialog",e,"")},a.getProfiles().then(function(e){t.profiles=e,t.profiles.forEach(function(e){e.selected=!0})})}function h(){var e=this,t=[],n=e.preview=g.preview();e.domain=c(n.url).domain(),e.facebook=i,e.publishEvent=[g.category,"share","facebookPages"],e.loginPublisher=l(function(){return i.simple_login(["publish_actions","publish_pages"]).then(function(e){return i.publisherLogin(e)})},5e3,!0,!0),e.publish=function(n){e.loading||(e.loading=!0,i.publish(n,g.url).then(function(){return t.push(n.id)}).finally(function(){return e.loading=!1}))},e.isPagePublished=function(e){return-1!==t.indexOf(e)},i.groups||e.loginPublisher()}var g=this;g.$onInit=function(){g.provider={},g.shareUrlEvent=[g.category,"share","url"],g.shareFacebookPagesEvent=[g.category,"facebookPages"],g.shareBufferEvent=[g.category,"buffer"],g.event={shareFacebook:[g.category,"share","facebook"],shareGoogle:[g.category,"share","google"],shareTwitter:[g.category,"share","twitter"],sharePocket:[g.category,"share","pocket"]},r.forEach(g.event,function(e,t){g.provider[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];g.close&&g.close(),u(function(){return o[t].apply(o,e)})}})},g.shareFacebookPages=function(t){if(!n.isLogin())return e.login();u(function(){return m(t)}),g.close()},g.shareBuffer=function(t){return n.isLogin()?a.isLogin()?(u(function(){return d(t)}),void g.close()):a.login():e.login()}}]),e.controller("TreeDialogCtrl",["$mdDialog","Analytics","trees","tagsApi","disqus","treeMeta",function(e,t,n,o,i,a){var s=this,c=a.id,l=!1,u=a.observer;s.commentCount=0,s.treeMeta=r.copy(a),s.save=function(){var t=s.treeMeta.title,r=s.treeMeta.description;t!=a.title||r!=a.description?(a.title=t,a.description=r,n.editTree(c).finally(function(){return e.hide()}),u.notifyObservers()):e.hide()},s.cancel=function(){return e.hide()},s.addTag=function(e){r.copy(s.treeMeta.tags,a.tags),n.addTag(c,e),t.trackEvent("treeInfo","tagAdd",""),u.notifyObservers()},s.removeTag=function(e){r.copy(s.treeMeta.tags,a.tags),n.removeTag(c,e),t.trackEvent("treeInfo","tagRemove",""),u.notifyObservers()},s.transformTag=o.transformTag,s.searchTags=function(){return o.getTags(s.searchText)},s.openComments=function(){l||i.reset(c,a.title),l=!0,t.trackEvent("treeInfo","comments","")},a.editable&&!a.published||i.getCommentCount(c).then(function(e){return s.commentCount=e})}]),e.controller("TreeEditorsDialogCtrl",["$scope","GApi","users","trees","debounce","Analytics","userIds","treeKey",function(e,t,n,r,o,i,a,s){function c(){l.container=u.toArray(),l.container.forEach(function(e){e.value.isEditor=a.indexOf(e.key)>-1}),l.showInvite=n.showInvite()}var l=this,u=l.usersContainer=n.usersContainer;l.container=[],l.disableScroll=function(){return u.loading||!u.more},l.scroll=function(){return u.more&&n.load()},l.canEdit=function(e){var t=e.id;e.isEditor?(a.push(t),r.addEditor(t,s)):(a.splice(a.indexOf(t),1),r.removeEditor(t,s)),l.isMaxEditors=a.length>=10,i.trackEvent("tree","editor","")},l.onload=function(){l.$element.find("md-dialog-content").mCustomScrollbar({theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:o(function(){l.disableScroll()||l.scroll()},1e3),onOverflowY:function(){l.hasScrollBar=!0},onOverflowYNone:function(){l.hasScrollBar=!1}}})},u.subscribe(c),e.$on("$destroy",function(){u.clear(),u.unsubscribe(c)}),l.scroll()}]),e.controller("TreeImagesDialogCtrl",["$timeout","trees","treeKey",function(e,t,n){var r=this,o=t.treesContainer.getTree(n);o&&(e(function(){return r.imageNodes=o.getImages()},1e3),r.selectImage=function(i){e(function(){return r.currentImage=i}),o.meta.image=i,t.editImage(n)},r.currentImage=o.meta.image,r.title=o.meta.title,r.editable=o.meta.editable&&!o.meta.limitedEdit)}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.controller("TreeCtrl",["$rootScope","$scope","$timeout","$mdDialog","GData","trees","nodes","users","Analytics","firebaseService","chromeTabs","rss","toastObserver","Trees","TreeMeta","Nodes","ObservableClass","debounce","treeEditorsDialogConfig","reportDialogConfig","util","deleteTreeConfirmDialog","nodeDialogConfig","nodeUrlDialogConfig","analyticsDialog","BASE_URL","STORAGE_URL","animationDuration",function(e,t,n,o,i,a,s,c,l,u,d,m,p,h,g,f,v,b,y,k,w,C,_,S,x,T,A,P){function D(n){n.name==G.toString()&&n.onMessage.addListener(function(n){"page:close"==n.type?t.$destroy():e.$emit("command:"+G,n)})}function $(n,r){var o,i=moment().day(-1).toDate();return o=n.type=="link:"+G?new Date(n.value.timestamp):new Date(n.value.modified),o.setMilliseconds(0),o<i&&q.editable?void r():n.type=="link:"+G?void e.$emit(n.type,n):void(-1===["store","remove"].indexOf(n.type.split(".")[0])?o>=K&&t.$applyAsync(function(){return I(n)}):o>t.tree.value.meta.modified&&(t.tree.value.meta.modified=o,n.value.nodes&&n.value.nodes.forEach(function(e){return f.addNode(e.value,e)}),t.$applyAsync(function(){return M(n)})))}function I(e){var n;switch(e.type){case"edit.tree":var r=t.tree.value.meta;r.title=e.value.title,r.description=e.value.description,r.observer.notifyObservers();break;case"favorite.tree":n=e.value.favorite,t.tree.value.meta.favorite=n;break;case"publish.tree":n=e.value.published,t.tree.value.meta.published=n}}function M(e){switch(e.type){case"store.links":z.storeLinks(e.value);break;case"remove.links":z.removeLinks(e.value);break;case"store.link":z.storeLink(e.value);break;case"remove.link":z.removeLink(e.value);break;case"store.root":z.storeRoot(e.value);break;case"remove.root":z.removeRoot(e.value)}q.update()}function E(e,r,o){function i(r){var i=t.tree.value,a=i.get(r);!a||a.related?(O(r,e),n(function(){return t.openUrl(r,o,q.windowId)},P)):t.openUrl(r,o,q.windowId)}return void 0===r&&(r=!0),void 0===o&&(o="related"),function(e){if(e)if(r){if(!q.editable)return t.openLongUrl(e,o,q.windowId);s.getNodeRequest(e).then(function(e){return e.value}).then(i)}else{if(!q.editable)return t.openUrl(e,o,q.windowId);i(e)}}}function O(e,n){var r=t.tree.value;r.remove(e);var o=h.newLink(n,e,new Date),i=r.getMerge(o);i.execute(),q.updateData(i),q.update()}function L(e){e&&t.tree.value.hasKey(e)&&(q.updateSort(null),q.update())}function U(e){return e&&e.filter(function(e){return!t.tree.value.hasKey(e.data.key)})}function N(){var e=t.tree.value.keys();return s.getNodes(e).then(function(){if(s.getNodesRequest&&!t.user&&q.editable){var n=e.filter(function(e){return!f.hasKey(e)});if(n.length)return s.getNodesRequest(n)}})}function R(){return f.getByKeys(t.tree.value.keys()).map(function(e){return e.url})}function B(e){q.windowId=e}function j(e){q.windowId==e&&B(null)}var F,q=this,G=q.key=t.tree.key,z=a.treesContainer,W=T+"/embed/?tree="+G,H="trees/"+t.tree.value.meta.shortUrl+"/commands",Y=t.tree.value.meta.modified,K=new Date,V=e.$on("link:"+G,function(e,n,o,i){void 0===i&&(i=r.noop),t.$applyAsync(function(){var e=n.value,r=e.link,o=e.timestamp,i=new Date(o);if(i.setMilliseconds(0),!(i<=t.tree.value.meta.modified)){var a=h.newLink(r.parent,r.child,i),s=t.tree.value.getMerge(a);t.newNode(n.value),s&&(t.tree.value.meta.modified=i,s.execute(),q.update())}}),i()});t.tree.value.isOpened=!0,q.selectedPage=t.tree.value.meta.selectedPage,q.treeUrl=T+"/?tree="+G,q.url=t.tree.value.meta.shortUrl,q.shortUrl=s.getShortUrl(t.tree.value.meta.shortUrl),q.embedCode='<iframe width="400" height="500" frameborder="0" allowfullscreen src="'+W+'"</iframe>',q.editable=t.tree.value.meta.editable,q.limitedEdit=t.tree.value.meta.limitedEdit,q.searchTextObserver=v(),q.add=b(function(){var e=t.tree.value;i.isLogin()||t.isExtension?a.add(e).then(function(){return t.tree.value.meta.isReposted=!0}):t.mainCtrl.login()},1e3,!0,!1),q.toggleFavorite=b(function(){t.tree.value.meta.favorite=!t.tree.value.meta.favorite,a.toggleFavorite(G)},1e3,!0,!1),q.togglePublished=b(function(){return i.isLogin()?(t.tree.value.meta.published=!t.tree.value.meta.published,a.togglePublished(G)):void t.mainCtrl.login()},1e3,!0,!1),q.canShare=function(){return t.tree.value.meta.published||!q.limitedEdit},q.shareUrl=function(){},q.publish=function(){if(!t.tree.value.meta.published&&q.editable){var e=t.tree.value.meta.title,r=e.slice(0,15);return e.length>15&&(r+="..."),q.togglePublished().then(function(){return p.notifyObservers('Tree "'+r+'" is now public')}).then(function(){return n(3e3)})}},q.getPreview=function(){var e=t.tree.value.meta;return{title:e.title+"| Brancher",image:A+"tree_image/"+e.shortUrl,secondaryImage:e.image,url:T,description:e.description,targetUrl:q.shortUrl,type:"tree",tags:e.tags}},q.getNodesPreview=function(){var e=t.tree.value.sortBy(function(e){return e.value.timestamp}).map(function(e){return e.key});return s.getNodesPreview(e)},q.shareYoutube=function(){if(!i.isLogin())return void t.mainCtrl.login();c.loginYoutube().then(function(e){o.show({scope:t,preserveScope:!0,templateUrl:"partials/shared/youtube-tree-dialog.html",controller:"YoutubeTreeDialogCtrl",controllerAs:"youtubeTreeDialog",hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,locals:{accessToken:e}})})},q.updateData=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0),a.commandQueue.enqueue(function(){return a.updateTree(G,e,t,n).then(function(){var n,o=e.getCount();if(e.isMerge?n=!t:e.isRemove&&(n=!!t),r.isDefined(n)){var i=n?o+" node(s) added":o+" node(s) removed";p.notifyObservers(i)}})},null,[])},q.execute=function(e,t,r){return void 0===r&&(r=!0),n(function(){var n=z.method(e)(G,t);if(n)return n.execute(),q.update(),q.updateData(n,!1,r)},0)},q.undo=b(function(){n(function(){var e=t.tree.value.stack;e.undo(),q.updateData(e.getCommand(e.pointer),!0),q.update()},0)},1e3,!0,!1),q.redo=b(function(){n(function(){var e=t.tree.value.stack;e.redo(),q.updateData(e.getCurrent()),q.update()})},1e3,!0,!1),q.updateView=b(function(e){q.treeNodesCtrl.isListed=!q.treeNodesCtrl.isListed,q.update(e)},1e3,!0,!1),q.updateExpandedView=function(){q.treeNodesCtrl.isExpanded=!q.treeNodesCtrl.isExpanded,q.updateFocus(null),q.updateLayout()},q.removeRelated=function(e){t.tree.value.remove(e),q.update()},q.openUrl=function(e){var n=t.tree.value,r=n.get(e);r.related&&n.meta.editable&&O(e,r.parent),t.openUrl(e,q.treeNodesCtrl.isListed?"treeListView":"treeView",q.windowId)},q.related=function(e,t){q.openRelatedDialog(e,s.related(t).then(U),s.getNode(t),"Related").then(E(t,!1))},q.rss=function(e,t){q.openRelatedDialog(e,m.query(t),s.getNode(t),"RSS").then(E(t,!0,"rss"))},q.googleSearch=function(e,t){var n=s.getNode(t),r=s.googleSearch(n.title);q.openRelatedDialog(e,r,n,"Search").then(E(t,!0,"google"))},q.showNodeDialog=function(e,t){var n=r.copy(_);n.targetEvent=e,n.locals={dialogConfig:{key:t,openUrl:function(e){return o.hide(e)}}},o.show(n).then(E(t,!1,"linked"))},q.addUrlDialog=function(e,n){var i=r.copy(S);i.targetEvent=e,i.controller=function(){var e=this;e.getUrl=function(t){e.loading=!0,s.getNodeRequest(t).then(function(e){return o.hide(e.value)}).finally(function(){return e.loading=!1})}},o.show(i).then(function(e){t.tree.value.hasKey(e)||O(e,n)})},q.showEditorsDialog=function(e){if(!i.isLogin())return void t.mainCtrl.login();var n=r.copy(y);n.targetEvent=e,n.locals={userIds:t.tree.value.meta.editors,treeKey:q.key},o.show(n)},q.showReportDialog=function(e){if(!i.isLogin())return t.mainCtrl.login();var n=r.copy(k);n.targetEvent=e,n.locals={reportTarget:{tree:q.key}},o.show(n).then(function(){return q.reportDisabled=!0})},q.buffer=function(){a.treesContainer.bufferTree(G)},q.sync=function(){a.sync(G).then(function(){t.tree.value.meta.sync=0,q.update()})},q.newTree=function(e){var n=s.getNode(e)||{},r=t.tree.value;if(r.hasKey(e)){var o=new Date,i={title:n.title||"Untitled",description:n.description,image:n.image,tags:n.tags,created:o,modified:o},r=r.getBranch(e);r.meta=new g("",i),a.add(r)}},q.getTree=function(){return t.tree.value},q.pasteBranch=function(e,t){return l.trackEvent("node","drag",""),z.pasteBranch(G,e,t)},q.openTabs=function(){function e(e){return d.openTabs(e.slice(0,5).map(function(e){return"https://goo.gl/"+e.value}),q.windowId).then(B)}var n=t.tree.value.sortBy(function(e){return e.value}).map(function(e){return s.getNode(e.key)});q.treeNodesCtrl.reverse&&n.reverse(),r.isNumber(q.windowId)?d.getWindowURIs(q.windowId).then(function(e){return n.filter(function(t){return!e.some(function(e){return e.equals(t.url)})})}).then(e):e(n)},q.closeTabs=function(){d.closeTabs(R()).then(function(){return B(null)})},q.moveTabs=function(){d.moveTabs(R(),q.windowId).then(B)},q.deleteTreeDialog=function(e){o.show(C(e)).then(function(){a.removeTree(G),l.trackEvent("tree","deleteTree","tree")})},q.showAnalyticsDialog=function(e){var n=r.copy(x);n.targetEvent=e,n.locals={dialogConfig:{key:t.tree.value.meta.shortUrl,title:t.tree.value.meta.title}},o.show(n)},q.setUpCommandsListener=function(){i.isLogin()||!q.editable||q.limitedEdit?(u.on(H,"child_added",$),F=function(){return u.off(H,"child_added")}):F=e.$on("command:"+G,function(e,n,o,i){void 0===i&&(i=r.noop);var a,s;if(n.type=="link:"+G){var c=n.value;a=c.tree.id,s=n,t.newNode(c)}else a=n.value.value.id,s=n.value;a==G&&$(s,r.noop),i()})},q.$onInit=function(){t.$emit("tree:init")},q.$postLink=function(){t.$emit("tree:postLink")},q.init=function(){return N().then(function(){return q.update(!0)})},t.isPage&&chrome.runtime.onConnect.addListener(D),t.$on("$destroy",function(){q.clear(),t.tree.value.isOpened=!1,f.unsubscribe(L,q),s.windowCloseObserver.unsubscribe(j,q),V(),F&&F(),t.tree.value.meta.modified>Y&&a.updateContainer(G,["modified"]),t.isPage&&chrome.runtime.onConnect.removeListener(D)}),f.subscribe(L,q),s.windowCloseObserver.subscribe(j,q),q.editable&&!q.limitedEdit||c.getUser(t.tree.value.meta).then(function(e){return t.tree.value.meta.user=e},r.noop)}]),e.controller("UserImagesDialogCtrl",["$scope","$timeout","facebook","facebook_id","title",function(e,t,n,r,o){function i(){return a.loading=!0,n.listUserPhotos(r,c).then(function(e){e&&(e.data=e.data||[],c=e.paging&&e.paging.next,s=!!c,e.data.forEach(function(e){e.link=e.images&&e.images[0]&&e.images[0].source}),a.images=a.images.concat(e.data))}).finally(function(){return a.loading=!1})}var a=this,s=!0,c="";a.images=[],a.loading=!1,a.title=o,e.scrollConfig={theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){s&&!a.loading&&i()}}},i().then(function(){a.noResults=!a.images.length})}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.controller("YoutubeIFrameDialogCtrl",["$rootScope","$element","nodes","youtubeIFrame","BASE_URL","youtubeDialogData",function(e,t,n,r,o,i){function a(e){if(void 0===e&&(e=1),s.autoplay){var t=c.container().map(function(e){return n.getYoutubeVideoId(e)}).filter(function(e){return!!e}),o=t.indexOf(i.videoId);if(o==t.length-1){if(c.scroll&&e>=1){var l=c.scroll();l&&l.then(function(){return a(e-1)})}}else i.videoId=t[o+1],r.loadVideoById(i.videoId)}}var s=this,c=i.nodeCtrl,l=i.videoId,u=e.userSettings;s.autoplay=!u.autoplayOff,s.autoplayChange=function(){u.autoplayOff=!s.autoplay},i.onLoad.then(function(){var e=t.find("iframe")[0];e.src=r.getFrameUrl(i.videoId),e.onload=function(){r.createPlayer(e,function(e){0==e&&a()},function(){i.videoId!=l&&a()})}}),i.onClose.then(function(){return r.destroy()})}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.controller("YoutubeTreeDialogCtrl",["$scope","$http","$timeout","$q","URI","accessToken",function(e,t,n,r,o,i){function a(e){var a=r.when();return c.getYoutubeVideos().forEach(function(r){a=a.then(function(){return t.post(l+i,{snippet:{playlistId:e,resourceId:{kind:"youtube#video",videoId:o(r.url).query(!0).v}}}).then(function(){return n(2e3)})})}),a}var s=this,c=e.tree.value,l="https://www.googleapis.com/youtube/v3/playlistItems?part=snippet,status&access_token=";t.post("https://www.googleapis.com/youtube/v3/playlists?part=snippet,status&access_token="+i,{snippet:{title:c.meta.title,description:c.meta.description,tags:c.meta.tags||[]},status:{privacyStatus:"public"}}).then(function(e){var t=e.data.id;return s.playlistUrl="https://www.youtube.com/playlist?list="+t,n(2e3).then(function(){return t})}).then(a).then(function(){s.complete=!0})}])}(angular.module("tnSharedControllers",["tnLayout"])),function(e){e.controller("IgnoreListDialogCtrl",["$timeout","ignoreListService",function(e,t){function n(){r.ignoreList=t.getList()}var r=this;r.ignoreUrl="",r.addItem=function(o){t.addItem(o),e(function(){return r.ignoreUrl=""}),n()},r.removeItem=function(e){t.removeItem(e),n()},n()}]),e.controller("NewTreeDialogCtrl",["$mdDialog","tagsApi","trees","nodes","Tree","TreeMeta",function(e,t,n,o,i,a){function s(){l.loading=!1}function c(e){var t=new Date,r={title:e.title,description:e.description,image:e.image,tags:e.tags,created:t,modified:t,children:[e.value],parents:["ROOT"],timestamps:[t]},o=new a("",r),s=new i(r,o);return n.add(s)}var l=this;l.getUrl=function(t){l.loading=!0,o.getNodeRequest(t).then(c).then(function(){return e.hide()}).catch(r.noop).finally(s)}}]),e.controller("PublishListDialogCtrl",["$scope","$timeout","users","URI","debounce",function(e,t,n,r,o){var i=this,a=n.userPublishedDomains;i.users=n,i.domainUrl="",i.publishList=[],i.addItem=function(e){if(e){-1===e.indexOf("//")&&(e="//"+e);var t=r(e).host();-1===i.publishList.indexOf(t)&&n.publishDomain(t).then(function(){i.domainUrl="",i.publishList.unshift(t)})}},i.removeItem=function(e){var t=i.publishList.indexOf(e);t>-1&&n.unpublishDomain(e).then(function(){i.publishList.splice(t,1)})},i.disableScroll=function(){return a.loading||!a.more},i.onload=function(){i.$element.find("md-dialog-content").mCustomScrollbar({theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:o(function(){i.disableScroll()||i.scroll()},1e3),onOverflowY:function(){i.hasScrollBar=!0},onOverflowYNone:function(){i.hasScrollBar=!1}}})},i.scroll=function(){a.more&&n.listPublishDomains().then(function(e){e&&(i.publishList=i.publishList.concat(e))})},e.$on("$destroy",function(){return n.clearPublishDomains()}),i.scroll()}]),e.controller("SettingsCtrl",["$rootScope","$state","users","Analytics","ngLangcodeFactory",function(e,t,n,r,o){var i=this;i.userSettings=e.userSettings,i.contentLanguages=o.langAlpha1(),i.depthChange=function(){r.trackEvent("settings","treeDepth","")},i.breadthChange=function(){r.trackEvent("settings","treeBreadth","")},i.contentLanguageChange=function(){r.trackEvent("settings","language",""),n.getTrending().then(function(){t.includes("main.tab.global")&&t.go("main.tab.global",{},{reload:"main.tab.global"})})}}]),e.controller("SubscriptionsDialogCtrl",["$rootScope","$scope","$mdDialog","debounce","users","scroll",function(e,t,n,r,o,i){function a(){s.container=c.toArray()}var s=this,c=s.usersContainer=o.usersContainer;s.container=[],s.disableScroll=function(){return c.loading||!c.more},s.scroll=function(){return c.more&&i()},s.click=function(t){e.toggleUser(t),n.hide()},s.onload=function(){s.$element.find("md-dialog-content").mCustomScrollbar({theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:r(function(){s.disableScroll()||s.scroll()},1e3),onOverflowY:function(){s.hasScrollBar=!0},onOverflowYNone:function(){s.hasScrollBar=!1}}})},c.subscribe(a),t.$on("$destroy",function(){c.clear(),c.unsubscribe(a)}),s.scroll()}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.controller("TreeMetaCtrl",["$scope","$mdDialog","trees","nodes","users","Analytics","debounce","dialogConfig","deleteTreeConfirmDialog","BASE_URL","STORAGE_URL",function(e,t,n,o,i,a,s,c,l,u,d){function m(){e.treeMeta.value.newLinks=0,p.previewed=!0,p.update(h.assoc(g))}var p=this,h=n.treesContainer,g=e.treeMeta.key,f=e.treeMeta.value.shortUrl;p.treeUrl=u+"/?tree="+g,p.defaultUrl=u,f&&(p.minimapUrl=d+"minimap/"+f),p.togglePreview=s(function(){var t=e.treeMeta.value;if(p.previewed)p.closePreview();else{if(t.loading||n.state.treeLoading)return;h.hasKey(g)?e.updateTabScroll("scrollTo",document.getElementById(g)):n.getTree(e.tabCtrl.getLoadOptions(),t).then(m)}},1e3,!0),p.closePreview=function(t){var n=e.treeMeta.value;p.previewed&&(h.remove(g),n.newLinks=0,p.previewed=!1,p.update(null,t))},p.openTreeDialog=function(n){var o=r.copy(c);o.targetEvent=n,o.locals={treeMeta:e.treeMeta.value,isOpened:!1},t.show(o)},p.deleteTreeDialog=function(e){t.show(l(e)).then(function(){n.removeTree(g),a.trackEvent("tree","deleteTree","treeMeta")})},e.$applyAsync(function(){var t=e.treeMeta.value;t.openOnLoad?(p.previewed=!0,t.openOnLoad=!1,p.update(h.assoc(g),!0)):p.update()}),e.$on("$destroy",function(){h.remove(g),p.destroy()}),e.$on("tree:init",function(e){e.targetScope.treeCtrl.setUpCommandsListener()}),e.$state&&e.$state.includes("main.tab.feed")&&i.getUser(e.treeMeta.value).then(function(t){return e.treeMeta.value.user=t},r.noop)}]),e.controller("CollectionsCtrl",["$scope","$animateCss","users","Analytics","toastObserver","debounce",function(e,t,n,o,i,a){function s(){var e=c.collection,t=e.domains,n=e.tags;c.numActive=(t&&t.filter(c.isActive).length||0)+(n&&n.filter(c.isActive).length||0)}var c=this,l=e.userSettings,u=function(e){return"Removed "+e.name+" from your profile"},d=r.element("#collections-container");c.collection=n.userCollections,c.editable=!0,c.hideBookmarks=l.hideBookmarks,c.removeDomain=function(e){n.addDomian(e),o.trackEvent("collections","remove",""),i.notifyObservers(u(e))},c.removeTag=function(e){n.addTag(e),o.trackEvent("collections","remove",""),i.notifyObservers(u(e))},c.transform=function(e){return e},c.isActive=function(e){return!e.visited&&new Date(e.timestamp)>n.lastVisit},c.showBookmarks=a(function(){var e=d[0].scrollHeight+"px",n={from:{"max-height":"0px",opacity:0},to:{"max-height":e,opacity:1},easing:"ease-out",duration:.5};l.hideBookmarks=c.hideBookmarks=!c.hideBookmarks,c.hideBookmarks&&(n.from["max-height"]=e,n.from.opacity=1,n.to["max-height"]="0px",n.to.opacity=0),t(d,n).start().done(function(){c.hideBookmarks||d.css({"max-height":""})})},500,!0),c.hideBookmarks&&d.css({"max-height":0}),e.mainCtrl.initPromise?n.bookmarksObserver.subscribe(s):s(),e.$on("$destroy",function(){return n.bookmarksObserver.unsubscribe(s)})}]),e.controller("HeroCtrl",["$scope","$mdDialog","$state","GData","trees","users","debounce","subscriptionsDialogConfig","BASE_URL",function(e,t,n,o,i,a,s,c,l){function u(e){return a.isSubscribed(e).then(function(e){d.canSubscribe=e.can_subscribe,d.canSubscribe&&(d.isSubscribed=e.is_subscribed,d.userSubscriptions={subscribers:parseInt(e.subscribers),subscriptions:parseInt(e.subscriptions)},d.collection={tags:e.tags,domains:e.domains})})}var d=this,m=n.params,p=m.userId,h=m.plusId;d.userSubscriptions={subscribers:0,subscriptions:0},d.subscribe=s(function(){if(o.isLogin()){(d.isSubscribed?a.unsubscribeUser(d.user):a.subscribeUser(d.user)).then(function(){return d.isSubscribed=!d.isSubscribed})}else e.mainCtrl.login().then(function(){return u(d.user)})},1e3,!0),d.openSubscriptionsDialog=function(e,o){var i=r.copy(c),s=o?function(){return a.loadSubscribers(n.params)}:function(){return a.loadSubscriptions(n.params)};i.targetEvent=e,i.locals={scroll:s},t.show(i)},d.transform=function(e){return e},d.isActive=function(){return!1},(p&&"me"!=p||h)&&a.getUser(n.params).then(function(e){d.user=e,e.id?d.socialUrl="https://www.facebook.com/"+e.id:e.plusId&&(d.socialUrl="https://plus.google.com/"+e.plusId),d.url=l+"/user/?userId="+(e.id||"")+"&plusId="+(e.plusId||""),u(e)})}]),e.controller("ListCtrl",["$scope","$element","$q","$mdDialog","Analytics","GData","Nodes","nodes","textSuggest","geolocation","nodesConfig","nodeSize","propertyType",function(e,t,n,o,i,a,s,c,l,u,d,m,p){function h(){f.container=w.values(),f.height=f.container.length*y+24+"px"}function g(e){e&&!v.isSearch()&&c.newNode(e)}var f=this,v=f.listCtrl=d.listCtrl,b=!1,y=m.listed,k=e.isExtension,w=c.container;f.searchNearby=!1,f.hasScrollBar=!1,f.state=c.state,f.hasRemove=!0,f.scrollConfig={theme:"minimal-dark",axis:"y",callbacks:{onTotalScrollOffset:y,alwaysTriggerOffsets:!1,onTotalScroll:function(){f.scroll()},onOverflowY:function(){f.hasScrollBar=!0},onOverflowYNone:function(){f.hasScrollBar=!1}}},f.disableScroll=function(){return f.state.loading||!(f.state.more||f.state.moreLocal)},f.scroll=function(){var e,t;if(!f.disableScroll())return v.isSearch()&&(t=v.getText()),t?(v.disableSort=!0,e=f.searchNearby?u.getCurrentPosition().then(function(e){return c.search(t,e)},function(){return f.searchNearby=!1,c.search(t)}):c.search(t)):k?(v.disableSort=!1,e=c.loadLocal(v)):a.isLogin()?(f.state.moreLocal=!1,e=c.load()):(c.addNodes({nodes:s.values()}),e=c.$q.when()),e.then(function(){return w.notifyObservers()})},f.updateSort=function(){var e=v.sortBy,t=v.sortOrder;switch(v.type[e]){case p.date:v.reverse=!t;break;case p.str:v.reverse=t}return c.clearNodes(),f.scroll()},f.search=function(){var e=!1;if(v.isSearch()?!v.getSearchText()&&v.getSelectedText()||(b=!0,e=!0):b&&(b=!1,e=!0),e&&(c.clearNodes(),f.scroll()),e){var t="/list";b&&(t=t+"?q="+v.getText()),i.set("page",t),i.trackPage(t)}},f.searchText=function(){return l.query(v.searchText)},f.removeNode=function(e){var t=c.$q.when();(k||a.isLogin())&&(t=c.remove(e)),t.then(function(){s.remove(e),w.remove(e),w.notifyObservers()})},f.click=function(t){return e.openUrl(t,"historyView")},f.getNodesPreview=function(){return c.getNodesPreview(f.container.map(function(e){return e.data.key}))},e.$watch("vm.listCtrl.sortBy",function(e,t){e!=t&&f.updateSort()}),e.$on("$destroy",function(){s.unsubscribe(g),w.unsubscribe(h),v.clearSearch(),f.updateListScroll("destroy")}),w.subscribe(h),s.subscribe(g),e.mainCtrl.authPromise.then(function(){return f.updateSort()}).finally(e.mainCtrl.initPromise||r.noop)}]),e.controller("MainCtrl",["$scope","$rootScope","$state","$mdDialog","$mdSidenav","$timeout","$q","GData","GApiShared","Analytics","trees","nodes","users","facebook","clientInitPromise","Nodes","layoutObservers","buffer","debounce","subscriptionsDialogConfig","nodeUrlDialogConfig","BASE_URL",function(e,t,n,o,i,a,s,c,l,u,d,m,p,h,g,f,v,b,y,k,w,C){var _=this,S=e.groupCtrl,x=e.isExtension,T=e.isMobile,A=_.state=d.state;if(_.showUsers=!1,_.showNav=!T,_.userSubscriptions=p.userSubscriptions,_.sidebarScrollConfig={theme:"minimal-dark"},_.APP_URL=C,_.initPromise=function(){return g().finally(function(){_.initPromise=null,d.pinnedTreesObserver.notifyObservers(),p.bookmarksObserver.notifyObservers()})},_.authPromise=p.userSetup().then(function(){if(c.isLogin()&&-1!==location.search.indexOf("require_login=1"))return l.loginUser()}).then(function(){return _.authPromise=s.when()}),S.treesSearch.searchText=n.params.q||"",t.toggleUser=y(function(e){var t,r;e&&(e.id?(t=e.id,p.usersCache.put(t,e)):r=e.plusId,n.go("main.tab.user",{userId:t,plusId:r}).then(function(){_.recentUsers=p.addRecent(e)||_.recentUsers}))},1e3,!0),t.toggleTag=function(e){n.go("main.tab.tag",{tag:e})},t.toggleDomain=function(e){n.go("main.tab.domain",{domain:e})},_.login=t.login=y(function(){return p.login().then(function(){return n.go("main.tab.session",{},{reload:"main.tab.session"})}).finally(function(){return t.isLoggingIn=!1})},1e3,!0),_.logout=function(){return p.logout().then(function(){d.pinnedTreesContainer.clear(),n.go("main.tab.global",{})})},_.toggleNavSidbar=y(function(){v.widthObserver.notifyObservers(),_.showNav=!_.showNav;var e=_.showNav?"update":"disable";a(function(){return _.updateSidebarScroll(e)})},750,!0),_.openSettingsDialog=function(t){o.show({targetEvent:t,scope:e.$new(),hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/components/settings-dialog.html",controller:"SettingsCtrl",controllerAs:"vm",onComplete:function(e,t){t.find("#dialogContent_settings-dialog").mCustomScrollbar({theme:"minimal-dark"})},onRemoving:function(e){e.find("#dialogContent_settings-dialog").mCustomScrollbar("destroy")}})},_.openIgnoreListDialog=function(e){o.show({targetEvent:e,hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/components/ignore-list-dialog.html",controller:"IgnoreListDialogCtrl",controllerAs:"vm"})},_.openPublishListDialog=function(e){if(!c.isLogin())return _.login();o.show({targetEvent:e,hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/components/publish-list-dialog.html",controller:"PublishListDialogCtrl",controllerAs:"vm",onComplete:function(e,t){e.vm.$element=t,e.vm.onload()},onRemoving:function(e){e.find("md-dialog-content").mCustomScrollbar("destroy")}})},_.openSubscriptionsDialog=function(e,t){var n=r.copy(k),i=t?function(){return p.loadSubscribers()}:function(){return p.loadSubscriptions()};n.targetEvent=e,n.locals={scroll:i},o.show(n)},_.openNewTreeDialog=function(e){if(!c.isLogin()&&!x)return _.login();var t=r.copy(w);t.controller="NewTreeDialogCtrl",t.targetEvent=e,t.onShowing=function(e,t){return t.find("md-dialog").attr("id","new-tree-dialog")},o.show(t)},_.disableScroll=function(){return A.loading||A.treeLoading||(n.includes("main.tab.search")?!(A.more||A.treesMore):!A.more)},t.$on("$stateChangeStart",function(e,t){function n(){_.login(),e.preventDefault()}var r;if(d.state.loading||d.state.treeLoading)return void e.preventDefault();if(!c.isLogin()){if(!x&&("main.tab.session"==t.name||"main.list"==t.name))return void n();if("main.tab.recommendations"==t.name)return void n()}d.clearTrees(),m.clearNodes(),b.isEmpty()||(r=b.get()),f.keepIf(function(e){var t=e.key;return d.treesContainer.any(function(e){return e.value.hasKey(t)})||r&&r.hasKey(t)})}),t.$on("$stateChangeSuccess",function(t,a,s,c,l){var d="/"+a.name.split(".").pop();n.includes("main.tab.search")?(d=s.favorite?"/favorites":s.published?"/published":s.global?"/global":"/session",d=d+"?q="+s.q):n.includes("main.tab.tag")?d=d+"?tag="+s.tag:n.includes("main.tab.domain")&&(d=d+"?domain="+s.domain),u.set("page",d),u.trackPage(d),i("users-sidebar").close(),e.isMobile&&i("nav-sidebar").close(),r.element("#onboarding-dialog")[0]||o.hide()}),e.isMobile){var P=function(){return _.updateSidebarScroll("disable")};_.updateSidebarScroll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(n=r.element("#nav-sidebar")).mCustomScrollbar.apply(n,e);var n},_.sidebarScrollConfig.callbacks={onCreate:function(){return e.$applyAsync(P)}},e.$applyAsync(function(){_.updateSidebarScroll(_.sidebarScrollConfig),i("nav-sidebar").onClose(P)})}}]),e.controller("NodesCtrl",["$scope","$state","nodes","users","facebook","GData","wwwFilter","toastObserver","BASE_URL",function(e,t,n,r,o,i,a,s,c){function l(){h.container=g.values().slice(0,v?b:g.size)}function u(){var e;if(f.search){var r=t.params.q;e=f.global?n.searchGlobal(r):n.search(r).then(function(){return g.notifyObservers()})}else if(f.global)e=n.loadGlobal();else if(f.favorite){if(f.search)return;e=n.loadFavorites()}else f.tag?e=n.loadTag(m):f.domain?e=n.loadDomain(m):f.recommended&&(e=n.loadRecommended());if(e)return e.then(function(e){h.modified=e&&new Date(e)})}var d,m,p,h=this,g=n.container,f=e.tabCtrl.getLoadOptions(),v=!0,b=4,y="",k="",w="";f.tag?(y="Tag: ",k=m=t.params.tag,w="tag-title",d=function(e){return r.addTag(e).then(function(){return r.userCollections.tags.splice(0,0,e)})},p=r.userCollections.tags,h.url=c+"/tag/"+m):f.domain&&(y="Domain: ",m=t.params.domain,k=a(m),w="domain-title",d=function(e){return r.addDomian(e).then(function(){return r.userCollections.domains.splice(0,0,e)})},p=r.userCollections.domains,h.url=c+"/domain/"+m),h.inUserCollection=!1,h.title=y,h.titleText=k,h.titleClass=w,h.hasRemove=f.favorite,h.state=n.state,h.gridView=!e.isMobile,h.facebook=o,h.load=function(){if(!h.disableScroll())return u()},h.addNodeProperty=function(){if(!i.isLogin())return e.login();d({name:m,timestamp:h.modified&&h.modified.toISOString(),visited:!0}).then(function(){h.inUserCollection=!0,s.notifyObservers("Added "+m+" to your profile")})},h.disableScroll=function(){return h.state.loading||g.isEmpty()||!h.state.more&&!(v&&g.size>b)},h.scroll=function(){if(v)return v=!1,void g.notifyObservers();u()},h.click=function(t){return e.openUrl(t,"nodesView")},h.removeNode=function(e){n.removeFavorite(e).then(function(){s.notifyObservers("Removed from favorites"),g.remove(e),g.notifyObservers()})},h.url&&(h.getPreview=function(){for(var e,t=0;t<h.container.length;t++){var r=n.getNode(h.container[t].data.key);if(r.image){e=r.image;break}}return{title:k+"| Brancher",image:e,url:c,type:"collection",targetUrl:h.url}}),h.getNodesPreview=function(){return n.getNodesPreview(h.container.map(function(e){return e.data.key}))},e.$on("$destroy",function(){return g.unsubscribe(l)}),g.subscribe(l),e.tabCtrl.loadQueue.enqueue(u,null,[]),p&&p.forEach(function(e){e.name==m&&(h.inUserCollection=!0,e.visited=!0)})}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.controller("PinnedTreesCtrl",["$scope","$compile","$animateCss","Analytics","trees","debounce",function(e,t,n,o,i,a){function s(){m.container=p.map(function(e){return g.assoc(e.key)}),m.hidePinned=f.hidePinned,m.hidePinned?u.css({height:0}):u.css({height:""}),e.$applyAsync(c)}function c(){d.sortable&&d.sortable(v)}function l(e){var t=r.element("#linked-tree");e?(t.append(e),t.show()):t.hide()}var u,d,m=this,p=i.pinnedTreesContainer,h=i.pinnedTreesObserver,g=i.TreesMetaContainer,f=e.userSettings,v={axis:"y",handle:".tree-meta__drag-handle, .tree-avatar__image",start:function(e,t){t.item.data("index",t.item.index())},update:function(t,n){var r=n.item.data("index"),i=n.item.index();if(r!=i){var a=m.container[r].key;e.pinning.move(a,i),o.trackEvent("pinned","drag","")}}};m.showPinned=a(function(){var e=d.height()+"px",t={from:{height:"0px",opacity:0},to:{height:e,opacity:1},easing:"ease-out",duration:.5};f.hidePinned=m.hidePinned=!m.hidePinned,m.hidePinned&&(t.from.height=e,t.from.opacity=1,t.to.height="0px",t.to.opacity=0),n(u,t).start().done(function(){m.hidePinned||u.css({height:""})})},500,!0),m.onload=function(){if(u=r.element("#pinned-trees"),d=r.element("#pinned-trees-container"),e.mainCtrl.initPromise||s(),i.linkedTreeKey){var n=e.$new();n.treeMeta=g.assoc(i.linkedTreeKey),t("<tn-tree-meta class='pinned-tree'></tn-tree-meta>")(n,l)}else l()},h.subscribe(s),e.$on("$destroy",function(){h.unsubscribe(s)}),e.$on("$stateChangeStart",function(e,t){"main.list"==t.name&&d.sortable&&d.sortable("destroy")})}]),e.controller("TabCtrl",["$scope","$element","$mdDialog","$state","$stateParams","$queueFactory","Analytics","debounce","GData","trees","users","layoutObservers","TREE_MSG",function(e,t,n,r,o,i,a,s,c,l,u,d,m){var p=this,h=e.groupCtrl,g=e.isExtension,f=h.treesSearch,v=d.scrollObserver,b=d.scrollEndObserver,y=e.mainCtrl.state;if(p.loadQueue=i(),p.hasScrollBar=!1,p.showSearchBar=!1,p.scrollConfig={theme:"minimal-dark",axis:"y",callbacks:{whileScrolling:function(){v.notifyObservers(this.mcs.top)},onTotalScroll:s(function(){e.mainCtrl.disableScroll()||p.scroll(p.getLoadOptions())},1e3),onScroll:function(){b.notifyObservers(this.mcs.top)},onOverflowY:function(){p.hasScrollBar=!0},onOverflowYNone:function(){p.hasScrollBar=!1}}},p.getLoadOptions=function(){var e=r.params,t=!1,n=e.userId||"me",o=e.plusId||"",i=r.includes("main.tab.search"),a=r.includes("main.tab.favorites")||e.favorite,s=r.includes("main.tab.published")||e.published,l=r.includes("main.tab.feed"),u=r.includes("main.tab.recommendations"),d=r.includes("main.tab.shared"),m=r.includes("main.tab.tag"),p=r.includes("main.tab.domain"),h=r.includes("main.tab.global")||e.global;return h&&(n=""),(r.includes("main.tab.user")||o)&&(e.userId||(n="")),c.isLogin()||(r.includes("main.tab.session")||a)&&(t=!0),{search:i,local:t,userId:n,plusId:o,favorite:a,published:s,feed:l,recommended:u,shared:d,tag:m,domain:p,global:h}},p.scroll=function(t){var n,o=r.current.name.split(".").pop();if(t.search){var i=f.getText();h.disableSort=!0,h.disableAll=!1,n=l.searchTreesByMeta(t,i)}else if(t.feed)h.disableAll=!0,n=l.loadFeed().then(function(e){if(e){var t=(n=l.TreesMetaContainer).valuesAt.apply(n,e);return u.getUsers(t);var n}}).then(function(){return l.treesMetaContainer.notifyObservers()});else if(t.shared)h.disableAll=!0,n=l.loadShared();else if(t.recommended)h.disableAll=!0,n=l.loadRecommended();else if(t.tag){var a=r.params.tag;h.disableAll=!0,n=l.loadTag(a)}else if(t.domain){var s=r.params.domain;h.disableAll=!0,n=l.loadDomain(s)}else h.disableSort=t.global||t.published||t.favorite||r.includes("main.tab.user"),h.disableAll=!1,n=l.load(t);return e.isExtension&&chrome.browserAction.setBadgeText({text:""}),y.viewState[o]=0,n},e.$on("$destroy",function(){e.updateTabScroll("destroy")}),"main.tab"==r.current.name)o.tree&&(e.addTree(m),l.linkedTreeKey=m.id),e.mainCtrl.authPromise.then(function(){var e=g||c.isLogin()?"main.tab.session":"main.tab.global";return r.go(e)});else{var k="/"+r.current.name.split(".").pop();a.set("page",k),a.trackPage(k)}}]),e.controller("TreesMetaCtrl",["$scope","$state","$element","trees","util","propertyType",function(e,t,n,r,o,i){function a(){return l.firstLoad=!0,m.scroll(m.getLoadOptions()).then(function(){if(v){var e=r.getTreeMeta(u.first().key);return e.openOnLoad=!0,r.getTree(m.getLoadOptions(),e).then(function(){u.subscribe(s),u.notifyObservers()})}})}function s(){var n,r,a=m.getLoadOptions(),s=d.sortBy;if(a.search||a.domain||a.tag||a.global)r="Results";else if(a.feed)r="Latest";else if(a.recommended)r="Recommendations";else if(a.shared)r="Shared with me";else switch(n=d.type[s],a.published||t.includes("main.tab.user")?(s="datePublished",n=i.date):a.favorite&&(s="dateFavorite",n=i.date),n){case i.date:r=function(e){return o.formatDateCalendar(e[s]||"Results")};break;case i.str:r=function(e){return e[s][0]}}l.container=u.groupTrees(r),l.sortBy=s,l.showTimeline=n==i.date&&!d.sortOrder&&l.container.length>2,e.$applyAsync(function(){return l.updateTimeline&&l.updateTimeline()}),e.updateTabScroll("update")}var c,l=this,u=r.treesMetaContainer,d=e.groupCtrl,m=e.tabCtrl,p=e.isExtension,h=e.mainCtrl,g=h.authPromise,f=h.initPromise,v=t.params.openFirst;v||u.subscribe(s),e.$on("$destroy",function(){u.unsubscribe(s)}),e.$applyAsync(function(){return n[0].focus()}),f?t.includes("main.tab.shared")?c=function(){return g.then(f).finally(a)}:t.includes("main.tab.global")||t.includes("main.tab.tag")||t.includes("main.tab.domain")||t.includes("main.tab.user")?(c=a,g.then(f)):c=t.includes("main.tab.session")&&!p?function(){return g.then(function(){return e.user?f().finally(a):(e.mainCtrl.initPromise=null,f(),t.go("main.tab.global"))})}:function(){return g.then(f).finally(a)}:c=a,e.tabCtrl.loadQueue.enqueue(c,null,[])}]),e.controller("UsersCtrl",["$scope","$mdSidenav","$timeout","users","facebook","debounce",function(e,t,n,o,i,a){var s,c=this,l=c.usersContainer=o.usersContainer,u=e.mainCtrl,d={theme:"minimal-dark",axis:"y",callbacks:{onCreate:function(){e.$applyAsync(function(){return s.mCustomScrollbar("disable")})},onTotalScroll:a(function(){c.disableScroll()||c.scroll()},1e3),onOverflowY:function(){c.hasScrollBar=!0},onOverflowYNone:function(){c.hasScrollBar=!1}}};u.toggleUsers=function(){c.scroll(),t("users-sidebar").open().then(function(){return s.mCustomScrollbar("update")})},c.container=[],c.disableScroll=function(){return l.loading||!l.more},c.scroll=function(){return l.more&&o.load()},c.logout=function(){return i.logout().then(function(){t("users-sidebar").close()})},c.onload=function(){s=r.element("#users-sidebar"),s.mCustomScrollbar(d)},l.subscribe(function(){c.container=l.toArray(),c.showInvite=o.showInvite()}),e.$applyAsync(function(){return t("users-sidebar").onClose(function(){s.mCustomScrollbar("disable"),l.clear(),l.notifyObservers()})})}])}(angular.module("tnControllers",["tnSharedControllers","ngLangcode"])),function(e){e.filter("listedTreeFilter",["filterFilter","Nodes",function(e,t){return function(n,r){if(!r)return n;var o=[];return angular.forEach(n,function(n){var i=n.data.key,a=t.get(i);e([a],r).length&&o.push(n)}),o}}]),e.filter("listedTreeSort",["Nodes","Container",function(e,t){return function(n,r){var o=new t(n),i=r.sortBy,a=r.reverse,s=r.data[i]?function(t){return e.get(t.data.key)[i]||""}:function(e){return e.data.value[i]||""},c=o.sortBy(s);return a&&c.reverse(),c}}]),e.filter("relativeTimestamp",function(){return function(e){return moment(new Date(e)).fromNow()}}).filter("absoluteTimestamp",function(){return function(e){return moment(e).format("MMM DD, YYYY [at] h:mm a")}}),e.filter("numberAbbreviate",function(){var e=new NumberAbbreviate;return function(t){return e.abbreviate(t,1)}}),e.filter("trustAsResourceUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),e.filter("treeNodeFilter",["filterFilter","Nodes",function(e,t){return function(n,r){if(!r)return!1;var o=n.data.key,i=t.get(o);return!!e([i],r).length}}]),e.filter("www",function(){return function(e){return e&&"www"==e.slice(0,3)?e.slice(4):e}})}(angular.module("tnFilters",[])),function(e){e.directive("tnActiveChip",function(){return{restrict:"A",link:function(e,t,n){"true"==n.tnActiveChip&&t.parent().parent().addClass("tn-active")}}}),e.directive("tnClipboard",["toastObserver",function(e){return{restrict:"A",link:function(t,r){var o=n(26),i=new o(r[0]);i.on("success",function(){return e.notifyObservers("URL copied")}),t.$on("$destroy",function(){return i.destroy()})}}}]),e.directive("tnDomain",["BASE_URL",function(e){return{restrict:"A",templateUrl:"partials/shared/domain.html"}}]),e.directive("tnImageError",["placeholderImage",function(e){return{restrict:"A",link:function(t,n){var r=n[0];r.onerror=function(){n.addClass("image-error"),r.src=e}}}}]),e.directive("tnInviteFriends",["users",function(e){return{scope:!0,controller:function(){var t=this;t.users=e,t.inviteUrl="https://goo.gl/Wj6Z8f"},controllerAs:"inviteFriendsCtrl",templateUrl:"partials/shared/invite-friends.html",restrict:"E"}}]),e.directive("tnLike",["facebookSDK","URI","FB_ID","BASE_URL",function(e,t,n,r){return{scope:{url:"@",likeLayout:"@",action:"@",size:"@",width:"@",height:"@",share:"@"},restrict:"E",link:function(o,i){var a=o.url,s={href:a,action:o.action||"like",layout:o.likeLayout||"box_count",share:o.share||!1,size:o.size||"small",width:o.width||"89",height:o.height||"48",show_faces:!1,appId:n};e.then(function(){if("undefined"==typeof FB){var e=t(r+"/fblike_iframe").query(s).toString(),n=angular.element("<iframe/>").attr("src",e).attr("width",s.width).attr("height",s.height).attr("style","border:none;overflow:hidden").attr("scrolling","no").attr("frameborder","0").attr("allowTransparency","true");i.append(n)}else{var o=angular.element("<div/>").addClass("fb-like").attr("data-href",s.href).attr("data-show-faces",s.show_faces).attr("data-size",s.size).attr("data-share",s.share).attr("data-action",s.action).attr("data-layout",s.layout);i.append(o),FB.XFBML.parse(i[0])}})}}}]),e.directive("tnShareMenu",function(){return{scope:{category:"@",url:"@",shareUrl:"&",close:"&",publish:"&",preview:"&",container:"&",containerPreview:"&"},controller:"ShareMenuCtrl",controllerAs:"shareMenuCtrl",bindToController:!0,templateUrl:"partials/shared/share-menu.html",restrict:"E"}}),e.directive("tnSvg",["$mdIcon","$parse",function(e,t){return{restrict:"A",link:function(n,r,o){e(o.tnSvg).then(function(e){var n=t(o.tnSvgAttrs)(null)||{};angular.forEach(n,function(t,n){e.setAttribute(n,t)}),r.append(e)})}}}]),e.directive("tnTag",["BASE_URL",function(e){return{restrict:"A",link:function(t){t.linkHref=e+"/tag/"+t.$chip},templateUrl:"partials/shared/tag.html"}}])}(angular.module("tnSharedDirectives",["tnFilters","tnConfig"])),function(e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnImage",["nodes","placeholderImage",function(e,t){return{restrict:"A",link:function(n,r){function o(){function o(){i.hasNoImage=!0,l.src=t.toString()}var s=e.getNode(a),c=s.locked_image||s.image,l=r[0];if(!c)return void o();l.src=c,l.onerror=function(){return n.$applyAsync(o)},l.alt=s.title}var i=n.nodeCtrl,a=i.node.data.key,s=i.dataObserver;s.subscribe(o),o(),n.$on("$destroy",function(){return s.unsubscribe(o)})}}}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnListItem",["$animate","nodeListedMoveTransition","nodeListedLeaveTransition",function(e,t,n){return{priority:1,restrict:"A",link:function(r,o){var i=d3.select(o[0]).select(".node-listed");r.$watch("$index",function(e,n){i.call(t,r.node,e,n)}),e.on("leave",o,function(e,t){"start"==t&&i.call(n,r.$index)})}}}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnNodeDrag",["$q","$interval","trees","Trees","Link","nodeSize","layoutObservers","util",function(e,t,n,o,i,a,s,c){var l={scrollInertia:100,timeout:0,scrollEasing:"linear"};return{priority:1,require:"tnNode",restrict:"A",link:function(u,d){function m(){var e=d3.event,t=e.sourceEvent;if(t.stopPropagation(),t.preventDefault(),3==t.which||2==t.button)return void(g=null);w.node=u.node,g=r.element(v.node()).clone().addClass("node--dragged").removeClass("node--is-open").css("visibility","hidden").css("pointer-events","none").prependTo(document.body)}function p(){if(f&&(t.cancel(f),f=null),g){var e=d3.event,n=e.sourceEvent,r=n.pageX,o=n.pageY,i=w.size,a=w.position;g.css("visibility","visible").css("transform",c.translate(r-.5*i.width,o-.5*i.height));var s=g[0].getBoundingClientRect();a.x=s.left,a.y=s.top,s.top<100?f=t(function(){return u.updateTabScroll("scrollTo","+=50",l)},100):s.bottom>k[0].offsetHeight&&(f=t(function(){return u.updateTabScroll("scrollTo","-=50",l)},100)),y.notifyObservers(w)}}function h(){f&&(t.cancel(f),f=null),g&&(g.remove(),g=null,w.isDragEnd=!0,y.notifyObservers(w),w.isDragEnd=!1,w.node=null)}var g,f,v=d3.select(d[0]).select(".node"),b=u.node.data.key,y=s.nodeDragObserver,k=r.element("#trees-containers"),w={key:b,node:null,isDragEnd:!1,position:{x:0,y:0},size:{width:a.width,height:a.height},callback:function(t){if(n.treesContainer.getTree(t.tree).hasKey(b))return e.reject();var r=o.newLink(t.key,b,new Date),a=e.when(r);return r.put(t.key,new i),a}};v.classed("node--draggable",!0).call(d3.behavior.drag().on("dragstart",m).on("drag",p).on("dragend",h)),v.selectAll(".node__tools, .node__site-container").call(d3.behavior.drag().on("dragstart",function(){var e=d3.event;e.sourceEvent.stopPropagation(),e.sourceEvent.preventDefault()})),u.$on("$destroy",function(){v.on(".drag",null).on(".click",null),v.selectAll(".node__tools, .node__site-container").on(".drag",null)})}}}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=e;o.directive("tnListNodeMenu",function(){return{scope:!0,restrict:"A",require:["?^tnNode","?^tnNodeListed"],link:function(e,t,n,r,o){var i=e.nodeMenuCtrl;i.nodeCtrl=r[0]||r[1],i.template="partials/components/list-node-menu.html",i.includeShare=!!n.includeShare,o(e,function(e){return t.append(e)})},template:"",controller:"NodeMenuCtrl",controllerAs:"nodeMenuCtrl",transclude:!0}}),o.directive("tnNodeMainAction",function(){return{scope:!0,restrict:"A",link:function(e,t,n,r){e.nodeMenuCtrl.nodeCtrl=r},require:"^tnNode",controller:r.noop,templateUrl:"partials/shared/node-main-action.html",controllerAs:"nodeMenuCtrl"}}),o.directive("tnShareNodeMenu",function(){return{scope:!0,restrict:"A",require:"^tnNode",link:function(e,t,n,r,o){var i=e.nodeMenuCtrl;i.nodeCtrl=r,i.template="partials/shared/node-share-menu.html",o(e,function(e){return t.append(e)})},template:"",controller:"MenuCtrl",controllerAs:"nodeMenuCtrl",transclude:!0}}),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnNodeTooltip",["nodes","timestampObserver","uppercaseFilter","relativeTimestampFilter","absoluteTimestampFilter",function(e,t,n,r,o){return{restrict:"A",link:function(i,a){function s(){var t=e.getNode(l),i=t.title,s=t.description,c=t.visited,d=t.type,m=t.tags,p=t.address,h=t.url,g=n(i)+"\n\n";h&&(g+=h+"\n\n"),d&&(g+="Type: "+d+"\n\n"),s&&(g+="Description: "+s+"\n\n"),m&&m.length&&(g+="Tags: "+m.join(", ")+"\n\n"),p&&(g+="Address: "+p+"\n\n"),c&&(g+="Visited: "+r(c)+" ("+o(c)+")\n"),u&&(g+="Added: "+r(u)+" ("+o(u)+")\n"),a.attr("title",g)}var c=i.nodeCtrl,l=c.node.data.key,u=c.node.data.value.timestamp,d=c.dataObserver;t.subscribe(s),d.subscribe(s),i.$on("$destroy",function(){d.unsubscribe(s),t.unsubscribe(s)}),s()}}}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnNodeType",["nodes",function(e){return{restrict:"A",link:function(t,n){var r=e.getNode(t.nodeCtrl.node.data.key).type;r&&n.attr("data-node-type"," ("+r+")")}}}]);var o=e;o.directive("tnNode",function(){return{priority:2,restrict:"E",scope:{node:"=",openUrl:"&",container:"&",containerPreview:"&",scroll:"&"},templateUrl:"partials/shared/node.html",controller:"NodeCtrl",controllerAs:"nodeCtrl",bindToController:!0,transclude:{menu:"?nodeMenu",tools:"?nodeTools",main:"?nodeMain",share:"?nodeShare"}}}),o.directive("tnNodeListed",["$rootScope",function(e){return{priority:2,restrict:"E",scope:{node:"=",openUrl:"&",showVisited:"=",container:"&",containerPreview:"&",scroll:"&"},templateUrl:function(){return e.isMobile?"partials/mobile/node-listed.html":"partials/shared/node-listed.html"},controller:"NodeCtrl",controllerAs:"nodeCtrl",bindToController:!0,transclude:!0}}]),o.directive("tnNodePath",function(){return{priority:2,restrict:"E",scope:{node:"=",last:"=",openUrl:"&"},templateUrl:"partials/shared/node-path.html",controller:"NodeCtrl",controllerAs:"nodeCtrl",bindToController:!0}}),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnTextContainer",["$compile","$interpolate",function(e,t){var n=t("<ng-transclude></ng-transclude><span tn-text='{{property}}'></span>");return{terminal:!0,restrict:"A",link:function(t,r,o,i,a){e(n({property:o.tnTextContainer}))(t,function(e){return r.append(e)},{parentBoundTranscludeFn:a,futureParentElement:r})},transclude:!0}}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnText",["relativeTimestampFilter","absoluteTimestampFilter","numberAbbreviateFilter","nodes","timestampObserver","nodesConfig","propertyType",function(e,t,n,r,o,i,a){var s=i.type;return{restrict:"A",link:function(t,i,c){function l(){var t,o=r.getNode(u)[d]||"";if(o)switch(m){case a.date:t=e(o);break;case a.count:var s=parseInt(o);s&&(t=n(s));break;default:t=o}t?(i.text(t),i.parent().removeClass("ng-hide")):i.parent().addClass("ng-hide")}var u=t.nodeCtrl.node.data.key,d=c.tnText,m=s[d],p=t.nodeCtrl.dataObserver;p.subscribe(l),m==a.date&&o.subscribe(l),t.$on("$destroy",function(){p.unsubscribe(l),m==a.date&&o.unsubscribe(l)}),l()}}}])}(angular.module("tnNodeDirectives",["tnSharedDirectives"])),function(e){e.directive("tnSecondaryImage",function(){return{scope:{primary:"@",secondary:"@"},restrict:"A",link:function(e,t){var n=t[0],r=!1;n.onerror=function(){e.secondary&&!r?(n.src=e.secondary,r=!0):t.addClass("ng-hide")},n.src=e.primary}}}),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnLink",["linkTransition","nodeLinkDefaultColor",function(e,t){return{restrict:"A",link:function(n,r,o){function i(){var t=n.link;t.target.exit||(u&&a(t.source.color),c.call(e,t))}function a(e){l.attr("stroke",e||t)}var s=d3.select(r[0]).datum(n),c=s.selectAll("path"),l=c.filter(".link-visible"),u=!o.tnLink;n.$watchGroup(["link.source.x","link.source.y","link.target.x","link.target.y"],i)},templateUrl:"partials/shared/link.html"}}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnTreeItemShared",function(){return{priority:1,require:["?tnNode","?tnNodeListed"],restrict:"A",link:function(e,t,n,r){var o=r[0]||r[1],i=e.node.data.key,a=e.treeCtrl;o.treeKey=e.tree.key,o.googleSearch=function(e){a.googleSearch(e,i)},o.showNodeDialog=function(e){a.showNodeDialog(e,i)}}}}),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnTreeItem",["$q","$interval","$parse","$timeout","debounce","layoutObservers","nodeSize","util","nodeSearchResultColorExpression","nodeMoveTransition",function(e,t,n,o,i,a,s,c,l,u){var d=n("node | treeNodeFilter: vm.searchText"),m={scrollInertia:100,timeout:0,scrollEasing:"linear"};return{priority:1,require:"?tnNode",restrict:"A",link:function(n,p,h,g){function f(){var e=n.node,t=e.y-e.y0,r=t<0?"+="+Math.abs(t):"-="+t;t&&n.updateTabScroll("scrollTo",r)}function v(){var e=n.node,t=e.data.value.page,r=t*N;e._children&&(g.disableNext=e._children.length<=r+N,g.disablePrev=0==t,g.showNav=!!(e._children.length>N&&e.children&&e.children.length),g.showExpand=!!e._children.length&&!e.children,g.showCollapse=!(!e.children||!e.children.length))}function b(e){e&&d({node:n.node,vm:$})?g.nodeColors=l:g.nodeColors=null}function y(){var e=d3.event,t=e.sourceEvent;if(t.stopPropagation(),t.preventDefault(),3==t.which||2==t.button)return void(T=null);R.node=n.node,P=$.getBoundingClientRect(),T=r.element(D.node()).clone().addClass("node--dragged").removeClass("node--is-open").css("visibility","hidden").css("pointer-events","none").prependTo(document.body)}function k(){if(A&&(t.cancel(A),A=null),T){var e=d3.event,r=e.sourceEvent,o=r.pageX,i=r.pageY,a=R.size,s=R.position,l=$.zoomBehavior.scale();T.css("visibility","visible").css("transform",c.translate(o-.5*l*a.width,i-.5*l*a.height)+c.scale(l));var u=T[0].getBoundingClientRect();s.x=u.left,s.y=u.top,u.top<100?A=t(function(){return n.updateTabScroll("scrollTo","+=50",m)},100):u.bottom>U[0].offsetHeight?A=t(function(){return n.updateTabScroll("scrollTo","-=50",m)},100):u.right>P.right-100?A=t(function(){return $.scrollX(20)},50):u.left-100<P.left&&(A=t(function(){return $.scrollX(-20)},50)),M.notifyObservers(R)}}function w(){A&&(t.cancel(A),A=null),T&&(T.remove(),T=null,R.isDragEnd=!0,M.notifyObservers(R),R.isDragEnd=!1,R.node=null,P=null)}function C(e){if((R.tree!=e.tree||!(R.key==e.key||e.node.parent&&R.key==e.node.parent.data.key))&&$.editable){var t=!1,n=D.node().getBoundingClientRect(),r=$.zoomBehavior.scale();R.position.x=n.left,R.position.y=n.top,R.position.x<e.position.x+.5*r*e.size.width&&R.position.x+.5*r*R.size.width>e.position.x&&R.position.y<e.position.y+.5*r*e.size.height&&.5*r*R.size.height+R.position.y>e.position.y&&(t=!e.isDragEnd,e.isDragEnd&&e.callback(R).then(_)),D.classed("node--is-overlapping",t)}}function _(e){var t=$.pasteBranch(I,e);t&&(t.execute(),$.updateData(t),$.update())}function S(){var e=n.node;e.exit||(D.call(u,e),e.enter=!1,e.exit=!1,e.pageExit=!1,e.pageEnterNext=!1,e.pageEnterPrev=!1)}function x(){var e=n.node,t=O()||L(),r=e.isLeaf;e.size=R.size={width:s.width,height:s.height},D.classed("node--is-root",t).classed("node--is-leaf",r&&!t),v()}var T,A,P,D=d3.select(p[0]).select(".node").datum(n),$=n.treeCtrl,I=n.node.data.key,M=a.nodeDragObserver,E=$.searchTextObserver,O=r.bind($,$.isFocused,I),L=r.bind($,$.isRoot,I),U=r.element("#trees-containers"),N=$.maxTreeBreadth,R={tree:$.key,key:I,node:null,isDragEnd:!1,position:{x:0,y:0},size:{width:0,height:0},callback:function(t){var n=$.getTree(),r=n.getBranchCopy(this.key),i=e.when(r);return this.tree==t.tree&&r.hasKey(t.key)?e.reject():$.editable&&n.root!=this.key?$.execute("deleteBranch",this.key,!1).then(function(){return o(500)}).then(function(){return i}):i}};if(U=U[0]?U:r.element("#embedded-tree-container"),n.$watchGroup(["node.x","node.y"],S),g){var B=function(e){e.x0=e.x,e.y0=e.y-(N+1)*s.height,e.pageExit=!0},j=function(e){e.x0=e.x-(N+1)*s.width,e.y0=e.y,e.pageExit=!0},F=function(e){e.x0=e.x,e.y0=e.y+(N+1)*s.height,e.pageExit=!0},q=function(e){e.x0=e.x+(N+1)*s.width,e.y0=e.y,e.pageExit=!0};g.isSelectedPage=I==n.tree.value.meta.selectedPage,g.showNext=i(function(){n.$applyAsync(function(){var e=n.node,t=e.data.value.page+=1,r=t*N;e.descendants().slice(1).forEach($.treeNodesCtrl.vertical?j:B),e.children=e._children.slice(r,r+N),e.descendants().slice(1).forEach(function(e){return e.pageEnterNext=!0}),v(),$.updateLayout(),f()})},1e3,!0),g.showPrev=i(function(){n.$applyAsync(function(){var e=n.node,t=e.data.value.page-=1,r=t*N;e.descendants().slice(1).forEach($.treeNodesCtrl.vertical?q:F),e.children=e._children.slice(r,r+N),e.descendants().slice(1).forEach(function(e){return e.pageEnterPrev=!0}),v(),$.updateLayout(),f()})},1e3,!0),g.setChildren=i(function(e){n.$applyAsync(function(){var t=n.node;if(e){var r=t.data.value.page,o=r*N;t.data.value.expanded=!0,t.data.value.collapsed=!1,t.children=t._children.slice(o,o+N),t.isNotEmpty=!1}else t.data.value.expanded=!1,t.data.value.collapsed=!0,t.children=null,t.isNotEmpty=!0;v(),$.updateLayout(),f()})},1e3,!0),g.focus=function(){$.updateFocus(n.node),$.updateLayout()},n.node.data.value.related||(D.classed("node--draggable",!0).call(d3.behavior.drag().on("dragstart",y).on("drag",k).on("dragend",w)),M.subscribe(C),D.selectAll(".node__tools, .node__site-container").call(d3.behavior.drag().on("dragstart",function(){var e=d3.event;e.sourceEvent.stopPropagation(),e.sourceEvent.preventDefault()}))),E.subscribe(b),n.$watch(function(){return O()||L()},x),n.$watchGroup(["node._children.length","node.children.length"],x),n.$on("$destroy",function(){M.unsubscribe(C),E.unsubscribe(b),D.on(".drag",null).on(".click",null),D.selectAll(".node__tools, .node__site-container").on(".drag",null)})}}}}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=e;o.directive("tnTreeMenu",function(){return{restrict:"E",link:function(e){e.treeMenuCtrl.template="partials/shared/tree-menu.html"},template:"<ng-transclude></ng-transclude>",controller:"MenuCtrl",controllerAs:"treeMenuCtrl",transclude:!0}}),o.directive("tnTreeShareMenu",["GData",function(e){return{restrict:"E",link:function(t){var n=t.treeShareMenuCtrl,r=n.open;n.template="partials/shared/tree-share-menu.html",n.open=function(o){if(!e.isLogin()&&t.treeCtrl.editable)return o.preventDefault(),void t.mainCtrl.login();r.call(n,o)}},template:"<ng-transclude></ng-transclude>",controller:"MenuCtrl",controllerAs:"treeShareMenuCtrl",transclude:!0}}]),o.directive("tnTreeSortMenu",function(){return{restrict:"E",link:function(e){e.treeSortMenuCtrl.template="partials/shared/tree-sort-menu.html"},template:"<ng-transclude></ng-transclude>",controller:"MenuCtrl",controllerAs:"treeSortMenuCtrl",transclude:!0}}),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=e,i=function(e,t,n,o,i){var a=e.nodeMenuCtrl,s=e.treeCtrl;a.nodeCtrl=o[0]||o[1],a.isListed=s.treeNodesCtrl.isListed,a.isFocused=r.bind(s,s.isFocused,e.node.data.key),a.isRoot=r.bind(s,s.isRoot,e.node.data.key),a.editable=s.editable,a.template="partials/shared/tree-node-menu.html",a.includeShare=!!n.includeShare,i&&i(e,function(e){return t.append(e)})};o.directive("tnTreeNodeMenu",function(){return{scope:!0,restrict:"A",link:i,template:"",require:["?^tnNode","?^tnNodeListed"],controller:"NodeMenuCtrl",controllerAs:"nodeMenuCtrl",transclude:!0}}),o.directive("tnTreeNodeTools",function(){return{scope:!0,restrict:"A",link:i,require:["^tnNode"],controller:r.noop,templateUrl:"partials/shared/tree-node-tools.html",controllerAs:"nodeMenuCtrl"}}),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(13),o=e,s=function(e){return e.data.key};o.directive("tnTree",["$mdDialog","$timeout","$compile","$parse","$templateCache","$rootScope","Analytics","NodeMeta","Tab","treeLayout","treesConfig","nodeSize","layoutObservers","keysObserver","dialogConfig","relatedDialogConfig","mapDialogConfig","util","animationUtil","animationDuration","animationEase","treeMetaHeight","treeMargin","treesToolbarHeight","treeBodyHorizontalPadding","treeBodyVerticalPadding","treeLegendHeight","propertyType",function(e,t,n,o,i,c,l,u,d,m,p,h,g,f,v,b,y,k,w,C,_,S,x,T,A,P,D,$){var I=h.listed,M=8,E={width:100,height:100},O=r.element(i.get("partials/shared/minimap.html")),L=n(O),U=o("array | listedTreeFilter: vm.searchText | listedTreeSort: vm.treeNodesCtrl"),N=a.stratify().id(function(e){return e.key}).parentId(function(e){return e.value.parent}),R=function(n,o){function i(e){var t=ae.scale(),n=t*he.height;he.position.y<n&&(37==e?ee.scrollX(-20):39==e&&ee.scrollX(20))}function a(e){var t=ae.scaleExtent();ee.disableZoomIn=e>=t[1],ee.disableZoomOut=e<=t[0]}function c(e,t){return function(){var n=d3.event;if(n.stopPropagation(),!n.defaultPrevented){var r=d3.mouse(this),o=t.width,i=t.height,a=t.viewportWidth,s=d.height,c=(o-.75*a)*(r[0]/E.width),u=(i-.75*s)*(r[1]/E.height);t.setTreePosition(c,u),e.call(F,t),q(t),l.trackEvent("tree","minimapClick","")}}}function u(){var e=d3.event;e.sourceEvent.stopPropagation(),e.sourceEvent.preventDefault()}function w(){var e=d3.event;e.sourceEvent.stopPropagation(),e.sourceEvent.preventDefault()}function x(e,t){return function(){var n=d3.event,r=n.x,o=n.y,i=j(t),a=r*t.width/E.width,s=o*t.height/E.height;t.setTreePosition(a,Math.min(s,i)),e.call(F,t),q(t)}}function O(e,t){function n(){a(d3.event.scale),t.setTreePosition(t.position.x,t.position.y),e.call(H,t,!0),q(t)}var r=t.width,o=t.height;ae=ae.size([r,o]).on("zoom",n)}function R(e,t){J.call(d3.behavior.drag().on("dragstart",u).on("drag",x(e,t)).on("dragend",function(){w(),l.trackEvent("tree","minimapDrag","")}))}function B(e,t){var n=0;e.call(d3.behavior.drag().on("dragstart",function(){var e=d3.event.sourceEvent;n=e.pageY,u()}).on("drag",function(){var r=d3.event,o=r.dx,i=r.sourceEvent,a=t.position,s=a.x,c=a.y,l=i.pageY,u=l-n,d=j(t),m=s-o,p=c-u;n=l,t.setTreePosition(m,Math.min(p,d)),e.call(F,t),q(t)}).on("dragend",function(){n=0,w(),l.trackEvent("tree","backgroundDrag","")}).origin(function(){return{x:0,y:0}}))}function j(e){return ae.scale()*e.height-d.height+T+S+D+2*P+M}function F(e,t,r){void 0===r&&(r=!0);var i=t.position,a=i.x,s=i.y,c=ae.scale(),l=k.translate(-a,P)+k.scale(c);r&&n.updateTabScroll("scrollTo",s+o[0].offsetTop,{scrollInertia:0,timeout:0,callbacks:!1}),e.style("transform",l)}function q(e){ce.call(W,e),J&&J.call(z,e)}function G(){t(function(){he.updateViewportWidth(),he.setTreePosition(he.position.x,he.position.y),me.isListed||ue.call(F,he),q(he)},500,!1)}function z(e,t){var n=d.height,r=t.width,o=t.height,i=t.position,a=t.viewportWidth,s=i.x,c=i.y,l=ae.scale();r&&(s=Math.max(.5*A,s-.5*A),c=Math.max(.5*P,Math.min(c,l*o-n)),e.attr("width",Math.max(0,Math.min(r,(1-l)*r+a)-A)).attr("height",Math.max(0,Math.min(o,(1-l)*o+n)-.5*P)).attr("transform","translate("+s+", "+c+")"))}function W(e,t){if(!ne){var n=ae.scale(),r=n*t.height,o=t.position.y,i=o>0&&o<r-h.height;e.classed("tree-toolbar--fixed",i).style("width",i?e.node().parentNode.clientWidth+"px":null)}}function H(e,t,n){var r=t.width,o=t.height,i=t.prevHeight,a=t.prevScale,s=t.prevScale=ae.scale(),l=s*o+2*P,u=a*i+2*P,d=d3.interpolateString(u+"px",l+"px");n?le.style("height",d(1)):le.call(V,d),Z.call(K,t,n).on("click",c(e,t)),J.call(z,t),t.prevWidth=r,t.prevHeight=o,t.updateViewportWidth(),e.style("height",o+"px").style("width",r+"px").call(B,t).call(R,t).call(O,t)}function Y(e,t,n){var r=t.height,o=t.prevHeight,i=t.prevScale,a=i*o,s=d3.interpolateString(a+"px",r+"px");t.prevScale=1,n?le.style("height",s(1)):le.call(V,s),e.on(".drag",null).style("height",null).style("width",null).style("transform",null),t.prevHeight=r}function K(e,t,n){function r(e){var t=this;t.style.setProperty("height",m(e)),t.style.setProperty("width",p(e)),t.style.setProperty("transform",f(e))}var o=t.width,i=t.height,a=t.prevWidth,s=t.prevHeight,c=E.width/o,l=E.height/i,u=k.scale(c,l),m=d3.interpolateString(s+"px",i+"px"),p=d3.interpolateString(a+"px",o+"px"),h=E.width/a,g=E.height/s,f=d3.interpolateString(k.scale(h,g),u);d.active&&!n?e.transition().duration(C).tween("minimap",function(){return r}):r.call(e.node(),1)}function V(e,t){var n=o.parent(),r=parseFloat(t(1))-parseFloat(t(0));if(r){var i=d3.interpolateString(k.translate(0,0),k.translate(0,r));if(e.transition().ease(_).duration(C).styleTween("height",function(){return t}).each("end",function(){return se.style("height",null)}),n.hasClass("tree-meta")){var a=n.parent().nextAll().add(n.nextAll()).add(o.closest(".trees-container").next());se.style("height",o.height()+"px"),d3.selectAll(a).filter(function(){var e=d3.select(this);return e.classed("tree-meta")||e.classed("trees-subhead")||e.classed("trees-list")||e.classed("trees-container")}).classed("container-animated",!0).transition().ease(_).duration(C).styleTween("transform",function(){return i}).each("end",function(){d3.select(this).classed("container-animated",!1).style("transform",null)})}}}function Q(e){he.setTreePosition(he.position.x,-e-o[0].offsetTop),q(he)}var X,Z,J,ee=n.treeCtrl,te=n.userSettings,ne=n.isMobile,re=n.isEmbedded,oe=g.scrollObserver,ie=g.widthObserver,ae=ee.zoomBehavior=d3.behavior.zoom().scaleExtent([.5,1]).scale(te.zoom),se=d3.select(o[0]),ce=se.select(".tree-toolbar"),le=se.select(".tree-body"),ue=le.select(".tree-nodes"),de=r.element(ce.node()),me=ee.treeNodesCtrl=r.copy(p.treeCtrl),pe=!0,he={width:0,height:0,prevWidth:0,prevHeight:0,prevScale:ae.scale(),viewportWidth:0,position:{x:-A,y:0},setTreePosition:function(e,t){var n=this,r=n.width,o=n.height,i=n.position,a=n.viewportWidth,s=ae.scale();i.x=Math.max(-A,Math.min(e,s*r-a+A)),i.y=Math.min(Math.max(t,0),s*o)},updateViewportWidth:function(){this.viewportWidth=o.width()||o[0].getBoundingClientRect().width}},ge=te.maxTreeDepth;ne||L(n,function(e){Z=d3.select(e[0]).select(".tree-minimap"),J=Z.select(".frame rect"),de.prepend(e)},{futureParentElement:de}),re&&(T=0),ie.subscribe(G),oe.subscribe(Q),f.subscribe(i),n.$applyAsync(function(){ue.node().focus()}),o[0].id=n.tree.key,ee.maxTreeBreadth=te.maxTreeBreadth,ee.searchText="",ee.nodeSize=h,ee.focusedNode=null,ee.updateViewportWidth=function(){return he.updateViewportWidth()},ee.clear=function(){Z&&Z.on(".zoom",null).on(".click",null),ue.on(".drag",null),J&&J.on(".drag",null),ie.unsubscribe(G),oe.unsubscribe(Q),f.unsubscribe(i)},ee.updateLayoutDirection=function(){te.treeLayout=me.vertical,ee.updateLayout()},ee.updateSort=function(e){if(me.sortBy!=e){var t=me.sortBy=e||me.sortBy,n=me.sortOrder;switch(me.type[t]){case $.date:me.reverse=!n;break;case $.str:me.reverse=n}te.treeSort=t}},ee.expandTree=function(){function e(t){t._children&&(t.children=t._children,t.children.forEach(e),t.isNotEmpty=!1)}e(ee.focusedNode||X)},ee.updateTree=function(){var e=n.tree.value,t=e.getCompareFunction(me),r=X&&d3.map(X.descendants(),s),o=e.toArray().filter(function(t){return t.value.isRoot||e.hasKey(t.value.parent)});X=N(o).sort(function(e,n){return t(e.data,n.data)}),r&&X.each(function(e){var t=r.get(e.data.key);t&&(e.x=t.x,e.y=t.y)}),X.each(function(e){var t=e.data.key,n=ee.isRoot(t),r=e.isLeaf=!e.children;e.isDeleteOne=!(e.data.value.related||r||!ee.editable||n||ee.isFocused(t)),e.isDeleteBranch=!e.data.value.related&&ee.editable&&!n&&r,e.isDeleteRoot=ee.editable&&n&&e.children&&1==e.children.length&&!e.children[0].data.value.related})},ee.updateFocus=function(e){ee.focusedNode=e;var t=ee.focusedNode||X,n=t.depth;ee.expandTree(),me.isExpanded||t.descendants().forEach(function(e){var t=e.depth-n,r=e.data.value;if(!e.isLeaf){if(e._children=e._children||e.children,!r.collapsed&&(r.expanded||t<ge)){var o=r.page*ee.maxTreeBreadth;return e._children[o]||(r.page-=1,o-=ee.maxTreeBreadth),void(e.children=e._children.slice(o,o+ee.maxTreeBreadth))}e.children=null,e.isNotEmpty=!0}})},ee.updateLayout=function(e){var t,r=n.tree.value,o=ee.focusedNode||X,i=me.vertical,a=me.isListed;if(he.prevWidth=he.width,he.prevHeight=he.height,ee.focusedNode?ee.treePath=ee.focusedNode.ancestors().slice(1).reverse():ee.treePath=null,ee.showMinimap=o.descendants().some(function(e){return e.children&&e.children.length>1}),!ee.showMinimap&&pe&&(a=me.isListed=!0),pe=!1,a)ee.expandTree(),ee.listedNodes=U({array:o.descendants(),vm:ee}),he.height=ee.listedNodes.length*I,he.width=null,ee.nodes=null,ee.links=null,t=Y;else{var s=m.nodes(o,ee.nodes,ee.maxTreeBreadth+1,i);ee.nodes=s.nodes,ee.links=o.links(),he.height=s.height,he.width=s.width,ee.listedNodes=null,t=H}ee.hasImages=!!r.getImages().length,ee.hasMap=!!r.getGeo().length,ee.hasYoutubeVideos=!!r.getYoutubeVideos().length,ee.expandTreeDisabled=!me.isExpanded&&n.tree.value.length==X.descendants().length,he.updateViewportWidth(),ue.call(F,he,!1).call(t,he,e)},ee.update=function(e){var t=null;if(ee.updateTree(),ee.focusedNode){var n=ee.focusedNode.data.key;t=X.descendants().filter(function(e){return n==e.data.key})[0]}ee.updateFocus(t),ee.updateLayout(e)},ee.isRoot=function(e){return X.data.key==e},ee.isFocused=function(e){return ee.focusedNode&&ee.focusedNode.data.key==e},ee.openTreeDialog=function(t){var o=r.copy(v);o.targetEvent=t,o.locals={treeMeta:n.tree.value.meta,isOpened:!0},o.scope=n.$new(),e.show(o)},ee.openRelatedDialog=function(t,o,i,a){var s=r.copy(b),c=s.scope=n.$new();return s.targetEvent=t,s.onShowing=function(){o.then(function(t){var n=c.relatedDialogCtrl;n.container=t,n.loading=!1,n.openUrl=function(t){return e.hide(t)},n.title=a,n.node=i})},e.show(s)},ee.showImagesDialog=function(t){e.show({targetEvent:t,hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,locals:{treeKey:ee.key},controller:"TreeImagesDialogCtrl",controllerAs:"vm",templateUrl:"partials/shared/images-dialog.html"})},ee.showMapDialog=function(t){var o=r.copy(y);o.targetEvent=t,o.locals={geoNodes:n.tree.value.getGeo(),title:n.tree.value.meta.title},e.show(o)},ee.clickPath=function(e){ee.isRoot(e.data.key)&&(e=null),ee.updateFocus(e),ee.updateLayout()},ee.zoom=function(e){t(function(){var t=+(ae.scale()+.1*(e?1:-1)).toFixed(1),n=ae.scaleExtent();t>=n[0]&&t<=n[1]&&(ae=ee.zoomBehavior=ae.scale(t),ae.event(Z),te.zoom=t),a(t),ue.call(F,he,!1)})},ee.search=function(){var e="treeView";me.isListed&&(e="treeListView",ee.updateLayout()),ee.searchText&&l.trackEvent("tree","search",e),ee.searchTextObserver.notifyObservers(ee.searchText)},ee.scrollX=function(e){var t=he.position,n=t.x,r=t.y,o=n+e;he.setTreePosition(o,r),ue.call(F,he,!1),q(he)},ee.getBoundingClientRect=function(){return le.node().getBoundingClientRect()},a(ae.scale()),ee.updateSort(null)};return{restrict:"E",templateUrl:function(){return c.isMobile?"partials/mobile/tree.html":"partials/shared/tree.html"},controller:"TreeCtrl",link:R,controllerAs:"treeCtrl",bindToController:!0}}]),o.service("treeLayout",["nodeSize",function(e){var t=this,n=e.margin,o=e.width,i=e.height,c=function(){return 1},l=function(e){return[e.x,e.y+.5*i]},u=function(e){return e.x},d=function(e){return e.y},m=a.tree().separation(c).nodeSize([i+n.left,o+n.top]),p=a.tree().separation(c).nodeSize([o+n.left,i+n.top]);t.diagonal=d3.svg.diagonal().source(function(e){return{x:e.source.x+o-5,y:e.source.y}}).target(function(e){return{x:e.target.x+5,y:e.target.y}}).projection(l),t.diagonalPrev=d3.svg.diagonal().source(function(e){var t=e.source,n=e.target,r=t.x0+o-5,i=t.y0;return t.x===n.x0&&t.y===n.y0&&(r=t.x+o-5,i=t.y),{x:r,y:i}}).target(function(e){return{x:e.target.x0+5,y:e.target.y0}}).projection(l),t.nodes=function(t,n,a,c){void 0===c&&(c=!1);var l=c?p:m,h=t.parent;t.parent=null;var g,f,v,b,y=l(t.copy()).descendants(),k=t.descendants(),w=d3.map(n||[],s),C=d3.map(k,s),_=d3.map(),S=!!n;if(k.forEach(function(e,t){e.x0=e.x,e.y0=e.y,e.x=y[t].x,e.y=y[t].y}),c){var x=d3.max(k,u),T=d3.min(k,u);f=d3.max(k,d),g=x-T;var A=.5*g;v=function(e){e.x0=A,e.y0=0,_.set(s(e),!0)},b=function(e){return e.x-=T}}else{k.forEach(function(e){return e.x=[e.y,e.y=e.x][0]});var P=d3.max(k,d),D=d3.min(k,d);g=d3.max(k,u),f=P-D;var $=.5*f;v=function(e){e.x0=0,e.y0=$,_.set(s(e),!0)},b=function(e){return e.y-=D}}return C.forEach(function(e,t){if(b(t),w.has(e)){var n=w.get(e);t.size=n.size,t.domain=n.domain,t.favicon=n.favicon,t.color=n.color,n.x=t.x,n.y=t.y}else t.x0=t.x,t.y0=t.y}),S&&(w.forEach(function(e,t){return _.set(s(t),!1)}),C.forEach(function(t,n){if(!w.has(t)&&(n.enter=!0,!_.get(t))){if(n.pageEnterNext)return void(c?(n.x0=n.x+a*e.width,n.y0=n.y):(n.x0=n.x,n.y0=n.y+a*e.height));if(n.pageEnterPrev)return void(c?(n.x0=n.x-a*e.width,n.y0=n.y):(n.x0=n.x,n.y0=n.y-a*e.height));for(var o=n.parent,i=[n];o&&!w.has(s(o));)i.push(o),o=o.parent;o?r.forEach(i,function(e){e.x0=o.x0,e.y0=o.y0,_.set(s(e),!0)}):r.forEach(i,v)}}),w.forEach(function(e,t){if(!C.has(e)&&(t.exit=!0,!t.pageExit&&!_.get(e))){for(var n=t.parent,o=[t];n&&!C.has(s(n));)o.push(n),n=n.parent;n?r.forEach(o,function(e){e.x0=n.x,e.y0=n.y,_.set(s(e),!0)}):r.forEach(o,v)}})),t.parent=h,{nodes:k,height:f+i,width:g+o}}}])}(angular.module("tnTreeDirectives",["tnLayout","tnNodeDirectives","tnUtil"])),function(e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n(0);e.directive("tnTreeMetaText",["numberAbbreviateFilter","treesConfig","propertyType",function(e,t,n){var r=t.groupCtrl.type;return{restrict:"A",link:function(t,o,i){function a(){var r=t.treeMeta.value[s]||"",i=r.toString();if(c==n.count){var a=parseInt(r);i=a&&e(a)}i?(o.text(i),o.parent().removeClass("ng-hide")):o.parent().addClass("ng-hide")}var s=i.tnTreeMetaText,c=r[s],l=t.treeMeta.value.observer;l.subscribe(a),t.$on("$destroy",function(){return l.unsubscribe(a)}),a()}}}])}(angular.module("tnTreeMetaDirectives",["tnTreeDirectives"])),function(e){e.directive("tnTreesTimeline",["trees","layoutObservers","util","Analytics","treesToolbarHeight",function(e,t,n,r,o){return{scope:!0,template:"<svg><g id='timeline-axis'></g><g id='timeline-circle'><circle r='6'></g></svg>",restrict:"E",link:function(i,a){function s(){var e=d3.event;v.attr("transform","translate(0, "+Math.min(h.range()[0],Math.max(0,e.y))+")")}function c(){var e=parseFloat(this.getAttribute("transform").match(/\d+/g)[1]),t=[];f.selectAll("g.tick").each(function(n){return t.push(Math.abs(h(n)-e))});var n=d3.min(t);l(null,t.indexOf(n)),r.trackEvent("timeline","drag","")}function l(e,t){u(t),v.call(m,t+1)}function u(e){i.updateTabScroll("scrollTo","#trees-meta-container .trees-subhead:nth-child("+(2*e+1)+")",{scrollInertia:850,timeout:0})}function d(e){var t=b[0].offsetTop,n=[],r=Math.max(0,-e-t),o=1;b.find(".trees-subhead").each(function(e,r){return n.push(r.offsetTop-t)});for(var i=1;i<n.length;i+=1)r>=n[i]&&(o=i+1);v.call(m,o)}function m(e,t){var n=f.select("g.tick:nth-child("+t+")"),r=n.attr("transform");e.attr("transform")!=r&&e.transition().duration(850).attr("transform",r)}function p(){var t=window.innerHeight-o,a=.8*t,s=e.treesMetaContainer.groupTrees(function(e){return e[i.vm.sortBy].toDateString()}).map(function(e){return new Date(e.key)});h=d3.time.scale().domain([d3.min(s),d3.max(s)]).range([a,0]);var c=d3.svg.axis().orient("left").tickValues(s).tickFormat(function(e){return moment(e).format("DD/MM")}).scale(h);f.attr("width",1).attr("height",a).style("transform",n.translate(-20,.1*t)).select("g#timeline-axis").call(c),f.selectAll("text").on("click",function(e,t){l(null,t),r.trackEvent("timeline","click","")})}var h,g=d3.behavior.drag().on("drag",s).on("dragend",c),f=d3.select(a[0]).select("svg"),v=f.select("g#timeline-circle").call(g),b=angular.element("#trees-meta-container"),y=t.scrollEndObserver;i.vm.updateTimeline=p,i.$on("$destroy",function(){i.vm.updateTimeline=null,y.unsubscribe(d)}),y.subscribe(d)}}}]),e.directive("tnTreesSearch",["$state","textSuggest","treesConfig",function(e,t,n){var r=n.groupCtrl.treesSearch,o=function(n){var o=this,i=!!e.params.q;o.searchText=function(){return t.query(r.searchText)},o.search=function(){var t=!1;if(r.isSearch()?!r.getSearchText()&&r.getSelectedNode()||(i=!0,t=!0):i&&(i=!1,t=!0),t){var o=n.tabCtrl.getLoadOptions(),a=o.userId,s=o.plusId,c=o.favorite,l=o.published,u=o.global,d=r.getText();i?e.go("main.tab.search",{userId:a,plusId:s,favorite:c,published:l,global:u,q:d}):a&&"me"!=a||s?e.go("main.tab.user",{userId:a,plusId:s}):c?e.go("main.tab.favorites"):l?e.go("main.tab.published"):u?e.go("main.tab.global"):e.go("main.tab.session")}},n.$on("$stateChangeSuccess",function(){e.includes("main.tab.search")||(i=!1,r.clear())})};return o.$inject=["$scope"],{restrict:"E",controller:o,templateUrl:"partials/components/trees-search.html",controllerAs:"treesSearchCtrl",bindToController:!0}}]),e.directive("tnTreesSort",["trees","treesConfig",function(e,t){var n=t.groupCtrl;return{restrict:"E",link:function(t){var r=t.treesSortCtrl,o=t.userSettings;r.template="partials/components/trees-sort.html",r.update=function(r){r!=n.sortBy&&(o.treesSort=n.sortBy=r||n.sortBy,e.clearTrees(),n.updateSort(),t.tabCtrl.scroll(t.tabCtrl.getLoadOptions()))}},template:"<ng-transclude></ng-transclude>",controller:"MenuCtrl",controllerAs:"treesSortCtrl",transclude:!0}}])}(angular.module("tnTreesDirectives",["tnTreeMetaDirectives"])),function(e){e.run(["$rootScope","$state",function(e,t){e.$state=t}]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,n){var r="partials/views/",o={url:"/?{tree:any}",name:"main.tab",templateUrl:r+"tab.html",controller:"TabCtrl",controllerAs:"tabCtrl"},i={url:"^/history",templateUrl:r+"list.html",controller:"ListCtrl",controllerAs:"vm"},a={templateUrl:r+"trees-meta.html",controller:"TreesMetaCtrl",controllerAs:"vm"},s={templateUrl:r+"hero.html",controller:"HeroCtrl",controllerAs:"vm"},c={templateUrl:r+"nodes.html",controller:"NodesCtrl",controllerAs:"vm"},l={template:"",controller:angular.noop},u={treesmeta:a,nodes:l,hero:l,collections:l},d={treesmeta:a,nodes:c,hero:l,collections:l},m=[];m.push({url:"^/home",name:"main.tab.session",parent:o,views:{treesmeta:a,nodes:c,hero:l,collections:{templateUrl:r+"collections.html",controller:"CollectionsCtrl",controllerAs:"vm"}}}),m.push({url:"^/published",name:"main.tab.published",parent:o,views:d}),m.push({url:"^/feed",name:"main.tab.feed",parent:o,views:u}),m.push({url:"^/shared",name:"main.tab.shared",parent:o,views:u}),m.push({url:"^/favorites",name:"main.tab.favorites",parent:o,views:d}),m.push({url:"^/trending?{openFirst:bool}",name:"main.tab.global",parent:o,views:d}),m.push({url:"^/recommended",name:"main.tab.recommendations",parent:o,views:d}),m.push({url:"^/user/?userId&plusId",name:"main.tab.user",parent:o,views:{treesmeta:a,nodes:l,hero:s,collections:l}}),m.push({url:"^/tag/:tag",name:"main.tab.tag",views:{treesmeta:a,nodes:c,hero:l,collections:l}}),m.push({url:"^/domain/:domain",name:"main.tab.domain",views:{treesmeta:a,nodes:c,hero:l,collections:l}}),m.push({url:"^/search/?userId&plusId&{favorite:bool}&{published:bool}&{global:bool}&q",name:"main.tab.search",views:{treesmeta:a,nodes:c,hero:s,collections:l}}),t.otherwise("/"),n.html5Mode(!0),e.state("main",{abstract:!0,templateProvider:["$templateCache","$rootScope",function(e,t){var n=t.isMobile?"partials/mobile/main.html":r+"main.html";return e.get(n)}],controller:"MainCtrl",controllerAs:"mainCtrl"}).state(o).state("main.list",i),m.forEach(function(t){return e.state(t)})}])}(angular.module("tnRouting",["ui.router"])),function(e){e.service("textSuggest",["$http","$sce",function(e,t){this.query=function(n){var r={jsonpCallbackParam:"callback",params:{q:n,client:"youtube"}};return e.jsonp(t.trustAsResourceUrl("https://suggestqueries.google.com/complete/search"),r).then(function(e){var t=[],r=e.data;return angular.forEach(r[1],function(e){var r=e[0];r!=n&&t.push({text:r})}),t})}}])}(angular.module("tnTextSuggest",[])),function(e){"use strict";function t(){this.defaults={scrollButtons:{enable:!0},axis:"yx"},$.mCustomScrollbar.defaults.scrollButtons=this.defaults.scrollButtons,$.mCustomScrollbar.defaults.axis=this.defaults.axis,this.$get=function(){return{defaults:this.defaults}}}function n(e,t,n,r){n.mCustomScrollbar("destroy");var o={};r.ngScrollbarsConfig&&(o=r.ngScrollbarsConfig);for(var i in e)if(e.hasOwnProperty(i))switch(i){case"scrollButtons":o.hasOwnProperty(i)||(t.scrollButtons=e[i]);break;case"axis":o.hasOwnProperty(i)||(t.axis=e[i]);break;default:o.hasOwnProperty(i)||(o[i]=e[i])}n.mCustomScrollbar(o)}function r(e){return{scope:{ngScrollbarsConfig:"=?",ngScrollbarsUpdate:"=?",element:"=?"},link:function(t,r,o){t.elem=r;var i=e.defaults,a=$.mCustomScrollbar.defaults;t.ngScrollbarsUpdate=function(){r.mCustomScrollbar.apply(r,arguments)},t.$watch("ngScrollbarsConfig",function(e,o){void 0!==e&&n(i,a,r,t)}),n(i,a,r,t)}}}e.provider("ScrollBars",t).directive("ngScrollbars",r),t.$inject=[],r.$inject=["ScrollBars"]}(angular.module("ngScrollbars",[])),function(e){e.factory("$queueFactory",["$q","$window","$timeout","$rootScope",function(e,t,n,r){var o=function(e){this.init(e)},i=o.prototype;return i._limit=null,i._queue=null,i._deferFunc=null,i.init=function(e){this._limit=e.limit,this._queue=[],e.deferred&&(t.setImmediate?this._deferFunc=function(e){t.setImmediate(function(){e(),r.$apply()})}:this._deferFunc=function(e){n(e)})},i.enqueue=function(e,t,n){var r=[e,t,n];return this._queue.push([e,t,n]),this.dequeue(),r},i.remove=function(e){var t=this._queue.indexOf(e);return this._queue.splice(t,1)[0]},i.dequeue=function(){if(!(this._limit<=0||0===this._queue.length)){this._limit--;var t,n,r=this._queue.shift(),o=r[0],i=r[1],a=r[2],s=this;t=n=function(){s._limit++,s._deferFunc?s._deferFunc(function(){s.dequeue()}):s.dequeue()},e.when(o.apply(i||null,a||null)).then(t,n)}},i.clear=function(){this._queue.length=0},function(e,t){var n;return angular.isObject(e)?n=e:(e=e||1,angular.isUndefined(t)&&(t=!1),n={limit:e,deferred:!!t}),new o(n)}}])}(angular.module("ngQueue",[])),function(e){"use strict";e.service("debounce",["$timeout",function(e){return function(t,n,r,o){function i(){c=this,s=arguments;var i=function(){a=null,r||(l=t.apply(c,s))},u=r&&!a;return a&&e.cancel(a),a=e(i,n,o),u&&(l=t.apply(c,s)),l}var a,s,c,l;return i.cancel=function(){e.cancel(a),a=null},i}}]).directive("debounce",["debounce","$parse",function(e,t){return{require:"ngModel",priority:999,link:function(n,r,o,i){var a,s,c=t(o.debounce)(n),l=!!t(o.immediate)(n),u=i.$render.bind(i),d=e(function(e){s=!0,i.$$lastCommittedViewValue=a,i.$setViewValue(e),s=!1},parseInt(c,10),l);i.$render=function(){u(),d.cancel(),a=this.$viewValue},i.$parsers.unshift(function(e){return s?(a=e,e):(d(i.$viewValue),a)})}}}])}(angular.module("debounce",[])),function(e){e.provider("Analytics",function(){var e,t,n,r,o,i=!0,a="auto",s=!1,c=!1,l="USD",u=!1,d=!1,m=!1,p=!1,h=!1,g=!1,f=!1,v=!1,b=!1,y=!1,k=!1,w="$routeChangeSuccess",C=!1,_=!1,S=!1,x="",T=!0,A=!1;this.log=[],this.offlineQueue=[],this.setAccount=function(t){return e=angular.isUndefined(t)||!1===t?void 0:angular.isArray(t)?t:angular.isObject(t)?[t]:[{tracker:t,trackEvent:!0}],this},this.trackPages=function(e){return T=!!e,this},this.trackPrefix=function(e){return x=e,this},this.setDomainName=function(e){return n=e,this},this.useDisplayFeatures=function(e){return m=!!e,this},this.useAnalytics=function(e){return i=!!e,this},this.useEnhancedLinkAttribution=function(e){return f=!!e,this},this.useCrossDomainLinker=function(e){return c=!!e,this},this.setCrossLinkDomains=function(e){return t=e,this},this.setPageEvent=function(e){return w=e,this},this.setCookieConfig=function(e){return a=e,this},this.useECommerce=function(e,t){return h=!!e,g=!!t,this},this.setCurrency=function(e){return l=e,this},this.setRemoveRegExp=function(e){return e instanceof RegExp&&(o=e),this},this.setExperimentId=function(e){return r=e,this},this.ignoreFirstPageLoad=function(e){return v=!!e,this},this.trackUrlParams=function(e){return A=!!e,this},this.disableAnalytics=function(e){return p=!!e,this},this.setHybridMobileSupport=function(e){return y=!!e,this},this.startOffline=function(e){return k=!!e,!0===k&&this.delayScriptTag(!0),this},this.delayScriptTag=function(e){return d=!!e,this},this.logAllCalls=function(e){return b=!!e,this},this.enterTestMode=function(){return _=!0,this},this.enterDebugMode=function(e){return u=!0,S=!!e,this},this.readFromRoute=function(e){return C=!!e,this},this.$get=["$document","$location","$log","$rootScope","$window","$injector",function(P,D,$,I,M,E){var O=this,L=function(e,t){return angular.isObject(t)&&angular.isDefined(t[e])},U=function(e,t,n){return L(e,t)&&t[e]===n},N=function(e,t){return angular.isString(t)?t+"."+e:L("name",t)?t.name+"."+e:e},R={};C&&(E.has("$route")?R=E.get("$route"):$.warn("$route service is not available. Make sure you have included ng-route in your application dependencies."));var B=function(){if(C&&R.current&&"pageTrack"in R.current)return R.current.pageTrack;var e=A?D.url():D.path();return o?e.replace(o,""):e},j=function(){var e={utm_source:"campaignSource",utm_medium:"campaignMedium",utm_term:"campaignTerm",utm_content:"campaignContent",utm_campaign:"campaignName"},t={};return angular.forEach(D.search(),function(n,r){var o=e[r];angular.isDefined(o)&&(t[o]=n)}),t},F=function(e,t,n,r,o,i,a,s,c){var l={};return e&&(l.id=e),t&&(l.affiliation=t),n&&(l.revenue=n),r&&(l.tax=r),o&&(l.shipping=o),i&&(l.coupon=i),a&&(l.list=a),s&&(l.step=s),c&&(l.option=c),l},q=function(e){!i&&M._gaq&&"function"==typeof e&&e()},G=function(){var e=Array.prototype.slice.call(arguments);if(!0===k)return void O.offlineQueue.push([G,e]);M._gaq||(M._gaq=[]),!0===b&&O._log.apply(O,e),M._gaq.push(e)},z=function(e){i&&M.ga&&"function"==typeof e&&e()},W=function(){var e=Array.prototype.slice.call(arguments);return!0===k?void O.offlineQueue.push([W,e]):"function"!=typeof M.ga?void O._log("warn","ga function not set on window"):(!0===b&&O._log.apply(O,e),void M.ga.apply(null,e))},H=function(t){var n=Array.prototype.slice.call(arguments,1),r=n[0],o=[];if("function"==typeof t?e.forEach(function(e){t(e)&&o.push(e)}):o=e,0===o.length)return void W.apply(O,n);o.forEach(function(e){L("select",e)&&"function"==typeof e.select&&!e.select(n)||(n[0]=N(r,e),W.apply(O,n))})};return this._log=function(){var e=Array.prototype.slice.call(arguments);if(e.length>0){if(e.length>1)switch(e[0]){case"debug":case"error":case"info":case"log":case"warn":$[e[0]](e.slice(1))}O.log.push(e)}},this._createScriptTag=function(){if(!e||e.length<1)return void O._log("warn","No account id set to create script tag");if(e.length>1&&(O._log("warn","Multiple trackers are not supported with ga.js. Using first tracker only"),e=e.slice(0,1)),!0===s)return void O._log("warn","ga.js or analytics.js script tag already created");!0===p&&(O._log("info","Analytics disabled: "+e[0].tracker),M["ga-disable-"+e[0].tracker]=!0),G("_setAccount",e[0].tracker),n&&G("_setDomainName",n),f&&G("_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"),T&&!v&&(o?G("_trackPageview",B()):G("_trackPageview"));var t,r=P[0];return t=!0===m?("https:"===r.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===r.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",!0!==_?function(){var e=r.createElement("script");e.type="text/javascript",e.async=!0,e.src=t;var n=r.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}():O._log("inject",t),s=!0,!0},this._createAnalyticsScriptTag=function(){if(!e)return void O._log("warn","No account id set to create analytics script tag");if(!0===s)return void O._log("warn","ga.js or analytics.js script tag already created");!0===p&&e.forEach(function(e){O._log("info","Analytics disabled: "+e.tracker),M["ga-disable-"+e.tracker]=!0});var n=P[0],o=!0===y?"https:":"",i=o+"//www.google-analytics.com/"+(u?"analytics_debug.js":"analytics.js");if(!0!==_?function(e,t,n,r,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=r,a.parentNode.insertBefore(i,a)}(window,n,"script",i,"ga"):("function"!=typeof M.ga&&(M.ga=function(){O._log("debug","ga("+Array.prototype.slice.call(arguments).join()+")")}),O._log("inject",i)),S&&(M.ga_debug={trace:!0}),e.forEach(function(e){e.crossDomainLinker=L("crossDomainLinker",e)?e.crossDomainLinker:c,e.crossLinkDomains=L("crossLinkDomains",e)?e.crossLinkDomains:t,e.displayFeatures=L("displayFeatures",e)?e.displayFeatures:m,e.enhancedLinkAttribution=L("enhancedLinkAttribution",e)?e.enhancedLinkAttribution:f,e.set=L("set",e)?e.set:{},e.trackEcommerce=L("trackEcommerce",e)?e.trackEcommerce:h,e.trackEvent=!!L("trackEvent",e)&&e.trackEvent;var n={};L("fields",e)?n=e.fields:L("cookieConfig",e)?angular.isString(e.cookieConfig)?n.cookieDomain=e.cookieConfig:n=e.cookieConfig:angular.isString(a)?n.cookieDomain=a:a&&(n=a),!0===e.crossDomainLinker&&(n.allowLinker=!0),L("name",e)&&(n.name=e.name),e.fields=n,W("create",e.tracker,e.fields),!0===y&&W(N("set",e),"checkProtocolTask",null);for(var r in e.set)e.set.hasOwnProperty(r)&&W(N("set",e),r,e.set[r]);!0===e.crossDomainLinker&&(W(N("require",e),"linker"),angular.isDefined(e.crossLinkDomains)&&W(N("linker:autoLink",e),e.crossLinkDomains)),e.displayFeatures&&W(N("require",e),"displayfeatures"),e.trackEcommerce&&(g?(W(N("require",e),"ec"),W(N("set",e),"&cu",l)):W(N("require",e),"ecommerce")),e.enhancedLinkAttribution&&W(N("require",e),"linkid"),T&&!v&&W(N("send",e),"pageview",x+B())}),r){var d=n.createElement("script"),b=n.getElementsByTagName("script")[0];d.src=o+"//www.google-analytics.com/cx/api.js?experiment="+r,b.parentNode.insertBefore(d,b)}return s=!0,!0},this._ecommerceEnabled=function(e,t){var n=h&&!g;return!0===e&&!1===n&&(h&&g?O._log("warn",t+" is not available when Enhanced Ecommerce is enabled with analytics.js"):O._log("warn","Ecommerce must be enabled to use "+t+" with analytics.js")),n},this._enhancedEcommerceEnabled=function(e,t){var n=h&&g;return!0===e&&!1===n&&O._log("warn","Enhanced Ecommerce must be enabled to use "+t+" with analytics.js"),n},this._trackPage=function(e,t,n){e=e||B(),t=t||P[0].title,q(function(){G("_set","title",t),G("_trackPageview",x+e)}),z(function(){var r={page:x+e,title:t};angular.extend(r,j()),angular.isObject(n)&&angular.extend(r,n),H(void 0,"send","pageview",r)})},this._trackEvent=function(e,t,n,r,o,i){q(function(){G("_trackEvent",e,t,n,r,!!o)}),z(function(){var a={},s=function(e){return U("trackEvent",e,!0)};angular.isDefined(o)&&(a.nonInteraction=!!o),angular.isObject(i)&&angular.extend(a,i),angular.isDefined(a.page)||(a.page=B()),H(s,"send","event",e,t,n,r,a)})},this._addTrans=function(e,t,n,r,o,i,a,s,c){q(function(){G("_addTrans",e,t,n,r,o,i,a,s)}),z(function(){if(O._ecommerceEnabled(!0,"addTrans")){H(function(e){return U("trackEcommerce",e,!0)},"ecommerce:addTransaction",{id:e,affiliation:t,revenue:n,tax:r,shipping:o,currency:c||"USD"})}})},this._addItem=function(e,t,n,r,o,i){q(function(){G("_addItem",e,t,n,r,o,i)}),z(function(){if(O._ecommerceEnabled(!0,"addItem")){H(function(e){return U("trackEcommerce",e,!0)},"ecommerce:addItem",{id:e,name:n,sku:t,category:r,price:o,quantity:i})}})},this._trackTrans=function(){q(function(){G("_trackTrans")}),z(function(){if(O._ecommerceEnabled(!0,"trackTrans")){H(function(e){return U("trackEcommerce",e,!0)},"ecommerce:send")}})},this._clearTrans=function(){z(function(){if(O._ecommerceEnabled(!0,"clearTrans")){H(function(e){return U("trackEcommerce",e,!0)},"ecommerce:clear")}})},this._addProduct=function(e,t,n,r,o,i,a,s,c,l){q(function(){G("_addProduct",e,t,n,r,o,i,a,s,c)}),z(function(){if(O._enhancedEcommerceEnabled(!0,"addProduct")){var u=function(e){return U("trackEcommerce",e,!0)},d={id:e,name:t,category:n,brand:r,variant:o,price:i,quantity:a,coupon:s,position:c};angular.isObject(l)&&angular.extend(d,l),H(u,"ec:addProduct",d)}})},this._addImpression=function(e,t,n,r,o,i,a,s){q(function(){G("_addImpression",e,t,n,r,o,i,a,s)}),z(function(){if(O._enhancedEcommerceEnabled(!0,"addImpression")){H(function(e){return U("trackEcommerce",e,!0)},"ec:addImpression",{id:e,name:t,category:o,brand:r,variant:i,list:n,position:a,price:s})}})},this._addPromo=function(e,t,n,r){q(function(){G("_addPromo",e,t,n,r)}),z(function(){if(O._enhancedEcommerceEnabled(!0,"addPromo")){H(function(e){return U("trackEcommerce",e,!0)},"ec:addPromo",{id:e,name:t,creative:n,position:r})}})},this._setAction=function(e,t){q(function(){G("_setAction",e,t)}),z(function(){if(O._enhancedEcommerceEnabled(!0,"setAction")){H(function(e){return U("trackEcommerce",e,!0)},"ec:setAction",e,t)}})},this._trackTransaction=function(e,t,n,r,o,i,a,s,c){this._setAction("purchase",F(e,t,n,r,o,i,a,s,c))},this._trackRefund=function(e){this._setAction("refund",F(e))},this._trackCheckOut=function(e,t){this._setAction("checkout",F(null,null,null,null,null,null,null,e,t))},this._trackDetail=function(){this._setAction("detail"),this._pageView()},this._trackCart=function(e,t){-1!==["add","remove"].indexOf(e)&&(this._setAction(e,{list:t}),this._trackEvent("UX","click",e+("add"===e?" to cart":" from cart")))},this._promoClick=function(e){this._setAction("promo_click"),this._trackEvent("Internal Promotions","click",e)},this._productClick=function(e){this._setAction("click",F(null,null,null,null,null,null,e,null,null)),this._trackEvent("UX","click",e)},this._pageView=function(e){z(function(){W(N("send",e),"pageview")})},this._send=function(){var e=Array.prototype.slice.call(arguments);e.unshift("send"),z(function(){W.apply(O,e)})},this._set=function(e,t,n){z(function(){W(N("set",n),e,t)})},this._trackTimings=function(e,t,n,r){z(function(){H(void 0,"send","timing",e,t,n,r)})},this._trackException=function(e,t){z(function(){H(void 0,"send","exception",{exDescription:e,exFatal:!!t})})},d||(i?this._createAnalyticsScriptTag():this._createScriptTag()),T&&I.$on(w,function(){(!C||R.current&&R.current.templateUrl&&!R.current.doNotTrack)&&O._trackPage()}),{log:O.log,offlineQueue:O.offlineQueue,configuration:{accounts:e,universalAnalytics:i,crossDomainLinker:c,crossLinkDomains:t,currency:l,debugMode:u,delayScriptTag:d,disableAnalytics:p,displayFeatures:m,domainName:n,ecommerce:O._ecommerceEnabled(),enhancedEcommerce:O._enhancedEcommerceEnabled(),enhancedLinkAttribution:f,experimentId:r,hybridMobileSupport:y,ignoreFirstPageLoad:v,logAllCalls:b,pageEvent:w,readFromRoute:C,removeRegExp:o,testMode:_,traceDebuggingMode:S,trackPrefix:x,trackRoutes:T,trackUrlParams:A},getUrl:B,setCookieConfig:O._setCookieConfig,getCookieConfig:function(){return a},createAnalyticsScriptTag:function(e){return e&&(a=e),O._createAnalyticsScriptTag()},createScriptTag:function(){return O._createScriptTag()},offline:function(e){if(!0===e&&!1===k&&(k=!0),!1===e&&!0===k)for(k=!1;O.offlineQueue.length>0;){var t=O.offlineQueue.shift();t[0].apply(O,t[1])}return k},trackPage:function(e,t,n){O._trackPage.apply(O,arguments)},trackEvent:function(e,t,n,r,o,i){O._trackEvent.apply(O,arguments)},addTrans:function(e,t,n,r,o,i,a,s,c){O._addTrans.apply(O,arguments)},addItem:function(e,t,n,r,o,i){O._addItem.apply(O,arguments)},trackTrans:function(){O._trackTrans.apply(O,arguments)},clearTrans:function(){O._clearTrans.apply(O,arguments)},addProduct:function(e,t,n,r,o,i,a,s,c,l){O._addProduct.apply(O,arguments)},addPromo:function(e,t,n,r){O._addPromo.apply(O,arguments)},addImpression:function(e,t,n,r,o,i,a,s){O._addImpression.apply(O,arguments)},productClick:function(e){O._productClick.apply(O,arguments)},promoClick:function(e){O._promoClick.apply(O,arguments)},trackDetail:function(){O._trackDetail.apply(O,arguments)},trackCart:function(e,t){O._trackCart.apply(O,arguments)},trackCheckout:function(e,t){O._trackCheckOut.apply(O,arguments)},trackTimings:function(e,t,n,r){O._trackTimings.apply(O,arguments)},trackTransaction:function(e,t,n,r,o,i,a,s,c){O._trackTransaction.apply(O,arguments)},trackException:function(e,t){O._trackException.apply(O,arguments)},setAction:function(e,t){O._setAction.apply(O,arguments)},pageView:function(){O._pageView.apply(O,arguments)},send:function(e){O._send.apply(O,arguments)},set:function(e,t,n){O._set.apply(O,arguments)}}}]}).directive("gaTrackEvent",["Analytics","$parse",function(e,t){return{restrict:"A",link:function(n,r,o){var i=t(o.gaTrackEvent);r.bind("click",function(){o.gaTrackEventIf&&!n.$eval(o.gaTrackEventIf)||i.length>1&&e.trackEvent.apply(e,i(n))})}}}])}(angular.module("angular-google-analytics",[])),function(e){e.config(["AnalyticsProvider","ANALYTICS_TRACKING_ID",function(e,t){e.setAccount(t).trackPages(!1).useDisplayFeatures(!1).useCrossDomainLinker(!1).useECommerce(!1,!1).useEnhancedLinkAttribution(!1)}])}(angular.module("tnAnalytics",["angular-google-analytics","tnConfig"])),function(e){e.directive("bricklayer",["$timeout",function(e){return{restrict:"C",link:function(t,r,o){var i=n(27),a=n(28),s=new i(r[0]);a(r[0],function(){s.redraw()}),e(function(){s.redraw()}),t.$on("bricklayer.append",function(e,t){s.append(t[0]),s.redraw(),a(t,function(){s.redraw()})}),t.$on("bricklayer.prepend",function(e,t){s.prepend(t[0]),s.redraw(),a(t,function(){s.redraw()})}),t.$on("bricklayer.redraw",function(){s.redraw()})},controller:angular.noop}}]).directive("bricklayerAppend",function(){return{require:"^^bricklayer",restrict:"ACE",link:function(e,t,n){e.$emit("bricklayer.append",t)}}}).directive("bricklayerPrepend",function(){return{require:"^^bricklayer",restrict:"ACE",link:function(e,t,n){e.$emit("bricklayer.prepend",t)}}})}(angular.module("tnBricklayer",[])),function(e){e.config(["$animateProvider",function(e){e.classNameFilter(/is-animated/)}]),Object.defineProperty(t,"__esModule",{value:!0});n(0);e.factory("linkTransition",["Tab","treeLayout","animationUtil","animationDuration","animationEase",function(e,t,n,r,o){return function(i,a){var s=t.diagonal(a);if(e.active){var c=t.diagonalPrev(a),l=n.transformDiagonal(d3.interpolate(c,s));i.style("opacity",a.target.enter?0:null).transition().ease(o).duration(r).style("opacity",1).tween("d",function(){return l})}else i.attr("d",s)}}]),Object.defineProperty(t,"__esModule",{value:!0});n(0);e.animation(".link",["Tab","treeLayout","animationUtil","animationDuration","animationEase",function(e,t,n,r,o){var i={};return i.leave=function(n,i){var a=d3.select(n[0]),s=a.datum().link,c=t.diagonalPrev(s),l=a.selectAll("path");!e.active||s.source.exit&&!s.target.exit||!s.source.pageExit&&s.target.pageExit?i():l.transition().ease(o).duration(r).attr("d",c).style("opacity",0).each("end",i)},i}]),Object.defineProperty(t,"__esModule",{value:!0});n(0);e.factory("nodeListedLeaveTransition",["Tab","nodeSize","util","animationUtil","animationDuration",function(e,t,n,r,o){var i=t.listed;return function(e,t){var a=n.translate(0,t*i),s=n.translate(0,(t-2)*i),c=r.transformTween(d3.interpolateString(a,s));e.style("will-change","transform").style("z-index",1).transition().duration(o).tween("transform",function(){return c})}}]),Object.defineProperty(t,"__esModule",{value:!0});n(0);e.factory("nodeListedMoveTransition",["Tab","nodeSize","util","animationUtil","animationDuration",function(e,t,n,r,o){var i=t.listed;return function(t,a,s,c){var l=n.translate(0,s*i);if(e.active&&s!=c){var u=n.translate(0,c*i),d=r.transformTween(d3.interpolateString(u,l));t.style("will-change","transform").transition().duration(o).tween("transform",function(){return d}).each("end",function(){t.style("will-change",null).style("z-index",null)})}else t.style("transform",l)}}]),Object.defineProperty(t,"__esModule",{value:!0});n(0);e.factory("nodeMoveTransition",["Tab","util","animationUtil","animationDuration","animationEase",function(e,t,n,r,o){return function(i,a){var s=t.translate(a.x0,a.y0),c=t.translate(a.x,a.y);if(e.active&&s!=c){var l=n.transformTween(d3.interpolateString(s,c));if(i.style("will-change","transform").style("z-index",a.enter?2:null).transition().ease(o).duration(r).tween("transform",function(){return l}).each("end",function(){i.style("will-change",null).style("z-index",null)}),a.enter){var u=i.select(".node__container").style("will-change","opacity").style("opacity",0);u.transition().ease(o).duration(r).style("opacity",1).each("end",function(){u.style("will-change",null).style("opacity",null)})}}else i.style("transform",c)}}]),Object.defineProperty(t,"__esModule",{value:!0});n(0);e.animation(".tree-node",["Tab","util","animationUtil","animationDuration","animationEase",function(e,t,n,r,o){var i={};return i.leave=function(i,a){var s=d3.select(i[0]).select(".node"),c=s.datum().node,l=t.translate(c.x,c.y);if(c.exit=!1,e.active){var u=t.translate(c.x0,c.y0),d=n.transformTween(d3.interpolateString(l,u));s.style("will-change","transform").style("z-index",1).transition().ease(o).duration(r).tween("transform",function(){return d}).style("box-shadow","none").each("end",a),s.select(".node__container").style("will-change","opacity").transition().ease(o).duration(r).style("opacity",0)}else a()},i}]),Object.defineProperty(t,"__esModule",{value:!0});n(0);e.factory("animationUtil",function(){var e={},t=d3.interpolateNumber(0,1),n=d3.interpolateNumber(1,0);return e.opacityInterpolatorEnter=function(){return t},e.opacityInterpolatorExit=function(){return n},e.distance=function(e){return Math.sqrt(Math.pow(e.x-e.x0,2)+Math.pow(e.y-e.y0,2))},e.transformTween=function(e){return function(t){this.style.setProperty("transform",e(t))}},e.transformDiagonal=function(e){return function(t){this.setAttribute("d",e(t))}},e})}(angular.module("tnAnimation",["tnLayout","tnConfig","ngAnimate"])),function(e){e.run(["GAuth","CLIENT_ID","SCOPES",function(e,t,n){e.setClient(t),e.setScope(n.join(" "))}])}(angular.module("tnGapiShared",["angular-google-gapi","tnConfig"])),function(e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(n(0),n(2));n(3),n(4);var o=function(){function e(e){if(this.$q=e,this.firebase=r,this.refs={},r){var t={apiKey:"AIzaSyAVFXhdstGRYa40dbjNhJmzKx4ASVrBpuA",authDomain:"getbrancher.firebaseapp.com",databaseURL:"https://getbrancher.firebaseio.com",storageBucket:"getbrancher.appspot.com",messagingSenderId:"988709185566"};this.firebase.initializeApp(t),this.database=this.firebase.database()}}return e.prototype.getToken=function(e){var t=this.$q.defer();return e?(e.getToken().then(function(e){return t.resolve(e)}).catch(function(){return t.reject()}),t.promise):this.$q.reject()},e.prototype.login=function(e){var t=this,n=this.$q.defer(),r=this.firebase.auth(),o=r.currentUser,i=function(e){return n.resolve(e)};return o?o.providerData.some(function(t){return t.providerId==e.providerId})?i(o):this.link(o,e).then(i,function(){return i(o)}):r.signInWithCredential(e).then(i,function(e){return n.reject(e)}),n.promise.then(function(e){return t.getToken(e)})},e.prototype.signInWithPopup=function(e,t){var n=this,r=this.$q.defer();return this.firebase.auth().signInWithPopup(e).then(function(e){return r.resolve(e.user)}).catch(function(e){return r.reject(e)}),r.promise.then(function(e){return n.link(e,t)}).then(function(e){return n.getToken(e)})},e.prototype.onAuthError=function(e,t){var n=this;return function(r){switch(r.code){case"auth/account-exists-with-different-credential":case"auth/internal-error":return n.signInWithPopup(e,t)}return n.$q.reject()}},e.prototype.link=function(e,t){var n=this.$q.defer();return e.linkWithCredential(t).then(function(e){return n.resolve(e)},function(){return n.reject()}),n.promise},e.prototype.onAuthStateChanged=function(e){this.firebase.auth().onAuthStateChanged(function(t){return e(!!t)})},e.prototype.loginFacebook=function(e){var t=this.firebase.auth.FacebookAuthProvider.credential(e);return this.login(t).then(function(e){return e},this.onAuthError(new this.firebase.auth.GoogleAuthProvider,t))},e.prototype.loginGoogle=function(e){var t=this.firebase.auth.GoogleAuthProvider.credential(null,e);return this.login(t).then(function(e){return e},this.onAuthError(new this.firebase.auth.FacebookAuthProvider,t))},e.prototype.logoutFacebook=function(){return this.logout("facebook.com")},e.prototype.logoutGoogle=function(){return this.logout("google.com")},e.prototype.logout=function(e){var t=this.firebase.auth().currentUser;return t&&t.providerData.some(function(t){return t.providerId==e})?this.unlink(e):this.$q.when()},e.prototype.unlink=function(e){var t=this.$q.defer();return this.firebase.auth().currentUser.unlink(e).then(function(){return t.resolve()},function(){return t.reject()}),t.promise},e.prototype.on=function(t,n,r){var o=this.database.ref(t);o.on(n,function(e){return r(e.val(),function(){return e.ref.remove()})}),this.refs[e.ref_key(t,n)]=o},e.prototype.off=function(t,n){var r=this.refs[e.ref_key(t,n)];r&&r.off()},e.prototype.push=function(e,t){var n=this.$q.defer();return this.database.ref(e).push(JSON.parse(JSON.stringify(t))).then(function(){return n.resolve()}).catch(function(e){return n.reject(e)}),n.promise},e.prototype.update=function(e,t){var n=this.$q.defer();return this.database.ref(e).update(t),n.promise},e.prototype.onDataWithRemove=function(e,t,n,r){if(e<moment().day(-1).toDate())return void r();e>t&&n()},e.ref_key=function(e,t){return e+"_"+t},e}();e.factory("firebaseService",["$q",function(e){return new o(e)}])}(angular.module("tnFirebase",[])),function(e){e.run(["GApi","BASE",function(e,t){e.load("tree","v1",t),e.load("user","v1",t)}]).factory("GApiShared",["GAuth","GApi","GData","firebaseService","SCOPES",function(e,t,n,r,o){var i=this;return i.loginUser=function(o){return void 0===o&&(o=!1),e.getToken().then(function(e){return r.loginGoogle(e.access_token)}).then(function(e){return t.executeAuth("user","store.user",{check_license:o,firebase_token:e})}).then(function(){return n.getUser()})},i.getYoutubeScope=function(){var e=o.slice(0);return e.push("https://www.googleapis.com/auth/youtube","https://www.googleapis.com/auth/youtube"),e},i}])}(angular.module("tnGapi",["tnGapiShared","tnFirebase"])),function(e){e.config(["$mdThemingProvider","$mdIconProvider",function(e,t){t.defaultIconSet("img/icons.svg"),e.theme("default").backgroundPalette("grey",{default:"50"}).primaryPalette("teal",{default:"200"}).accentPalette("pink")}]).run(["$rootScope",function(e){e.theming={topbar:{backgroundColor:"background-300",borderColor:"background-900-.27"}}}]).value("nodeColorExpression",{backgroundColor:"default-background-100"}).value("nodeRelatedColorExpression",{backgroundColor:"default-primary-200"}).value("nodeSearchResultColorExpression",{backgroundColor:"default-accent-300"}).factory("nodeLinkDefaultColor",["$mdColors",function(e){return e.getThemeColor("default-accent-600")}])}(angular.module("tnTheming",["ngMaterial"])),function(e){e.service("tagsApi",["GApi","API_KEY",function(e,t){var n=this;n.getTags=function(n){return e.execute("kgsearch","entities.search",{query:n,prefix:!0,key:t}).then(function(e){return e.itemListElement.map(function(e){var t=e.result,n=t.image;return{name:t.name,image:n&&n.contentUrl,description:t.description}})})},n.transformTag=function(e){return angular.isObject(e)?e.name:angular.isString(e)?e:void 0}}])}(angular.module("tnTags",[])),function(e){e.factory("disqus",["$window","$http","$timeout","DISQUS_API_KEY","DISQUS_FORUM","BASE_URL",function(e,t,n,r,o,i){function a(){return 0}var s={};return $.getScript("https://brancher.disqus.com/embed.js"),e.disqus_config=function(){this.shortname=o},s.reset=function(e,t){return n(function(){DISQUS.reset({reload:!0,config:function(){var n=this;n.page.identifier=e,n.page.url=i+"/?tree="+e,n.page.title=t}})})},s.getCommentCount=function(e){return t.get("https://disqus.com/api/3.0/threads/details.json",{params:{api_key:r,"thread:ident":e,forum:o}}).then(function(e){return e.data.response.posts},a)},s}])}(angular.module("tnDisqus",[])),function(e){e.service("rss",["$q","$http","$cacheFactory","URI","nodes","BASE_URL",function(e,t,r,o,i,a){var s=this,c=r("rss",{capacity:20}),l=n(29);s.query=function(n){var r=i.getNode(n),o=r&&r.rss;if(!o)return e.reject();var s=c.get(o);return s?e.when(s):t.get(a+"/rss",{params:{url:o}}).then(function(t){function n(){var e=angular.element(this),t={},n=e.find("link")[0],r=n&&(n.href||n.getAttribute("href")||n.textContent);if(r){var o=angular.element(e.find("description, summary")[0]).text(),i=t.tags=[];t.value=r,t.title=e.find("title").text(),t.description=o&&l(o).substring(0,500),e.find("category").each(function(e,t){var n=angular.element(t).text()||t.getAttribute("term");n&&i.push(n)}),a.push(t)}}if(200!=t.status)return e.reject();var r=angular.element($.parseXML(t.data)),a=[];r.find("entry").each(n),0==a.length&&r.find("item").each(n),i.addNodesShared(a);var s=i.mapNodesShared(a,!1);return c.put(o,s),e.when(s)})}}])}(angular.module("tnRSS",[])),function(e){e.factory("maps",["$rootScope","$window","$compile","$templateCache","$q","$timeout","API_KEY",function(e,t,n,r,o,i,a){var s,c,l=angular.element("<script>")[0],u=r.get("partials/shared/marker-info-window.html"),d=n(u),m=o.defer(),p={};return p.onLoad=m.promise.catch(angular.noop),l.src="https://maps.googleapis.com/maps/api/js?key="+a+"&callback=initMap&language=en",l.onerror=function(){return m.reject()},t.initMap=function(){m.resolve(),s=new google.maps.Geocoder,c=new google.maps.DistanceMatrixService},document.head.appendChild(l),p.geocodeNode=function(e){var t=o.defer();return s?(s.geocode({address:e.address},function(n,r){if(r===google.maps.GeocoderStatus.OK){var o=n[0],i=o.geometry.location;e.address=o.formatted_address,e.geo=i.lat()+", "+i.lng()}t.resolve()}),t.promise):o.reject()},p.createMap=function(e,t){var n=new google.maps.Map(e,{zoom:10});return n.addListener("click",t),n},p.createUserMarker=function(e,t){return new google.maps.Marker({position:{lat:t.latitude,lng:t.longitude},map:e,title:"My location",icon:"img/my-location.png"})},p.createNodeMarker=function(t,n,r){function o(e){l.setContent(e[0]),i(a,100)}function a(){l.open(t,c)}var s=n.geo.split(","),c=new google.maps.Marker({position:{lat:parseFloat(s[0]),lng:parseFloat(s[1])},map:t,title:n.title}),l=new google.maps.InfoWindow,u=e.$new(!0);return u.node=n,c.addListener("click",function(){if(l.getContent())return l.setContent(""),l.setZIndex(1),void l.close();d(u,o),r(),l.setZIndex(2)}),l.addListener("closeclick",function(){l.setContent(""),l.setZIndex(1)}),{marker:c,infoWindow:{value:l,scope:u}}},p.clearInstanceListeners=function(e){google.maps.event.clearInstanceListeners(e)},p.setUserDistances=function(e,t){c.getDistanceMatrix({origins:[e.getPosition()],destinations:t.map(function(e){return e.marker.getPosition()}),travelMode:google.maps.TravelMode.DRIVING},function(e,n){n==google.maps.DistanceMatrixStatus.OK&&e.rows[0].elements.forEach(function(e,n){if(e.status==google.maps.DistanceMatrixElementStatus.OK){t[n].infoWindow.scope.info={duration:e.duration.text,distance:e.distance.text}}})})},p}])}(angular.module("tnMaps",["tnConfig"])),function(e){e.service("geolocation",["$q","$interval",function(e,t){var n,r=this,o=!("undefined"==typeof navigator||!navigator.geolocation);r.getCurrentPosition=function(){if(!o)return e.reject();if(n)return e.when(n);var t=e.defer();return navigator.geolocation.getCurrentPosition(function(e){n=e.coords,t.resolve(n)},function(){return t.reject()}),t.promise},t(function(){return n=null},6e5)}])}(angular.module("tnGeolocation",[])),function(e){e.service("itunes",["$http","$sce","URI","uriParser",function(e,t,n,r){function o(e){var t=[];if(200==e.status){var o=e.data;o&&angular.isArray(o.results)&&o.results.forEach(function(e){var o=e.trackViewUrl;o&&t.push({url:r.makeAffiliateLink(n(o)).toString(),title:e.trackName,author:e.artistName,category:e.kind,image:e.artworkUrl100})})}return t}this.search=function(n,r){void 0===r&&(r=2);var i={jsonpCallbackParam:"callback",params:{term:n,limit:r,explicit:"No"}};return e.jsonp(t.trustAsResourceUrl("https://itunes.apple.com/search"),i).then(o)}}])}(angular.module("tnITunes",["URIjs"])),function(e){e.config(["$compileProvider","$provide",function(e,t){e.imgSrcSanitizationWhitelist(/^\s*((https?|ftp|file|blob|chrome-extension):|data:image\/)/),e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension):/),e.debugInfoEnabled(!1),t.factory("toastObserver",["$mdToast","ObservableClass",function(e,t){var n=t();return n.subscribe(function(t){if(t){var n=e.simple().capsule(!0).textContent(t).toastClass("tn-toast").position("top right");e.show(n)}}),n}]),t.factory("keysObserver",["ObservableClass",function(e){var t=e();return window.addEventListener("keydown",function(e){return t.notifyObservers(e.keyCode)},!0),t}]),t.factory("clientInitPromise",["facebookSDK","facebook","users",function(e,t,n){return function(r){return void 0===r&&(r=!1),n.userInfo(r).then(function(){if(!r)return n.getTrending()}).then(function(){return e.then(function(){return t.userSetup()})})}}])}]).run(["$rootScope","$mdDialog","GData","Analytics","trees","nodes","users","Nodes","chromeTabs","URI","uriParser","TreeMeta","buffer","debounce",function(e,t,n,r,o,i,a,s,c,l,u,d,m,p){function h(t){return n.isLogin()?t():e.login()}function g(t){!n.isLogin()||e.isExtension||e.isPage||"undefined"!=typeof chrome&&angular.element("#brancher-extension")[0]||i.addNodeVisit(t)}e.$mdDialog=t,e.buffer=m,e.openUrl=function(t,n,o,a,s){void 0===a&&(a="node"),void 0===s&&(s="open");var d="https://goo.gl/"+t,m=i.getNode(t),p=l(m.url||"");return m.isArticle&&e.isMobile&&(d="https://brancher-io.cdn.ampproject.org/c/s/brancher.io/article/amp/?key="+t),u.isAffiliate(p)&&(d=u.makeAffiliateLink(p).toString()),r.trackEvent(a,s,n),g(t),c.create(d,m.url,o)},e.openLongUrl=function(e,t,n,o,i){void 0===o&&(o="node"),void 0===i&&(i="open");var a=l(e||"");return u.isAffiliate(a)&&(e=u.makeAffiliateLink(a).toString()),r.trackEvent(o,i,t),c.create(e,void 0,n)},e.newNode=function(t){var n=t.link,r=n&&n.value,o=n&&n.child;r&&r.title&&(r.visited&&(r.visited=new Date(r.visited)),s.addNode(o,r),e.$broadcast("update:"+o),s.notifyObservers(o))},e.newImage=function(t){var n=t.link;if(n){var r=n.value,o=n.child,a=i.getNode(o);a&&(angular.merge(a,r),e.$broadcast("update:"+o))}},e.addTree=function(e){var t=new d(e.id,e);t.openOnLoad=!0,t.pinned=e.pinned||o.pinnedTreesContainer.hasKey(t.id),o.TreesMetaContainer.put(t.id,t),o.addTreeObject(t,e)},e.pinning={disabled:!1,togglePin:p(function(e){var t=o.getTreeMeta(e);return t.loading=!0,h(t.pinned?function(){return o.unpin(e)}:function(){return o.pin(e)})},1e3,!0),move:function(e,t){return h(function(){return o.move(e,t)})}},e.$on("pin",function(t,n){e.$applyAsync(function(){var t=n.value.tree.id;o.TreesMetaContainer.hasKey(t)||o.TreesMetaContainer.put(t,new o.TreeMeta(t,n.value.tree)),o.pinTree(t),e.pinning.disabled=o.isPinDisabled()})}),e.$on("unpin",function(t,n){e.$applyAsync(function(){o.unpinTree(n.value.tree),e.pinning.disabled=o.isPinDisabled()})})}]).run(function(){var e=function(e){var t=e.parents(".mCSB_container");return[e.offset().top-t.offset().top,e.offset().left-t.offset().left]};$(".mCustomScrollbar").mCustomScrollbar(),$.extend($.expr[":"],{mcsInView:$.expr[":"].mcsInView||function(t){var n,r,o=$(t),i=o.parents(".mCSB_container");if(i.length)return n=i.parent(),r=[i[0].offsetTop,i[0].offsetLeft],r[0]+e(o)[0]>=0&&r[0]+e(o)[0]<n.height()-o.outerHeight(!1)&&r[1]+e(o)[1]>=0&&r[1]+e(o)[1]<n.width()-o.outerWidth(!1)},mcsInSight:$.expr[":"].mcsInSight||function(t,n,r){var o,i,a,s,c=$(t),l=c.parents(".mCSB_container"),u="exact"===r[3]?[[1,0],[1,0]]:[[.9,.1],[.6,.4]];if(l.length)return o=[c.outerHeight(!1),c.outerWidth(!1)],a=[l[0].offsetTop+e(c)[0],l[0].offsetLeft+e(c)[1]],i=[l.parent()[0].offsetHeight,l.parent()[0].offsetWidth],s=[o[0]<i[0]?u[0]:u[1],o[1]<i[1]?u[0]:u[1]],a[0]-i[0]*s[0][0]<0&&a[0]+o[0]-i[0]*s[0][1]>=0&&a[1]-i[1]*s[1][0]<0&&a[1]+o[1]-i[1]*s[1][1]>=0},mcsOverflow:$.expr[":"].mcsOverflow||function(e){var t=$(e).data("mCS");if(t)return t.overflowed[0]||t.overflowed[1]}})})}(angular.module("tnClientShared",["ngMaterial","URIjs","ngScrollbars","ngQueue","debounce","tnAnalytics","tnBricklayer","tnAnimation","tnTreeDirectives","tnSharedControllers","tnGapi","tnTheming","tnTags","tnConfig","tnDisqus","tnRSS","tnMaps","tnGeolocation","tnITunes","tnUrlShortener","tnFirebase"])),function(e){e.run(["$rootScope","$mdDialog","chromeTabs","EXTENSION_URL",function(e,t,n,r){var o=localStorage;e.$on("notification:click",function(e,t){"overQuota"==t&&n.create(r)}),o.getItem("firstVisit")||angular.element("#brancher-extension")[0]||t.show({hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,templateUrl:"partials/components/onboarding.html"}),o.setItem("firstVisit","1")}]).run(["$rootScope","$state","GData","firebaseService","trees","users","treesConfig","linkEvent",function(e,t,n,r,o,i,a,s){function c(r){var i=r.value,a=i.linkType,c=i.tree,l=c&&t.includes("main.tab.session");if(a===s.image)return void e.newImage(i);if(e.newNode(i),a===s.tree)o.updateViewState("session"),l&&o.newTree(i.tree);else if(a===s.link){var u=l&&"modified"==m.sortBy&&!m.sortOrder;o.newLink(i,u,!n.isLogin())}}function l(){if(n.isLogin()){var e=new Date;u=i.onLinks(e),d=i.onFeed(e)}else d&&d(),u&&u()}var u,d,m=a.groupCtrl;i.userLoginObserver.subscribe(l),e.$on("link",function(t,n,r,o){void 0===o&&(o=angular.noop),e.$applyAsync(function(){return c(n)}),o()}),e.$on("remove",function(t,n){e.$applyAsync(function(){var e=n.value.tree;o.TreesMetaContainer.remove(e),o.treesMetaContainer.deleteMeta(e),o.treesContainer.deleteTree(e),o.pinnedTreesContainer.remove(e),o.pinnedTreesObserver.notifyObservers()})}),e.$on("move",function(t,n){e.$applyAsync(function(){return o.moveTree(n.value.tree,n.value.index)})}),e.$on("feed",function(n,r){e.$applyAsync(function(){if(t.includes("main.tab.feed")){var e=o.treesMetaContainer,n=e.toArray();e.clear(),o.addTree(r.value),n.forEach(function(t){return e.put(t.key,t.value)}),e.notifyObservers()}else o.state.viewState.feed+=1})})}])}(angular.module("tnClient",["ui.router","tnControllers","tnTreesDirectives","tnRouting","tnTextSuggest","tnClientShared"])),function(e){e.config(["AnalyticsProvider",function(e){e.setHybridMobileSupport(!0)}])}(angular.module("tnExtensionClient",["tnAnalytics"])),function(e){e.directive("tnRating",["$mdDialog","GData","users","chromeTabs","EXTENSION_URL",function(e,t,n,r,o){var i=localStorage,a=function(a){var s=this,c=i.getItem("userHasRated");s.stars=[],s.stars.length=5,s.rate=function(t,a){i.setItem("userHasRated","true"),c=!0,a<3?e.show({targetEvent:t,hasBackdrop:!0,disableParentScroll:!0,clickOutsideToClose:!0,controller:function(){var t=this;t.submit=function(){n.complain(a+1,t.complaint),e.hide()},t.cancel=function(){n.complain(a+1),e.hide()}},controllerAs:"vm",templateUrl:"partials/components/complaint-dialog.html"}):(n.complain(a+1),r.create(o+"/reviews"))},s.isHidden=function(){return!(!c&&t.isLogin()&&!n.hasRatedApp&&!a.isMobile)}};return a.$inject=["$scope"],{restrict:"E",controller:a,templateUrl:"partials/components/rating.html",controllerAs:"ratingCtrl",bindToController:!0}}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnTreeTooltip",["timestampObserver","uppercaseFilter","relativeTimestampFilter","absoluteTimestampFilter",function(e,t,n,r){return{restrict:"A",link:function(o,i){function a(){var e=o.treeMeta.value,a=e.title,s=e.description,c=e.tags,l=e.created,u=e.modified,d=e.domains,m=t(a)+"\n\n";s&&(m+="Description: "+s+"\n\n"),c&&c.length&&(m+="Tags: "+c.join(", ")+"\n\n"),d&&d.length&&(m+="Domains: "+d.filter(function(e){return"www.google.com"!=e}).join(", ")+"\n\n"),m+="Created: "+n(l)+" ("+r(l)+")\n",m+="Modified: "+n(u)+" ("+r(u)+")\n",i.attr("title",m)}var s=o.treeMeta.value.observer;e.subscribe(a),s.subscribe(a),o.$on("$destroy",function(){e.unsubscribe(a),s.unsubscribe(a)}),a()}}}]),Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);e.directive("tnTreeMeta",["$compile","$templateCache","$animateCss",function(e,t,n){var o,i=e(t.get("partials/components/tree-meta.html")),a="tree-meta-list-item-container",s="tree-meta-previewed",c="tree-meta-remove-preview",l=function(t,l){function u(){g.$destroy(),g=null,o&&o()}function d(){i(t,m),l.hasClass(s)&&n(l,{addClass:c,removeClass:s}).start().done(function(){return l.removeClass(c)})}function m(e){var n=l.find("tn-tree");n.length?(n.replaceWith(e),e.is(":mcsInSight")||t.updateTabScroll("scrollTo",e,{scrollInertia:0,timeout:0})):l.append(e),e.find(".tree-meta__drag-handle").off("click")}function p(){o=t.$on("tree:postLink",function(){g.$applyAsync(function(){g.treeCtrl.init(),g.treeCtrl.updateViewportWidth()})}),v(g,h)}function h(e){var t=l.find("."+a);t.length?t.replaceWith(e):l.append(e)}var g,f=t.treeMetaCtrl,v=e("<tn-tree></tn-tree>");f.destroy=r.noop,f.update=function(e,r){e?(g=t.$new(),g.tree=e,r?(l.addClass(s),p()):n(l,{addClass:s}).start().then(p)):g?(u(),d()):d()}};return{terminal:!0,restrict:"E",controller:"TreeMetaCtrl",controllerAs:"treeMetaCtrl",compile:function(e){return e.addClass("tree-meta"),l},bindToController:!0}}])}(angular.module("tnDirectives",["tnTreeMetaDirectives"])),function(e){n(30),e.config(["$provide",function(e){e.factory("trees",["treesControlStatic",function(e){return new e}]),e.factory("nodes",["nodesControlStatic",function(e){return new e}]),e.factory("users",["usersControlStatic",function(e){return new e}]),e.factory("facebook",["facebookControlStatic",function(e){return new e}]),e.factory("facebookSDK",["$q",function(e){return e.when()}]),e.factory("pocket",["pocketControlStatic",function(e){return new e}]),e.factory("bufferService",["bufferControlStatic",function(e){return new e}]),e.factory("youtubeIFrame",["youtubeIFrameControlStatic",function(e){return new e}]),e.value("TREE_MSG",null)}]).run(["$rootScope","Analytics","Tab","trees","createOverQuotaNotification",function(e,t,n,r,o){t.set("hostname","history.chrome"),e.isExtension=!0,e.$on("tab:selected",function(e,t,r,o){return o(n)}),r.quotaObserver.subscribe(o)}]),deferredBootstrapper.bootstrap({element:document.body,module:"control",injectorModules:["tnIndexedDB","tnChrome","URIjs"],moduleResolves:[{module:"tnDataControl",resolve:{IndexedDBConfig:["IDB",function(e){return e}]}},{module:"tnChromeControl",resolve:{TabConfig:["chromeTabs",function(e){return e.getCurrent()}]}}]})}(angular.module("control",["tnDataControlExtension","tnDataExtension","tnChromeControl","tnChromeTabs","tnClient","tnExtensionClient","tnDirectives"])),angular.module("control").run(["$templateCache",function(e){"use strict";e.put("partials/components/ignore-list-dialog.html",'<md-dialog id=ignore-list-dialog><md-dialog-content><form ng-submit=vm.addItem(vm.ignoreUrl)><div class=ignore-list-dialog__input-container><md-input-container class=ignore-list-dialog__input md-no-float><input placeholder=www.example.com ng-model=vm.ignoreUrl></md-input-container><md-button class="md-icon-button ignore-list-dialog__button" ng-click=vm.addItem(vm.ignoreUrl) ng-disabled=!vm.ignoreUrl ga-track-event="[\'ignoreList\', \'add\']"><md-icon md-svg-icon=add></md-icon></md-button></div></form><div><md-list class=ignore-list-dialog__list><md-list-item class=ignore-list-dialog__list-item ng-repeat="ignoreDomain in vm.ignoreList track by ignoreDomain"><p>{{ ignoreDomain }}</p><md-button class="md-icon-button md-secondary" ng-click=vm.removeItem(ignoreDomain) ga-track-event="[\'ignoreList\', \'remove\']"><md-icon md-svg-icon=remove></md-icon></md-button></md-list-item></md-list></div></md-dialog-content></md-dialog>'),e.put("partials/components/publish-list-dialog.html",'<md-dialog id=publish-list-dialog><md-dialog-content><form ng-submit=vm.addItem(vm.domainUrl)><div class=ignore-list-dialog__input-container><md-input-container class=ignore-list-dialog__input md-no-float><input placeholder=www.example.com ng-model=vm.domainUrl></md-input-container><md-button class="md-icon-button ignore-list-dialog__button" ng-click=vm.addItem(vm.domainUrl) ng-disabled=!vm.domainUrl ga-track-event="[\'publishList\', \'add\']"><md-icon md-svg-icon=add></md-icon></md-button></div></form><div><md-list class=ignore-list-dialog__list><md-list-item class=ignore-list-dialog__list-item ng-repeat="publishDomain in vm.publishList track by publishDomain"><p>{{ publishDomain }}</p><md-button class="md-icon-button md-secondary" ng-click=vm.removeItem(publishDomain) ga-track-event="[\'publishList\', \'remove\']"><md-icon md-svg-icon=remove></md-icon></md-button></md-list-item></md-list></div><div class="scroll-button scroll-button--subscribers" ng-hide="vm.hasScrollBar || vm.disableScroll()" layout=row layout-align="space-around center"><md-button ng-click=vm.scroll()><md-icon md-svg-icon=arrow-down></md-icon></md-button></div><div ng-show=vm.users.userPublishedDomains.loading layout=row layout-align="center center"><md-progress-circular md-mode=indeterminate></md-progress-circular></div></md-dialog-content></md-dialog>'),e.put("partials/components/settings-dialog.html",'<md-dialog id=settings-dialog><md-dialog-content><md-content class=settings-form><md-toolbar><div class=md-toolbar-tools><h2 class=md-display-1><span>Settings</span></h2><div flex></div><div><md-button class=md-icon-button ng-click=$mdDialog.cancel()><md-icon md-svg-icon=close></md-icon></md-button></div></div></md-toolbar><div class=settings-group_content><span class=md-body-1>Tree Depth</span><md-slider-container flex><md-slider class=md-accent ng-model=vm.userSettings.maxTreeDepth ng-change=vm.depthChange() md-discrete min=3 max=8 step=1 aria-label="Tree Depth"></md-slider><md-input-container><input flex type=number ng-model=vm.userSettings.maxTreeDepth ng-change=vm.depthChange() min=3 max=8 step=1 aria-label="Tree Depth"></md-input-container></md-slider-container><span class=md-body-1>Tree Breadth</span><md-slider-container flex><md-slider class=md-accent ng-model=vm.userSettings.maxTreeBreadth ng-change=vm.breadthChange() md-discrete min=3 max=6 step=1 aria-label="Tree Breadth"></md-slider><md-input-container><input flex type=number ng-model=vm.userSettings.maxTreeBreadth ng-change=vm.breadthChange() min=3 max=6 step=1 aria-label="Tree Breadth"></md-input-container></md-slider-container><div id=setting-language><md-input-container><label>Content Language</label><md-select ng-model=vm.userSettings.contentLanguage ng-change=vm.contentLanguageChange()><md-option value=""><em>Default</em></md-option><md-option ng-repeat="language in vm.contentLanguages track by $index" ng-value=language><span>{{ language | lang2code : "alpha1" : "name" }}</span></md-option></md-select></md-input-container></div></div></md-content></md-dialog-content></md-dialog>'),e.put("partials/components/subscriptions-dialog.html",'<md-dialog id=subscriptions-dialog class=users-dialog><md-dialog-content><md-list><div class=subscription-user ng-repeat="subscriptionUser in vm.container track by subscriptionUser.key"><md-list-item ng-click=vm.click(subscriptionUser.value) aria-label=User><img class=md-avatar ng-src="{{ ::subscriptionUser.value.picture.data.url }}" alt="{{ ::subscriptionUser.value.name }}"><p>{{ ::subscriptionUser.value.name }}</p></md-list-item></div></md-list><div class="scroll-button scroll-button--subscribers" ng-hide="vm.hasScrollBar || vm.disableScroll()" layout=row layout-align="space-around center"><md-button ng-click=vm.scroll()><md-icon md-svg-icon=arrow-down></md-icon></md-button></div><div ng-show=vm.usersContainer.loading layout=row layout-align="center center"><md-progress-circular md-mode=indeterminate></md-progress-circular></div></md-dialog-content></md-dialog>'),e.put("partials/views/collections.html",'<div id=user-collections-container ng-show="vm.collection.domains.length || vm.collection.tags.length" md-colors="::{borderColor: \'background-900-0.13\'}"><md-subheader class=md-no-sticky md-colors="::{background: \'background-50-.22\'}"><span>Bookmarks</span> <span ng-if=::vm.editable><span ng-show=::vm.numActive>({{vm.numActive}} new)</span><md-button class=md-icon-button ng-click=vm.showBookmarks() ga-track-event="[\'bookmarks\', \'hide\']"><md-icon md-svg-icon="{{ (vm.hideBookmarks) ? \'arrow-down\' : \'arrow-left\' }}"></md-icon></md-button></span></md-subheader><div id=collections-container><div ng-show=vm.collection.domains.length><md-chips ng-model=vm.collection.domains readonly=true md-transform-chip=vm.transform md-on-remove=vm.removeDomain($chip) md-removable=vm.editable><md-chip-template tn-active-chip="{{ ::vm.isActive($chip)}}"><div><a class=domain__link ng-attr-title="{{($chip.timestamp) ? ($chip.timestamp | relativeTimestamp) : \'\'}}" ng-href="{{::\'/domain/\' + $chip.name}}"><span>{{ ::$chip.name | www }}</span></a></div></md-chip-template></md-chips></div><div ng-show=vm.collection.tags.length><md-chips ng-model=vm.collection.tags readonly=true md-transform-chip=vm.transform md-on-remove=vm.removeTag($chip) md-removable=vm.editable><md-chip-template tn-active-chip="{{ ::vm.isActive($chip)}}"><div><a class=tag__link ng-attr-title="{{($chip.timestamp) ? ($chip.timestamp | relativeTimestamp) : \'\'}}" ng-href="{{::\'/tag/\' + $chip.name}}"><span>{{ ::$chip.name }}</span></a></div></md-chip-template></md-chips></div></div></div>'),e.put("partials/views/hero.html",'<div id=hero-container ng-show=vm.user><md-list-item class=secondary-button-padding ng-href="{{ vm.socialUrl }}" target=_blank ng-if=::!isMobile><img class=md-avatar ng-src="{{ vm.user.picture.data.url }}" ng-attr-alt="{{ vm.user.name }}"> <span>{{::vm.user.name }}</span><md-button class="md-icon-button md-secondary" ng-attr-data-clipboard-text="{{ vm.url }}" ng-disabled=!vm.canSubscribe tn-clipboard ga-track-event="[\'hero\', \'share\', \'url\']"><md-tooltip>Copy URL</md-tooltip><md-icon md-svg-icon=clipboard></md-icon></md-button><md-button class=md-secondary ng-click=vm.subscribe() ng-disabled=!vm.canSubscribe ng-class="{\'md-warn\': vm.isSubscribed}" ga-track-event="[\'hero\', \'subscribe\']"><md-icon md-svg-icon="{{ (!vm.isSubscribed) ? \'add\' : \'remove\' }}"></md-icon><span>{{ (!vm.isSubscribed) ? "Subscribe" : "Unsubscribe" }}</span></md-button><md-button class=md-secondary ng-click=vm.openSubscriptionsDialog($event) ng-disabled="!(vm.userSubscriptions.subscriptions && vm.canSubscribe)" ga-track-event="[\'hero\', \'following\']"><md-icon md-svg-icon=people></md-icon>Following <span ng-show=vm.userSubscriptions.subscriptions>({{ vm.userSubscriptions.subscriptions | numberAbbreviate }})</span></md-button><md-button class=md-secondary ng-click="vm.openSubscriptionsDialog($event, true)" ng-disabled="!(vm.userSubscriptions.subscribers && vm.canSubscribe)" ga-track-event="[\'hero\', \'followers\']"><md-icon md-svg-icon=people-outline></md-icon>Followers <span ng-show=vm.userSubscriptions.subscribers>({{vm.userSubscriptions.subscribers | numberAbbreviate }})</span></md-button></md-list-item><md-list-item class=secondary-button-padding ng-href="{{ vm.socialUrl }}" target=_blank ng-if=::isMobile><img class=md-avatar ng-src="{{ vm.user.picture.data.url }}" ng-attr-alt="{{ vm.user.name }}"> <span>{{ ::vm.user.name }}</span><md-menu class=md-secondary><md-button class=md-icon-button ng-click="$event.stopPropagation(); $mdOpenMenu()" ga-track-event="[\'hero\', \'moreButton\']" aria-label=More><md-icon md-svg-icon=arrow-down></md-icon></md-button><md-menu-content><md-menu-item><md-button ng-disabled=!vm.canSubscribe ng-attr-data-clipboard-text="{{ \'https://goo.gl/\' + vm.url }}" tn-clipboard ga-track-event="[\'hero\', \'share\', \'url\']"><md-icon md-svg-icon=clipboard></md-icon>Copy URL</md-button></md-menu-item><md-menu-item><md-button ng-click=vm.subscribe() ng-disabled=!vm.canSubscribe ng-class="{\'md-warn\': vm.isSubscribed}" ga-track-event="[\'hero\', \'subscribe\']"><md-icon md-svg-icon="{{ (!vm.isSubscribed) ? \'add\' : \'remove\' }}"></md-icon><span>{{ (!vm.isSubscribed) ? "Subscribe" : "Unsubscribe" }}</span></md-button></md-menu-item><md-menu-item><md-button ng-click=vm.openSubscriptionsDialog($event) ng-disabled="!(vm.userSubscriptions.subscriptions && vm.canSubscribe)" ga-track-event="[\'hero\', \'following\']"><md-icon md-svg-icon=people></md-icon>Following <span ng-show=vm.userSubscriptions.subscriptions>({{ vm.userSubscriptions.subscriptions | numberAbbreviate }})</span></md-button></md-menu-item><md-menu-item><md-button ng-click="vm.openSubscriptionsDialog($event, true)" ng-disabled="!(vm.userSubscriptions.subscribers && vm.canSubscribe)" ga-track-event="[\'hero\', \'followers\']"><md-icon md-svg-icon=people-outline></md-icon>Followers <span ng-show=vm.userSubscriptions.subscribers>({{ vm.userSubscriptions.subscribers | numberAbbreviate }})</span></md-button></md-menu-item></md-menu-content></md-menu></md-list-item><div ng-include="\'partials/views/collections.html\'"></div></div>'),e.put("partials/views/list.html",'<md-toolbar class=topbar-container md-colors=::theming.topbar><div class="md-toolbar-tools topbar-inner" layout=row layout-align="space-between center"><div class=logo-container ng-include="\'partials/components/logo.html\'"></div><div class=topbar-content ng-if=::!isMobile layout=row layout-align="space-between center"><div class=topbar-search-container ng-include="\'partials/components/list-search.html\'" flex=70 layout=row></div><div flex=5 layout=row layout-align="start center"><div ng-if=::isExtension><md-menu><md-button class=md-icon-button ng-click="$event.stopPropagation(); $mdOpenMenu()" ng-disabled=vm.listCtrl.disableSort ga-track-event="[\'nodes\', \'sortButton\']" aria-label="History sort"><md-tooltip>Sort</md-tooltip><md-icon md-svg-icon=sort></md-icon></md-button><md-menu-content><md-subheader class=md-no-sticky>Sort by</md-subheader><md-menu-item><md-button ng-click="vm.listCtrl.sortBy = \'title\'" ga-track-event="[\'nodes\', \'sort\', \'title\']"><md-icon md-svg-icon=check ng-style="{visibility: (vm.listCtrl.sortBy == \'title\') ? \'visible\' : \'hidden\'}"></md-icon>Title</md-button></md-menu-item><md-menu-item><md-button ng-click="vm.listCtrl.sortBy = \'visited\'" ga-track-event="[\'nodes\', \'sort\', \'visited\']"><md-icon md-svg-icon=check ng-style="{visibility: (vm.listCtrl.sortBy == \'visited\') ? \'visible\' : \'hidden\'}"></md-icon>Visited</md-button></md-menu-item><md-subheader class=md-no-sticky>Sort order</md-subheader><md-menu-item><md-button ng-disabled=vm.listCtrl.disableSort ng-click="vm.listCtrl.sortOrder = !vm.listCtrl.sortOrder; vm.updateSort()" ga-track-event="[\'nodes\', \'sort\', \'order\']"><md-icon md-svg-icon=sort-ascending ng-hide=vm.listCtrl.sortOrder></md-icon><md-icon md-svg-icon=sort-descending ng-show=vm.listCtrl.sortOrder></md-icon>{{ (!vm.listCtrl.sortOrder) ? \'Ascending\' : \'Descending\' }}</md-button></md-menu-item></md-menu-content></md-menu></div></div><div class=topbar-controls-container flex=25 layout=row layout-align="center center" ng-include="\'partials/components/topbar-controls.html\'"></div></div><div class="topbar-content is-animated" ng-if=::isMobile layout=row layout-align="space-between center"><div id=topbar-search-button><md-button class=md-icon-button ng-click="vm.showSearchBar = !vm.showSearchBar" ga-track-event="[\'nodes\', \'searchButton\']"><md-icon md-svg-icon=search ng-class="{\'md-accent\': vm.showSearchBar}"></md-icon></md-button></div><div class="topbar-search-container is-animated" ng-show=vm.showSearchBar ng-include="\'partials/components/list-search.html\'" flex=70 layout=row></div><div class=topbar-controls-container ng-hide=vm.showSearchBar flex=25 layout=row layout-align="end center" ng-include="\'partials/components/topbar-controls.html\'"></div></div></div></md-toolbar><md-content id=list-view-container ng-scrollbars ng-scrollbars-update=vm.updateListScroll ng-scrollbars-config=::vm.scrollConfig flex><div id=list-view-inner ng-style="{\'height\': vm.height}"><md-list><tn-node-listed ng-repeat="node in vm.container track by node.data.key" node=node open-url=vm.click(key) show-visited=::true container=vm.getNodesPreview() scroll=vm.scroll()><div tn-list-node-menu include-share=true><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.open($event)" ga-track-event="[\'node\', \'menu\', \'historyView\']" md-no-ink aria-label="Open menu"><md-icon class=node__menu-button-icon md-svg-icon=dots></md-icon></md-button></div></tn-node-listed></md-list></div><div class=scroll-button ng-hide="vm.hasScrollBar || vm.disableScroll()" layout=row layout-align="space-around center"><md-button ng-click=vm.scroll()><md-icon md-svg-icon=arrow-down></md-icon></md-button></div><div ng-if=vm.state.loading layout=row layout-align="space-around center"><md-progress-circular md-mode=indeterminate></md-progress-circular></div></md-content>'),e.put("partials/components/list-search.html",'<div flex><md-autocomplete class=topbar-search md-items="item in vm.searchText()" placeholder=Search md-min-length=3 md-delay=1000 md-search-text=vm.listCtrl.searchText md-selected-item=vm.listCtrl.selectedText md-item-text=item.text md-search-text-change=vm.search() md-selected-item-change=vm.search()><span md-highlight-text=vm.listCtrl.searchText>{{ item.text }}</span></md-autocomplete></div><div id=topbar-search-nearby-container ng-hide=!!vm.listCtrl.searchText><md-checkbox id=topbar-search-nearby ng-model=vm.searchNearby ga-track-event="[\'nodes\', \'searchNearby\']" aria-label="Search nearby"><span id=topbar-search-nearby-text>Nearby</span></md-checkbox></div>'),e.put("partials/views/nodes.html",'<div id=nodes-container class=is-animated ng-show=!!vm.container.length><md-subheader class="md-no-sticky trees-subhead" ng-if=::vm.title><span id=nodes-container__title><span ng-class=::vm.titleClass>{{::vm.title}}</span> <span>{{::vm.titleText}}</span> <span class=md-caption ng-show=vm.modified>({{vm.modified | relativeTimestamp}})</span></span><md-button class=md-icon-button ng-click=vm.addNodeProperty() ng-disabled=vm.inUserCollection ga-track-event="[\'collections\', \'add\']"><md-icon md-svg-icon=add></md-icon></md-button><tn-like url="{{ ::vm.url }}"></tn-like><md-menu><md-button ng-click=$mdMenu.open($event) class=md-icon-button ga-track-event="[\'collections\', \'shareMenu\']" aria-label=Share><md-icon md-svg-icon=share></md-icon></md-button><md-menu-content><tn-share-menu url="{{ ::vm.url }}" preview=vm.getPreview() container=vm.getNodesPreview() category=collections></tn-share-menu></md-menu-content></md-menu></md-subheader><div ng-if=::!isMobile><div layout=row layout-align="start center" layout-wrap ng-if=vm.gridView><tn-node ng-repeat="node in vm.container track by node.data.key" tn-node-drag node=node open-url=vm.click(key) container=vm.getNodesPreview() container-preview=vm.getPreview() scroll=vm.load()><node-menu tn-list-node-menu><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.open($event)" ga-track-event="[\'node\', \'menu\', \'nodesView\']" md-no-ink aria-label="Open menu"><md-icon class=node__menu-button-icon md-svg-icon=dots-white-small></md-icon></md-button></node-menu><node-share tn-share-node-menu><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.open($event)" ga-track-event="[\'node\', \'shareMenu\', \'nodesView\']" md-no-ink aria-label="Open menu"><md-icon class=node__menu-button-icon md-svg-icon=share></md-icon></md-button></node-share><node-tools><div class=node__tools-container ng-if=::vm.hasRemove><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); vm.removeNode(node.data.key)" ga-track-event="[\'node\', \'removeFavorite\', \'nodeCover\']" aria-label=Remove><md-icon class=node__menu-button-icon md-svg-icon=remove></md-icon></md-button></div></node-tools><node-main tn-node-main-action></node-main></tn-node></div></div><div ng-if=!vm.gridView><md-list><tn-node-listed ng-repeat="node in vm.container track by node.data.key" node=node open-url=vm.click(key) show-visited="::$state.includes(\'main.tab.favorites\')"><div tn-list-node-menu include-share=true><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.open($event)" ga-track-event="[\'node\', \'menu\', \'nodesView\']" md-no-ink aria-label="Open menu"><md-icon class=node__menu-button-icon md-svg-icon=dots></md-icon></md-button></div></tn-node-listed></md-list></div></div><div ng-hide=vm.disableScroll() layout=row layout-align="space-around center"><md-button class=md-icon-button ng-click=vm.scroll()><md-icon md-svg-icon=arrow-down></md-icon></md-button></div><div ng-show=vm.state.loading layout=row layout-align="space-around center"><md-progress-circular md-mode=indeterminate></md-progress-circular></div>'),e.put("partials/views/pinned-trees.html","<div id=linked-tree><md-subheader>Linked</md-subheader></div><div id=trees-containers__selected ng-show=!!vm.container.length md-colors=\"::{borderColor: 'background-900-0.13'}\"><md-subheader class=md-no-sticky id=pinned-trees-subhead md-colors=\"::{background: 'background-50-.22'}\"><span>Pinned</span> <span id=pinned-trees-count>({{vm.container.length}})</span><md-button id=pinned-trees-hide-button class=md-icon-button ng-click=vm.showPinned() ga-track-event=\"['pinned', 'hide']\"><md-icon md-svg-icon=\"{{ (vm.hidePinned) ? 'arrow-down' : 'arrow-left' }}\"></md-icon></md-button></md-subheader><md-list id=pinned-trees class=\"md-dense trees-list\"><div id=pinned-trees-container><tn-tree-meta class=pinned-tree layout=column ng-repeat=\"treeMeta in vm.container track by treeMeta.key\"></tn-tree-meta></div></md-list></div>"),e.put("partials/views/tab.html",'<md-toolbar class="md-menu-toolbar topbar-container" md-colors=::theming.topbar><div class="md-toolbar-tools topbar-inner" layout=row layout-align="space-between center"><div class=logo-container ng-include="\'partials/components/logo.html\'"></div><div class=topbar-content ng-if=::!isMobile layout=row layout-align="space-between center"><div class=topbar-search-container flex=70 layout=row><tn-trees-search flex></tn-trees-search></div><div flex=5 layout=row layout-align="start center"><tn-trees-sort><md-button class=md-icon-button ng-click="$event.stopPropagation(); treesSortCtrl.open($event)" ng-disabled="groupCtrl.disableSort || groupCtrl.disableAll" ga-track-event="[\'trees\', \'sortButton\']" aria-label="Trees sort"><md-tooltip>Sort</md-tooltip><md-icon md-svg-icon=sort></md-icon></md-button></tn-trees-sort></div><div class=topbar-controls-container flex=25 layout=row layout-align="center center" ng-include="\'partials/components/topbar-controls.html\'"></div></div><div class="topbar-content is-animated" ng-if=::isMobile layout=row layout-align="space-between center"><div id=topbar-search-button><md-button class=md-icon-button ng-click="tabCtrl.showSearchBar = !tabCtrl.showSearchBar" ga-track-event="[\'trees\', \'searchButton\']"><md-icon md-svg-icon=search ng-class="{\'md-accent\': tabCtrl.showSearchBar}"></md-icon></md-button></div><div class="topbar-search-container is-animated" ng-show=tabCtrl.showSearchBar flex=70 layout=row><tn-trees-search flex></tn-trees-search></div><div ng-show=tabCtrl.showSearchBar layout=row layout-align="start center"><tn-trees-sort><md-button class=md-icon-button ng-click="$event.stopPropagation(); treesSortCtrl.open($event)" ng-disabled="groupCtrl.disableSort || groupCtrl.disableAll" ga-track-event="[\'trees\', \'sortButton\']" aria-label="Trees sort"><md-icon md-svg-icon=sort></md-icon></md-button></tn-trees-sort></div><div class=topbar-controls-container ng-hide=tabCtrl.showSearchBar flex=25 layout=row layout-align="end center" ng-include="\'partials/components/topbar-controls.html\'"></div></div></div></md-toolbar><md-content id=trees-containers layout=column ng-scrollbars ng-scrollbars-update=updateTabScroll ng-scrollbars-config=::tabCtrl.scrollConfig><div id=announcement1 ng-if="!userSettings.announcement1 && !isMobile && user"><md-button class=md-icon-button ng-click="userSettings.announcement1 = true" ga-track-event="[\'announcement1\', \'close\']"><md-icon md-svg-icon=close></md-icon></md-button><span>Announcement! We are making a big change. Now everyone\'s trees will be visible in <a ui-sref=main.tab.global>Trending section</a>. Your trees will be visible to other users but they will not link to your account and will not contain any personally identifiable information. If you want everyone to be able to go from your tree to your profile you will have to make that tree public. (Publishing trees automatically is easy with “Publish domain” button in the extension popup). With this change we hope to achieve more structured information being available and making search feature more meaningful. If you want to remove your private data from brancher please contact us at office@artadian.com or on <a href=https://www.facebook.com/brancher.io target=_blank>facebook</a>.</span></div><div ui-view=hero></div><div class=trees-container onload=vm.onload() ng-controller="PinnedTreesCtrl as vm" ng-include="\'partials/views/pinned-trees.html\'"></div><div ui-view=collections></div><div ui-view=nodes></div><div class=trees-container id=trees-meta-container tabindex=0 ui-view=treesmeta></div><div ng-if=isLoggingIn ng-include="\'partials/shared/init-load.html\'"></div></md-content>'),e.put("partials/views/trees-meta.html",'<md-subheader class="md-no-sticky trees-subhead" ng-repeat-start="treeMetaGroup in vm.container track by $index"><span ng-show=treeMetaGroup.value.length>{{ ::treeMetaGroup.key }}</span></md-subheader><md-list class="md-dense trees-list" ng-repeat-end><tn-tree-meta layout=row ng-repeat="treeMeta in treeMetaGroup.value track by treeMeta.key"></tn-tree-meta></md-list><div id=no-trees-msg class=is-animated ng-show="!mainCtrl.state.loading && !mainCtrl.initPromise && !vm.container.length && $state.includes(\'main.tab.session\')"><div ng-show=::!isExtension><tn-inline-install text="{{::(!isMobile) ? \'Install Chrome Extension\' : \'\'}}"></tn-inline-install></div><div class=md-display-2>Start browsing the web</div><div class=md-display-1>your history will appear here</div></div><tn-trees-timeline ng-if="!isMobile && vm.showTimeline"></tn-trees-timeline><div class=scroll-button ng-hide="tabCtrl.hasScrollBar || !vm.firstLoad || mainCtrl.disableScroll()" layout=row layout-align="space-around center"><md-button ng-click=tabCtrl.scroll(tabCtrl.getLoadOptions())><md-icon md-svg-icon=arrow-down></md-icon></md-button></div><div ng-show=mainCtrl.state.loading style="margin-top: 8px" layout=row layout-align="space-around center"><md-progress-circular md-mode=indeterminate></md-progress-circular></div>'),e.put("partials/views/users.html",'<md-sidenav id=users-sidebar class="md-sidenav-right is-animated sidebar sidebar--over" md-component-id=users-sidebar md-is-open=mainCtrl.showUsers><md-content><md-list><md-subheader>Facebook Friends</md-subheader><div id=facebook-logout-button><md-button class=md-icon-button ng-show=facebook.status ng-click=usersCtrl.logout() ga-track-event="[\'users\', \'logout\']"><md-tooltip>Logout</md-tooltip><md-icon md-svg-icon=logout></md-icon></md-button></div><md-list-item ng-click=toggleUser(user.value) ng-repeat="user in usersCtrl.container track by user.key" aria-label="Select friend"><img class=md-avatar ng-src="{{ ::user.value.picture.data.url }}" alt="{{ ::user.value.name }}"><p>{{ ::user.value.name }}</p></md-list-item></md-list><tn-invite-friends ng-show=usersCtrl.showInvite></tn-invite-friends><div class="scroll-button scroll-button--users" ng-hide="usersCtrl.hasScrollBar || usersCtrl.disableScroll()" layout=row layout-align="space-around center"><md-button ng-click=usersCtrl.scroll()><md-icon md-svg-icon=arrow-down></md-icon></md-button></div><div ng-show=usersCtrl.usersContainer.loading layout=row layout-align="space-around center"><md-progress-circular md-mode=indeterminate></md-progress-circular></div></md-content></md-sidenav>'),e.put("partials/components/list-node-menu.html",'<md-menu-content><tn-share-menu ng-if=::nodeMenuCtrl.includeShare close=nodeMenuCtrl.close() url="{{ ::nodeMenuCtrl.nodeCtrl.nodeShortURL }}" preview=nodeMenuCtrl.nodeCtrl.getPreview() container=nodeMenuCtrl.nodeCtrl.container() container-preview=nodeMenuCtrl.nodeCtrl.containerPreview() category=node></tn-share-menu><md-menu-item><md-button title=Info ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.showNodeDialog($event)" ga-track-event="[\'node\', \'info\']"><md-icon md-svg-icon=info></md-icon>Info</md-button></md-menu-item><md-menu-item><md-button title="Add to favorites" ng-class="{\'md-accent\': nodeMenuCtrl.nodeCtrl.favorite}" ng-disabled=nodeMenuCtrl.nodeCtrl.favoriteDisabled ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.toggleFavorite()" ga-track-event="[\'node\', \'favorite\']"><md-icon md-svg-icon=favorite></md-icon>Favorite</md-button></md-menu-item><md-menu-item ng-show=!nodeMenuCtrl.nodeCtrl.isWebSearch><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.related($event)" ga-track-event="[\'node\', \'related\']" aria-label=Related><md-icon>new_releases</md-icon>Related</md-button></md-menu-item><md-menu-item ng-show=nodeMenuCtrl.nodeCtrl.isArticle><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.openArticle($event)" ga-track-event="[\'node\', \'reader\']"><md-icon md-svg-icon=reader></md-icon>Reader</md-button></md-menu-item><md-menu-item ng-if=!$root.isMobile><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.showAnalyticsDialog($event)" ga-track-event="[\'node\', \'analytics\']"><md-icon md-svg-icon=analytics></md-icon>Analytics</md-button></md-menu-item><md-menu-item ng-show=nodeMenuCtrl.nodeCtrl.isWebSearch><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.googleSearch($event)" ga-track-event="[\'node\', \'search\']" aria-label=Other><md-icon md-svg-icon=search></md-icon>Search</md-button></md-menu-item><md-menu-item ng-show=nodeMenuCtrl.nodeCtrl.hasPhotos><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.showPhotosDialog($event)" ga-track-event="[\'node\', \'photos\']" aria-label=Images><md-icon md-svg-icon=images></md-icon>Images</md-button></md-menu-item><md-menu-item ng-show=nodeMenuCtrl.nodeCtrl.hasRSS><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.rss($event)" ga-track-event="[\'node\', \'rss\']" aria-label=RSS><md-icon md-svg-icon=rss></md-icon>RSS</md-button></md-menu-item><md-menu-item ng-show=nodeMenuCtrl.nodeCtrl.hasGeolocation><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.showMapDialog($event)" ga-track-event="[\'node\', \'map\']"><md-icon md-svg-icon=map></md-icon>Map</md-button></md-menu-item><md-menu-item><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.copyNode(node.data.key)" ga-track-event="[\'node\', \'copy\']" aria-label=Copy><md-icon md-svg-icon=copy></md-icon>Copy</md-button></md-menu-item><md-menu-item ng-if="::vm.hasRemove && !node.data.value.related"><md-button ng-click="nodeMenuCtrl.close(); vm.removeNode(node.data.key)" ga-track-event="[\'node\', \'remove\']" aria-label=Remove><md-icon md-svg-icon=remove></md-icon>Remove</md-button></md-menu-item><md-menu-item><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.showReportDialog($event)" ga-track-event="[\'node\', \'report\']" aria-label=Report ng-disabled=nodeMenuCtrl.nodeCtrl.reportDisabled><md-icon md-svg-icon=report></md-icon>Report</md-button></md-menu-item></md-menu-content>'),e.put("partials/shared/analytics-dialog.html","<md-dialog id=analytics-dialog><md-dialog-content><md-content><div id=analytics-dialog-close><img ng-click=$root.$mdDialog.cancel() src=/img/close-black.png ga-track-event=\"['analyticsDialog', 'close']\"></div><div id=analytics-dialog-header><h2 id=analytics-dialog-title class=md-display-1><a ng-href={{analyticsDialog.url}} ga-track-event=\"['analyticsDialog', 'open']\" target=_blank>{{ analyticsDialog.title }}</a></h2><div id=analytics-dialog-info><div id=analytics-total-clicks-num class=md-headline><span>Clicks:</span> {{ analyticsDialog.clicks }}</div><div id=analytics-created-date class=md-subhead><span>Created:</span> {{ analyticsDialog.created | relativeTimestamp }}</div></div></div><div id=analytics-dialog-container><div id=countries class=analytics-pie-chart><h4 class=md-headline>Countries</h4></div><div id=referrers class=analytics-pie-chart><h4 class=md-headline>Referrers</h4></div><div id=browsers class=analytics-pie-chart><h4 class=md-headline>Browsers</h4></div><div id=platforms class=analytics-pie-chart><h4 class=md-headline>Platforms</h4></div></div></md-content></md-dialog-content></md-dialog>"),e.put("partials/shared/article-dialog.html","<md-dialog id=article-dialog><div id=article-dialog-close><img ng-click=$root.$mdDialog.cancel() src=/img/close-black.png ga-track-event=\"['articleDialog', 'close']\"></div><div flex><iframe id=atricle-frame width=100% height=100%></iframe></div><div id=article-dialog-progress layout=column layout-align=\"center center\"><md-progress-circular md-mode=indeterminate></md-progress-circular></div></md-dialog>"),e.put("partials/shared/buffer-dialog.html",'<md-dialog id=buffer-dialog><md-dialog-content md-colors="{backgroundColor: \'default-background-100\'}"><div id=buffer-dialog-close-button><md-button class=md-icon-button ng-click=$root.$mdDialog.cancel() ga-track-event="[\'bufferDialog\', \'close\']"><md-icon md-svg-icon=close></md-icon></md-button></div><div id=buffer-update-container><div class=buffer-update-details><div class=buffer-message><md-input-container><label>Message Text</label><textarea ng-model=vm.current.text max-rows=5></textarea></md-input-container><md-chips ng-model=vm.current.tags ng-show=vm.current.tags.length md-on-select=vm.selectTag($chip) md-removable=false></md-chips></div><div class=buffer-photo><md-input-container><label>Photo URL</label><input ng-model=vm.current.photo></md-input-container></div><md-list><md-list-item class=buffer-profile ng-repeat="profile in vm.profiles track by profile.id"><md-checkbox ng-model=profile.selected ng-change=vm.onProfileSelect()></md-checkbox><img class=md-avatar ng-src="{{ ::profile.avatar }}"><p><span class=buffer-profile__username>{{ ::profile.formatted_username }}</span> <span class=buffer-profile__service>{{ ::profile.service }}</span></p></md-list-item></md-list><div class=buffer-timing><div><md-checkbox ng-model=vm.current.now ng-change="vm.trackEvent(\'now\')" ng-disabled=vm.current.top>Send immediately</md-checkbox></div><div><md-checkbox ng-model=vm.current.top ng-change="vm.trackEvent(\'top\')" ng-disabled=vm.current.now>Add to the top</md-checkbox></div><div><md-button id=buffer-add-button class=md-primary ng-click=vm.publish() ng-disabled="vm.publishDisabled || vm.current.isPublished || vm.loading" ga-track-event=vm.publishEvent><md-icon md-svg-icon=buffer></md-icon>Add to Buffer</md-button><md-progress-circular md-mode=indeterminate ng-show=vm.loading></md-progress-circular></div><div><div ng-show=vm.error><md-icon md-svg-icon=error></md-icon>Error</div><div>{{ vm.messeage }}</div></div></div></div></div><md-content id=content-previews-container><div id=content-previews><md-card class=content-preview ng-repeat="preview in ::vm.container track by preview.targetUrl" ng-click="vm.current = preview; vm.messeage = \'\'" ng-class="{\'content-preview--selected md-whiteframe-10dp\': preview.targetUrl == vm.current.targetUrl, \'content-preview--published\': preview.isPublished}" ga-track-event="[\'bufferDialog\', \'select\']"><img class="md-card-image content-preview-image" primary="{{ ::preview.image }}" secondary="{{ ::preview.secondaryImage }}" tn-secondary-image><md-card-title><md-card-title-text><span class=md-headline>{{ ::preview.title }}</span></md-card-title-text></md-card-title><md-card-content ng-show=preview.description><p>{{ ::preview.description }}</p></md-card-content><md-card-footer>{{ ::preview.domain }}</md-card-footer></md-card></div></md-content></md-dialog-content></md-dialog>'),e.put("partials/shared/domain.html",'<div><a class=domain__link ng-href={{::linkHref}} ng-click="$event.preventDefault(); $event.stopPropagation(); $root.toggleDomain($chip)">{{ $chip }}</a></div>'),e.put("partials/shared/facebook-pages-dialog.html","<md-dialog id=facebook-pages-dialog><md-dialog-content><md-content><div id=facebook-pages-dialog-close-button><md-button class=md-icon-button ng-click=$root.$mdDialog.cancel() ga-track-event=\"['facebookPagesDialog', 'close']\"><md-icon md-svg-icon=close></md-icon></md-button></div><div><md-card><img class=md-card-image primary=\"{{ vm.preview.image }}\" secondary=\"{{ vm.preview.secondaryImage }}\" tn-secondary-image><md-card-title><md-card-title-text><span class=md-headline>{{ vm.preview.title }}</span></md-card-title-text></md-card-title><md-card-content ng-show=vm.preview.description><p>{{ vm.preview.description }}</p></md-card-content><md-card-footer>{{ vm.domain }}</md-card-footer></md-card></div><md-list><md-subheader><span>My pages</span><md-button class=md-icon-button ng-click=vm.loginPublisher() ga-track-event=\"['facebookPagesDialog', 'refresh']\"><md-icon md-svg-icon=refresh></md-icon></md-button><md-progress-circular md-diameter=25 md-mode=indeterminate ng-show=vm.loading></md-progress-circular></md-subheader><div><a href=https://www.facebook.com/pages/create target=_blank ga-track-event=\"['facebookPagesDialog', 'createFacebookPage']\" ng-hide=vm.facebook.groups>Don't have a page yet?</a></div><md-list-item ng-repeat=\"group in vm.facebook.groups track by group.id\" ng-disabled=vm.isPagePublished(group.id) ga-track-event=vm.publishEvent ng-click=vm.publish(group)>{{group.name}}</md-list-item></md-list></md-content></md-dialog-content></md-dialog>"),e.put("partials/shared/images-dialog.html",'<md-dialog class=images-dialog id=tree-images-dialog><md-dialog-content><md-toolbar><div class=md-toolbar-tools><h2 class=md-display-1><span>{{ vm.title }}</span></h2><div flex></div><div><md-button class=md-icon-button ga-track-event="[\'treeImagesDialog\', \'close\']" ng-click=$root.$mdDialog.cancel()><md-icon md-svg-icon=close></md-icon></md-button></div></div></md-toolbar><div class=bricklayer><div class=tree-image-container ng-class="{\'md-whiteframe-10dp tree-image-container--selected\': vm.currentImage == (node.locked_image || node.image)}" bricklayer-append ng-repeat="node in ::vm.imageNodes track by node.value"><img class=tree-image ng-click="$root.openUrl(node.value, \'images\')" ng-src="{{ ::node.locked_image || node.image }}" tn-image-error><div class=tree-image-caption md-colors="::{backgroundColor: \'primary-500\'}">{{ ::node.title }}</div><div class=select-tree-image ng-if=::vm.editable><md-button class=md-icon-button title="Set as tree image" ng-click="vm.selectImage(node.locked_image || node.image)" ng-disabled="vm.currentImage == (node.locked_image || node.image)" ga-track-event="[\'treeImagesDialog\', \'image\']"><md-icon md-svg-icon=add md-colors="{color: \'accent-400\'}"></md-icon></md-button></div></div></div></md-dialog-content></md-dialog>'),e.put("partials/shared/init-load.html",'<div id=init-load><md-backdrop class="md-opaque is-animated"></md-backdrop><md-progress-circular id=init-loader md-diameter=80 md-mode=indeterminate></md-progress-circular></div>'),e.put("partials/shared/invite-friends.html","<div class=invite-friends><div class=\"invite-friends-header md-headline\"><div>Unfortunately none of your friends are on brancher.</div><div>Let them know about us!</div></div><div class=invite-friends-buttons><md-button class=md-icon-button ng-attr-data-clipboard-text=\"{{ inviteFriendsCtrl.inviteUrl }}\" ga-track-event=\"['users', 'share', 'url']\" tn-clipboard><md-icon md-svg-icon=clipboard></md-icon></md-button><md-button class=md-icon-button ng-click=inviteFriendsCtrl.users.shareFacebook(inviteFriendsCtrl.inviteUrl) ga-track-event=\"['users', 'share', 'facebook']\"><md-icon md-svg-icon=facebook></md-icon></md-button><md-button class=md-icon-button ng-click=inviteFriendsCtrl.users.shareGoogle(inviteFriendsCtrl.inviteUrl) ga-track-event=\"['users', 'share', 'google']\"><md-icon md-svg-icon=google-plus></md-icon></md-button><md-button class=md-icon-button ng-click=inviteFriendsCtrl.users.shareTwitter(inviteFriendsCtrl.inviteUrl) ga-track-event=\"['users', 'share', 'twitter']\"><md-icon md-svg-icon=twitter></md-icon></md-button></div></div>"),e.put("partials/shared/link.html","<path class=link-visible></path><path class=link-overlay></path>"),e.put("partials/shared/map-dialog.html","<md-dialog id=map-dialog><md-dialog-content><md-toolbar><div class=md-toolbar-tools><h2 class=md-display-1><span>{{ mapDialogCtrl.title }}</span></h2><div flex></div><div><md-button class=md-icon-button ga-track-event=\"['mapDialog', 'close']\" ng-click=$root.$mdDialog.cancel()><md-icon md-svg-icon=close></md-icon></md-button></div></div></md-toolbar><div id=map-progress layout=column layout-align=\"center center\" flex><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div flex><div id=map-container></div></div></md-dialog-content></md-dialog>"),e.put("partials/shared/marker-info-window.html",'<div class=marker-info-window ng-click="$root.openUrl(node.value, \'map\')" layout=row><div class=marker-info-window__image-container ng-if="::node.locked_image || node.image" flex=33><img class=marker-info-window__image ng-src="{{ ::node.locked_image || node.image }}" ng-attr-alt="{{ ::node.title }}"></div><div><div class="md-title marker-info-window__title">{{ ::node.title }}</div><div class=md-caption ng-if=info><span class=marker-info-window__distance>{{ ::info.distance }}</span> <span class=marker-info-window__duration>({{ ::info.duration }})</span></div><div class="md-body-1 marker-info-window__description" ng-if=::node.description>{{ ::node.description }}</div><div class="md-caption marker-info-window__address" ng-if=::node.address>{{ ::node.address }}</div><div class="md-caption marker-info-window__visited" ng-if=::node.visited ng-attr-title="{{ :: node.visited | absoluteTimestamp}}">Visited {{ ::node.visited | relativeTimestamp }}</div></div></div>'),e.put("partials/shared/minimap.html",'<div class="tree-minimap-container md-whiteframe-1dp" ng-hide="treeCtrl.treeNodesCtrl.isListed || treeCtrl.nodes.length < 4 || !treeCtrl.showMinimap"><div class=tree-minimap><svg class=tree-minimap-svg width=100% height=100%><rect height=100% width=100% md-colors="::{ fill: \'background-50-0.8\' }"></rect><g><g class="link is-animated" ng-repeat="link in treeCtrl.links track by link.target.data.key" tn-link=true></g><g ng-repeat="node in treeCtrl.nodes track by node.data.key" tn-tree-item><g class="node is-animated"><rect stroke=black rx=15% ry=5% width=180 height=200 ng-style="::{ fill: node.color || \'white\' }"><title>{{ ::node.domain }}</title></rect></g></g></g><g class=frame stroke=#111111><rect height=100% width=100% stroke-width=16 rx=15 ry=15 md-colors="::{ fill: \'background-900-0.18\', stroke: \'primary-900-0.44\' }"></rect></g></svg></div></div>'),e.put("partials/shared/node-dialog.html",'<md-dialog id=node-dialog><md-dialog-content><md-content><div class=node-dialog__content><div><h2 class="md-display-1 node-dialog__title"><a ng-href="{{\'https://goo.gl/\' + vm.node.value}}" ga-track-event="[\'nodeDialog\', \'open\']" target=_blank>{{ vm.node.title }}</a></h2><div id=dialog-close-button><md-button class=md-icon-button ga-track-event="[\'nodeDialog\', \'close\']" ng-click=$root.$mdDialog.cancel()><md-icon md-svg-icon=close></md-icon></md-button></div></div><div layout=column><div class=node-dialog__image-container ng-if=::vm.node.image><img class=node-dialog__image ng-src="{{ ::vm.node.image }}" tn-image-error></div><div class=node-dialog__content-section><a class=node-dialog__domain-container ga-track-event="[\'nodeDialog\', \'domain\']" ng-click="$event.preventDefault(); $event.stopPropagation(); $root.toggleDomain(vm.domain)" ng-href={{::vm.domainUrl}}><img ng-src={{::vm.node.favicon}} ng-if=::vm.node.favicon width=24 height=24> <span class="md-caption node-dialog__domain">{{::vm.domain | www}}</span></a><div class=node-dialog__like><tn-like url="{{ ::vm.node.url }}"></tn-like></div></div><div class="node-dialog__content-section node-dialog__tags-container" ng-show=!!vm.node.tags.length><md-chips ng-model=vm.node.tags md-transform-chip=vm.transformTag($chip) readonly=true><md-chip-template tn-tag></md-chip-template></md-chips></div><div class="node-dialog__content-section node-dialog__description-container"><p class=md-body-1>{{ ::vm.node.description }}</p></div></div></div><div><md-subheader>Linked</md-subheader></div><div layout=column flex><div ng-hide=!!vm.container.length flex><div class=dialog-status-component ng-show=vm.loading layout=column layout-align="center center"><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div class="md-body-1 dialog-status-component" ng-show="!(vm.container.length || vm.loading)" layout=column layout-align="center center">No Results</div></div><div ng-show=!!vm.container.length flex><md-list><tn-node-listed ng-repeat="node in vm.container track by node.data.key" node=node open-url=vm.openUrl(key)></tn-node-listed></md-list></div></div></md-content></md-dialog-content></md-dialog>'),e.put("partials/shared/node-listed.html",'<md-list-item class="secondary-button-padding node-listed" ng-class="::{\'node-listed--visited\': nodeCtrl.showVisited, \'node--is-open\': nodeCtrl.isOpened}" md-colors=nodeCtrl.colors ng-href="{{ ::nodeCtrl.nodeURL }}" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeCtrl.openUrl({ \'key\': nodeCtrl.node.data.key})" layout=row layout-align="space-between center" md-no-ink tn-node-tooltip><div class=node__image-container><img tn-image class="md-avatar node__image"></div><div class="md-list-item-text node__container"><div class=node__title-container><span class=node__title-text tn-text=title tn-node-type></span> <span class="md-caption node__description" tn-text-container=description><span>&nbsp; - &nbsp;</span></span></div><div class=node__youtube-button_container ng-if=::nodeCtrl.isYoutubeVideo><img src=img/YouTube-icon-dark.png class="node__youtube-button node__youtube-button--no-hover"> <img src=img/YouTube-icon-full_color.png class="node__youtube-button node__youtube-button--hover" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeCtrl.openYoutubeVideo($event)" ga-track-event="[\'node\', \'youtube\', \'nodeListed\']"></div></div><div class="md-secondary node__count-icon-container"><span class=node__count-icon tn-text-container=views title="Unique views"><i class=material-icons>remove_red_eye</i></span></div><div class="md-secondary node__info-inner"><a class=node__site-container ga-track-event="[\'node\', \'domain\', \'nodeListed\']" ng-href={{::nodeCtrl.domainUrl}} ng-click="$event.preventDefault(); $event.stopPropagation(); $root.toggleDomain(nodeCtrl.node.domain)"><span class=node__favicon-container><img class=node__favicon tn-image-error ng-if=::nodeCtrl.node.favicon ng-src={{::nodeCtrl.node.favicon}}></span><div class=node__site-name-container><p class="node__site-name md-caption">{{ ::nodeCtrl.node.domain | www }}</p></div></a></div><div class="md-secondary node__timestamp-visited"><span><span tn-text=visited></span></span></div><ng-transclude class="md-secondary node__menu"></ng-transclude><md-divider ng-if=!$last></md-divider></md-list-item>'),e.put("partials/shared/node-main-action.html","<div class=node__main-action-container><div class=node__main-action><md-button class=\"md-icon-button node__main-button node__main-button-reader\" title=Reader ng-click=\"$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.nodeCtrl.openArticle($event)\" ng-show=nodeMenuCtrl.nodeCtrl.isArticle ga-track-event=\"['node', 'reader', 'nodeCover']\"><md-icon class=node__main-button-icon md-svg-icon=reader></md-icon></md-button><md-button class=\"md-icon-button node__main-button node__main-button-search\" title=Search ng-click=\"$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.nodeCtrl.googleSearch($event, node.data.key)\" ng-show=nodeMenuCtrl.nodeCtrl.isWebSearch ga-track-event=\"['node', 'search', 'nodeCover']\" aria-label=Search><md-icon class=node__main-button-icon md-svg-icon=search></md-icon></md-button><md-button class=\"md-icon-button node__main-button node__main-button-images\" title=Images ng-click=\"$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.nodeCtrl.showPhotosDialog($event)\" ng-show=nodeMenuCtrl.nodeCtrl.hasPhotos ga-track-event=\"['node', 'photos', 'nodeCover']\" aria-label=Images><md-icon class=node__main-button-icon md-svg-icon=images></md-icon></md-button></div></div>"),e.put("partials/shared/node-path.html","<md-list-item class=\"md-2-line node-path\" ng-click=\"nodeCtrl.openUrl({ 'node': nodeCtrl.node })\" ga-track-event=\"['tree', 'path']\"><img class=md-avatar tn-image><div class=md-list-item-text><div class=node-path__title tn-text=title></div></div><md-icon class=md-secondary md-svg-icon=arrow-right ng-if=!nodeCtrl.last></md-icon></md-list-item>"),e.put("partials/shared/node-share-menu.html",'<md-menu-content><tn-share-menu close=nodeMenuCtrl.close() url="{{ ::nodeMenuCtrl.nodeCtrl.nodeShortURL }}" preview=nodeMenuCtrl.nodeCtrl.getPreview() container=nodeMenuCtrl.nodeCtrl.container() container-preview=nodeMenuCtrl.nodeCtrl.containerPreview() category=node></tn-share-menu></md-menu-content>'),e.put("partials/shared/node-url-dialog.html",'<md-dialog class=node-url-dialog aria-label="New tree"><form name=form><md-dialog-content class=md-dialog-content layout=row><md-input-container flex><label>Url</label><input name=url ng-model=vm.url ng-change=vm.getUrl(vm.url) ng-model-options="::{ debounce: 500 }" md-autofocus minlength=4 required></md-input-container><md-progress-circular ng-show=vm.loading md-mode=indeterminate></md-progress-circular></md-dialog-content></form></md-dialog>'),e.put("partials/shared/node.html",'<div class="node md-whiteframe-1dp" ng-class="{\'node--is-open\': nodeCtrl.isOpened, \'node--no-image\': nodeCtrl.hasNoImage, \'md-whiteframe-10dp\': nodeCtrl.node.isNotEmpty}" tn-node-tooltip><a class=node__url ng-href="{{ ::nodeCtrl.nodeURL }}" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeCtrl.openUrl({ \'key\': nodeCtrl.node.data.key})"></a><div class=node__container><div class=node__menu-container><div class=node__tools ng-transclude=menu></div></div><div class=node__share-menu-container><div class=node__tools ng-transclude=share></div></div><div class=node__tools ng-transclude=tools></div><div class=node__image-container><img class=node__image tn-image><div class=node__image-filter></div><div class=node__youtube-button_container ng-show=::nodeCtrl.isYoutubeVideo><img src=img/YouTube-icon-dark.png class="node__youtube-button node__youtube-button--no-hover"> <img src=img/YouTube-icon-full_color.png class="node__youtube-button node__youtube-button--hover node__tools" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeCtrl.openYoutubeVideo($event)" ga-track-event="[\'node\', \'youtube\', \'nodeCard\']"></div><div class=node__count title="Unique views"><span tn-text=views></span></div><div class=node__tools ng-transclude=main></div></div><div class=node__text-container md-colors=nodeCtrl.colors><div class=node__title-container><div class=node__title-container-inner><div class=node__title-text tn-text=title tn-node-type></div></div></div><div class=node__description-container><div class=node__description><span><span tn-text=description></span></span> <span><span tn-text=address></span></span></div></div><a class=node__site-container ng-href="{{::nodeCtrl.domainUrl }}" ng-click="$event.preventDefault(); $event.stopPropagation(); $root.toggleDomain(nodeCtrl.node.domain)" ga-track-event="[\'node\', \'domain\', \'nodeCard\']" layout=row layout-align="space-between center"><div class=node__site-name-container><div class=node__favicon-container><img class=node__favicon ng-src="{{ ::nodeCtrl.node.favicon }}" ng-if=::nodeCtrl.node.favicon tn-image-error></div><div class="node__site-name md-caption">{{ ::nodeCtrl.node.domain | www }}</div></div></a></div></div></div>'),e.put("partials/shared/privacy-warning-dialog.html","<md-dialog id=privacy-warning-dialog><md-dialog-content><div id=dialog-close-button><md-button class=md-icon-button ga-track-event=\"['privacyDialog', 'close']\" ng-click=$root.$mdDialog.cancel()><md-icon md-svg-icon=close></md-icon></md-button></div><div id=privacy-warning><span id=privacy-warning-title>Privacy:</span> <span>This tree will be available to anyone with a link. If you want to share this tree securely only with select group of people please choose</span><div id=privacy-warning-dialog-editors-button><md-button ng-click=treeCtrl.showEditorsDialog($event) ga-track-event=\"['privacyDialog', 'editors']\"><md-icon md-svg-icon=shared></md-icon><span>Editors</span></md-button></div></div><div id=publish-option><md-button class=md-icon-button title=Publish aria-label=Publish ng-class=\"{ 'md-accent': tree.value.meta.published }\" ng-click=\"$event.stopPropagation(); treeCtrl.togglePublished()\" ga-track-event=\"['privacyDialog', 'publish']\"><md-icon md-svg-icon=public></md-icon></md-button><span id=publish-option-text>Share this tree with brancher community by making it public</span></div><div id=do-not-show-checkbox><md-checkbox ng-model=userSettings.shareUrlWarningDisabled ng-change=privacyDialog.shareUrlWarningChange()>Do not show anymore</md-checkbox></div></md-dialog-content></md-dialog>"),e.put("partials/shared/related-dialog.html",'<md-dialog id=related-dialog><md-dialog-content><md-content><div layout=column flex><div class=related-dialog__title-container><h2 class="md-display-1 related-dialog__title"><span class=related-dialog__title-type>{{ relatedDialogCtrl.title }}:</span> <a ng-href="{{\'https://goo.gl/\' + relatedDialogCtrl.node.value}}" ga-track-event="[\'relatedDialog\', \'open\']" target=_blank>{{ relatedDialogCtrl.node.title }}</a></h2><div id=dialog-close-button><md-button class=md-icon-button ga-track-event="[\'relatedDialog\', \'close\']" ng-click=$root.$mdDialog.cancel()><md-icon md-svg-icon=close></md-icon></md-button></div></div><md-divider></md-divider><div ng-hide=!!relatedDialogCtrl.container.length flex><div class=dialog-status-component ng-show=relatedDialogCtrl.loading layout=column layout-align="center center"><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div class="md-body-1 dialog-status-component" ng-show="!(relatedDialogCtrl.container.length || relatedDialogCtrl.loading)" layout=column layout-align="center center">No Results</div></div><div ng-show=!!relatedDialogCtrl.container.length flex><md-list><tn-node-listed ng-repeat="node in relatedDialogCtrl.container track by node.data.key" node=node open-url=relatedDialogCtrl.openUrl(key)></tn-node-listed></md-list></div></div></md-content></md-dialog-content></md-dialog>'),e.put("partials/shared/report-dialog.html","<md-dialog id=report-dialog><form name=form><md-dialog-content class=md-dialog-content><div><md-radio-group ng-model=vm.reason><md-radio-button value=spam>Spam</md-radio-button><md-radio-button value=adult>Adult</md-radio-button><md-radio-button value=abusive>Abusive</md-radio-button><md-radio-button value=malware>Malware</md-radio-button></md-radio-group></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel() ga-track-event=\"['report', 'cancelReport']\">Cancel</md-button><md-button class=md-warn ga-track-event=\"['report', 'sendReport']\" ng-click=vm.report() ng-disabled=\"form.$invalid || form.$pristine\">Report</md-button></md-dialog-actions></form></md-dialog>"),e.put("partials/shared/report-google-dialog.html","<md-dialog id=report-google-dialog><md-content><md-dialog-content class=md-dialog-content><div id=dialog-close-button><md-button class=md-icon-button ga-track-event=\"['reportGoogleDialog', 'close']\" ng-click=$root.$mdDialog.cancel()><md-icon md-svg-icon=close></md-icon></md-button></div><div class=md-headline>Google seems to think this URL is fine</div><div><a class=\"md-button md-accent\" href=https://goo.gl/#reportspam target=_blank tn-clipboard ng-attr-data-clipboard-text=\"{{ reportGoogleDialog.reportUrl }}\" ga-track-event=\"['reportGoogleDialog', 'report']\"><md-icon md-svg-icon=report></md-icon><span>Report to google</span></a></div><div class=md-caption>*Short URL will be copied to clipboard when you click report. Just paste it (ctrl + v) in the input field.</div><div id=do-not-show-checkbox><md-checkbox ng-model=$root.userSettings.reportGoogleDisabled ng-change=reportGoogleDialog.showDialogChange()>Do not show anymore</md-checkbox></div></md-dialog-content></md-content></md-dialog>"),e.put("partials/shared/share-menu.html",'<md-menu-item><md-button ng-attr-data-clipboard-text="{{ shareMenuCtrl.url }}" ng-click="shareMenuCtrl.close(); shareMenuCtrl.shareUrl()" ga-track-event=shareMenuCtrl.shareUrlEvent aria-label="Copy url" tn-clipboard><md-icon md-svg-icon=clipboard></md-icon>Copy URL</md-button></md-menu-item><md-menu-item><md-button ng-click=shareMenuCtrl.provider.shareFacebook(shareMenuCtrl.url) ga-track-event=shareMenuCtrl.event.shareFacebook aria-label="Share on facebook"><md-icon md-svg-icon=facebook></md-icon>Facebook</md-button></md-menu-item><md-menu-item><md-button ng-click=shareMenuCtrl.provider.shareTwitter(shareMenuCtrl.url) ga-track-event=shareMenuCtrl.event.shareTwitter aria-label="Share twitter"><md-icon md-svg-icon=twitter></md-icon>Twitter</md-button></md-menu-item><md-menu-item><md-button ng-click=shareMenuCtrl.provider.shareGoogle(shareMenuCtrl.url) ga-track-event=shareMenuCtrl.event.shareGoogle aria-label="Share G+"><md-icon md-svg-icon=google-plus></md-icon>Google</md-button></md-menu-item><md-menu-item><md-button ng-click=shareMenuCtrl.provider.sharePocket(shareMenuCtrl.url) ga-track-event=shareMenuCtrl.event.sharePocket aria-label="Add to Pocket"><md-icon md-svg-icon=pocket></md-icon>Pocket</md-button></md-menu-item><md-menu-item><md-button ng-click=shareMenuCtrl.shareFacebookPages($event) ga-track-event=shareMenuCtrl.shareFacebookPagesEvent aria-label="Share on facebook page"><md-icon md-svg-icon=facebook></md-icon>Pages</md-button></md-menu-item><md-menu-item ng-show=!$root.isMobile><md-button ng-click=shareMenuCtrl.shareBuffer($event) ga-track-event=shareMenuCtrl.shareBufferEvent aria-label="Share with Buffer"><md-icon md-svg-icon=buffer></md-icon>Buffer</md-button></md-menu-item>'),e.put("partials/shared/tag.html",'<div><a class=tag__link ng-href={{::linkHref}} ng-click="$event.preventDefault(); $event.stopPropagation(); $root.toggleTag($chip)">{{ $chip }}</a></div>'),e.put("partials/shared/tree-dialog.html",'<md-dialog id=tree-dialog class=tree-form-dialog aria-label="Edit tree" md-colors="{backgroundColor: \'background-200\'}"><form name=form><md-dialog-content><md-tabs class=tree-dialog__tab-container md-stretch-tabs=always md-no-pagination=true md-no-ink md-no-ink-bar><md-tab class=tree-dialog__tab><md-tab-label>Edit</md-tab-label><md-tab-body class=tree-dialog__tab-body><md-content class=tree-dialog__inner-container ng-show="::vm.treeMeta.editable && !vm.treeMeta.limitedEdit" layout=column><div layout=row flex=66><div class=tree-dialog__input-containers><div><md-input-container class=tree-dialog__input-container><label>Title</label><input name=title ng-model=vm.treeMeta.title md-autofocus md-maxlength=100 required></md-input-container></div><div class=tree-dialog__input-container><div class=md-subhead>Tags</div><md-chips class=tree-dialog-tags ng-model=vm.treeMeta.tags md-autocomplete-snap md-max-chips=10 md-transform-chip=vm.transformTag($chip) md-on-remove=vm.removeTag($chip) md-on-add=vm.addTag($chip)><md-autocomplete md-items="tag in vm.searchTags()" ng-disabled="vm.treeMeta.tags.length >= 10" md-min-length=3 md-delay=1000 md-search-text=vm.searchText md-selected-item=vm.selectedTag md-item-text=tag.name><md-item-template><div class=search-item><img class=search-item-image ng-if=tag.image ng-src="{{ tag.image }}"> <span md-highlight-text=vm.searchText>{{ tag.name }}</span> <span ng-if=tag.description>- {{ tag.description }}</span></div></md-item-template><md-not-found>No matches found.</md-not-found></md-autocomplete><md-chip-template tn-tag></md-chip-template></md-chips></div><div class=tree-dialog__input-container><div class=md-subhead>Domains</div><md-chips class=tree-dialog-tags ng-model=vm.treeMeta.domains readonly=true md-transform-chip=vm.transformTag($chip)><md-chip-template tn-domain></md-chip-template></md-chips></div></div><div flex layout=column><div class=tree-dialog-image-container><img class=tree-dialog-image ng-src="{{ ::vm.treeMeta.image || $root.placeholderImage }}" tn-image-error><div class=tree-dialog-image-edit><md-button class=md-icon-button ga-track-event="[\'treeInfo\', \'image\']" ng-if=treeCtrl ng-click=treeCtrl.showImagesDialog($event)><md-icon md-svg-icon=edit></md-icon></md-button></div></div></div></div><div flex=33><md-input-container class=tree-dialog__input-container><label>Description</label><textarea ng-model=vm.treeMeta.description md-maxlength=500></textarea></md-input-container></div></md-content><md-content class=tree-dialog__inner-container ng-if="::!vm.treeMeta.editable || vm.treeMeta.limitedEdit" layout=column><div layout=row flex=66><div class=tree-dialog__input-containers><div class=tree-dialog__input-container><h3 class=md-headline>{{ vm.treeMeta.title }}</h3></div><div class=tree-dialog__input-container ng-show=!!vm.treeMeta.tags.length><div class=md-subhead>Tags</div><md-chips class=tree-dialog-tags ng-model=vm.treeMeta.tags md-transform-chip=vm.transformTag($chip) readonly=true><md-chip-template tn-tag></md-chip-template></md-chips></div><div class=tree-dialog__input-container><div class=md-subhead>Domains</div><md-chips class=tree-dialog-tags ng-model=vm.treeMeta.domains readonly=true md-transform-chip=vm.transformTag($chip)><md-chip-template tn-domain></md-chip-template></md-chips></div></div><div flex layout=column><div class=tree-dialog-image-container><img class=tree-dialog-image ng-src="{{ vm.treeMeta.image || $root.placeholderImage }}" tn-image-error></div></div></div><div flex=33><p class=md-body-1>{{ vm.treeMeta.description }}</p></div></md-content></md-tab-body></md-tab><md-tab class=tree-dialog__tab ng-disabled="::vm.treeMeta.editable && !vm.treeMeta.published" md-on-select=vm.openComments()><md-tab-label>Comments ({{ ::vm.commentCount }})</md-tab-label><md-tab-body><div id=disqus_thread></div></md-tab-body></md-tab></md-tabs></md-dialog-content><md-dialog-actions class=tree-dialog__actions><md-button ng-click=vm.cancel() ga-track-event="[\'treeInfo\', \'cancel\']">Cancel</md-button><md-button class=md-primary ng-click=vm.save(form) ng-if=::vm.treeMeta.editable ga-track-event="[\'treeInfo\', \'save\']" ng-disabled="form.$invalid || form.$pristine">Save</md-button></md-dialog-actions></form></md-dialog>'),e.put("partials/shared/tree-editors-dialog.html",'<md-dialog id=tree-editors-dialog class=users-dialog><md-dialog-content><md-list><div class=subscription-user ng-repeat="editorUser in vm.container track by editorUser.key"><md-list-item aria-label=User><img class=md-avatar ng-src="{{ ::editorUser.value.picture.data.url }}" alt="{{ ::editorUser.value.name }}"><p>{{ ::editorUser.value.name }}</p><md-checkbox class=md-secondary ng-model-options="::{ debounce: 750 }" ng-disabled=vm.isMaxEditors ng-change=vm.canEdit(editorUser.value) ng-model=editorUser.value.isEditor></md-checkbox></md-list-item></div></md-list><tn-invite-friends ng-show=vm.showInvite></tn-invite-friends><div class="scroll-button scroll-button--subscribers" ng-hide="vm.hasScrollBar || vm.disableScroll()" layout=row layout-align="space-around center"><md-button ng-click=vm.scroll()><md-icon md-svg-icon=arrow-down></md-icon></md-button></div><div ng-show=vm.usersContainer.loading layout=row layout-align="center center"><md-progress-circular md-mode=indeterminate></md-progress-circular></div></md-dialog-content></md-dialog>'),e.put("partials/shared/tree-menu.html",'<md-menu-content><div ng-if=::isExtension class=tree-menu_mass><md-menu-item><md-button ng-click="treeMenuCtrl.close(); treeCtrl.openTabs()" ga-track-event="[\'tree\', \'openTabs\']">Open</md-button></md-menu-item><md-menu-item><md-button ng-click="treeMenuCtrl.close(); treeCtrl.moveTabs()" ga-track-event="[\'tree\', \'moveTabs\']">Move</md-button></md-menu-item><md-menu-item><md-button ng-click="treeMenuCtrl.close(); treeCtrl.closeTabs()" ga-track-event="[\'tree\', \'closeTabs\']">Close</md-button></md-menu-item></div><md-menu-item ng-if="::treeCtrl.editable && !isMobile"><md-button ng-click="treeMenuCtrl.close(); treeCtrl.showAnalyticsDialog($event)" ng-disabled=!tree.value.meta.published ga-track-event="[\'tree\', \'analytics\']" ng-attr-title="{{(!tree.value.meta.published) ? \'Publish this tree to see Analytics\' : \'\' }}"><md-icon md-svg-icon=analytics></md-icon>Analytics</md-button></md-menu-item><md-menu-item ng-if="::treeCtrl.editable && !treeCtrl.limitedEdit"><md-button ng-click="treeMenuCtrl.close(); treeCtrl.showEditorsDialog($event)" ga-track-event="[\'tree\', \'editors\']"><md-icon md-svg-icon=shared></md-icon>Editors</md-button></md-menu-item><md-menu-item><md-button ng-click="treeMenuCtrl.close(); treeCtrl.showImagesDialog($event)" ng-disabled=!treeCtrl.hasImages ga-track-event="[\'tree\', \'images\']"><md-icon md-svg-icon=images></md-icon>Images</md-button></md-menu-item><md-menu-item><md-button ng-click="treeMenuCtrl.close(); treeCtrl.showMapDialog($event)" ng-disabled=!treeCtrl.hasMap ga-track-event="[\'tree\', \'map\']"><md-icon md-svg-icon=map></md-icon>Map</md-button></md-menu-item><md-menu-item ng-if="treeCtrl.editable && tree.value.meta.original"><md-button ng-click="treeMenuCtrl.close(); treeCtrl.sync()" ng-disabled=!tree.value.meta.sync ga-track-event="[\'tree\', \'sync\']" aria-label=Sync><md-icon md-svg-icon=sync></md-icon>Sync <span ng-show=tree.value.meta.sync>({{ tree.value.meta.sync }})</span></md-button></md-menu-item><md-menu-item><md-button ng-click="treeMenuCtrl.close(); treeCtrl.buffer()" ga-track-event="[\'tree\', \'copy\']" aria-label=Copy><md-icon md-svg-icon=copy></md-icon>Copy</md-button></md-menu-item><md-menu-item ng-if=!treeCtrl.editable><md-button ng-click="treeMenuCtrl.close(); treeCtrl.showReportDialog($event)" aria-label=Report ng-disabled=treeCtrl.reportDisabled ga-track-event="[\'tree\', \'report\']"><md-icon md-svg-icon=report></md-icon>Report</md-button></md-menu-item></md-menu-content>'),e.put("partials/shared/tree-node-menu.html",'<md-menu-content><tn-share-menu ng-if=::nodeMenuCtrl.includeShare close=nodeMenuCtrl.close() url="{{ ::nodeMenuCtrl.nodeCtrl.nodeShortURL }}" preview=nodeMenuCtrl.nodeCtrl.getPreview() container=nodeMenuCtrl.nodeCtrl.container() container-preview=nodeMenuCtrl.nodeCtrl.containerPreview() category=node></tn-share-menu><md-menu-item><md-button title=Info ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.showNodeDialog($event)" ga-track-event="[\'node\', \'info\']"><md-icon md-svg-icon=info></md-icon>Info</md-button></md-menu-item><md-menu-item><md-button title="Add to favorites" ng-class="{\'md-accent\': nodeMenuCtrl.nodeCtrl.favorite}" ng-disabled=nodeMenuCtrl.nodeCtrl.favoriteDisabled ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.toggleFavorite()" ga-track-event="[\'node\', \'favorite\']"><md-icon md-svg-icon=favorite></md-icon>Favorite</md-button></md-menu-item><md-menu-item ng-show="!(node.data.value.related || nodeMenuCtrl.nodeCtrl.isWebSearch)"><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.related($event, node.data.key)" ga-track-event="[\'node\', \'related\']" aria-label=Related><md-icon>new_releases</md-icon>Related</md-button></md-menu-item><md-menu-item ng-show=nodeMenuCtrl.nodeCtrl.isArticle><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.openArticle($event)" ga-track-event="[\'node\', \'reader\', \'nodeMenu\']"><md-icon md-svg-icon=reader></md-icon>Reader</md-button></md-menu-item><md-menu-item ng-show=nodeMenuCtrl.nodeCtrl.isWebSearch><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.googleSearch($event, node.data.key)" ga-track-event="[\'node\', \'search\', \'nodeMenu\']" aria-label=Other><md-icon md-svg-icon=search></md-icon>Search</md-button></md-menu-item><md-menu-item ng-if=!$root.isMobile><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.showAnalyticsDialog($event)" ga-track-event="[\'node\', \'analytics\']"><md-icon md-svg-icon=analytics></md-icon>Analytics</md-button></md-menu-item><md-menu-item ng-show=nodeMenuCtrl.nodeCtrl.hasPhotos><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.showPhotosDialog($event)" ga-track-event="[\'node\', \'photos\', \'nodeMenu\']" aria-label=Images><md-icon md-svg-icon=images></md-icon>Images</md-button></md-menu-item><md-menu-item ng-show=nodeMenuCtrl.nodeCtrl.hasRSS><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.rss($event, node.data.key)" ga-track-event="[\'node\', \'rss\']" aria-label=RSS><md-icon md-svg-icon=rss></md-icon>RSS</md-button></md-menu-item><md-menu-item ng-show=nodeMenuCtrl.nodeCtrl.hasGeolocation><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.showMapDialog($event)" ga-track-event="[\'node\', \'map\']"><md-icon md-svg-icon=map></md-icon>Map</md-button></md-menu-item><md-menu-item ng-show="!(node.data.value.related || nodeMenuCtrl.isListed)"><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.focus()" ng-disabled="nodeMenuCtrl.isFocused()\n                       || treeCtrl.treeNodesCtrl.isExpanded\n                       || nodeMenuCtrl.isRoot()\n                       || node.isLeaf" ga-track-event="[\'node\', \'focus\']" aria-label=Focus><md-icon md-svg-icon=focus></md-icon>Focus</md-button></md-menu-item><md-menu-item ng-show="!nodeMenuCtrl.isListed && !isEmbedded && (user || isExtension)"><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.newTree(node.data.key)" ng-disabled="node.isLeaf || nodeMenuCtrl.isRoot()" ga-track-event="[\'node\', \'newTree\']" aria-label="New tree"><md-icon md-svg-icon=add></md-icon>New Tree</md-button></md-menu-item><md-menu-item ng-show="!nodeMenuCtrl.isListed && nodeMenuCtrl.editable"><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.addUrlDialog($event, node.data.key)" ga-track-event="[\'node\', \'addNode\']" aria-label="Add url"><md-icon md-svg-icon=add-node></md-icon>Add URL</md-button></md-menu-item><md-menu-item ng-if=::!isEmbedded><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.copyNode(node.data.key)" ga-track-event="[\'node\', \'copy\']" aria-label=Copy><md-icon md-svg-icon=copy></md-icon>Copy</md-button></md-menu-item><md-menu-item ng-if=::!isEmbedded ng-show="!(nodeMenuCtrl.isListed || node.isLeaf)"><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.execute(\'buffer\', node.data.key)" ga-track-event="[\'node\', \'copyAll\']" aria-label=Copy><md-icon md-svg-icon=copy-all></md-icon>Copy All</md-button></md-menu-item><md-menu-item ng-show=!node.data.value.related><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.execute(\'paste\', node.data.key)" ng-disabled="!nodeMenuCtrl.editable || buffer.isEmpty()" ga-track-event="[\'node\', \'paste\']" aria-label=Paste><md-icon md-svg-icon=paste></md-icon>Paste</md-button></md-menu-item><md-menu-item ng-if=node.isDeleteOne><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.execute(\'deleteOne\', node.data.key)" ga-track-event="[\'node\', \'remove\', \'menuButton\']" aria-label=Remove><md-icon md-svg-icon=remove></md-icon>Remove</md-button></md-menu-item><md-menu-item ng-if=node.isDeleteBranch><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.execute(\'deleteBranch\', node.data.key)" ga-track-event="[\'node\', \'remove\', \'menuButton\']" aria-label=Remove><md-icon md-svg-icon=remove></md-icon>Remove</md-button></md-menu-item><md-menu-item ng-if=node.isDeleteRoot><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.execute(\'deleteRoot\', node.data.key)" ga-track-event="[\'node\', \'remove\', \'menuButton\']" aria-label=Remove><md-icon md-svg-icon=remove></md-icon>Remove</md-button></md-menu-item><md-menu-item ng-if=node.data.value.related><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.removeRelated(node.data.key)" ga-track-event="[\'node\', \'remove\', \'menuButton\']" aria-label=Remove><md-icon md-svg-icon=remove></md-icon>Remove</md-button></md-menu-item><md-menu-item ng-show="!(node.data.value.related || node.isLeaf || nodeMenuCtrl.isListed)"><md-button ng-click="nodeMenuCtrl.close(); treeCtrl.execute(\'deleteBranch\', node.data.key)" ng-disabled="!nodeMenuCtrl.editable\n                       || nodeMenuCtrl.isRoot()\n                       || nodeMenuCtrl.isFocused()" ga-track-event="[\'node\', \'removeAll\']" aria-label="Remove all"><md-icon md-svg-icon=remove-all></md-icon>Remove All</md-button></md-menu-item><md-menu-item><md-button ng-click="nodeMenuCtrl.close(); nodeMenuCtrl.nodeCtrl.showReportDialog($event)" aria-label=Report ga-track-event="[\'node\', \'report\']" ng-disabled=nodeMenuCtrl.nodeCtrl.reportDisabled><md-icon md-svg-icon=report></md-icon>Report</md-button></md-menu-item></md-menu-content>'),e.put("partials/shared/tree-node-tools.html",'<div class=node__tools-container><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); treeCtrl.execute(\'deleteOne\', node.data.key)" ga-track-event="[\'node\', \'remove\', \'nodeButton\']" ng-if=node.isDeleteOne aria-label=Remove><md-icon class=node__menu-button-icon md-svg-icon=remove></md-icon></md-button><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); treeCtrl.execute(\'deleteBranch\', node.data.key)" ga-track-event="[\'node\', \'remove\', \'nodeButton\']" ng-if=node.isDeleteBranch aria-label=Remove><md-icon class=node__menu-button-icon md-svg-icon=remove></md-icon></md-button><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); treeCtrl.execute(\'deleteRoot\', node.data.key)" ga-track-event="[\'node\', \'remove\', \'nodeButton\']" ng-if=node.isDeleteRoot aria-label=Remove><md-icon class=node__menu-button-icon md-svg-icon=remove></md-icon></md-button><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); treeCtrl.removeRelated(node.data.key)" ga-track-event="[\'node\', \'remove\', \'nodeButton\']" ng-if=node.data.value.related aria-label=Remove><md-icon class=node__menu-button-icon md-svg-icon=remove></md-icon></md-button></div><div ng-show=!treeCtrl.treeNodesCtrl.isExpanded><div class=node__more-button-container ng-show="nodeMenuCtrl.nodeCtrl.showExpand || nodeMenuCtrl.nodeCtrl.showCollapse"><md-button class="node__more-button node__more-button-expand" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.nodeCtrl.setChildren(true)" ng-show=nodeMenuCtrl.nodeCtrl.showExpand ga-track-event="[\'node\', \'expand\']" aria-label=More md-no-ink><md-icon class=node__more-button__icon md-svg-icon=arrow-right></md-icon></md-button><md-button class="node__more-button node__more-button-collapse" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.nodeCtrl.setChildren()" ng-show=nodeMenuCtrl.nodeCtrl.showCollapse ga-track-event="[\'node\', \'collapse\']" aria-label=More md-no-ink><md-icon class=node__more-button__icon md-svg-icon=arrow-left></md-icon></md-button></div><div class=node__prev-button-container><md-button class=node__nav-button ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.nodeCtrl.showPrev()" ng-show="nodeMenuCtrl.nodeCtrl.showNav && !nodeMenuCtrl.nodeCtrl.disablePrev" ga-track-event="[\'node\', \'prev\']" md-no-ink><md-icon md-svg-icon=arrow-up class="node__nav-button__next-icon node__nav-button__prev-icon-hide"></md-icon><md-icon md-svg-icon=arrow-up class="node__nav-button__next-icon node__nav-button__prev-icon-hide"></md-icon><md-icon md-svg-icon=arrow-up></md-icon></md-button></div><div class=node__next-button-container><md-button class=node__nav-button ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.nodeCtrl.showNext()" ng-show="nodeMenuCtrl.nodeCtrl.showNav && !nodeMenuCtrl.nodeCtrl.disableNext" ga-track-event="[\'node\', \'next\']" md-no-ink><md-icon md-svg-icon=arrow-down class="node__nav-button__next-icon node__nav-button__next-icon-hide"></md-icon><md-icon md-svg-icon=arrow-down class="node__nav-button__next-icon node__nav-button__next-icon-hide"></md-icon><md-icon md-svg-icon=arrow-down class=node__nav-button__next-icon></md-icon></md-button></div></div>'),e.put("partials/shared/tree-share-menu.html","<md-menu-content><tn-share-menu share-url=treeCtrl.shareUrl() url={{::treeCtrl.shortUrl}} close=treeShareMenuCtrl.close() publish=treeCtrl.publish() preview=treeCtrl.getPreview() container=treeCtrl.getNodesPreview() category=tree></tn-share-menu><md-menu-item ng-show=treeCtrl.hasYoutubeVideos><md-button title=\"Create a playlist\" ng-click=\"treeShareMenuCtrl.close(); treeCtrl.shareYoutube()\" ga-track-event=\"['tree', 'share', 'youtube']\" aria-label=\"Create playlist\"><md-icon md-svg-icon=youtube></md-icon>Youtube</md-button></md-menu-item><md-menu-item><md-button ng-click=treeShareMenuCtrl.close() ng-attr-data-clipboard-text=\"{{ ::treeCtrl.embedCode }}\" ga-track-event=\"['tree', 'share', 'embed']\" tn-clipboard><md-icon md-svg-icon=embed></md-icon>Embed</md-button></md-menu-item></md-menu-content>"),e.put("partials/shared/tree-sort-menu.html","<md-menu-content><md-subheader class=md-no-sticky>Sort by</md-subheader><md-menu-item><md-button ng-click=\"treeSortMenuCtrl.close(); treeCtrl.updateSort('timestamp'); treeCtrl.update()\" ga-track-event=\"['tree', 'sort', 'added']\"><md-icon md-svg-icon=check ng-style=\"{visibility: (treeCtrl.treeNodesCtrl.sortBy == 'timestamp') ? 'visible' : 'hidden'}\"></md-icon>Added</md-button></md-menu-item><md-menu-item><md-button ng-click=\"treeSortMenuCtrl.close(); treeCtrl.updateSort('visited'); treeCtrl.update()\" ng-disabled=\"::!(isExtension || isPage)\" ga-track-event=\"['tree', 'sort', 'visited']\"><md-icon md-svg-icon=check ng-style=\"{visibility: (treeCtrl.treeNodesCtrl.sortBy == 'visited') ? 'visible' : 'hidden'}\"></md-icon>Visited</md-button></md-menu-item><md-menu-item><md-button ng-click=\"treeSortMenuCtrl.close(); treeCtrl.updateSort('title'); treeCtrl.update()\" ga-track-event=\"['tree', 'sort', 'title']\"><md-icon md-svg-icon=check ng-style=\"{visibility: (treeCtrl.treeNodesCtrl.sortBy == 'title') ? 'visible' : 'hidden'}\"></md-icon>Title</md-button></md-menu-item><md-subheader class=md-no-sticky>Sort order</md-subheader><md-menu-item><md-button ng-click=\"treeSortMenuCtrl.close(); treeCtrl.treeNodesCtrl.sortOrder = !treeCtrl.treeNodesCtrl.sortOrder; treeCtrl.updateSort(); treeCtrl.update()\" ga-track-event=\"['tree', 'sort', 'order']\"><md-icon md-svg-icon=sort-ascending ng-hide=treeCtrl.treeNodesCtrl.sortOrder></md-icon><md-icon md-svg-icon=sort-descending ng-show=treeCtrl.treeNodesCtrl.sortOrder></md-icon>{{ (!treeCtrl.treeNodesCtrl.sortOrder) ? 'Ascending' : 'Descending' }}</md-button></md-menu-item></md-menu-content>"),e.put("partials/shared/tree.html",'<div class=tree-toolbar-outer><div class=tree-toolbar ng-click=treeMetaCtrl.closePreview() ga-track-event="[\'tree\', \'close\']"><div class=tree-avatar-container><img class=tree-avatar__image ng-src="{{ tree.value.meta.image || placeholderImage}}" ng-attr-alt="{{ ::tree.value.meta.title }}" tn-image-error></div><div class=tree-toolbar__search-container><div class=tree-toolbar__search ng-click=$event.stopPropagation() md-colors="::{backgroundColor: \'background-300\'}" layout=row layout-align="start center"><div class=tree-list-search><md-input-container md-no-float><md-icon md-svg-icon=search></md-icon><input type=search placeholder=Search ng-model=treeCtrl.searchText ng-model-options="::{ debounce: 500 }" ng-change=treeCtrl.search()></md-input-container></div><div><tn-tree-sort-menu><md-button class=md-icon-button ng-click="$event.stopPropagation(); treeSortMenuCtrl.open($event)" ga-track-event="[\'tree\', \'sortButton\']" aria-label="Tree sort"><md-tooltip>Sort</md-tooltip><md-icon md-svg-icon=sort></md-icon></md-button></tn-tree-sort-menu></div><div class=tree-legend__user-container ng-click=toggleUser(tree.value.meta.user) ng-if=tree.value.meta.user ga-track-event="[\'tree\', \'user\']" layout=row><div class=tree-legend__user-avatar-container><img class=tree-legend__user-avatar ng-src="{{ tree.value.meta.user.picture.data.url }}" ng-attr-alt="{{ tree.value.meta.user.name }}"></div><div class=tree-legend__user-title>{{ tree.value.meta.user.name }}</div></div></div></div><div class=tree-toolbar__container><div class=tree-toolbar__container-inner><h4 class=tree-toolbar__title>{{ tree.value.meta.title }}</h4><tn-like url="{{ ::treeCtrl.treeUrl }}" ng-if="!treeCtrl.editable || tree.value.meta.published"></tn-like><tn-tree-share-menu ng-show=treeCtrl.canShare()><md-button class="md-icon-button tree-toolbar_button tree-toolbar__share" title=Share ng-click="$event.stopPropagation(); treeShareMenuCtrl.open($event)" ga-track-event="[\'tree\', \'shareMenu\']" aria-label=Share><md-icon md-svg-icon=share></md-icon></md-button></tn-tree-share-menu></div></div><div class=tree-toolbar__tools ng-click="$event.stopPropagation(); treeMetaCtrl.closePreview()"><div class=tree-toolbar__tools-inner><tn-tree-menu><md-button class="md-icon-button tree-toolbar_button tree-toolbar__menu" title=Menu ng-click="$event.stopPropagation(); treeMenuCtrl.open($event)" ga-track-event="[\'tree\', \'menu\']" aria-label="Open menu"><md-icon md-svg-icon=dots></md-icon></md-button></tn-tree-menu><div><md-button class="md-icon-button tree-toolbar_button tree-toolbar__info" title=Info ng-click="$event.stopPropagation(); treeCtrl.openTreeDialog($event)" ga-track-event="[\'tree\', \'info\', \'opened\']" aria-label=Info><md-icon md-svg-icon="{{treeCtrl.editable && !treeCtrl.limitedEdit ? \'edit\' : \'info\'}}"></md-icon></md-button></div><div class=add ng-show="::!treeCtrl.editable || treeCtrl.limitedEdit"><md-button class=md-icon-button title=Add ng-click="$event.stopPropagation(); treeCtrl.add()" ng-disabled=tree.value.meta.isReposted ga-track-event="[\'tree\', \'add\']" aria-label=Add><md-icon md-svg-icon=add></md-icon></md-button></div><div><md-button class="md-icon-button tree__pin-icon-button tree-toolbar_button" ng-class="{\'md-accent\': tree.value.meta.pinned}" title=Pin aria-label="Pin tree" ng-click="$event.stopPropagation(); pinning.togglePin(treeCtrl.key)" ng-disabled="pinning.disabled && !tree.value.meta.pinned" ga-track-event="[\'tree\', \'pin\', \'opened\']"><md-icon md-svg-icon=pin></md-icon></md-button></div><div class=fav ng-if="::treeCtrl.editable && !treeCtrl.limitedEdit"><md-button class=md-icon-button title=Favorite aria-label=Favorite ng-click="$event.stopPropagation(); treeCtrl.toggleFavorite()" ng-class="{ \'md-accent\': tree.value.meta.favorite }" ga-track-event="[\'tree\', \'favorite\']"><md-icon md-svg-icon=favorite></md-icon></md-button></div><md-button class="md-icon-button pub" title=Publish ng-if="treeCtrl.editable && !treeCtrl.limitedEdit" aria-label=Publish ng-click="$event.stopPropagation(); treeCtrl.togglePublished()" ng-class="{ \'md-accent\': tree.value.meta.published }" ga-track-event="[\'tree\', \'publish\']"><md-icon md-svg-icon=public></md-icon></md-button><div class=list><md-button class=md-icon-button title=Expand ng-class="{ \'md-accent\': treeCtrl.treeNodesCtrl.isExpanded}" ng-click="$event.stopPropagation(); treeCtrl.updateExpandedView()" ng-disabled="treeCtrl.expandTreeDisabled || treeCtrl.treeNodesCtrl.isListed" ga-track-event="[\'tree\', \'expand\']"><md-icon md-svg-icon=fullscreen></md-icon></md-button><md-button class=md-icon-button title=List aria-label=List ng-class="{ \'md-accent\': treeCtrl.treeNodesCtrl.isListed }" ng-click="$event.stopPropagation(); treeCtrl.updateView(true)" ga-track-event="[\'tree\', \'list\']"><md-icon md-svg-icon=list></md-icon></md-button></div><div ng-hide=::!treeCtrl.editable><md-button class="md-icon-button undo" title=Undo ng-click="$event.stopPropagation(); treeCtrl.undo()" ng-disabled="tree.value.stack.pointer == 0" ga-track-event="[\'tree\', \'undo\']" aria-label=Undo><md-icon md-svg-icon=undo></md-icon></md-button><div class=redo><md-button class="md-icon-button redo" title=Redo ng-click="$event.stopPropagation(); treeCtrl.redo()" ng-disabled="tree.value.stack.pointer == tree.value.stack.length" ga-track-event="[\'tree\', \'redo\']" aria-label=Redo><md-icon md-svg-icon=redo></md-icon></md-button></div></div><md-button class="md-icon-button zoomin" title="Zoom in" ng-click="$event.stopPropagation(); treeCtrl.zoom(true)" ng-disabled="treeCtrl.treeNodesCtrl.isListed || treeCtrl.disableZoomIn" ga-track-event="[\'tree\', \'zoom-in\']" aria-label="Zoom in"><md-icon md-svg-icon=zoom-in></md-icon></md-button><div class=zoomout><md-button class="md-icon-button zoomout" title="Zoom out" ng-disabled="treeCtrl.treeNodesCtrl.isListed || treeCtrl.disableZoomOut" ng-click="$event.stopPropagation(); treeCtrl.zoom()" ga-track-event="[\'tree\', \'zoom-out\']" aria-label="Zoom out"><md-icon md-svg-icon=zoom-out></md-icon></md-button></div><md-button class="md-icon-button md-warn tree-toolbar__delete" aria-label="Delete tree" title="Delete tree" ng-click="$event.stopPropagation(); treeCtrl.deleteTreeDialog($event)" ng-if="::treeCtrl.editable && !treeCtrl.limitedEdit" ga-track-event="[\'tree\', \'delete\', \'opened\']"><md-icon md-svg-icon=delete></md-icon></md-button><div class=tree-page-close title=Close><img ng-click=closePageTree() src=/img/close-black.png></div></div></div></div></div><md-content class=tree-path ng-show=treeCtrl.treePath.length md-colors="::{backgroundColor: \'background-100\'}"><md-list class=md-dense flex layout=row layout-align="start center" layout-wrap><tn-node-path ng-repeat="node in treeCtrl.treePath track by node.data.key" flex=50 node=node last=$last open-url=treeCtrl.clickPath(node)></tn-node-path></md-list></md-content><md-content class=tree-body ng-class="{\'tree-body--vertical-layout\': treeCtrl.treeNodesCtrl.vertical}" style="height: 0"><div class=tree-nodes tabindex=0><div class="tree-nodes-inner is-animated" ng-hide="treeCtrl.treeNodesCtrl.isListed || !treeCtrl.nodes.length"><svg class=tree-svg width=100% height=100%><g class="link is-animated" ng-repeat="link in treeCtrl.links track by link.target.data.key" tn-link></g></svg><tn-node class="tree-node is-animated" ng-repeat="node in treeCtrl.nodes track by node.data.key" node=node open-url=treeCtrl.openUrl(key) container=treeCtrl.getNodesPreview() container-preview=treeCtrl.getPreview() tn-tree-item tn-tree-item-shared><node-menu tn-tree-node-menu><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.open($event)" ga-track-event="[\'node\', \'menu\', \'treeView\']" md-no-ink aria-label="Open menu"><md-icon class=node__menu-button-icon md-svg-icon=dots-white-small></md-icon></md-button></node-menu><node-share tn-share-node-menu><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.open($event)" ga-track-event="[\'node\', \'shareMenu\', \'treeView\']" md-no-ink aria-label="Open menu"><md-icon class=node__menu-button-icon md-svg-icon=share></md-icon></md-button></node-share><node-tools tn-tree-node-tools></node-tools><node-main tn-node-main-action></node-main></tn-node></div><md-list ng-show=treeCtrl.treeNodesCtrl.isListed><tn-node-listed class=is-animated ng-repeat="node in treeCtrl.listedNodes track by node.data.key" node=node open-url=treeCtrl.openUrl(key) container=treeCtrl.getNodesPreview() container-preview=treeCtrl.getPreview() tn-list-item tn-tree-item-shared><div tn-tree-node-menu include-share=true><md-button class="md-icon-button node__menu-button" ng-click="$event.preventDefault(); $event.stopPropagation(); nodeMenuCtrl.open($event)" ga-track-event="[\'node\', \'menu\', \'treeListView\']" md-no-ink aria-label="Open menu"><md-icon class=node__menu-button-icon md-svg-icon=dots></md-icon></md-button></div></tn-node-listed></md-list></div></md-content>'),e.put("partials/shared/user-images-dialog.html",'<md-dialog class=images-dialog id=user-images-dialog><md-dialog-content><md-toolbar><div class=md-toolbar-tools><h2 class=md-display-1><span>{{ userImagesDialog.title }}</span></h2><div flex></div><div><md-button class=md-icon-button ga-track-event="[\'userImagesDialog\', \'close\']" ng-click=$root.$mdDialog.cancel()><md-icon md-svg-icon=close></md-icon></md-button></div></div></md-toolbar><div layout=column flex><md-content ng-hide=!!userImagesDialog.images.length flex><div class=dialog-status-component ng-show=userImagesDialog.loading layout=column layout-align="center center"><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div class="md-body-1 dialog-status-component" ng-show=userImagesDialog.noResults layout=column layout-align="center center">No Results</div></md-content><md-content id=dialog-container ng-show=!!userImagesDialog.images.length flex><div class=bricklayer><div class=tree-image-container bricklayer-append ng-repeat="image in userImagesDialog.images track by image.link"><img class=tree-image ng-src="{{ ::image.link }}" tn-image-error><div class=tree-image-caption ng-if=::image.name md-colors="::{backgroundColor: \'primary-500\'}">{{ ::image.name }}</div></div></div></md-content></div></md-dialog-content></md-dialog>'),e.put("partials/shared/youtube-dialog.html","<md-dialog id=youtube-dialog aria-label=Edit><md-dialog-content><div id=autoplay-youtube-dialog><md-switch ng-model=youtubeIFrameDialogCtrl.autoplay ng-change=youtubeIFrameDialogCtrl.autoplayChange() md-invert>autoplay</md-switch></div><div id=close-youtube-dialog><md-button class=md-icon-button ng-click=$root.$mdDialog.cancel() ga-track-event=\"['youtube', 'close']\"><md-icon md-svg-icon=close></md-icon></md-button></div><iframe id=ytplayer width=560 height=315 frameborder=0 allowfullscreen></iframe></md-dialog-content></md-dialog>"),e.put("partials/shared/youtube-tree-dialog.html","<md-dialog id=youtube-tree-dialog><md-dialog-content><md-content><div id=youtube-tree-dialog-close-button><md-button class=md-icon-button ng-click=$root.$mdDialog.cancel() ga-track-event=\"['youtubeTreeDialog', 'close']\"><md-icon md-svg-icon=close></md-icon></md-button></div><div id=youtube-tree-dialog-complete ng-show=youtubeTreeDialog.complete><md-button href={{youtubeTreeDialog.playlistUrl}} target=_blank ga-track-event=\"['youtubeTreeDialog', 'openPlaylistUrl']\"><md-icon md-svg-icon=youtube></md-icon>Go to playlist</md-button><md-button ng-attr-data-clipboard-text={{youtubeTreeDialog.playlistUrl}} tn-clipboard ga-track-event=\"['youtubeTreeDialog', 'copyPlaylistUrl']\"><md-icon md-svg-icon=clipboard></md-icon>Copy Url</md-button></div><div id=youtube-tree-dialog-progress ng-hide=youtubeTreeDialog.complete><div>Processing...</div><md-progress-circular></md-progress-circular></div></md-content></md-dialog-content></md-dialog>"),e.put("partials/components/trees-search.html",'<md-autocomplete class=topbar-search ng-disabled=groupCtrl.disableAll md-items="item in treesSearchCtrl.searchText()" placeholder=Search md-min-length=3 md-delay=1000 md-search-text=groupCtrl.treesSearch.searchText md-selected-item=groupCtrl.treesSearch.selectedNode md-item-text=item.text md-search-text-change=treesSearchCtrl.search() md-selected-item-change=treesSearchCtrl.search()><span md-highlight-text=groupCtrl.treesSearch.searchText>{{ item.text }}</span></md-autocomplete>'),e.put("partials/components/trees-sort.html","<md-menu-content><md-subheader class=md-no-sticky>Sort by</md-subheader><md-menu-item><md-button ng-click=\"treesSortCtrl.close(); treesSortCtrl.update('created')\" ga-track-event=\"['trees', 'sort', 'created']\"><md-icon md-svg-icon=check ng-style=\"{visibility: (groupCtrl.sortBy == 'created') ? 'visible' : 'hidden'}\"></md-icon>Created</md-button></md-menu-item><md-menu-item><md-button ng-click=\"treesSortCtrl.close(); treesSortCtrl.update('modified')\" ga-track-event=\"['trees', 'sort', 'modified']\"><md-icon md-svg-icon=check ng-style=\"{visibility: (groupCtrl.sortBy == 'modified') ? 'visible' : 'hidden'}\"></md-icon>Modified</md-button></md-menu-item><md-menu-item><md-button ng-click=\"treesSortCtrl.close(); treesSortCtrl.update('title')\" ga-track-event=\"['trees', 'sort', 'title']\"><md-icon md-svg-icon=check ng-style=\"{visibility: (groupCtrl.sortBy == 'title') ? 'visible' : 'hidden'}\"></md-icon>Title</md-button></md-menu-item><md-subheader class=md-no-sticky>Sort order</md-subheader><md-menu-item><md-button ng-disabled=\"groupCtrl.disableSort || groupCtrl.disableAll\" ng-click=\"treesSortCtrl.close(); groupCtrl.sortOrder = !groupCtrl.sortOrder; treesSortCtrl.update()\" ga-track-event=\"['trees', 'sort', 'order']\"><md-icon md-svg-icon=sort-ascending ng-hide=groupCtrl.sortOrder></md-icon><md-icon md-svg-icon=sort-descending ng-show=groupCtrl.sortOrder></md-icon>{{ (!groupCtrl.sortOrder) ? 'Ascending' : 'Descending' }}</md-button></md-menu-item></md-menu-content>"),e.put("partials/components/logo.html",'<md-button class="md-icon-button menu_toggle" ng-click=mainCtrl.toggleNavSidbar() ga-track-event="[\'user\', \'toggle\']" aria-label="Toggle sidebar" md-colors="{background: \'primary-600-.72s\'}" md-no-ink><md-icon id=logo_menu md-svg-icon=menu></md-icon></md-button><span class=topbar-container__logo-container><span class=topbar-container__logo><a ui-sref=main.tab.session>Brancher</a></span></span><md-button class=md-icon-button id=new-tree-dialog-button ng-click=mainCtrl.openNewTreeDialog($event) ga-track-event="[\'trees\', \'newTree\']" aria-label="New tree"><md-tooltip>New Tree</md-tooltip><md-icon md-svg-icon=add></md-icon></md-button>'),e.put("partials/components/topbar-controls.html","<div id=toggle-friends-button><md-button class=\"md-icon-button topbar-icon_container\" ng-click=mainCtrl.toggleUsers() ga-track-event=\"['user', 'friends']\" aria-label=Users><md-tooltip ng-if=::!isMobile>Friends</md-tooltip><md-icon class=topbar-icon md-svg-icon=friends></md-icon></md-button></div><div id=topbar-useravatar-container><a ui-sref=\"main.tab.user({plusId: user.id})\" ng-if=user><img class=md-avatar ng-src=\"{{ ::user.picture }}\"></a><md-button class=md-icon-button ga-track-event=\"['user', 'login']\" style=\"margin: 0\" ng-if=!user ng-click=mainCtrl.login() aria-label=Login><md-tooltip ng-if=::!isMobile>Login</md-tooltip><md-icon id=topbar-login-icon md-svg-icon=login></md-icon></md-button></div><div id=app-menu-button><md-menu><md-button class=md-icon-button ng-click=$mdOpenMenu($event) ga-track-event=\"['user', 'menu']\" aria-label=\"App Menu\"><md-icon md-svg-icon=dots></md-icon></md-button><md-menu-content><md-menu-item><md-button ng-click=mainCtrl.openSettingsDialog($event) ga-track-event=\"['user', 'settings']\"><md-icon md-svg-icon=settings></md-icon>Settings</md-button></md-menu-item><md-menu-item><md-button ng-click=mainCtrl.openPublishListDialog($event) ga-track-event=\"['user', 'publishList']\"><md-icon md-svg-icon=public></md-icon>Publish List</md-button></md-menu-item><md-menu-item ng-if=::isExtension><md-button ng-click=mainCtrl.openIgnoreListDialog($event) ga-track-event=\"['user', 'ignoreList']\"><md-icon md-svg-icon=hide></md-icon>Ignore List</md-button></md-menu-item><md-menu-item ng-if=!!mainCtrl.userSubscriptions.subscriptions><md-button ng-click=mainCtrl.openSubscriptionsDialog($event) ga-track-event=\"['user', 'following']\"><md-icon md-svg-icon=people></md-icon>Following ({{ mainCtrl.userSubscriptions.subscriptions | numberAbbreviate }})</md-button></md-menu-item><md-menu-item ng-if=!!mainCtrl.userSubscriptions.subscribers><md-button ng-click=\"mainCtrl.openSubscriptionsDialog($event, true)\" ga-track-event=\"['user', 'followers']\"><md-icon md-svg-icon=people-outline></md-icon>Followers ({{ mainCtrl.userSubscriptions.subscribers | numberAbbreviate }})</md-button></md-menu-item><md-menu-item><md-button target=_blank ng-href=https://www.facebook.com/brancher.io ga-track-event=\"['user', 'help']\"><md-icon md-svg-icon=help></md-icon>Help</md-button></md-menu-item><md-menu-item ng-if=user><md-button ng-click=mainCtrl.logout() ga-track-event=\"['user', 'logout']\"><md-icon md-svg-icon=logout></md-icon>Logout</md-button></md-menu-item></md-menu-content></md-menu></div>"),e.put("partials/components/nav-sidebar.html",'<tn-inline-install ng-if=::!isExtension></tn-inline-install><tn-rating ng-if=!mainCtrl.initPromise></tn-rating><div><md-list><p class=nav-text__group-title>My<img id=lock-icon src=/img/lock.png></p><md-list-item class=nav-list-item ui-sref=main.tab.session ui-sref-active=tn-active aria-label=Session><md-icon class=view-button md-svg-icon=home></md-icon><div class="md-list-item-text nav-text"><span>Home</span> <span class=nav-text__count ng-show=mainCtrl.state.viewState.session>{{ mainCtrl.state.viewState.session }}</span></div></md-list-item><md-list-item class=nav-list-item ui-sref=main.tab.recommendations ui-sref-active=tn-active><md-icon class="material-icons view-button">new_releases</md-icon><div class="md-list-item-text nav-text">Recommended</div></md-list-item><md-list-item class=nav-list-item ng-if="isExtension || user" ui-sref=main.tab.favorites aria-label=Favorites ui-sref-active=tn-active><md-icon class=view-button md-svg-icon=favorite></md-icon><div class="md-list-item-text nav-text">Favorites <span class=nav-text__count ng-show=mainCtrl.state.viewState.favorites>{{ mainCtrl.state.viewState.favorites }}</span></div></md-list-item><p class=nav-text__group-title>Public</p><md-list-item class=nav-list-item ng-if=user ui-sref=main.tab.published ui-sref-active=tn-active aria-label=Published><md-icon class=view-button md-svg-icon=public></md-icon><div class="md-list-item-text nav-text">Published <span class=nav-text__count ng-show=mainCtrl.state.viewState.published>{{ mainCtrl.state.viewState.published }}</span></div></md-list-item><md-list-item class=nav-list-item ui-sref=main.tab.global ui-sref-active=tn-active aria-label=Trending><md-icon class="material-icons view-button">whatshot</md-icon><div class="md-list-item-text nav-text">Trending</div></md-list-item><md-list-item class=nav-list-item ui-sref=main.tab.feed ui-sref-active=tn-active ng-if=user aria-label=Feed><md-icon class="material-icons view-button">view_stream</md-icon><div class="md-list-item-text nav-text">Feed <span class=nav-text__count ng-show=mainCtrl.state.viewState.feed>{{ mainCtrl.state.viewState.feed }}</span></div></md-list-item><md-list-item class=nav-list-item ui-sref=main.tab.shared ui-sref-active=tn-active aria-label="Shared with me"><md-icon class=view-button md-svg-icon=shared></md-icon><div class="md-list-item-text nav-text">Shared with me</div></md-list-item><md-divider class=if-divider></md-divider><md-list-item class=nav-list-item ui-sref=main.list ui-sref-active=tn-active aria-label=History><md-icon class=view-button md-svg-icon=history></md-icon><div class="md-list-item-text nav-text">History</div></md-list-item><md-divider class=if-divider></md-divider></md-list></div><div ng-show=mainCtrl.recentUsers.length><md-list><md-list-item class=recent-user ng-repeat="recentUser in mainCtrl.recentUsers track by (recentUser.id || recentUser.plusId)" ui-sref="main.tab.user({userId: recentUser.id || \'\', plusId: recentUser.plusId || \'\'})" ui-sref-active=user-selected aria-label="Select friend"><img class=md-avatar ng-src="{{ ::recentUser.picture.data.url }}" alt="{{ ::recentUser.name }}"><p>{{ ::recentUser.name }}</p></md-list-item></md-list><md-divider class=if-divider></md-divider></div><div id=app-like><tn-like url="{{ ::mainCtrl.APP_URL }}" width=176 height=28 share=true like-layout=button_count></tn-like></div><div id=footer><a href="{{ ::mainCtrl.APP_URL + \'/privacy\' }}" target=_blank>Privacy Policy</a> <a href="{{ ::mainCtrl.APP_URL + \'/terms\' }}" target=_blank>Terms of Service</a></div><div id=trending ng-if=trending><h4 id=trending-header class=md-title>Discover</h4><div id=trending-tags-section class=trending-section><div class=trending-item ng-repeat="tag in trending.tags track by tag"><a ui-sref="main.tab.tag({tag: tag})">{{::tag}}</a></div></div><div id=trending-domains-section class=trending-section><div class=trending-item ng-repeat="domain in trending.domains track by domain"><a ui-sref="main.tab.domain({domain: domain})">{{::domain | www}}</a></div></div></div>'),e.put("partials/components/onboarding.html","<md-dialog id=onboarding-dialog><md-dialog-content><md-content class=main-promo-section><div id=onboarding-dialog-close><md-button class=md-icon-button ng-click=$root.$mdDialog.cancel() ga-track-event=\"['onboarding', 'close']\"><md-icon md-svg-icon=close></md-icon></md-button></div><h1 id=onboarding-title class=md-display-1>Brancher</h1><div ng-hide=$root.isExtension><div id=onboarding-install-text class=md-body-2>Install chrome extension to create trees from your browser history</div><div id=onboarding-inline-install><tn-inline-install></tn-inline-install></div></div><div id=onboarding-video-text class=md-body-1>Watch this short screencast to see how to create a tree</div><div class=promo-video><iframe width=560 height=315 src=https://www.youtube.com/embed/9ecRuRWn2dI frameborder=0 allowfullscreen></iframe></div><div class=main-promo-text><div class=main-promo-text-unit><div class=main-promo-text__image><img src=https://brancher.io/img/welcome/lock.png></div><div class=main-promo-text__text>Fully secure and free browser history. Control access to every link in your history with privacy settings. Three layers of access: private (only you), shared (your friends) and public. By default it’s private.</div></div><div class=main-promo-text-unit><div class=main-promo-text__image><img src=https://brancher.io/img/welcome/tree.png></div><div class=main-promo-text__text>Revolutionary new way to record and display browser history. Ideal for online research. In the cloud. Semantic. Practical.</div></div><div class=main-promo-text-unit><div class=main-promo-text__image><img src=https://brancher.io/img/welcome/people.png></div><div class=main-promo-text__text>Share up to a 100 links grouped automatically or manually. Let your friends see all the great stuff you find online. And follow them back to stay up to date.</div></div><div class=main-promo-text-unit><div class=main-promo-text__image><img src=https://brancher.io/img/welcome/reader.png></div><div class=main-promo-text__text>Clear and pleasant Article Reader. Fast. Smart.</div></div><div class=main-promo-text-unit><div class=main-promo-text__image><img src=https://brancher.io/img/welcome/search.png></div><div class=main-promo-text__text>Powerful search and tons of relevant content. Recommendations. Feed. Trends.</div></div><div class=main-promo-text-unit><div class=main-promo-text__image><img src=https://brancher.io/img/welcome/tab.png></div><div class=main-promo-text__text>Simple tab manager that makes it easy keeping your browser windows clean and organized.</div></div><div class=main-promo-text-unit><div class=main-promo-text__image><img src=https://brancher.io/img/welcome/tablet.png></div><div class=main-promo-text__text>Access your history from anywhere. Any device.</div></div></div></md-content></md-dialog-content></md-dialog>"),e.put("partials/components/rating.html",'<div id=rating-container ng-hide=ratingCtrl.isHidden()><div class=md-title>Rate us!</div><md-icon class=rating-star md-svg-icon="{{ ($index <= ratingCtrl.mouseOverIndex) ? \'star\' : \'star-border\' }}" ng-click="ratingCtrl.rate($event, $index)" ng-repeat="star in ::ratingCtrl.stars track by $index" ng-mouseenter="ratingCtrl.mouseOverIndex = $index" ng-mouseleave="ratingCtrl.mouseOverIndex = -1"></md-icon></div>'),e.put("partials/components/complaint-dialog.html",'<md-dialog id=complaint-dialog><form name=form><md-dialog-content class=md-dialog-content><div>Help us improve!</div><div><md-input-container class=complaint-dialog-input><textarea ng-model=vm.complaint rows=5 md-select-on-focus></textarea></md-input-container></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-warn ng-click=vm.submit() ng-disabled="!vm.complaint || form.$pristine">Submit</md-button></md-dialog-actions></form></md-dialog>'),e.put("partials/components/tree-meta.html","<div class=tree-meta-list-item-container ng-class=\"::{\n     'tree-meta--not-seen': !treeMeta.value.seen && treeMeta.value.editable,\n     'tree-meta-feed-item-container': $state.includes('main.tab.feed') && !treeMeta.value.editable,\n"+'     \'tree-meta--editable\': treeMeta.value.editable && !treeMeta.value.limitedEdit}"><div class=tree-avatar-container><img class=tree-avatar__image ng-src="{{ treeMeta.value.image || placeholderImage}}" ng-attr-alt="{{ ::treeMeta.value.title }}" tn-image-error><div class=tree-meta__minimap-container ng-if=::treeMetaCtrl.minimapUrl><img class=md-whiteframe-z1 ng-src={{::treeMetaCtrl.minimapUrl}} tn-image-error alt=Minimap></div></div><md-list-item class="secondary-button-padding tree-meta-list-item" ng-click="$event.preventDefault(); treeMetaCtrl.togglePreview()" ng-href="{{ ::treeMetaCtrl.treeUrl }}" ga-track-event="[\'tree\', \'open\']" md-no-ink tn-tree-tooltip><div class="md-list-item-text tree-meta__container"><div class=tree-meta__drag-handle><md-icon md-svg-icon=drag-vertical></md-icon></div><div class="md-title tree-meta__title-container tree-meta__title"><span><span tn-tree-meta-text=title></span></span></div><div><md-button class="md-icon-button tree-meta__info-icon-button" title=Info/Edit/Comments aria-label="Tree info" ng-click="$event.preventDefault(); $event.stopPropagation(); treeMetaCtrl.openTreeDialog($event)" ga-track-event="[\'tree\', \'info\', \'closed\']"><md-icon md-svg-icon="{{treeMeta.value.editable && !treeMeta.value.limitedEdit ? \'edit\' : \'info\'}}"></md-icon></md-button></div><div><md-button class="md-icon-button tree-meta__pin-icon-button" title=Pin ng-class="{\'md-accent\': treeMeta.value.pinned}" aria-label="Pin tree" ng-disabled="pinning.disabled && !treeMeta.value.pinned" ng-click="$event.preventDefault(); $event.stopPropagation(); pinning.togglePin(treeMeta.key)" ga-track-event="[\'tree\', \'pin\', \'closed\']"><md-icon md-svg-icon=pin></md-icon></md-button></div><div class="md-caption tree-meta__title-container tree-meta__description" flex><span><span tn-tree-meta-text=description></span></span></div><div ng-show=treeMeta.value.newLinks><span class=tree-meta__count md-colors="::{backgroundColor: \'orange-700\'}">+{{ treeMeta.value.newLinks }} NEW</span></div></div><md-button class="md-secondary tree-meta__user-container" title="Open user profile" ng-click="$event.preventDefault(); $event.stopPropagation(); toggleUser(treeMeta.value.user)" aria-label="User profile"><img class=tree-meta__user-image ng-src="{{ ::treeMeta.value.user.picture.data.url }}" ng-attr-alt="{{ ::treeMeta.value.user.name }}"> <span class=tree-meta__user-name>{{ ::treeMeta.value.user.name }}</span></md-button><div class="md-secondary counter-container tree_meta__added-count" title=Reposts><span><i class="material-icons tree-meta__material-icons">share</i> <span tn-tree-meta-text=addedCount></span></span></div><div class="md-secondary counter-container tree_meta__views-count" title=Views><span><i class="material-icons tree-meta__material-icons">remove_red_eye</i> <span tn-tree-meta-text=views></span></span></div><div class="md-secondary counter-container tree-meta__nodes-count" title="Links count"><span><i class="material-icons tree-meta__material-icons">filter_none</i> <span tn-tree-meta-text=count></span></span></div><md-button class="md-secondary md-warn md-icon-button tree-meta__delete-icon-button" aria-label="Delete tree" ng-click="$event.preventDefault(); $event.stopPropagation(); treeMetaCtrl.deleteTreeDialog($event)" ng-if="::treeMeta.value.editable && !treeMeta.value.limitedEdit" ga-track-event="[\'tree\', \'delete\', \'closed\']"><md-icon md-svg-icon=delete></md-icon></md-button><md-progress-circular class="md-secondary tree-progress" ng-show=treeMeta.value.loading md-mode=indeterminate></md-progress-circular></md-list-item></div>'),e.put("partials/views/main.html",'<div id=nav-sidebar-container ng-scrollbars ng-scrollbars-update=mainCtrl.updateSidebarScroll ng-scrollbars-config=::mainCtrl.sidebarScrollConfig><md-sidenav id=nav-sidebar class="md-sidenav-left is-animated sidebar" md-component-id=nav-sidebar md-is-locked-open=mainCtrl.showNav><div layout=column ng-include="\'partials/components/nav-sidebar.html\'"></div></md-sidenav></div><div id=main-container-inner ui-view flex></div><div ng-controller="UsersCtrl as usersCtrl" ng-include="\'partials/views/users.html\'" onload=usersCtrl.onload()></div>')}])},function(e,t,n){e.exports=n(1)(33)},function(e,t,n){e.exports=n(1)(11)},function(e,t,n){e.exports=n(1)(17)},function(e,t,n){e.exports=n(1)(18)},function(e,t,n){e.exports=n(1)(25)},function(e,t,n){e.exports=n(1)(44)},function(e,t,n){e.exports=n(1)(46)},function(e,t,n){e.exports=n(1)(48)},function(e,t,n){e.exports=n(1)(27)},function(e,t,n){e.exports=n(1)(51)},function(e,t,n){e.exports=n(1)(52)},function(e,t,n){e.exports=n(1)(53)},function(e,t,n){e.exports=n(1)(54)},function(e,t,n){e.exports=n(1)(55)},function(e,t){!function(e,t){function n(t,n){var o,i,a,s=t.nodeName.toLowerCase();return"area"===s?(o=t.parentNode,i=o.name,!(!t.href||!i||"map"!==o.nodeName.toLowerCase())&&(!!(a=e("img[usemap=#"+i+"]")[0])&&r(a))):(/input|select|textarea|button|object/.test(s)?!t.disabled:"a"===s?t.href||n:n)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var o=0,i=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,r){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var r,o,i=e(this[0]);i.length&&i[0]!==document;){if(("absolute"===(r=i.css("position"))||"relative"===r||"fixed"===r)&&(o=parseInt(i.css("zIndex"),10),!isNaN(o)&&0!==o))return o;i=i.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++o)})},removeUniqueId:function(){return this.each(function(){i.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),o=isNaN(r);return(o||r>=0)&&n(t,!o)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function o(t,n,r,o){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),o&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i="Width"===r?["Left","Right"]:["Top","Bottom"],a=r.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?s["inner"+r].call(this):this.each(function(){e(this).css(a,o(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return"number"!=typeof t?s["outer"+r].call(this,t):this.each(function(){e(this).css(a,o(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var o,i=e.ui[t].prototype;for(o in r)i.plugins[o]=i.plugins[o]||[],i.plugins[o].push([n,r[o]])},call:function(e,t,n){var r,o=e.plugins[t];if(o&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;o.length>r;r++)e.options[o[r][0]]&&o[r][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var r=n&&"left"===n?"scrollLeft":"scrollTop",o=!1;return t[r]>0||(t[r]=1,o=t[r]>0,t[r]=0,o)}})}(jQuery),function(e,t){var n=0,r=Array.prototype.slice,o=e.cleanData;e.cleanData=function(t){for(var n,r=0;null!=(n=t[r]);r++)try{e(n).triggerHandler("remove")}catch(e){}o(t)},e.widget=function(n,r,o){var i,a,s,c,l={},u=n.split(".")[0];n=n.split(".")[1],i=u+"-"+n,o||(o=r,r=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[u]=e[u]||{},a=e[u][n],s=e[u][n]=function(e,n){return this._createWidget?(arguments.length&&this._createWidget(e,n),t):new s(e,n)},e.extend(s,a,{version:o.version,_proto:e.extend({},o),_childConstructors:[]}),c=new r,c.options=e.widget.extend({},c.options),e.each(o,function(n,o){return e.isFunction(o)?(l[n]=function(){var e=function(){return r.prototype[n].apply(this,arguments)},t=function(e){return r.prototype[n].apply(this,e)};return function(){var n,r=this._super,i=this._superApply;return this._super=e,this._superApply=t,n=o.apply(this,arguments),this._super=r,this._superApply=i,n}}(),t):(l[n]=o,t)}),s.prototype=e.widget.extend(c,{widgetEventPrefix:a?c.widgetEventPrefix:n},l,{constructor:s,namespace:u,widgetName:n,widgetFullName:i}),a?(e.each(a._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,s,n._proto)}),delete a._childConstructors):r._childConstructors.push(s),e.widget.bridge(n,s)},e.widget.extend=function(n){for(var o,i,a=r.call(arguments,1),s=0,c=a.length;c>s;s++)for(o in a[s])i=a[s][o],a[s].hasOwnProperty(o)&&i!==t&&(n[o]=e.isPlainObject(i)?e.isPlainObject(n[o])?e.widget.extend({},n[o],i):e.widget.extend({},i):i);return n},e.widget.bridge=function(n,o){var i=o.prototype.widgetFullName||n;e.fn[n]=function(a){var s="string"==typeof a,c=r.call(arguments,1),l=this;return a=!s&&c.length?e.widget.extend.apply(null,[a].concat(c)):a,s?this.each(function(){var r,o=e.data(this,i);return o?e.isFunction(o[a])&&"_"!==a.charAt(0)?(r=o[a].apply(o,c),r!==o&&r!==t?(l=r&&r.jquery?l.pushStack(r.get()):r,!1):t):e.error("no such method '"+a+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+a+"'")}):this.each(function(){var t=e.data(this,i);t?t.option(a||{})._init():e.data(this,i,new o(a,this))}),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var o,i,a,s=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(s={},o=n.split("."),n=o.shift(),o.length){for(i=s[n]=e.widget.extend({},this.options[n]),a=0;o.length-1>a;a++)i[o[a]]=i[o[a]]||{},i=i[o[a]];if(n=o.pop(),r===t)return i[n]===t?null:i[n];i[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];s[n]=r}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(n,r,o){var i,a=this;"boolean"!=typeof n&&(o=r,r=n,n=!1),o?(r=i=e(r),this.bindings=this.bindings.add(r)):(o=r,r=this.element,i=this.widget()),e.each(o,function(o,s){function c(){return n||!0!==a.options.disabled&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?a[s]:s).apply(a,arguments):t}"string"!=typeof s&&(c.guid=s.guid=s.guid||c.guid||e.guid++);var l=o.match(/^(\w+)\s*(.*)$/),u=l[1]+a.eventNamespace,d=l[2];d?i.delegate(d,u,c):r.bind(u,c)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var o,i,a=this.options[t];if(r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],i=n.originalEvent)for(o in i)o in n||(n[o]=i[o]);return this.element.trigger(n,r),!(e.isFunction(a)&&!1===a.apply(this.element[0],[n].concat(r))||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,o,i){"string"==typeof o&&(o={effect:o});var a,s=o?!0===o||"number"==typeof o?n:o.effect||n:t;o=o||{},"number"==typeof o&&(o={duration:o}),a=!e.isEmptyObject(o),o.complete=i,o.delay&&r.delay(o.delay),a&&e.effects&&e.effects.effect[s]?r[t](o):s!==t&&r[s]?r[s](o.duration,o.easing,i):r.queue(function(n){e(this)[t](),i&&i.call(r[0]),n()})}})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var r=this,o=1===n.which,i=!("string"!=typeof this.options.cancel||!n.target.nodeName)&&e(n.target).closest(this.options.cancel).length;return!(o&&!i&&this._mouseCapture(n))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=!1!==this._mouseStart(n),!this._mouseStarted)?(n.preventDefault(),!0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,!0))}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e){function t(e,t,n){return e>t&&t+n>e}function n(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===e.axis||n(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){"disabled"===t?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=null,o=!1,i=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,i.widgetName+"-item")===i?(r=e(this),!1):void 0}),e.data(t.target,i.widgetName+"-item")===i&&(r=e(t.target)),!!r&&(!(this.options.handle&&!n&&(e(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(o=!0)}),!o))&&(this.currentItem=r,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(t,n,r){var o,i,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(i=this.document.find("body"),this.storedCursor=i.css("cursor"),i.css("cursor",a.cursor),this.storedStylesheet=e("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(i)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(o=this.containers.length-1;o>=0;o--)this.containers[o]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,r,o,i,a=this.options,s=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+a.scrollSpeed:t.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+a.scrollSpeed:t.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(t.pageY-e(document).scrollTop()<a.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-a.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<a.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+a.scrollSpeed)),t.pageX-e(document).scrollLeft()<a.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-a.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<a.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+a.scrollSpeed))),!1!==s&&e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--)if(r=this.items[n],o=r.item[0],(i=this._intersectsWithPointer(r))&&r.instance===this.currentContainer&&o!==this.currentItem[0]&&this.placeholder[1===i?"next":"prev"]()[0]!==o&&!e.contains(this.placeholder[0],o)&&("semi-dynamic"!==this.options.type||!e.contains(this.element[0],o))){if(this.direction=1===i?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var r=this,o=this.placeholder.offset(),i=this.options.axis,a={};i&&"x"!==i||(a.left=o.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),i&&"y"!==i||(a.top=o.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,o=r+this.helperProportions.height,i=e.left,a=i+e.width,s=e.top,c=s+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||r+l>s&&c>r+l,m="y"===this.options.axis||t+u>i&&a>t+u,p=d&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>i&&a>n-this.helperProportions.width/2&&r+this.helperProportions.height/2>s&&c>o-this.helperProportions.height/2},_intersectsWithPointer:function(e){var n="x"===this.options.axis||t(this.positionAbs.top+this.offset.click.top,e.top,e.height),r="y"===this.options.axis||t(this.positionAbs.left+this.offset.click.left,e.left,e.width),o=n&&r,i=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return!!o&&(this.floating?a&&"right"===a||"down"===i?2:1:i&&("down"===i?2:1))},_intersectsWithSides:function(e){var n=t(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),r=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),o=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return this.floating&&i?"right"===i&&r||"left"===i&&!r:o&&("down"===o&&n||"up"===o&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n,r,o,i,a=[],s=[],c=this._connectWith();if(c&&t)for(n=c.length-1;n>=0;n--)for(o=e(c[n]),r=o.length-1;r>=0;r--)(i=e.data(o[r],this.widgetFullName))&&i!==this&&!i.options.disabled&&s.push([e.isFunction(i.options.items)?i.options.items.call(i.element):e(i.options.items,i.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),i]);for(s.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),n=s.length-1;n>=0;n--)s[n][0].each(function(){a.push(this)});return e(a)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;t.length>n;n++)if(t[n]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n,r,o,i,a,s,c,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(n=m.length-1;n>=0;n--)for(o=e(m[n]),r=o.length-1;r>=0;r--)(i=e.data(o[r],this.widgetFullName))&&i!==this&&!i.options.disabled&&(d.push([e.isFunction(i.options.items)?i.options.items.call(i.element[0],t,{item:this.currentItem}):e(i.options.items,i.element),i]),this.containers.push(i));for(n=d.length-1;n>=0;n--)for(a=d[n][1],s=d[n][0],r=0,l=s.length;l>r;r++)c=e(s[r]),c.data(this.widgetName+"-item",a),u.push({item:c,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,r,o,i;for(n=this.items.length-1;n>=0;n--)r=this.items[n],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(o=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=o.outerWidth(),r.height=o.outerHeight()),i=o.offset(),r.left=i.left,r.top=i.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)i=this.containers[n].element.offset(),this.containers[n].containerCache.left=i.left,this.containers[n].containerCache.top=i.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var n,r=t.options;r.placeholder&&r.placeholder.constructor!==String||(n=r.placeholder,r.placeholder={element:function(){var r=t.currentItem[0].nodeName.toLowerCase(),o=e("<"+r+">",t.document[0]).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===r?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(o)}):"img"===r&&o.attr("src",t.currentItem.attr("src")),n||o.css("visibility","hidden"),o},update:function(e,o){(!n||r.forcePlaceholderSize)&&(o.height()||o.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder)},_contactContainers:function(r){var o,i,a,s,c,l,u,d,m,p,h=null,g=null;for(o=this.containers.length-1;o>=0;o--)if(!e.contains(this.currentItem[0],this.containers[o].element[0]))if(this._intersectsWith(this.containers[o].containerCache)){if(h&&e.contains(this.containers[o].element[0],h.element[0]))continue;h=this.containers[o],g=o}else this.containers[o].containerCache.over&&(this.containers[o]._trigger("out",r,this._uiHash(this)),this.containers[o].containerCache.over=0);if(h)if(1===this.containers.length)this.containers[g].containerCache.over||(this.containers[g]._trigger("over",r,this._uiHash(this)),this.containers[g].containerCache.over=1);else{for(a=1e4,s=null,p=h.floating||n(this.currentItem),c=p?"left":"top",l=p?"width":"height",u=this.positionAbs[c]+this.offset.click[c],i=this.items.length-1;i>=0;i--)e.contains(this.containers[g].element[0],this.items[i].item[0])&&this.items[i].item[0]!==this.currentItem[0]&&(!p||t(this.positionAbs.top+this.offset.click.top,this.items[i].top,this.items[i].height))&&(d=this.items[i].item.offset()[c],m=!1,Math.abs(d-u)>Math.abs(d+this.items[i][l]-u)&&(m=!0,d+=this.items[i][l]),a>Math.abs(d-u)&&(a=Math.abs(d-u),s=this.items[i],this.direction=m?"up":"down"));if(!s&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[g])return;s?this._rearrange(r,s,null,!0):this._rearrange(r,null,this.containers[g].element,!0),this._trigger("change",r,this._uiHash()),this.containers[g]._trigger("change",r,this._uiHash(this)),this.currentContainer=this.containers[g],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[g]._trigger("over",r,this._uiHash(this)),this.containers[g].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):"clone"===n.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||e("parent"!==n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||n.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,o=this.options;"parent"===o.containment&&(o.containment=this.helper[0].parentNode),("document"===o.containment||"window"===o.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===o.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===o.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(o.containment)||(t=e(o.containment)[0],n=e(o.containment).offset(),r="hidden"!==e(t).css("overflow"),this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,n){n||(n=this.position);var r="absolute"===t?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(o[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:o.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:o.scrollLeft())*r}},_generatePosition:function(t){var n,r,o=this.options,i=t.pageX,a=t.pageY,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,c=/(html|body)/i.test(s[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(i=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(i=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),o.grid&&(n=this.originalPageY+Math.round((a-this.originalPageY)/o.grid[1])*o.grid[1],a=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-o.grid[1]:n+o.grid[1]:n,r=this.originalPageX+Math.round((i-this.originalPageX)/o.grid[0])*o.grid[0],i=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-o.grid[0]:r+o.grid[0]:r)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():c?0:s.scrollTop()),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():c?0:s.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var o=this.counter;this._delay(function(){o===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){this.reverting=!1;var n,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)("auto"===this._storedCSS[n]||"static"===this._storedCSS[n])&&(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),n=this.containers.length-1;n>=0;n--)t||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),n=0;r.length>n;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(n=0;r.length>n;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery)}]);